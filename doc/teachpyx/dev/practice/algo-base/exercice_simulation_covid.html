<!doctype html>
<html class="no-js" lang="fr" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Recherche" href="../../search.html" /><link rel="next" title="L’énigme d’Einstein et sa résolution" href="../../auto_examples/plot_einstein_riddle.html" /><link rel="prev" title="Modèle épidémiologique (SIRD)" href="exercice_simulation_covid_simple.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.08.19 -->
        <title>Simulation COVID - Documentation teachpyx 0.3.1</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Documentation teachpyx 0.3.1</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/project_ico.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Documentation teachpyx 0.3.1</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Recherche" name="q" aria-label="Recherche">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../py/index.html">Le langage Python</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Le langage Python</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_lang/index.html">Variables et fonctions</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Variables et fonctions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_lang/types.html">Types et variables du langage python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_lang/syntaxe.html">Syntaxe du langage Python (boucles, tests, fonctions)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_lang/constructions.html">Constructions classiques</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_lang/collections.html">Constructions classiques</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_lang/dates.html">Dates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_lang/encoding.html">Encoding et jeux de caractères</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_classes/index.html">Classes</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_classes/classes.html">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_classes/questions.html">Questions</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_exception/index.html">Exceptions</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Exceptions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_exception/exception.html">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_exception/exception_ext.html">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_exception/warning.html">Warning et logging</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_module/index.html">Entrées, Sorties, Modules</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Entrées, Sorties, Modules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_module/files.html">Fichiers</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../py/c_module/serialization.html">Sérialisation</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Sérialisation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../auto_examples/plot_serialisation_examples.html">Sérialisation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_module/module.html">Module ou extension</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_regex/index.html">Expressions régulières</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Expressions régulières</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_regex/regex.html">Expressions régulières</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_parallelisation/index.html">Parallélisation</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Parallélisation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_parallelisation/thread.html">Threads</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../py/c_gui/index.html">Interfaces graphiques</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Interfaces graphiques</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../py/c_gui/tkinter.html">tkinter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../c_data/index.html">Matrices et DataFrames</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Matrices et DataFrames</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../c_data/matrices.html">Calcul matriciel</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Calcul matriciel</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../c_data/nb_array.html">Calcul Matriciel, Optimisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../c_data/nb_numpy.html">Calcul matriciel avec numpy (version courte)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../c_data/dataframes.html">Dataframes</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Dataframes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../c_data/nb_dataframe.html">DataFrame et Graphes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../c_data/nb_pandas.html">Manipulation de données avec pandas (version courte)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../c_resume/index.html">Précis</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Précis</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../c_resume/python_sheet.html">Cheat sheet: Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../c_resume/conseil_programmes.html">Quelques conseils pour écrire un programme</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../articles/index.html">Collections d’articles inclassables</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Collections d’articles inclassables</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../articles/2023-09-06-ensae.html">2023-09-06 : ENSAE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../articles/2023-08-09-hermionne.html">2023-08-09 : l’énigme d’Hermionne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../articles/2023-08-03-code-jam.html">2023-08-03 : Code Jam</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../articles/2022-12-07-cartopy.html">2022-12-07 : Utilisation de cartopy sous Windows (sous WSL)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exercices</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../index_python.html">Exercices sur le langage python</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of Exercices sur le langage python</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../py-base/code_liste_tuple.html">Liste, tuple, ensemble, dictionnaire, liste chaînée, coût des opérations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/nbheap.html">Heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/structures_donnees_conversion.html">D’une structure de données à l’autre</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/recherche_dichotomique.html">Recherche dichotomique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/exercice_hash.html">Répartition, table de hashage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/classes_metro.html">Un bref aperçu des classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/classes_2048.html">2048 et les classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/pivot_gauss.html">Pivot de gauss avec numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/coloriage_carre.html">Jeux de coloriage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/code_multinomial.html">Simuler une loi multinomiale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/tableau_contingence.html">Calculer un chi 2 sur un tableau de contingence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/tri_nlnd.html">Tri plus rapide que prévu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/histogramme_rapide.html">Histogramme et dictionnaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/exercice_pi.html">Calculs de surface et autres calculs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/profiling_example.html">Exemple de profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/profile_gini.html">Profiling la fonction Gini</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/profiling_conv.html">Profiling, application à la convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/exercice_regex.html">Expressions régulières</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/exercice_json_xml.html">JSON - XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py-base/exercice_serialisation_json.html">Sérialisation avec JSON, XML, pickle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/premiers_pas.html">Premiers pas en Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/variable_boucle_tests.html">Variables, boucles, tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/dictionnaire_vigenere.html">Dictionnaires, fonctions, code de Vigenère</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/module_file_regex.html">Modules, fichiers, expressions régulières</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/integrale_rectangle.html">Intégrale et la méthode des rectangles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/j2048.html">2048 - stratégie gagnante</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/texte_langue.html">Deviner la langue d’un texte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/pyramide_bigarree.html">Tracer une pyramide bigarrée</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/classes_carre_magique.html">Classes, méthodes, attributs, opérateurs et carré magique</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/classes_heritage.html">Classes, héritage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/premiers_pas_correction.html">Premiers pas en Python (correction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/variable_boucle_tests_correction.html">Variables, boucles, tests (correction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/dictionnaire_vigenere_correction.html">Dictionnaires, fonctions, code de Vigenère (correction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/module_file_regex_correction.html">Modules, fichiers, expressions régulières (correction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/integrale_rectangle_correction.html">Intégrale et la méthode des rectangles - correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/j2048_correction.html">2048 - stratégie gagnante - correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/texte_langue_correction.html">Deviner la langue d’un texte (correction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/pyramide_bigarree_correction.html">Tracer une pyramide bigarrée - correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/classes_carre_magique_correction.html">Classes, méthodes, attributs, opérateurs et carré magique (correction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tds-base/classes_heritage_correction.html">Classes, héritage (correction)</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index_algo.html">Algorithmes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Algorithmes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="matrix_dictionary.html">Produit matriciel avec une matrice creuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_echelle.html">Calculer le nombre de façons de monter une échelle.</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_plus_grande_somme.html">La sous-séquence de plus grande somme</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_xn.html">Calculer x**n le plus rapidement possible</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_topk.html">Les k premiers éléments (top k)</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_suffix.html">Algo - jeux de dictionnaires, plus grand suffixe commun</a></li>
<li class="toctree-l2"><a class="reference internal" href="BJKST.html">Algorithmes de streaming, BJKST</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_editdist.html">Distance entre deux mots de même longueur et tests unitaires</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_edit_distance.html">Distance d’édition</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_ordonnancement.html">Algo - Problème d’ordonnancement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auto_examples/plot_tsp.html">Réflexions autour du voyage de commerce (TSP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_tsp.html">TSP - Traveling Salesman Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="tsp_aparte.html">Aparté sur le voyageur de commerce</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_compose_connexe.html">Graphe et Composantes connexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_random_graph.html">Graphes aléatoires</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercice_simulation_covid_simple.html">Modèle épidémiologique (SIRD)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Simulation COVID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auto_examples/plot_einstein_riddle.html">L’énigme d’Einstein et sa résolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algo-compose/paris_parcours.html">Parcourir les rues de Paris</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algo-compose/vigenere.html">Casser le code de Vigenère</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algo-compose/exercice_morse.html">Décoder du Morse sans espaces</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../index_exam.html">Séances minutées</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Séances minutées</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exams.html">Exercices minutés</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Exercices minutés</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2013_coloriage_correction.html">1A.e - TD noté, 27 novembre 2012 (coloriage, correction)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2013_bout_de_code_coloriage.html">1A.e - TD noté, 27 novembre 2012 (éléments de code pour le coloriage)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2015.html">1A.e - TD noté, 5 décembre 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2015_rattrapage_enonce.html">1A.e - TD noté 2015 rattrapage (énoncé, écrit et oral)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2016.html">1A.e - TD noté, 11 décembre 2015</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2017.html">1A.e - TD noté, 16 décembre 2016</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2017_2.html">1A.e - TD noté, 21 février 2017</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2017_2.html#Exercice-1">Exercice 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2018_1.html">1A.e - Enoncé 12 décembre 2017 (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2018_2.html">1A.e - Enoncé 12 décembre 2017 (2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2019_1.html">1A.e - Enoncé 23 octobre 2018 (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2019_2.html">1A.e - Enoncé 23 octobre 2018 (2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2020_1.html">1A.e - Enoncé 22 octobre 2019 (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2020_2.html">1A.e - Enoncé 22 octobre 2019 (2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2021.html">1A - Enoncé 24 novembre 2020</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2022.html">1A - Enoncé 3 novembre 2021</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2022_rattrapage.html">1A - Enoncé 15 novembre 2021 - rattrapage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2022_rattrapage2.html">1A - Enoncé 3 mars 2022- rattrapage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/td_note_2023.html">1A - Enoncé 26 octobre 2022</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/interro_rapide_20_minutes_2014_09.html">1A.e - Correction de l’interrogation écrite du 26 septembre 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/interro_rapide_20_minutes_2014_10.html">1A.e - Correction de l’interrogation écrite du 10 octobre 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/interro_rapide_20_minutes_2014_11.html">1A.e - Correction de l’interrogation écrite du 14 novembre 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/interro_rapide_20_minutes_2014_12.html">1A.e - Correction de l’interrogation écrite du 14 novembre 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/interro_rapide_20_minutes_2015_09.html">1A.e - Correction de l’interrogation écrite du 26 septembre 2015</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exams/interro_rapide_20_minutes_2015_11.html">1A.e - Correction de l’interrogation écrite du 6 novembre 2015</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compléments</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../algorithm_culture.html">Survol algorithmique</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../i_index.html">En diagonal</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of En diagonal</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../auto_examples/index.html">Gallerie d’exemples</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of Gallerie d’exemples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_pandas_groupby.html">Pandas et groupby</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_numpy_tricks.html">Points d’implémentation avec numpy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_lambda_function.html">Astuces avec les lambda functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_gil_example.html">Le GIL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_matador.html">Mathador, énigme à 4 opérations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_serialisation_protobuf.html">Sérialisation avec protobuf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_float_and_double_rouding.html">Float Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_partie_dame.html">Parties de dames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_hypercube.html">Hypercube et autres exercices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_serialisation_examples.html">Sérialisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_tarabiscote.html">Exercices expliqués de programmation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_tsp.html">Réflexions autour du voyage de commerce (TSP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../auto_examples/plot_einstein_riddle.html">L’énigme d’Einstein et sa résolution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/index.html">Code inclus dans cette librairie</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of Code inclus dans cette librairie</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/classique.html">examples.construction_classique</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tools.html">tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/practice/rues_paris.html">teachpyx.practice.rues_paris</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/numpysex.html">examples.numpysex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/faqs.html">faq</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../i_ex.html">Syntaxes et définitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../i_faq.html">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOGS.html">Change Logs</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Simulation-COVID">
<h1>Simulation COVID<a class="headerlink" href="#Simulation-COVID" title="Lien permanent vers cette rubrique">#</a></h1>
<p>Ou comment utiliser les mathématiques pour comprendre la propagation de l’épidémie.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<section id="Enoncé">
<h2>Enoncé<a class="headerlink" href="#Enoncé" title="Lien permanent vers cette rubrique">#</a></h2>
<section id="On-récupère-les-données-du-COVID-par-région-et-par-âge-et-premier-graphe">
<h3>On récupère les données du COVID par région et par âge et premier graphe<a class="headerlink" href="#On-récupère-les-données-du-COVID-par-région-et-par-âge-et-premier-graphe" title="Lien permanent vers cette rubrique">#</a></h3>
<p>A cette adresse : <a class="reference external" href="https://www.data.gouv.fr/en/datasets/donnees-relatives-a-lepidemie-de-covid-19-en-france-vue-densemble/">Données relatives à l’épidémie de COVID-19 en France : vue d’ensemble</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">read_csv</span><span class="p">,</span> <span class="n">to_datetime</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.data.gouv.fr/en/datasets/r/d3a98a30-893f-47f7-96c5-2f4bcaaa0d71&quot;</span>
<span class="n">covid</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">covid</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">covid</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">covid</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>total_cas_confirmes</th>
      <th>total_deces_hopital</th>
      <th>total_deces_ehpad</th>
      <th>total_cas_confirmes_ehpad</th>
      <th>total_cas_possibles_ehpad</th>
      <th>patients_reanimation</th>
      <th>patients_hospitalises</th>
      <th>total_patients_gueris</th>
      <th>nouveaux_patients_hospitalises</th>
      <th>nouveaux_patients_reanimation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>802</th>
      <td>2022-05-13</td>
      <td>NaN</td>
      <td>118431</td>
      <td>28826.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1233.0</td>
      <td>19272.0</td>
      <td>653050.0</td>
      <td>756.0</td>
      <td>77.0</td>
    </tr>
    <tr>
      <th>803</th>
      <td>2022-05-14</td>
      <td>NaN</td>
      <td>118494</td>
      <td>28837.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1213.0</td>
      <td>18901.0</td>
      <td>653734.0</td>
      <td>387.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>804</th>
      <td>2022-05-15</td>
      <td>NaN</td>
      <td>118508</td>
      <td>28844.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1214.0</td>
      <td>18935.0</td>
      <td>653827.0</td>
      <td>145.0</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>805</th>
      <td>2022-05-16</td>
      <td>NaN</td>
      <td>118633</td>
      <td>28845.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1199.0</td>
      <td>18742.0</td>
      <td>654775.0</td>
      <td>900.0</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>806</th>
      <td>2022-05-17</td>
      <td>NaN</td>
      <td>118723</td>
      <td>28845.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1173.0</td>
      <td>18290.0</td>
      <td>655984.0</td>
      <td>883.0</td>
      <td>106.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">covid</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution des hospitalisations par jour&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_5_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_5_0.png" />
</div>
</div>
<p>Il y a quelques valeurs manquantes même pour les séries aggrégées… Comme je n’ai pas le courage de corriger les valeurs unes à unes, je prends un autre fichier et quelques aberrations comme le nombre de décès qui décroît, ce qui est rigoureusement impossible.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">concat</span><span class="p">,</span> <span class="n">to_datetime</span>


<span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;deaths&quot;</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s2">&quot;France&quot;</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/&quot;</span>
        <span class="s2">&quot;master/csse_covid_19_data/&quot;</span>
        <span class="s2">&quot;csse_covid_19_time_series/time_series_covid19_</span><span class="si">%s</span><span class="s2">_global.csv&quot;</span> <span class="o">%</span> <span class="n">kind</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">eur</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Country/Region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">country</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Province/State&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">eur</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">kind</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tf</span>


<span class="k">def</span> <span class="nf">extract_whole_data</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;deaths&quot;</span><span class="p">,</span> <span class="s2">&quot;confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;recovered&quot;</span><span class="p">],</span> <span class="n">country</span><span class="o">=</span><span class="s2">&quot;France&quot;</span><span class="p">):</span>
    <span class="n">population</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="mf">67e6</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">total</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kind</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">extract_data</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">conc</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">conc</span><span class="p">[</span><span class="s2">&quot;infected&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conc</span><span class="p">[</span><span class="s2">&quot;confirmed&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">conc</span><span class="p">[</span><span class="s2">&quot;deaths&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">conc</span><span class="p">[</span><span class="s2">&quot;recovered&quot;</span><span class="p">])</span>
    <span class="n">conc</span><span class="p">[</span><span class="s2">&quot;safe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">conc</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;confirmed&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">conc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">conc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conc</span>


<span class="n">covid</span> <span class="o">=</span> <span class="n">extract_whole_data</span><span class="p">()</span>
<span class="n">covid</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_20449/102400080.py:30: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  conc.index = to_datetime(conc.index)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>deaths</th>
      <th>confirmed</th>
      <th>recovered</th>
      <th>infected</th>
      <th>safe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-03-05</th>
      <td>161407</td>
      <td>38591184</td>
      <td>0</td>
      <td>38429777</td>
      <td>28408816.0</td>
    </tr>
    <tr>
      <th>2023-03-06</th>
      <td>161450</td>
      <td>38599330</td>
      <td>0</td>
      <td>38437880</td>
      <td>28400670.0</td>
    </tr>
    <tr>
      <th>2023-03-07</th>
      <td>161474</td>
      <td>38606393</td>
      <td>0</td>
      <td>38444919</td>
      <td>28393607.0</td>
    </tr>
    <tr>
      <th>2023-03-08</th>
      <td>161501</td>
      <td>38612201</td>
      <td>0</td>
      <td>38450700</td>
      <td>28387799.0</td>
    </tr>
    <tr>
      <th>2023-03-09</th>
      <td>161512</td>
      <td>38618509</td>
      <td>0</td>
      <td>38456997</td>
      <td>28381491.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">covid</span><span class="p">[[</span><span class="s2">&quot;confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;infected&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution de l&#39;épidémie par jour&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">covid</span><span class="p">[[</span><span class="s2">&quot;deaths&quot;</span><span class="p">,</span> <span class="s2">&quot;recovered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution de l&#39;épidémie par jour&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_8_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_8_0.png" />
</div>
</div>
<p>Même aberration, un nombre décès qui décroît… Il faudrait comprendre pourquoi pour savoir comment réparer les données. Ou on improvise. Pour chaque observation <img class="math" src="../../_images/math/19d21c014d490e28293fa24a18ebec8e9cac4da8.svg" alt="X_t &lt; X_{t-1}"/>, on calcule le ratio <img class="math" src="../../_images/math/b8ecc17260ced41c3442c65a28f6e3db212eae25.svg" alt="\frac{X_{t}}{X_{t-1}}"/> et on multiplie toutes les observations <img class="math" src="../../_images/math/ff0e0f520ff1cbfe08d602e96fb6626c23357b39.svg" alt="i&lt;t"/> par ce ratio.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># pour avoir une barre de progression</span>


<span class="k">def</span> <span class="nf">correct_series</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">200000</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">X</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">ratio</span>


<span class="n">covid_modified</span> <span class="o">=</span> <span class="n">covid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">covid</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">covid_modified</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">correct_series</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">covid_modified</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

<span class="n">covid_modified</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  0%|          | 0/5 [00:00&lt;?, ?it/s]100%|██████████| 5/5 [00:00&lt;00:00, 18.09it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>deaths</th>
      <th>confirmed</th>
      <th>recovered</th>
      <th>infected</th>
      <th>safe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-03-05</th>
      <td>161407</td>
      <td>38591184</td>
      <td>342253</td>
      <td>38429777</td>
      <td>28381491.0</td>
    </tr>
    <tr>
      <th>2023-03-06</th>
      <td>161450</td>
      <td>38599330</td>
      <td>342253</td>
      <td>38437880</td>
      <td>28381491.0</td>
    </tr>
    <tr>
      <th>2023-03-07</th>
      <td>161474</td>
      <td>38606393</td>
      <td>342253</td>
      <td>38444919</td>
      <td>28381491.0</td>
    </tr>
    <tr>
      <th>2023-03-08</th>
      <td>161501</td>
      <td>38612201</td>
      <td>342253</td>
      <td>38450700</td>
      <td>28381491.0</td>
    </tr>
    <tr>
      <th>2023-03-09</th>
      <td>161512</td>
      <td>38618509</td>
      <td>342253</td>
      <td>38456997</td>
      <td>28381491.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">covid_modified</span><span class="p">[[</span><span class="s2">&quot;confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;infected&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution de l&#39;épidémie par jour&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">covid_modified</span><span class="p">[[</span><span class="s2">&quot;deaths&quot;</span><span class="p">,</span> <span class="s2">&quot;recovered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution de l&#39;épidémie par jour&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_11_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_11_0.png" />
</div>
</div>
<p>C’est mieux.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">covid</span> <span class="o">=</span> <span class="n">covid_modified</span>
</pre></div>
</div>
</div>
<p>On lisse.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lisse</span> <span class="o">=</span> <span class="n">covid</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lisse</span><span class="p">[[</span><span class="s2">&quot;confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;infected&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution de l&#39;épidémie par jour&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">lisse</span><span class="p">[[</span><span class="s2">&quot;deaths&quot;</span><span class="p">,</span> <span class="s2">&quot;recovered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Evolution de l&#39;épidémie par jour&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_15_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_15_0.png" />
</div>
</div>
<p>La série des <em>recovered</em> ne compte vraisemblablement que ceux qui sont passés à l’hôpital. Il faudrait recouper avec d’autres données pour être sûr. Ce sera pour un autre jour.</p>
</section>
<section id="Modèle-SIRD">
<h3>Modèle <a class="reference external" href="http://www.xavierdupre.fr/app/aftercovid/helpsphinx/model_covidsir.html">SIRD</a><a class="headerlink" href="#Modèle-SIRD" title="Lien permanent vers cette rubrique">#</a></h3>
<p>Pour en savoir plus <a class="reference external" href="https://fr.wikipedia.org/wiki/Mod%C3%A8les_compartimentaux_en_%C3%A9pid%C3%A9miologie">Modèles compartimentaux en épidémiologie</a>. On classe la population en quatre catégories :</p>
<ul class="simple">
<li><p>S : personnes non contaminées</p></li>
<li><p>I : nombre de personnes malades ou contaminantes</p></li>
<li><p>R : personnes guéries (recovered)</p></li>
<li><p>D : personnes décédées</p></li>
</ul>
<p>Les gens changent de catégorie en fonction de l’évolution de l’épidémie selon les équations qui suivent :</p>
<ul class="simple">
<li><p><img class="math" src="../../_images/math/08d1d3fb3b0c23bafacb7da71f7ef920992e2125.svg" alt="\frac{dS}{dt} = - \beta \frac{S I}{N}"/></p></li>
<li><p><img class="math" src="../../_images/math/3039ef57c6bb58538ee3eebaeb5bf1b75cca9be6.svg" alt="\frac{dI}{dt} = \frac{\beta S I}{N} - \mu I - \nu I"/></p></li>
<li><p><img class="math" src="../../_images/math/e9126717465f1a11fdc05659fddb0c469f86ad80.svg" alt="\frac{dD}{dt} = \nu I"/></p></li>
<li><p><img class="math" src="../../_images/math/7f0cb24bdd8840d835a4b2faeaa31a0b384fd75a.svg" alt="\frac{dR}{dt} = \mu I"/></p></li>
</ul>
<p><img class="math" src="../../_images/math/bd898b02c226d1ce791865c51d30012165adf53d.svg" alt="\beta"/> est lié au taux de transmission, <img class="math" src="../../_images/math/5d3d84596a24991bbb584ea0dd6f3e7d2f7dcdac.svg" alt="\frac{1}{\mu}"/> est la durée moyenne jusqu’à guérison, <img class="math" src="../../_images/math/42a2bbf3be4fbebb3eb8ad29278704059859ca8a.svg" alt="\frac{1}{\nu}"/> est la durée moyenne jusqu’au décès.</p>
</section>
<section id="Q0-:-une-petite-fonction-pour-dessiner">
<h3>Q0 : une petite fonction pour dessiner<a class="headerlink" href="#Q0-:-une-petite-fonction-pour-dessiner" title="Lien permanent vers cette rubrique">#</a></h3>
<p>Cette fonction servira à représenter graphiquement les résultats.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>


<span class="k">def</span> <span class="nf">plot_simulation</span><span class="p">(</span>
    <span class="n">sim</span><span class="p">,</span>
    <span class="n">day0</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">logy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">two</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">true_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    On suppose que sim est une matrice (days, 4).</span>
<span class="sd">    :param sim: la simulation</span>
<span class="sd">    :param day0: le premier jour de la simulation (une observation par jour)</span>
<span class="sd">    :param safe: ajouter les personnes *safe* (non infectées), comme elles sont nombreuses,</span>
<span class="sd">        il vaut mieux aussi cocher *logy=True* pour que cela soit lisible</span>
<span class="sd">    :param ax: axes existant (utile pour superposer), None pour un créer un nouveau</span>
<span class="sd">    :param title: titre du graphe</span>
<span class="sd">    :param logy: échelle logarithmique sur l&#39;axe des y</span>
<span class="sd">    :param two: faire deux graphes plutôt qu&#39;un seul pour plus de visibilité</span>
<span class="sd">    :param true_data: vraies données à tracer également en plus de celle de la simulation</span>
<span class="sd">    :return: ax</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">])</span>
    <span class="c1"># On ajoute des dates.</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">day0</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">true_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">true_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sobs&quot;</span><span class="p">,</span> <span class="s2">&quot;Iobs&quot;</span><span class="p">,</span> <span class="s2">&quot;Robs&quot;</span><span class="p">,</span> <span class="s2">&quot;Dobs&quot;</span><span class="p">])</span>
        <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">day0</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">tdf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">two</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tdf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Dobs&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tdf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Sobs&quot;</span><span class="p">,</span> <span class="s2">&quot;Dobs&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">8</span>
                <span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">tdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;Dobs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;D&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Décès&quot;</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tdf</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Sobs&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">8</span>
                <span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;S&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="n">logy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</section>
<section id="Q1-:-écrire-une-fonction-qui-calcule-la-propagation">
<h3>Q1 : écrire une fonction qui calcule la propagation<a class="headerlink" href="#Q1-:-écrire-une-fonction-qui-calcule-la-propagation" title="Lien permanent vers cette rubrique">#</a></h3>
<p>On suppose que <img class="math" src="../../_images/math/0e3df5b97c9dd19d5886d244c304094433fcbb62.svg" alt="\beta, \mu, \nu, S_0, I_0, R_0, D_0"/> sont connus. On rappelle le modèle :</p>
<ul class="simple">
<li><p><img class="math" src="../../_images/math/03f397564563593ea68cccb8f8a07f9bfefbd73c.svg" alt="dS = - \beta \frac{S I}{N}"/></p></li>
<li><p><img class="math" src="../../_images/math/acae6dcd7ad590efc550c38ff2b254e4ba8b13b5.svg" alt="dI = \frac{\beta S I}{N} - \mu I - \nu I"/></p></li>
<li><p><img class="math" src="../../_images/math/ce94150bd3fa46baea7366df49af84c6fb600f7b.svg" alt="dD = \nu I"/></p></li>
<li><p><img class="math" src="../../_images/math/d7f727d39485c8c54011a656883d0f97d322de4a.svg" alt="dR = \mu I"/></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">14</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">21</span>
<span class="n">S0</span> <span class="o">=</span> <span class="mi">9990</span>
<span class="n">I0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">D0</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<p>Il faudra compléter le petit programme suivant :</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>


<span class="k">def</span> <span class="nf">simulation</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu</span>
        <span class="c1"># ....</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="n">sim</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">plot_simulation</span><span class="p">(</span><span class="n">sim</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_24_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_24_0.png" />
</div>
</div>
</section>
<section id="Q2-:-on-veut-estimer-les-paramètres-du-modèle,-une-fonction-d'erreur-?">
<h3>Q2 : on veut estimer les paramètres du modèle, une fonction d’erreur ?<a class="headerlink" href="#Q2-:-on-veut-estimer-les-paramètres-du-modèle,-une-fonction-d'erreur-?" title="Lien permanent vers cette rubrique">#</a></h3>
<p>C’est compliqué parce que… les paramètres évoluent au cours du temps, en fonction du comportement des gens, masque, pas masque, confinement, reconfinement, température, manque de tests également… Tout d’abord les vraies données.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lisse_mars</span> <span class="o">=</span> <span class="n">lisse</span><span class="p">[</span><span class="mi">30</span><span class="p">:]</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">lisse_mars</span><span class="o">.</span><span class="n">index</span>
<span class="n">france</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">lisse_mars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">france</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisse_mars</span><span class="p">[</span><span class="s2">&quot;deaths&quot;</span><span class="p">]</span>
<span class="n">france</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisse_mars</span><span class="p">[</span><span class="s2">&quot;recovered&quot;</span><span class="p">]</span>
<span class="n">france</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisse_mars</span><span class="p">[</span><span class="s2">&quot;safe&quot;</span><span class="p">]</span>
<span class="n">france</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisse_mars</span><span class="p">[</span><span class="s2">&quot;infected&quot;</span><span class="p">]</span>

<span class="n">france</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[28305367.1697884, 1.1640875027069664, 3.626756310367156,
        0.9857629613918629],
       [28305367.1697884, 1.1640875027069664, 3.626756310367156,
        0.9857629613918629],
       [28305367.1697884, 1.1640875027069664, 3.626756310367156,
        0.9857629613918629],
       [28305367.1697884, 1.1640875027069664, 3.626756310367156,
        0.9857629613918629],
       [28305367.1697884, 1.1640875027069664, 4.533445387958945,
        0.9857629613918629]], dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_simulation</span><span class="p">(</span><span class="n">france</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Vraies données&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_27_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_27_0.png" />
</div>
</div>
<p>Et sur les derniers jours.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_simulation</span><span class="p">(</span>
    <span class="n">france</span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">:],</span>
    <span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">],</span>
    <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Vraies données, derniers mois&quot;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_29_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_29_0.png" />
</div>
</div>
<p>Bref, on part du principe que le modèle est plutôt fiable sur une courte période de temps, on tire plein de paramètres aléatoires et on regarde ce qui marche le mieux. Et pour comparer deux jeux de paramètres, il faut donc une fonction d’erreur qu’on prendra comme égal à la somme des erreurs de prédictions.</p>
<p>Maintenant il faut faire attention à ce qu’on compare. La simulation calcule les catégories de population au temps <em>t</em>, mais pas toujours les séries cumulées. La série des personnes contaminées est <strong>transitoire dans la simulation</strong> et <strong>cumulées dans les données récupérées</strong>. La première étape consiste à transformer les données simulées pour qu’elles soient comparables aux données collectées.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulation_cumulee</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>Maintenant la fonction d’erreur :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="c1"># ... à compléter</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</section>
<section id="Q3-:-optimisation">
<h3>Q3 : optimisation<a class="headerlink" href="#Q3-:-optimisation" title="Lien permanent vers cette rubrique">#</a></h3>
<p>Pour optimiser, on tire des paramètres de façon aléatoire dans un intervalle donné et on choisit ceux qui minimisent l’erreur.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># pour avoir une barre de progression</span>


<span class="k">def</span> <span class="nf">optimisation</span><span class="p">(</span>
    <span class="n">true_data</span><span class="p">,</span>
    <span class="n">i_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">beta_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">mu_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">nu_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">error_fct</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">rnd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">max_iter</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">i_range</span><span class="p">,</span> <span class="n">beta_range</span><span class="p">,</span> <span class="n">mu_range</span><span class="p">,</span> <span class="n">nu_range</span><span class="p">]):</span>
        <span class="n">rnd</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>  <span class="c1"># à compléter ...</span>

    <span class="n">err_min</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)):</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">D0</span> <span class="o">=</span> <span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="c1"># dI0 =</span>
        <span class="c1"># S0 =</span>
        <span class="c1"># I0 =</span>
        <span class="c1"># R0 =</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">simulation_cumulee</span><span class="p">(</span>
            <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="n">true_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">error_fct</span><span class="p">(</span><span class="n">true_data</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err_min</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="n">err_min</span><span class="p">:</span>
            <span class="c1"># à compléter</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">best</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
<section id="Q4-:-dessiner-les-résultats">
<h3>Q4 : dessiner les résultats<a class="headerlink" href="#Q4-:-dessiner-les-résultats" title="Lien permanent vers cette rubrique">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
<section id="Q5-:-vérifier-que-cela-marche-sur-des-données-synthétiques">
<h3>Q5 : vérifier que cela marche sur des données synthétiques<a class="headerlink" href="#Q5-:-vérifier-que-cela-marche-sur-des-données-synthétiques" title="Lien permanent vers cette rubrique">#</a></h3>
<p>On simule, on vérifie que l’optimisation retrouve les paramètres de la simulation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
<section id="Q6-:-sur-des-données-réelles">
<h3>Q6 : sur des données réelles<a class="headerlink" href="#Q6-:-sur-des-données-réelles" title="Lien permanent vers cette rubrique">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Réponses">
<h2>Réponses<a class="headerlink" href="#Réponses" title="Lien permanent vers cette rubrique">#</a></h2>
<section id="Q1-:-propagation">
<h3>Q1 : propagation<a class="headerlink" href="#Q1-:-propagation" title="Lien permanent vers cette rubrique">#</a></h3>
<p>On l’applique aux données réelles.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>


<span class="k">def</span> <span class="nf">simulation</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu</span>
        <span class="n">dD</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">nu</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">beta</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dI</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dI</span> <span class="o">-</span> <span class="n">dR</span> <span class="o">-</span> <span class="n">dD</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dR</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">dD</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">14</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">21</span>
<span class="n">S0</span> <span class="o">=</span> <span class="mi">9990</span>
<span class="n">I0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">D0</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">plot_simulation</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulation pour essayer&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_46_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_46_0.png" />
</div>
</div>
</section>
<section id="Q2-:-série-cumulées-et-fonction-erreur">
<h3>Q2 : série cumulées et fonction erreur<a class="headerlink" href="#Q2-:-série-cumulées-et-fonction-erreur" title="Lien permanent vers cette rubrique">#</a></h3>
<p>On doit d’abord calculer la simulation qui modifie <img class="math" src="../../_images/math/d9b13018ba81d215ad9648767e4d2bbb94fab8b5.svg" alt="I_t"/> en <img class="math" src="../../_images/math/3b1d41c0394f1d0df53dcd8a361ce1a3c2fc5160.svg" alt="J_t"/> qui correspond à l’ensemble des personnes contaminées jusqu’à présent.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulation_cumulee</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">cum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">]</span>
    <span class="n">cum</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I0</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu</span>
        <span class="n">dD</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">nu</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">beta</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dI</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dI</span> <span class="o">-</span> <span class="n">dR</span> <span class="o">-</span> <span class="n">dD</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dR</span>
        <span class="n">res</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">dD</span>
        <span class="n">cum</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dI</span>
    <span class="n">res</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">14</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">21</span>
<span class="n">S0</span> <span class="o">=</span> <span class="mi">9990</span>
<span class="n">I0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">D0</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">simulation_cumulee</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">plot_simulation</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulation pour essayer&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_48_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_48_0.png" />
</div>
</div>
<p>On compare avec les vraies données en gras.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.04</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span> <span class="o">=</span> <span class="n">france</span><span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">simulation_cumulee</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">plot_simulation</span><span class="p">(</span>
    <span class="n">sim</span><span class="p">,</span>
    <span class="n">dates</span><span class="p">[</span><span class="mi">120</span><span class="p">],</span>
    <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">true_data</span><span class="o">=</span><span class="n">france</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">240</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulation et vraies données (en gros)&quot;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_50_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_50_0.png" />
</div>
</div>
<p>Pas simple de choisir des paramètres pour approximer la courbe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simulation</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">simulation</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">total</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">total</span>


<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">14</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">21</span>
<span class="n">S0</span> <span class="o">=</span> <span class="mi">9990</span>
<span class="n">I0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">D0</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">simulation_cumulee</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">plot_simulation</span><span class="p">(</span><span class="n">sim</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_52_0.png" src="../../_images/practice_algo-base_exercice_simulation_covid_52_0.png" />
</div>
</div>
<p>On regarde si on arrive à retrouver les paramètres de la simulation.</p>
</section>
<section id="Q3,-Q4,-Q5-:-optimisation-sur-des-données-synthétiques">
<h3>Q3, Q4, Q5 : optimisation sur des données synthétiques<a class="headerlink" href="#Q3,-Q4,-Q5-:-optimisation-sur-des-données-synthétiques" title="Lien permanent vers cette rubrique">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># pour avoir une barre de progression</span>


<span class="k">def</span> <span class="nf">optimisation</span><span class="p">(</span>
    <span class="n">true_data</span><span class="p">,</span>
    <span class="n">i_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">beta_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">mu_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">nu_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">error_fct</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">rnd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">max_iter</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">i_range</span><span class="p">,</span> <span class="n">beta_range</span><span class="p">,</span> <span class="n">mu_range</span><span class="p">,</span> <span class="n">nu_range</span><span class="p">]):</span>
        <span class="n">rnd</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span>
    <span class="n">err_min</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)):</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">rnd</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">dI0</span> <span class="o">=</span> <span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>
        <span class="n">D0</span> <span class="o">=</span> <span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dI0</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">true_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dI0</span>
        <span class="n">R0</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">D0</span> <span class="o">-</span> <span class="n">I0</span> <span class="o">-</span> <span class="n">S0</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">simulation_cumulee</span><span class="p">(</span>
            <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="n">true_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">error_fct</span><span class="p">(</span><span class="n">true_data</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err_min</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="n">err_min</span><span class="p">:</span>
            <span class="n">err_min</span> <span class="o">=</span> <span class="n">err</span>
            <span class="n">best</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
                <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span>
                <span class="n">nu</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span>
                <span class="n">I0</span><span class="o">=</span><span class="n">I0</span><span class="p">,</span>
                <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">S0</span><span class="o">=</span><span class="n">S0</span><span class="p">,</span>
                <span class="n">R0</span><span class="o">=</span><span class="n">R0</span><span class="p">,</span>
                <span class="n">D0</span><span class="o">=</span><span class="n">D0</span><span class="p">,</span>
                <span class="n">err</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
                <span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">best</span>


<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.04</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.07</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.04</span>
<span class="n">S0</span> <span class="o">=</span> <span class="mf">67e6</span>
<span class="n">I0</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">D0</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">simulation_cumulee</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">I0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>


<span class="n">res</span> <span class="o">=</span> <span class="n">optimisation</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">error_fct</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">i_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">))</span>
<span class="n">sim_opt</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span>
<span class="n">plot_simulation</span><span class="p">(</span>
    <span class="n">sim_opt</span><span class="p">,</span>
    <span class="n">dates</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span>
    <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">true_data</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;beta=</span><span class="si">%1.3f</span><span class="s2"> mu=</span><span class="si">%1.3f</span><span class="s2"> nu=</span><span class="si">%1.3f</span><span class="s2"> err=</span><span class="si">%1.3g</span><span class="s2"> i=</span><span class="si">%1.3g</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;err&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [00:00&lt;00:00, 3772.51it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_55_1.png" src="../../_images/practice_algo-base_exercice_simulation_covid_55_1.png" />
</div>
</div>
<p>Ca ne marche pas trop mal.</p>
</section>
<section id="id1">
<h3>Q6 : sur des données réelles<a class="headerlink" href="#id1" title="Lien permanent vers cette rubrique">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">optimisation</span><span class="p">(</span><span class="n">france</span><span class="p">[</span><span class="mi">180</span><span class="p">:],</span> <span class="n">error_fct</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">i_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">))</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span>
<span class="n">plot_simulation</span><span class="p">(</span>
    <span class="n">sim</span><span class="p">,</span>
    <span class="n">dates</span><span class="p">[</span><span class="mi">180</span><span class="p">],</span>
    <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">true_data</span><span class="o">=</span><span class="n">france</span><span class="p">[</span><span class="mi">180</span><span class="p">:],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;beta=</span><span class="si">%1.3f</span><span class="s2"> mu=</span><span class="si">%1.3f</span><span class="s2"> nu=</span><span class="si">%1.3f</span><span class="s2"> err=</span><span class="si">%1.3f</span><span class="s2"> i=</span><span class="si">%1.3f</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;err&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  2%|▏         | 19/1000 [00:00&lt;00:05, 188.39it/s]100%|██████████| 1000/1000 [00:05&lt;00:00, 197.61it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_58_1.png" src="../../_images/practice_algo-base_exercice_simulation_covid_58_1.png" />
</div>
</div>
<p>Ca ne marche pas super. On peut modifier l’erreur pour donner plus d’importance à la courbe des morts.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">simulation</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">m3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">simulation</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">simulation</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">simulation</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">m3</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">total</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">total</span>


<span class="n">res</span> <span class="o">=</span> <span class="n">optimisation</span><span class="p">(</span><span class="n">france</span><span class="p">[</span><span class="mi">150</span><span class="p">:],</span> <span class="n">error_fct</span><span class="o">=</span><span class="n">error_norm</span><span class="p">,</span> <span class="n">i_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">))</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;sim&quot;</span><span class="p">]</span>
<span class="n">plot_simulation</span><span class="p">(</span>
    <span class="n">sim</span><span class="p">,</span>
    <span class="n">dates</span><span class="p">[</span><span class="mi">150</span><span class="p">],</span>
    <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">two</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">true_data</span><span class="o">=</span><span class="n">france</span><span class="p">[</span><span class="mi">150</span><span class="p">:],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;beta=</span><span class="si">%1.3f</span><span class="s2"> mu=</span><span class="si">%1.3f</span><span class="s2"> nu=</span><span class="si">%1.3f</span><span class="s2"> err=</span><span class="si">%1.3f</span><span class="s2"> i=</span><span class="si">%1.3f</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;err&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 1000/1000 [00:05&lt;00:00, 169.45it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/practice_algo-base_exercice_simulation_covid_60_1.png" src="../../_images/practice_algo-base_exercice_simulation_covid_60_1.png" />
</div>
</div>
<p>L’erreur est répartie sur l’ensemble de la courbe mais cela ne tient pas compte de la dynamique. Il faudrait prendre en compte les dérivées comme dans l’aticle <a class="reference external" href="https://arxiv.org/pdf/2003.14391.pdf">A Modified SIR Model for the COVID-19 Contagion in Italy</a>. Ou partir sur une approche plus directe comme celle proposée dans l’article <a class="reference external" href="https://web.stanford.edu/~chadj/sird-paper.pdf">Estimating and Simulating a SIRD Model of COVID-19 for Many Countries, States, and Cities</a>.
<img class="math" src="../../_images/math/08d1d3fb3b0c23bafacb7da71f7ef920992e2125.svg" alt="\frac{dS}{dt} = - \beta \frac{S I}{N}"/> implique que <img class="math" src="../../_images/math/ecb635eb011868f39a48ddc1e3da0bf385d90a0a.svg" alt="\Delta(S_t) = S_{t+1} - S_t = -\beta \frac{S_t I_t}{N}"/>. On peut alors calculer une sorte de <img class="math" src="../../_images/math/cbeb34c08d899d61419971ce6215f8b06d692f25.svg" alt="\beta_t"/> dépendant du temps : <img class="math" src="../../_images/math/c345d2187939e5487cbeebc9cdb9de575b4857f1.svg" alt="\beta_t = -N\frac{S_{t+1} - S_t}{S_t I_t}"/>. Le problème, c’est <img class="math" src="../../_images/math/d9b13018ba81d215ad9648767e4d2bbb94fab8b5.svg" alt="I_t"/> qu’on ne connaît pas puisque c’est le nombre de personnes contaminantes à un instant <em>t</em>. On ne connaît pas plus <img class="math" src="../../_images/math/44ba19c0f5cc2b6cf8f04785fd0e153ec5753be3.svg" alt="S_t"/> mais on peut le déduire si on connaît <img class="math" src="../../_images/math/d9b13018ba81d215ad9648767e4d2bbb94fab8b5.svg" alt="I_t"/>. Cela dit, le paramètre <img class="math" src="../../_images/math/8687a0c993c7ac88ce9c6528c4a96f73dc988af5.svg" alt="\nu"/> est plus ou
moins connu puisqu’il s’agit de l’inverse de la durée moyenne d’incubation jusqu’au décès. De là, on peut retrouver <img class="math" src="../../_images/math/bd898b02c226d1ce791865c51d30012165adf53d.svg" alt="\beta"/>. On poursuit en passant au logarithme <img class="math" src="../../_images/math/633184ac317ae0b2778feeffc0a2d53a01ddcb20.svg" alt="\ln \beta_t = \ln N + \ln (S_t - S_{t+1}) - \ln S_t - \ln I_t"/>. Le nombre de cas positifs découverts chaque jour correspond à <img class="math" src="../../_images/math/0aa8b85cb7da8cb853d4d23756b1f811e2727077.svg" alt="S_t - S_{t+1}"/>. On ajoute que <img class="math" src="../../_images/math/79d0bad04a61b5d32bc7d510139bf15c2c17f45d.svg" alt="\forall t, N = S_t + I_t + R_t + D_t"/> et <img class="math" src="../../_images/math/a392b1faea2409071f7fb8f590d78325c631b0b4.svg" alt="D_{t+1} - D_t = \nu I_t"/>. Donc :</p>
<div class="math-wrapper docutils container">
<div class="math">
<p><img src="../../_images/math/8d8061cefc4c18d44184ed20855cf7d75967cb6c.svg" alt="\ln \beta_t = \ln N + \ln (S_t - S_{t+1}) - \ln (S_t - S_{t-1} + S_{t-1}) - \ln (D_{t+1} - D_t) + \ln \nu"/></p>
</div></div>
<p>Il y a deux inconnues, <img class="math" src="../../_images/math/ee9aa20145d5ff376573aaf5841ca55d8e339f51.svg" alt="\ln \beta - \ln \nu"/> qu’on suppose constant pendant la période et <img class="math" src="../../_images/math/a721b6132c0fe0412e48e99a6072969ff174eeeb.svg" alt="S_{t-1}"/>. Il suffit d’écrire ces équations sur quelques jours puis de résoudre le système d’équations.</p>
<div class="math-wrapper docutils container">
<div class="math">
<p><img src="../../_images/math/b7de462e585d6b12a12510f6911b9419af01d55c.svg" alt="\begin{array}{l}
\ln \beta - \ln \nu = \ln N + \ln (S_t - S_{t+1}) - \ln (S_t - S_{t-1} + S_{t-1}) - \ln (D_{t+1} - D_t) \\
\ln \beta - \ln \nu = \ln N + \ln (S_{t+1} - S_{t+2}) - \ln (S_{t+1} - S_{t} + S_{t} - S_{t-1} + S_{t-1}) - \ln (D_{t+2} - D_{t+1})
\end{array}"/></p>
</div></div>
<p>D’autres directions sont possibles comme <a class="reference external" href="https://www.math.u-bordeaux.fr/~pmagal100p/papers/MW-JMB-2018.pdf">The Parameter Identification Problem for SIR Epidemic Models: Identifying Unreported Cases</a> qui propose d’estimer les paramètres sur une plus grande période.</p>
<p>D’autres articles : <a class="reference external" href="https://kingaa.github.io/clim-dis/parest/parest.html">Introduction to inference: parameter estimation</a>, <a class="reference external" href="https://europepmc.org/article/med/32231374">Data-based analysis, modelling and forecasting of the COVID-19 outbreak</a>, <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7392128/">Identification and estimation of the SEIRD epidemic model for COVID-19</a>.</p>
<p>Quelques liens :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://covidtracker.fr/covidtracker-france/">CovidTracker</a></p></li>
<li><p><a class="reference external" href="https://github.com/collectif-codata/pyepidemics">pyepidemics</a></p></li>
<li><p><a class="reference external" href="https://freakonometrics.hypotheses.org/61300">COVID-19 pandemics control</a></p></li>
<li><p><a class="reference external" href="https://modcov19.math.cnrs.fr/">modcov19</a></p></li>
<li><p><a class="reference external" href="http://www.xavierdupre.fr/app/aftercovid/helpsphinx/index.html">aftercovid</a></p></li>
<li><p><a class="reference external" href="https://dashboard.covid19.data.gouv.fr/vue-d-ensemble?location=FRA">COVID-19 - France</a></p></li>
<li><p><a class="reference external" href="https://github.com/collectif-codata/awesome-covid19">Awesome COVID19 resources</a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../auto_examples/plot_einstein_riddle.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">L’énigme d’Einstein et sa résolution</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="exercice_simulation_covid_simple.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Modèle épidémiologique (SIRD)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2016-2023, Xavier Dupré
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Simulation COVID</a><ul>
<li><a class="reference internal" href="#Enoncé">Enoncé</a><ul>
<li><a class="reference internal" href="#On-récupère-les-données-du-COVID-par-région-et-par-âge-et-premier-graphe">On récupère les données du COVID par région et par âge et premier graphe</a></li>
<li><a class="reference internal" href="#Modèle-SIRD">Modèle SIRD</a></li>
<li><a class="reference internal" href="#Q0-:-une-petite-fonction-pour-dessiner">Q0 : une petite fonction pour dessiner</a></li>
<li><a class="reference internal" href="#Q1-:-écrire-une-fonction-qui-calcule-la-propagation">Q1 : écrire une fonction qui calcule la propagation</a></li>
<li><a class="reference internal" href="#Q2-:-on-veut-estimer-les-paramètres-du-modèle,-une-fonction-d'erreur-?">Q2 : on veut estimer les paramètres du modèle, une fonction d’erreur ?</a></li>
<li><a class="reference internal" href="#Q3-:-optimisation">Q3 : optimisation</a></li>
<li><a class="reference internal" href="#Q4-:-dessiner-les-résultats">Q4 : dessiner les résultats</a></li>
<li><a class="reference internal" href="#Q5-:-vérifier-que-cela-marche-sur-des-données-synthétiques">Q5 : vérifier que cela marche sur des données synthétiques</a></li>
<li><a class="reference internal" href="#Q6-:-sur-des-données-réelles">Q6 : sur des données réelles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Réponses">Réponses</a><ul>
<li><a class="reference internal" href="#Q1-:-propagation">Q1 : propagation</a></li>
<li><a class="reference internal" href="#Q2-:-série-cumulées-et-fonction-erreur">Q2 : série cumulées et fonction erreur</a></li>
<li><a class="reference internal" href="#Q3,-Q4,-Q5-:-optimisation-sur-des-données-synthétiques">Q3, Q4, Q5 : optimisation sur des données synthétiques</a></li>
<li><a class="reference internal" href="#id1">Q6 : sur des données réelles</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=bdd90cfe"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../_static/translations.js?v=d99ca74e"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>