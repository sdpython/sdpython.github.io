
<!DOCTYPE html>


<html lang="fr" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NeuralTreeNet et ONNX &#8212; Documentation mlstatpy 0.4.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script src="../../_static/documentation_options.js?v=f45c5ce7"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=d99ca74e"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/ml/neural_tree_onnx';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="NeuralTreeNet et coût" href="neural_tree_cost.html" />
    <link rel="prev" title="Un arbre de décision en réseaux de neurones" href="neural_tree.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Passer au contenu principal</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Haut de page
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/project_ico.png" class="logo__image only-light" alt="Documentation mlstatpy 0.4.0 - Home"/>
    <script>document.write(`<img src="../../_static/project_ico.png" class="logo__image only-dark" alt="Documentation mlstatpy 0.4.0 - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_clus/index.html">
                        Clustering
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_ml/index.html">
                        Non linéaire
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_ml/index_reg_lin.html">
                        Régression linéaire
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_ml/index_reg_log.html">
                        Régression logistique
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_nlp/index.html">
                        NLP
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../c_metric/index.html">
                        Métriques
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../c_algo/index.html">
                        Algorithmes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../c_garden/index.html">
                        Pérégrinations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../api/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../i_ex.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../defthe_index.html">
                        Listes des définitions et théorèmes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../auto_examples/index.html">
                        Gallery of examples
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link dropdown-item nav-internal" href="../index.html">
                        Galleries de notebooks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../glossary.html">
                        Glossary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../CHANGELOGS.html">
                        Change Logs
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../license.html">
                        License
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Recherche</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="clair/sombre" aria-label="clair/sombre" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Recherche</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_clus/index.html">
                        Clustering
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_ml/index.html">
                        Non linéaire
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_ml/index_reg_lin.html">
                        Régression linéaire
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_ml/index_reg_log.html">
                        Régression logistique
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../c_nlp/index.html">
                        NLP
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../c_metric/index.html">
                        Métriques
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../c_algo/index.html">
                        Algorithmes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../c_garden/index.html">
                        Pérégrinations
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../api/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../i_ex.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../defthe_index.html">
                        Listes des définitions et théorèmes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../auto_examples/index.html">
                        Gallery of examples
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link dropdown-item nav-internal" href="../index.html">
                        Galleries de notebooks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../glossary.html">
                        Glossary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../CHANGELOGS.html">
                        Change Logs
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../license.html">
                        License
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="clair/sombre" aria-label="clair/sombre" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Navigation de la section">
  <p class="bd-links__title" role="heading" aria-level="1">Navigation de la section</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../dsgarden/index.html">Le petit coin des data scientists</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/classification_multiple.html">Classification multiple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/correlation_non_lineaire.html">Corrélations non linéaires</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/discret_gradient.html">Le gradient et le discret</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/file_dattente_ex.html">File d’attente, un exemple simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/quantile_regression_example.html">Régression quantile illustrée</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/quantization_f8.html">Quantization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/regression_lineaire.html">Régression linéaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsgarden/split_train_test.html">Répartir en base d’apprentissage et de test</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../image/index.html">Images</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../image/segment_detection.html">Détection de segments dans une image</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../metric/index.html">Métriques</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../metric/pvalues_examples.html">p-values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metric/roc_example.html">ROC</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Machine Learning</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="logreg_voronoi.html">Voronoï et régression logistique</a></li>
<li class="toctree-l2"><a class="reference internal" href="mf_acp.html">Factorisation et matrice et ACP</a></li>
<li class="toctree-l2"><a class="reference internal" href="neural_tree.html">Un arbre de décision en réseaux de neurones</a></li>
<li class="toctree-l2"><a class="reference internal" href="neural_tree_cost.html">NeuralTreeNet et coût</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">NeuralTreeNet et ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="piecewise_linear_regression.html">Régression linéaire par morceaux</a></li>
<li class="toctree-l2"><a class="reference internal" href="regression_no_inversion.html">Régression sans inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="reseau_neurones.html">Réseaux de neurones</a></li>
<li class="toctree-l2"><a class="reference internal" href="survival.html">Analyse de survie en pratique</a></li>
<li class="toctree-l2"><a class="reference internal" href="valeurs_manquantes_mf.html">Valeurs manquantes et factorisation de matrices</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../nlp/index.html">NLP - Natural Language Processing</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../nlp/completion_profiling.html">Completion profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlp/completion_simple.html">Complétion Simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlp/completion_trie.html">Complétion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlp/completion_trie_long.html">Completion Trie and metrics</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Fil d'Ariane">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Accueil">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../c_ml/index.html" class="nav-link">Non linéaire</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">NeuralTreeNe...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="NeuralTreeNet-et-ONNX">
<h1>NeuralTreeNet et ONNX<a class="headerlink" href="#NeuralTreeNet-et-ONNX" title="Link to this heading">#</a></h1>
<p>La conversion d’un arbre de décision au format ONNX peut créer des différences entre le modèle original et le modèle converti (voir <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/gyexamples/plot_ebegin_float_double.html">Issues when switching to float</a>. Le problème vient d’un changement de type, les seuils de décisions sont arrondis au float32 le plus proche de leur valeur en float64 (double). Qu’advient-il si l’arbre de décision est converti en réseau de neurones d’abord.</p>
<p>L’approximation des seuils de décision ne change pas grand chose dans la majorité des cas. Cependant, il est possible que la comparaison d’une variable à un seuil de décision arrondi soit l’opposé de celle avec le seuil non arrondi. Dans ce cas, la décision suit un chemin différent dans l’arbre.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jyquickhelper</span> <span class="kn">import</span> <span class="n">add_notebook_menu</span>

<span class="n">add_notebook_menu</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="my_id_menu_nb">run previous cell, wait for 2 seconds</div>
<script>
function repeat_indent_string(n){
    var a = "" ;
    for ( ; n > 0 ; --n)
        a += "    ";
    return a;
}
// look up into all sections and builds an automated menu //
var update_menu_string = function(begin, lfirst, llast, sformat, send, keep_item, begin_format, end_format) {
    var anchors = document.getElementsByClassName("section");
    if (anchors.length == 0) {
        anchors = document.getElementsByClassName("text_cell_render rendered_html");
    }
    var i,t;
    var text_menu = begin;
    var text_memo = "<pre>\nlength:" + anchors.length + "\n";
    var ind = "";
    var memo_level = 1;
    var href;
    var tags = [];
    var main_item = 0;
    var format_open = 0;
    for (i = 0; i <= llast; i++)
        tags.push("h" + i);

    for (i = 0; i < anchors.length; i++) {
        text_memo += "**" + anchors[i].id + "--\n";

        var child = null;
        for(t = 0; t < tags.length; t++) {
            var r = anchors[i].getElementsByTagName(tags[t]);
            if (r.length > 0) {
child = r[0];
break;
            }
        }
        if (child == null) {
            text_memo += "null\n";
            continue;
        }
        if (anchors[i].hasAttribute("id")) {
            // when converted in RST
            href = anchors[i].id;
            text_memo += "#1-" + href;
            // passer à child suivant (le chercher)
        }
        else if (child.hasAttribute("id")) {
            // in a notebook
            href = child.id;
            text_memo += "#2-" + href;
        }
        else {
            text_memo += "#3-" + "*" + "\n";
            continue;
        }
        var title = child.textContent;
        var level = parseInt(child.tagName.substring(1,2));

        text_memo += "--" + level + "?" + lfirst + "--" + title + "\n";

        if ((level < lfirst) || (level > llast)) {
            continue ;
        }
        if (title.endsWith('¶')) {
            title = title.substring(0,title.length-1).replace("<", "&lt;")
         .replace(">", "&gt;").replace("&", "&amp;");
        }
        if (title.length == 0) {
            continue;
        }

        while (level < memo_level) {
            text_menu += end_format + "</ul>\n";
            format_open -= 1;
            memo_level -= 1;
        }
        if (level == lfirst) {
            main_item += 1;
        }
        if (keep_item != -1 && main_item != keep_item + 1) {
            // alert(main_item + " - " + level + " - " + keep_item);
            continue;
        }
        while (level > memo_level) {
            text_menu += "<ul>\n";
            memo_level += 1;
        }
        text_menu += repeat_indent_string(level-2);
        text_menu += begin_format + sformat.replace("__HREF__", href).replace("__TITLE__", title);
        format_open += 1;
    }
    while (1 < memo_level) {
        text_menu += end_format + "</ul>\n";
        memo_level -= 1;
        format_open -= 1;
    }
    text_menu += send;
    //text_menu += "\n" + text_memo;

    while (format_open > 0) {
        text_menu += end_format;
        format_open -= 1;
    }
    return text_menu;
};
var update_menu = function() {
    var sbegin = "";
    var sformat = '<a href="#__HREF__">__TITLE__</a>';
    var send = "";
    var begin_format = '<li>';
    var end_format = '</li>';
    var keep_item = -1;
    var text_menu = update_menu_string(sbegin, 2, 4, sformat, send, keep_item,
       begin_format, end_format);
    var menu = document.getElementById("my_id_menu_nb");
    menu.innerHTML=text_menu;
};
window.setTimeout(update_menu,2000);
            </script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> mlprodict
</pre></div>
</div>
</div>
<section id="Jeu-de-données">
<h2>Jeu de données<a class="headerlink" href="#Jeu-de-données" title="Link to this heading">#</a></h2>
<p>On construit un jeu de donnée aléatoire.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">middle</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">middle</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">middle</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">middle</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</section>
<section id="Partie-scikit-learn">
<h2>Partie scikit-learn<a class="headerlink" href="#Partie-scikit-learn" title="Link to this heading">#</a></h2>
<section id="Caler-un-arbre-de-décision">
<h3>Caler un arbre de décision<a class="headerlink" href="#Caler-un-arbre-de-décision" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="n">tree</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.6179766027481131, 0.33709933420465643)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.33709933420465643
</pre></div></div>
</div>
<p>La profondeur de l’arbre est insuffisante mais ce n’est pas ce qui nous intéresse ici.</p>
</section>
<section id="Conversion-au-format-ONNX">
<h3>Conversion au format ONNX<a class="headerlink" href="#Conversion-au-format-ONNX" title="Link to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skl2onnx</span> <span class="kn">import</span> <span class="n">to_onnx</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">X</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">InferenceSession</span>

<span class="n">x_exp</span> <span class="o">=</span> <span class="n">X_test</span>

<span class="n">oinf</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)</span>

<span class="n">got</span> <span class="o">=</span> <span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">x_exp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.7421041873949668
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnx_array_api.plotting.text_plot</span> <span class="kn">import</span> <span class="n">onnx_simple_text_plot</span>

<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onx</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
opset: domain=&#39;ai.onnx.ml&#39; version=1
opset: domain=&#39;&#39; version=15
input: name=&#39;X&#39; type=dtype(&#39;float32&#39;) shape=[None, 10]
TreeEnsembleRegressor(X, n_targets=1, nodes_falsenodeids=253:[128,65,34...252,0,0], nodes_featureids=253:[8,3,9...2,0,0], nodes_hitrates=253:[1.0,1.0...1.0,1.0], nodes_missing_value_tracks_true=253:[0,0,0...0,0,0], nodes_modes=253:[b&#39;BRANCH_LEQ&#39;,b&#39;BRANCH_LEQ&#39;...b&#39;LEAF&#39;,b&#39;LEAF&#39;], nodes_nodeids=253:[0,1,2...250,251,252], nodes_treeids=253:[0,0,0...0,0,0], nodes_truenodeids=253:[1,2,3...251,0,0], nodes_values=253:[0.00792999193072319,-0.12246682494878769...0.0,0.0], post_transform=b&#39;NONE&#39;, target_ids=127:[0,0,0...0,0,0], target_nodeids=127:[7,8,10...249,251,252], target_treeids=127:[0,0,0...0,0,0], target_weights=127:[-0.9345570802688599,-0.6372960805892944...0.6169403195381165,1.0096807479858398]) -&gt; variable
output: name=&#39;variable&#39; type=dtype(&#39;float32&#39;) shape=[None, 1]
</pre></div></div>
</div>
</section>
</section>
<section id="Après-la-conversion-en-un-réseau-de-neurones">
<h2>Après la conversion en un réseau de neurones<a class="headerlink" href="#Après-la-conversion-en-un-réseau-de-neurones" title="Link to this heading">#</a></h2>
<section id="Conversion-en-un-réseau-de-neurones">
<h3>Conversion en un réseau de neurones<a class="headerlink" href="#Conversion-en-un-réseau-de-neurones" title="Link to this heading">#</a></h3>
<p>Un paramètre permet de faire varier la pente des fonctions sigmoïdes utilisées.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">mlstatpy.ml.neural_tree</span> <span class="kn">import</span> <span class="n">NeuralTreeNet</span>

<span class="n">xe</span> <span class="o">=</span> <span class="n">x_exp</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xe</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trees</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">5</span><span class="p">))):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">NeuralTreeNet</span><span class="o">.</span><span class="n">create_from_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="s2">&quot;compact&quot;</span><span class="p">)</span>
    <span class="n">got</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xe</span><span class="p">)[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">me</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">mx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">me</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">trees</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 18/18 [00:01&lt;00:00, 12.49it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>k</th>
      <th>max</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.3</td>
      <td>0.568981</td>
      <td>0.158758</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.4</td>
      <td>0.608304</td>
      <td>0.132576</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.5</td>
      <td>0.692657</td>
      <td>0.128525</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.7</td>
      <td>0.780543</td>
      <td>0.131497</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.9</td>
      <td>0.809866</td>
      <td>0.128368</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>0.813889</td>
      <td>0.124802</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5.0</td>
      <td>0.392482</td>
      <td>0.022466</td>
    </tr>
    <tr>
      <th>7</th>
      <td>10.0</td>
      <td>0.341749</td>
      <td>0.006350</td>
    </tr>
    <tr>
      <th>8</th>
      <td>15.0</td>
      <td>0.270649</td>
      <td>0.002939</td>
    </tr>
    <tr>
      <th>9</th>
      <td>20.0</td>
      <td>0.299713</td>
      <td>0.002110</td>
    </tr>
    <tr>
      <th>10</th>
      <td>25.0</td>
      <td>0.305493</td>
      <td>0.001842</td>
    </tr>
    <tr>
      <th>11</th>
      <td>30.0</td>
      <td>0.306111</td>
      <td>0.001767</td>
    </tr>
    <tr>
      <th>12</th>
      <td>35.0</td>
      <td>0.299371</td>
      <td>0.001665</td>
    </tr>
    <tr>
      <th>13</th>
      <td>40.0</td>
      <td>0.233556</td>
      <td>0.001011</td>
    </tr>
    <tr>
      <th>14</th>
      <td>45.0</td>
      <td>0.233606</td>
      <td>0.000801</td>
    </tr>
    <tr>
      <th>15</th>
      <td>50.0</td>
      <td>0.233614</td>
      <td>0.000547</td>
    </tr>
    <tr>
      <th>16</th>
      <td>55.0</td>
      <td>0.233615</td>
      <td>0.000499</td>
    </tr>
    <tr>
      <th>17</th>
      <td>60.0</td>
      <td>0.233615</td>
      <td>0.000484</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Précision de la conversion</span><span class="se">\n</span><span class="s2">en réseau de neurones&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_ml_neural_tree_onnx_20_0.png" src="../../_images/notebooks_ml_neural_tree_onnx_20_0.png" />
</div>
</div>
<p>L’erreur est meilleure mais il faudrait recommencer l’expérience plusieurs fois avant de pouvoir conclure afin d’obtenir un interval de confiance pour le même type de jeu de données. Ce sera pour une autre fois. Le résultat dépend du jeu de données et surtout de la proximité des seuils de décisions. Néanmoins, on calcule l’erreur sur l’ensemble de la base de test. Celle-ci a été tronquée pour aller plus vite.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)</span>
<span class="n">got</span> <span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.2336143002078063, 0.0002511855017989173)
</pre></div></div>
</div>
<p>On voit que l’erreur peut-être très grande. Elle reste néanmoins plus petite que l’erreur de conversion introduite par ONNX.</p>
</section>
<section id="id1">
<h3>Conversion au format ONNX<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>On crée tout d’abord une classe qui suit l’API de scikit-learn et qui englobe l’arbre qui vient d’être créé qui sera ensuite convertit en ONNX.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlstatpy.ml.neural_tree</span> <span class="kn">import</span> <span class="n">NeuralTreeNetRegressor</span>

<span class="n">reg</span> <span class="o">=</span> <span class="n">NeuralTreeNetRegressor</span><span class="p">(</span><span class="n">trees</span><span class="p">[</span><span class="mi">50</span><span class="p">])</span>
<span class="n">onx2</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">X</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onx2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
opset: domain=&#39;&#39; version=15
input: name=&#39;X&#39; type=dtype(&#39;float32&#39;) shape=[None, 10]
init: name=&#39;Ma_MatMulcst&#39; type=dtype(&#39;float32&#39;) shape=(1260,)
init: name=&#39;Ad_Addcst&#39; type=dtype(&#39;float32&#39;) shape=(126,)
init: name=&#39;Mu_Mulcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([4.], dtype=float32)
init: name=&#39;Ma_MatMulcst1&#39; type=dtype(&#39;float32&#39;) shape=(16002,)
init: name=&#39;Ad_Addcst1&#39; type=dtype(&#39;float32&#39;) shape=(127,)
init: name=&#39;Ma_MatMulcst2&#39; type=dtype(&#39;float32&#39;) shape=(127,)
init: name=&#39;Ad_Addcst2&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([0.], dtype=float32)
MatMul(X, Ma_MatMulcst) -&gt; Ma_Y02
  Add(Ma_Y02, Ad_Addcst) -&gt; Ad_C02
    Mul(Ad_C02, Mu_Mulcst) -&gt; Mu_C01
      Sigmoid(Mu_C01) -&gt; Si_Y01
        MatMul(Si_Y01, Ma_MatMulcst1) -&gt; Ma_Y01
          Add(Ma_Y01, Ad_Addcst1) -&gt; Ad_C01
            Mul(Ad_C01, Mu_Mulcst) -&gt; Mu_C0
              Sigmoid(Mu_C0) -&gt; Si_Y0
                MatMul(Si_Y0, Ma_MatMulcst2) -&gt; Ma_Y0
                  Add(Ma_Y0, Ad_Addcst2) -&gt; Ad_C0
                    Identity(Ad_C0) -&gt; variable
output: name=&#39;variable&#39; type=dtype(&#39;float32&#39;) shape=[None, 1]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oinf2</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">onx2</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime1&quot;</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)</span>

<span class="n">got</span> <span class="o">=</span> <span class="n">oinf2</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">x_exp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.7421041873949668
</pre></div></div>
</div>
<p>L’erreur est la même.</p>
</section>
</section>
<section id="Temps-de-calcul">
<h2>Temps de calcul<a class="headerlink" href="#Temps-de-calcul" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_exp32</span> <span class="o">=</span> <span class="n">x_exp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Tout d’abord le temps de calcul pour scikit-learn.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> tree.predict(x_exp32)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
513 µs ± 7.52 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre></div></div>
</div>
<p>Le temps de calcul pour l’arbre de décision au format ONNX.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> oinf.run({&#39;X&#39;: x_exp32})[&#39;variable&#39;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
186 µs ± 3.41 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
</pre></div></div>
</div>
<p>Et le temps de calcul pour le réseau de neurones au format ONNX.m</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> oinf2.run({&#39;X&#39;: x_exp32})[&#39;variable&#39;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.75 ms ± 311 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<p>Ce temps de calcul très long est attendu car le modèle contient une multiplication de matrice très grande et surtout que tous les seuils de l’arbre sont calculés pour chaque observation. Là où l’implémentation de l’arbre de décision calcule <em>d</em> seuils, la profondeur de l’arbre, la nouvelle implémentation calcule tous les seuils soit <img class="math" src="../../_images/math/1682d5137f90f59dfe3c374bc145e09fd8338436.svg" alt="2^d"/> pour chaque feuille. Il y a <img class="math" src="../../_images/math/1682d5137f90f59dfe3c374bc145e09fd8338436.svg" alt="2^d"/> feuilles. Même en étant sparse, on peut réduire les calculs à <img class="math" src="../../_images/math/737dcde232cf6ef3e1c0a36492a42743119ec6c2.svg" alt="d * 2^d"/> ce qui fait encore beaucoup de
calculs inutiles.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(126, 11) (126,)
(127, 127) (127,)
(128,) ()
</pre></div></div>
</div>
<p>Cela dit, la plus grande matrice est creuse, elle peut être réduite considérablement.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="n">csr</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;coef.shape=</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, size dense=</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">coef</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;size sparse=</span><span class="si">{</span><span class="n">csr</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">, ratio=</span><span class="si">{</span><span class="n">csr</span><span class="o">.</span><span class="n">size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">node</span><span class="o">.</span><span class="n">coef</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coef.shape=(126, 11), size dense=1386, size sparse=252, ratio=0.18181818181818182
coef.shape=(127, 127), size dense=16129, size sparse=1015, ratio=0.06293012586025172
coef.shape=(128,), size dense=128, size sparse=127, ratio=0.9921875
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">trees</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef</span>
<span class="o">%</span><span class="k">timeit</span> mat @ r
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
49.8 µs ± 1.25 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csr</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> csr @ r
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7.08 µs ± 173 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)
</pre></div></div>
</div>
<p>Ce serait beaucoup plus rapide avec une matrice sparse et d’autant plus rapide que l’arbre est profond. Le modèle ONNX se décompose comme suit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onx2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
opset: domain=&#39;&#39; version=15
input: name=&#39;X&#39; type=dtype(&#39;float32&#39;) shape=[None, 10]
init: name=&#39;Ma_MatMulcst&#39; type=dtype(&#39;float32&#39;) shape=(1260,)
init: name=&#39;Ad_Addcst&#39; type=dtype(&#39;float32&#39;) shape=(126,)
init: name=&#39;Mu_Mulcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([4.], dtype=float32)
init: name=&#39;Ma_MatMulcst1&#39; type=dtype(&#39;float32&#39;) shape=(16002,)
init: name=&#39;Ad_Addcst1&#39; type=dtype(&#39;float32&#39;) shape=(127,)
init: name=&#39;Ma_MatMulcst2&#39; type=dtype(&#39;float32&#39;) shape=(127,)
init: name=&#39;Ad_Addcst2&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([0.], dtype=float32)
MatMul(X, Ma_MatMulcst) -&gt; Ma_Y02
  Add(Ma_Y02, Ad_Addcst) -&gt; Ad_C02
    Mul(Ad_C02, Mu_Mulcst) -&gt; Mu_C01
      Sigmoid(Mu_C01) -&gt; Si_Y01
        MatMul(Si_Y01, Ma_MatMulcst1) -&gt; Ma_Y01
          Add(Ma_Y01, Ad_Addcst1) -&gt; Ad_C01
            Mul(Ad_C01, Mu_Mulcst) -&gt; Mu_C0
              Sigmoid(Mu_C0) -&gt; Si_Y0
                MatMul(Si_Y0, Ma_MatMulcst2) -&gt; Ma_Y0
                  Add(Ma_Y0, Ad_Addcst2) -&gt; Ad_C0
                    Identity(Ad_C0) -&gt; variable
output: name=&#39;variable&#39; type=dtype(&#39;float32&#39;) shape=[None, 1]
</pre></div></div>
</div>
<p>Voyons comment le temps de calcul se répartit.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oinfpr</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span>
    <span class="n">onx2</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime1&quot;</span><span class="p">,</span> <span class="n">runtime_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;enable_profiling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">43</span><span class="p">):</span>
    <span class="n">oinfpr</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">x_exp32</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">oinfpr</span><span class="o">.</span><span class="n">get_profiling</span><span class="p">(</span><span class="n">as_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cat</th>
      <th>pid</th>
      <th>tid</th>
      <th>dur</th>
      <th>ts</th>
      <th>ph</th>
      <th>name</th>
      <th>args_op_name</th>
      <th>args_parameter_size</th>
      <th>args_graph_index</th>
      <th>args_provider</th>
      <th>args_exec_plan_index</th>
      <th>args_activation_size</th>
      <th>args_output_size</th>
      <th>args_input_type_shape</th>
      <th>args_output_type_shape</th>
      <th>args_thread_scheduling_stats</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Session</td>
      <td>78116</td>
      <td>8820</td>
      <td>387</td>
      <td>4</td>
      <td>X</td>
      <td>model_loading_array</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Session</td>
      <td>78116</td>
      <td>8820</td>
      <td>2532</td>
      <td>428</td>
      <td>X</td>
      <td>session_initialization</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Node</td>
      <td>78116</td>
      <td>8820</td>
      <td>0</td>
      <td>3294</td>
      <td>X</td>
      <td>gemm_fence_before</td>
      <td>Gemm</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Node</td>
      <td>78116</td>
      <td>8820</td>
      <td>1315</td>
      <td>3300</td>
      <td>X</td>
      <td>gemm_kernel_time</td>
      <td>Gemm</td>
      <td>5544</td>
      <td>11</td>
      <td>CPUExecutionProvider</td>
      <td>11</td>
      <td>200000</td>
      <td>2520000</td>
      <td>[{'float': [5000, 10]}, {'float': [10, 126]}, ...</td>
      <td>[{'float': [5000, 126]}]</td>
      <td>{'main_thread': {'thread_pool_name': 'session-...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Node</td>
      <td>78116</td>
      <td>8820</td>
      <td>0</td>
      <td>4635</td>
      <td>X</td>
      <td>gemm_fence_after</td>
      <td>Gemm</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>986</th>
      <td>Node</td>
      <td>78116</td>
      <td>8820</td>
      <td>0</td>
      <td>210170</td>
      <td>X</td>
      <td>Ma_MatMul2_fence_before</td>
      <td>MatMul</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>987</th>
      <td>Node</td>
      <td>78116</td>
      <td>8820</td>
      <td>124</td>
      <td>210172</td>
      <td>X</td>
      <td>Ma_MatMul2_kernel_time</td>
      <td>MatMul</td>
      <td>508</td>
      <td>8</td>
      <td>CPUExecutionProvider</td>
      <td>8</td>
      <td>2540000</td>
      <td>20000</td>
      <td>[{'float': [5000, 127]}, {'float': [127, 1]}]</td>
      <td>[{'float': [5000, 1]}]</td>
      <td>{'main_thread': {'thread_pool_name': 'session-...</td>
    </tr>
    <tr>
      <th>988</th>
      <td>Node</td>
      <td>78116</td>
      <td>8820</td>
      <td>0</td>
      <td>210305</td>
      <td>X</td>
      <td>Ma_MatMul2_fence_after</td>
      <td>MatMul</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>989</th>
      <td>Session</td>
      <td>78116</td>
      <td>8820</td>
      <td>4378</td>
      <td>205930</td>
      <td>X</td>
      <td>SequentialExecutor::Execute</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>990</th>
      <td>Session</td>
      <td>78116</td>
      <td>8820</td>
      <td>4388</td>
      <td>205925</td>
      <td>X</td>
      <td>model_run</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>991 rows × 17 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;args_provider&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;CPUExecutionProvider&#39;, nan}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">args_provider</span> <span class="o">==</span> <span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dfp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_kernel_time&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="n">gr_dur</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dfp</span><span class="p">[[</span><span class="s2">&quot;dur&quot;</span><span class="p">,</span> <span class="s2">&quot;args_op_name&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;args_op_name&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dur&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">gr_dur</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>dur</th>
    </tr>
    <tr>
      <th>args_op_name</th>
      <th>name</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MatMul</th>
      <th>Ma_MatMul2</th>
      <td>6778</td>
    </tr>
    <tr>
      <th>Mul</th>
      <th>Mu_Mul</th>
      <td>12923</td>
    </tr>
    <tr>
      <th>Sigmoid</th>
      <th>Si_Sigmoid</th>
      <td>14849</td>
    </tr>
    <tr>
      <th>Mul</th>
      <th>Mu_Mul1</th>
      <td>15151</td>
    </tr>
    <tr>
      <th>Sigmoid</th>
      <th>Si_Sigmoid1</th>
      <td>15608</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Gemm</th>
      <th>gemm</th>
      <td>31763</td>
    </tr>
    <tr>
      <th>gemm_token_0</th>
      <td>99047</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr_n</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dfp</span><span class="p">[[</span><span class="s2">&quot;dur&quot;</span><span class="p">,</span> <span class="s2">&quot;args_op_name&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;args_op_name&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dur&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">gr_n</span> <span class="o">=</span> <span class="n">gr_n</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gr_dur</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">gr_n</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>dur</th>
    </tr>
    <tr>
      <th>args_op_name</th>
      <th>name</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MatMul</th>
      <th>Ma_MatMul2</th>
      <td>43</td>
    </tr>
    <tr>
      <th>Mul</th>
      <th>Mu_Mul</th>
      <td>43</td>
    </tr>
    <tr>
      <th>Sigmoid</th>
      <th>Si_Sigmoid</th>
      <td>43</td>
    </tr>
    <tr>
      <th>Mul</th>
      <th>Mu_Mul1</th>
      <td>43</td>
    </tr>
    <tr>
      <th>Sigmoid</th>
      <th>Si_Sigmoid1</th>
      <td>43</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Gemm</th>
      <th>gemm</th>
      <td>43</td>
    </tr>
    <tr>
      <th>gemm_token_0</th>
      <td>43</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">gr_dur</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">gr_n</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;n occurences&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_ml_neural_tree_onnx_51_0.png" src="../../_images/notebooks_ml_neural_tree_onnx_51_0.png" />
</div>
</div>
<p>onnxruntime passe principalement son temps dans un produit matriciel. On vérifie plus précisément.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">args_op_name</span> <span class="o">==</span> <span class="s2">&quot;Gemm&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dur</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dur&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>127</th>
      <th>12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <td>Node</td>
      <td>Node</td>
    </tr>
    <tr>
      <th>pid</th>
      <td>78116</td>
      <td>78116</td>
    </tr>
    <tr>
      <th>tid</th>
      <td>8820</td>
      <td>8820</td>
    </tr>
    <tr>
      <th>dur</th>
      <td>4603</td>
      <td>4083</td>
    </tr>
    <tr>
      <th>ts</th>
      <td>37173</td>
      <td>5949</td>
    </tr>
    <tr>
      <th>ph</th>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <th>name</th>
      <td>gemm_token_0_kernel_time</td>
      <td>gemm_token_0_kernel_time</td>
    </tr>
    <tr>
      <th>args_op_name</th>
      <td>Gemm</td>
      <td>Gemm</td>
    </tr>
    <tr>
      <th>args_parameter_size</th>
      <td>64516</td>
      <td>64516</td>
    </tr>
    <tr>
      <th>args_graph_index</th>
      <td>12</td>
      <td>12</td>
    </tr>
    <tr>
      <th>args_provider</th>
      <td>CPUExecutionProvider</td>
      <td>CPUExecutionProvider</td>
    </tr>
    <tr>
      <th>args_exec_plan_index</th>
      <td>12</td>
      <td>12</td>
    </tr>
    <tr>
      <th>args_activation_size</th>
      <td>2520000</td>
      <td>2520000</td>
    </tr>
    <tr>
      <th>args_output_size</th>
      <td>2540000</td>
      <td>2540000</td>
    </tr>
    <tr>
      <th>args_input_type_shape</th>
      <td>[{'float': [5000, 126]}, {'float': [126, 127]}...</td>
      <td>[{'float': [5000, 126]}, {'float': [126, 127]}...</td>
    </tr>
    <tr>
      <th>args_output_type_shape</th>
      <td>[{'float': [5000, 127]}]</td>
      <td>[{'float': [5000, 127]}]</td>
    </tr>
    <tr>
      <th>args_thread_scheduling_stats</th>
      <td>{'main_thread': {'thread_pool_name': 'session-...</td>
      <td>{'main_thread': {'thread_pool_name': 'session-...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>C’est un produit matriciel d’environ <em>5000x800</em> par <em>800x800</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr_dur</span> <span class="o">/</span> <span class="n">gr_dur</span><span class="o">.</span><span class="n">dur</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>dur</th>
    </tr>
    <tr>
      <th>args_op_name</th>
      <th>name</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MatMul</th>
      <th>Ma_MatMul2</th>
      <td>0.034561</td>
    </tr>
    <tr>
      <th>Mul</th>
      <th>Mu_Mul</th>
      <td>0.065894</td>
    </tr>
    <tr>
      <th>Sigmoid</th>
      <th>Si_Sigmoid</th>
      <td>0.075714</td>
    </tr>
    <tr>
      <th>Mul</th>
      <th>Mu_Mul1</th>
      <td>0.077254</td>
    </tr>
    <tr>
      <th>Sigmoid</th>
      <th>Si_Sigmoid1</th>
      <td>0.079584</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Gemm</th>
      <th>gemm</th>
      <td>0.161958</td>
    </tr>
    <tr>
      <th>gemm_token_0</th>
      <td>0.505035</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">gr_dur</span> <span class="o">/</span> <span class="n">gr_dur</span><span class="o">.</span><span class="n">dur</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">dur</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">r</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.5050352082154203
</pre></div></div>
</div>
<p>Il occupe 82% du temps. et d’après l’expérience précédente, son temps d’éxecution peut-être réduit par 10 en le remplaçant par une matrice sparse. Cela ne suffira pas pour accélerer le temps de calcul de ce réseau de neurones. Il est 84 ms comparé à 247 µs pour l’arbre de décision. Avec cette optimisation, il pourrait passer de :</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="mf">3.75</span>  <span class="c1"># ms</span>
<span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.013941471759493
</pre></div></div>
</div>
<p>Soit une réduction du temps de calcul. Ce n’est pas mal mais pas assez.</p>
</section>
<section id="Hummingbird">
<h2>Hummingbird<a class="headerlink" href="#Hummingbird" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/microsoft/hummingbird">hummingbird</a> est une librairie qui convertit un arbre de décision en réseau de neurones. Voyons ses performances.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hummingbird.ml</span> <span class="kn">import</span> <span class="n">convert</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;torch&quot;</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)</span>
<span class="n">got</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\xavierdupre\__home_\github_fork\scikit-learn\sklearn\utils\deprecation.py:103: FutureWarning: The attribute `n_features_` is deprecated in 1.0 and will be removed in 1.2. Use `n_features_in_` instead.
  warnings.warn(msg, category=FutureWarning)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4.3419181139370266e-08, 4.430287026515114e-09)
</pre></div></div>
</div>
<p>Le résultat est beaucoup plus fidèle au modèle.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> model.predict(x_exp)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.17 ms ± 34.8 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre></div></div>
</div>
<p>Il reste plus lent mais beaucoup plus rapide que la solution manuelle proposée dans les précédents paragraphes. Il contient un attribut <code class="docutils literal notranslate"><span class="pre">model</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">Module</span>

<span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">Module</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>On convertit ce modèle au format ONNX.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch.onnx</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">x_exp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_exp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="s2">&quot;tree_torch.onnx&quot;</span><span class="p">,</span>
    <span class="n">opset_version</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span>
    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">],</span>
    <span class="n">dynamic_axes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">},</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">}},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>

<span class="n">onxh</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;tree_torch.onnx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onxh</span><span class="p">,</span> <span class="n">raise_exc</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
opset: domain=&#39;&#39; version=15
input: name=&#39;X&#39; type=dtype(&#39;float32&#39;) shape=[&#39;batch_size&#39;, 10]
init: name=&#39;_operators.0.root_nodes&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([8], dtype=int64)
init: name=&#39;_operators.0.root_biases&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([0.00792999], dtype=float32)
init: name=&#39;_operators.0.tree_indices&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([0], dtype=int64)
init: name=&#39;_operators.0.leaf_nodes&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([ 1.0096807 ,  0.6169403 ,  0.61055773,  0.37810475,  0.31796893,
        0.13317925,  0.0193846 , -0.2317742 ,  0.39089343,  0.23506087,
        0.3711936 ,  0.10317916,  0.14956598, -0.14193445, -0.05965868,
       -0.27377078,  0.4128183 ,  0.19658326,  0.25545415,  0.08118545,
        0.08400188, -0.1502193 , -0.36846825, -0.79687625,  0.35822242,
        0.49021915,  0.30870998,  0.01033915,  0.6740977 ,  0.6740977 ,
       -0.15315758, -0.41128033,  0.42920846,  0.13145493,  0.21853392,
       -0.10986731,  0.4493652 ,  0.11318789,  0.12666471, -0.0623082 ,
        0.2872893 ,  0.09948976,  0.11439473, -0.08801427,  0.16091613,
       -0.02319027, -0.10097775, -0.37583745,  0.18612385, -0.00453244,
        0.3287116 , -0.1499349 ,  0.7919218 ,  0.04704398, -0.15423109,
       -0.43160027,  0.10802375, -0.1073833 , -0.07759219, -0.29175794,
       -0.1528881 , -0.4909434 , -0.23361537, -0.43578717,  0.7831867 ,
        0.45349318,  0.34956965, -0.3199535 ,  0.3061573 , -0.34267113,
        0.34963542,  0.04491445,  0.35399815,  0.14815213,  0.06678926,
       -0.16095412,  0.3214274 ,  0.01484008, -0.1012276 , -0.3257699 ,
        0.26727676,  0.01970094,  0.10760042, -0.09169976,  0.20044112,
       -0.0324069 , -0.11015374, -0.28358367,  0.8083656 ,  0.13358633,
       -0.07912118, -0.27182895, -0.07054728, -0.24895027, -0.20600456,
       -0.42033467,  0.34701794, -0.0638995 ,  0.14252576, -0.06025055,
        0.4228329 ,  0.06789401,  0.03919645, -0.17267554,  0.07274943,
       -0.487512  ,  0.04517636, -0.18857062, -0.03975222, -0.2652712 ,
       -0.30853328, -0.50844556,  0.03321444, -0.15481217, -0.20701212,
       -0.40578464, -0.25884995, -0.46550158, -0.4797585 , -0.7324234 ,
        0.43939307, -0.06170902, -0.51546025, -0.19215119, -0.3705445 ,
       -0.57504356, -0.6372961 , -0.9345571 ], dtype=float32)
init: name=&#39;_operators.0.nodes.0&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([0, 3], dtype=int64)
init: name=&#39;_operators.0.nodes.1&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([1, 2, 5, 9], dtype=int64)
init: name=&#39;_operators.0.nodes.2&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([5, 6, 3, 7, 2, 0, 7, 1], dtype=int64)
init: name=&#39;_operators.0.nodes.3&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([3, 9, 5, 3, 6, 4, 1, 3, 6, 6, 1, 6, 5, 4, 6, 2], dtype=int64)
init: name=&#39;_operators.0.nodes.4&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([3, 2, 7, 6, 2, 4, 7, 8, 9, 5, 7, 8, 9, 4, 6, 9, 7, 9, 0, 7, 7, 9,
       2, 7, 6, 4, 6, 5, 4, 0, 6, 0], dtype=int64)
init: name=&#39;_operators.0.nodes.5&#39; type=dtype(&#39;int64&#39;) shape=(0,) -- array([2, 8, 7, 6, 6, 3, 4, 9, 7, 3, 2, 6, 3, 3, 0, 1, 1, 0, 4, 7, 9, 5,
       7, 9, 5, 3, 5, 9, 0, 5, 1, 4, 9, 4, 7, 7, 1, 9, 1, 1, 6, 2, 7, 7,
       6, 1, 4, 4, 0, 0, 9, 8, 8, 2, 6, 2, 0, 3, 4, 2, 5, 6, 7, 3],
      dtype=int64)
init: name=&#39;_operators.0.biases.0&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([ 0.19169255, -0.12246682], dtype=float32)
init: name=&#39;_operators.0.biases.1&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([-0.40610337, -0.1467492 , -0.01880287,  0.15879431], dtype=float32)
init: name=&#39;_operators.0.biases.2&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([ 0.736786  , -0.32427853,  0.30860555,  0.17994082,  0.6917758 ,
       -0.00594712,  0.35950053, -0.9819274 ], dtype=float32)
init: name=&#39;_operators.0.biases.3&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([-1.3495584 , -1.082793  , -0.6906011 , -0.08978076, -0.4007622 ,
        0.10756078, -0.68507075,  0.15814054,  0.5132364 , -0.18426335,
        0.13685235,  0.10721841,  0.01814443, -0.41644228, -0.59770894,
        0.607365  ], dtype=float32)
init: name=&#39;_operators.0.biases.4&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([ 1.4203796 , -0.49269757, -0.12210988, -0.09692484,  0.5076643 ,
       -1.3609421 ,  1.154743  ,  2.8748922 , -0.08181615,  0.7741028 ,
        0.20604724,  0.666296  , -0.6474025 ,  0.6459148 ,  0.02262808,
       -0.42282397,  0.46360654, -0.10058792,  0.25486696,  0.60041225,
       -0.06933744,  0.21294908,  0.96443814,  0.07923891,  0.4797698 ,
        1.2852331 ,  0.24348404, -0.3404966 , -0.07175394, -0.8248828 ,
       -0.74071133, -1.2140133 ], dtype=float32)
init: name=&#39;_operators.0.biases.5&#39; type=dtype(&#39;float32&#39;) shape=(0,) -- array([ 1.0626682 ,  1.4745288 ,  0.01898679,  0.5451088 ,  0.15444604,
        1.0631477 , -0.7555804 , -1.7192128 , -0.20905146,  0.19752283,
       -0.40471953,  0.13069782,  0.60331047,  1.5060809 ,  0.        ,
       -1.8283446 , -0.8124372 , -1.381897  ,  0.59209645,  0.3239226 ,
       -0.42840806, -0.43624896,  0.58229303, -1.0196047 , -0.5632828 ,
        0.91483426,  1.8038778 , -0.5665638 , -1.2530733 , -0.6500004 ,
       -1.3069727 ,  0.48267984,  0.73503745, -1.871724  , -1.4965518 ,
        1.3147466 ,  0.03919952, -0.885836  ,  0.5479692 , -0.8086383 ,
       -0.74240863,  0.14582941,  0.6496967 , -0.00911551,  2.4541488 ,
       -0.90482277,  0.26108736,  0.7569448 , -1.0786855 , -0.45229852,
        1.2146595 , -0.6756766 , -2.3066258 ,  0.7911504 ,  0.57490873,
       -0.40741247,  0.24633038, -1.2022957 , -0.65162694, -0.04244827,
        1.558136  , -1.6220782 ,  0.1574643 , -1.4209061 ], dtype=float32)
Constant(value=[-1]) -&gt; onnx::Reshape_27
Gather(X, _operators.0.root_nodes, axis=1) -&gt; onnx::LessOrEqual_17
  LessOrEqual(onnx::LessOrEqual_17, _operators.0.root_biases) -&gt; onnx::Cast_18
    Cast(onnx::Cast_18, to=7) -&gt; onnx::Add_19
      Add(onnx::Add_19, _operators.0.tree_indices) -&gt; onnx::Reshape_20
Constant(value=[-1]) -&gt; onnx::Reshape_21
  Reshape(onnx::Reshape_20, onnx::Reshape_21, allowzero=0) -&gt; onnx::Gather_22
    Gather(_operators.0.nodes.0, onnx::Gather_22, axis=0) -&gt; onnx::Reshape_23
Constant(value=[-1, 1]) -&gt; onnx::Reshape_24
  Reshape(onnx::Reshape_23, onnx::Reshape_24, allowzero=0) -&gt; onnx::GatherElements_25
    GatherElements(X, onnx::GatherElements_25, axis=1) -&gt; onnx::Reshape_26
  Reshape(onnx::Reshape_26, onnx::Reshape_27, allowzero=0) -&gt; onnx::LessOrEqual_28
Constant(value=2) -&gt; onnx::Mul_29
  Mul(onnx::Gather_22, onnx::Mul_29) -&gt; onnx::Add_30
Gather(_operators.0.biases.0, onnx::Gather_22, axis=0) -&gt; onnx::LessOrEqual_31
  LessOrEqual(onnx::LessOrEqual_28, onnx::LessOrEqual_31) -&gt; onnx::Cast_32
    Cast(onnx::Cast_32, to=7) -&gt; onnx::Add_33
    Add(onnx::Add_30, onnx::Add_33) -&gt; onnx::Gather_34
      Gather(_operators.0.nodes.1, onnx::Gather_34, axis=0) -&gt; onnx::Reshape_35
Constant(value=[-1, 1]) -&gt; onnx::Reshape_36
  Reshape(onnx::Reshape_35, onnx::Reshape_36, allowzero=0) -&gt; onnx::GatherElements_37
    GatherElements(X, onnx::GatherElements_37, axis=1) -&gt; onnx::Reshape_38
Constant(value=[-1]) -&gt; onnx::Reshape_39
  Reshape(onnx::Reshape_38, onnx::Reshape_39, allowzero=0) -&gt; onnx::LessOrEqual_40
Constant(value=2) -&gt; onnx::Mul_41
  Mul(onnx::Gather_34, onnx::Mul_41) -&gt; onnx::Add_42
Gather(_operators.0.biases.1, onnx::Gather_34, axis=0) -&gt; onnx::LessOrEqual_43
  LessOrEqual(onnx::LessOrEqual_40, onnx::LessOrEqual_43) -&gt; onnx::Cast_44
    Cast(onnx::Cast_44, to=7) -&gt; onnx::Add_45
    Add(onnx::Add_42, onnx::Add_45) -&gt; onnx::Gather_46
      Gather(_operators.0.nodes.2, onnx::Gather_46, axis=0) -&gt; onnx::Reshape_47
Constant(value=[-1, 1]) -&gt; onnx::Reshape_48
  Reshape(onnx::Reshape_47, onnx::Reshape_48, allowzero=0) -&gt; onnx::GatherElements_49
    GatherElements(X, onnx::GatherElements_49, axis=1) -&gt; onnx::Reshape_50
Constant(value=[-1]) -&gt; onnx::Reshape_51
  Reshape(onnx::Reshape_50, onnx::Reshape_51, allowzero=0) -&gt; onnx::LessOrEqual_52
Constant(value=2) -&gt; onnx::Mul_53
  Mul(onnx::Gather_46, onnx::Mul_53) -&gt; onnx::Add_54
Gather(_operators.0.biases.2, onnx::Gather_46, axis=0) -&gt; onnx::LessOrEqual_55
  LessOrEqual(onnx::LessOrEqual_52, onnx::LessOrEqual_55) -&gt; onnx::Cast_56
    Cast(onnx::Cast_56, to=7) -&gt; onnx::Add_57
    Add(onnx::Add_54, onnx::Add_57) -&gt; onnx::Gather_58
      Gather(_operators.0.nodes.3, onnx::Gather_58, axis=0) -&gt; onnx::Reshape_59
Constant(value=[-1, 1]) -&gt; onnx::Reshape_60
  Reshape(onnx::Reshape_59, onnx::Reshape_60, allowzero=0) -&gt; onnx::GatherElements_61
    GatherElements(X, onnx::GatherElements_61, axis=1) -&gt; onnx::Reshape_62
Constant(value=[-1]) -&gt; onnx::Reshape_63
  Reshape(onnx::Reshape_62, onnx::Reshape_63, allowzero=0) -&gt; onnx::LessOrEqual_64
Constant(value=2) -&gt; onnx::Mul_65
  Mul(onnx::Gather_58, onnx::Mul_65) -&gt; onnx::Add_66
Gather(_operators.0.biases.3, onnx::Gather_58, axis=0) -&gt; onnx::LessOrEqual_67
  LessOrEqual(onnx::LessOrEqual_64, onnx::LessOrEqual_67) -&gt; onnx::Cast_68
    Cast(onnx::Cast_68, to=7) -&gt; onnx::Add_69
    Add(onnx::Add_66, onnx::Add_69) -&gt; onnx::Gather_70
      Gather(_operators.0.nodes.4, onnx::Gather_70, axis=0) -&gt; onnx::Reshape_71
Constant(value=[-1, 1]) -&gt; onnx::Reshape_72
  Reshape(onnx::Reshape_71, onnx::Reshape_72, allowzero=0) -&gt; onnx::GatherElements_73
    GatherElements(X, onnx::GatherElements_73, axis=1) -&gt; onnx::Reshape_74
Constant(value=[-1]) -&gt; onnx::Reshape_75
  Reshape(onnx::Reshape_74, onnx::Reshape_75, allowzero=0) -&gt; onnx::LessOrEqual_76
Constant(value=2) -&gt; onnx::Mul_77
  Mul(onnx::Gather_70, onnx::Mul_77) -&gt; onnx::Add_78
Gather(_operators.0.biases.4, onnx::Gather_70, axis=0) -&gt; onnx::LessOrEqual_79
  LessOrEqual(onnx::LessOrEqual_76, onnx::LessOrEqual_79) -&gt; onnx::Cast_80
    Cast(onnx::Cast_80, to=7) -&gt; onnx::Add_81
    Add(onnx::Add_78, onnx::Add_81) -&gt; onnx::Gather_82
      Gather(_operators.0.nodes.5, onnx::Gather_82, axis=0) -&gt; onnx::Reshape_83
Constant(value=[-1, 1]) -&gt; onnx::Reshape_84
  Reshape(onnx::Reshape_83, onnx::Reshape_84, allowzero=0) -&gt; onnx::GatherElements_85
    GatherElements(X, onnx::GatherElements_85, axis=1) -&gt; onnx::Reshape_86
Constant(value=[-1]) -&gt; onnx::Reshape_87
  Reshape(onnx::Reshape_86, onnx::Reshape_87, allowzero=0) -&gt; onnx::LessOrEqual_88
Constant(value=2) -&gt; onnx::Mul_89
  Mul(onnx::Gather_82, onnx::Mul_89) -&gt; onnx::Add_90
Gather(_operators.0.biases.5, onnx::Gather_82, axis=0) -&gt; onnx::LessOrEqual_91
  LessOrEqual(onnx::LessOrEqual_88, onnx::LessOrEqual_91) -&gt; onnx::Cast_92
    Cast(onnx::Cast_92, to=7) -&gt; onnx::Add_93
    Add(onnx::Add_90, onnx::Add_93) -&gt; onnx::Gather_94
      Gather(_operators.0.leaf_nodes, onnx::Gather_94, axis=0) -&gt; onnx::Reshape_95
Constant(value=[-1, 1, 1]) -&gt; onnx::Reshape_96
  Reshape(onnx::Reshape_95, onnx::Reshape_96, allowzero=0) -&gt; output
Constant(value=[1]) -&gt; onnx::ReduceSum_98
  ReduceSum(output, onnx::ReduceSum_98, keepdims=0) -&gt; variable
output: name=&#39;variable&#39; type=dtype(&#39;float32&#39;) shape=[&#39;batch_size&#39;, &#39;ReduceSumvariable_dim_1&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">onnxview</span> onxh
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="M383513f79aa048579be42d593ab48485-cont"><div id="M383513f79aa048579be42d593ab48485" style="width:;height:;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  nodesep=0.05;\n  orientation=portrait;\n  size=7;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\nfloat((0, 10))\" fontsize=10];\n\n  variable [shape=box color=green label=\"variable\nfloat((0, 0))\" fontsize=10];\n\n  _operators_0_root_nodes [shape=box label=\"_operators_0_root_nodes\nint64((1,))\n[8]\" fontsize=10];\n  _operators_0_root_biases [shape=box label=\"_operators_0_root_biases\nfloat32((1,))\n[0.00792999]\" fontsize=10];\n  _operators_0_tree_indices [shape=box label=\"_operators_0_tree_indices\nint64((1,))\n[0]\" fontsize=10];\n  _operators_0_leaf_nodes [shape=box label=\"_operators_0_leaf_nodes\nfloat32((128, 1))\n[[ 1.0096807 ]\n [ 0.6169403 ]\n [ 0.61055773]\n [ 0....\" fontsize=10];\n  _operators_0_nodes_0 [shape=box label=\"_operators_0_nodes_0\nint64((2,))\n[0 3]\" fontsize=10];\n  _operators_0_nodes_1 [shape=box label=\"_operators_0_nodes_1\nint64((4,))\n[1 2 5 9]\" fontsize=10];\n  _operators_0_nodes_2 [shape=box label=\"_operators_0_nodes_2\nint64((8,))\n[5 6 3 7 2 0 7 1]\" fontsize=10];\n  _operators_0_nodes_3 [shape=box label=\"_operators_0_nodes_3\nint64((16,))\n[3 9 5 3 6 4 1 3 6 6 1 6 5 4 6 2]\" fontsize=10];\n  _operators_0_nodes_4 [shape=box label=\"_operators_0_nodes_4\nint64((32,))\n[3 2 7 6 2 4 7 8 9 5 7 8 9 4 6 9 7 9 0 7 7 9 2 7 6...\" fontsize=10];\n  _operators_0_nodes_5 [shape=box label=\"_operators_0_nodes_5\nint64((64,))\n[2 8 7 6 6 3 4 9 7 3 2 6 3 3 0 1 1 0 4 7 9 5 7 9 5...\" fontsize=10];\n  _operators_0_biases_0 [shape=box label=\"_operators_0_biases_0\nfloat32((2,))\n[ 0.19169255 -0.12246682]\" fontsize=10];\n  _operators_0_biases_1 [shape=box label=\"_operators_0_biases_1\nfloat32((4,))\n[-0.40610337 -0.1467492  -0.01880287  0.15879431]\" fontsize=10];\n  _operators_0_biases_2 [shape=box label=\"_operators_0_biases_2\nfloat32((8,))\n[ 0.736786   -0.32427853  0.30860555  0.17994082  0.6917758  -0.00594712\n  0.35950053 -0.9819274 ]\" fontsize=10];\n  _operators_0_biases_3 [shape=box label=\"_operators_0_biases_3\nfloat32((16,))\n[-1.3495584  -1.082793   -0.6906011  -0.08978076 -...\" fontsize=10];\n  _operators_0_biases_4 [shape=box label=\"_operators_0_biases_4\nfloat32((32,))\n[ 1.4203796  -0.49269757 -0.12210988 -0.09692484  ...\" fontsize=10];\n  _operators_0_biases_5 [shape=box label=\"_operators_0_biases_5\nfloat32((64,))\n[ 1.0626682   1.4745288   0.01898679  0.5451088   ...\" fontsize=10];\n\n  onnx____LessOrEqual_17 [shape=box label=\"onnx____LessOrEqual_17\" fontsize=10];\n  Gather_0 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_0)\naxis=1\" fontsize=10];\n  X -> Gather_0;\n  _operators_0_root_nodes -> Gather_0;\n  Gather_0 -> onnx____LessOrEqual_17;\n\n  onnx____Cast_18 [shape=box label=\"onnx____Cast_18\" fontsize=10];\n  LessOrEqual_1 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_1)\" fontsize=10];\n  onnx____LessOrEqual_17 -> LessOrEqual_1;\n  _operators_0_root_biases -> LessOrEqual_1;\n  LessOrEqual_1 -> onnx____Cast_18;\n\n  onnx____Add_19 [shape=box label=\"onnx____Add_19\" fontsize=10];\n  Cast_2 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_2)\nto=7\" fontsize=10];\n  onnx____Cast_18 -> Cast_2;\n  Cast_2 -> onnx____Add_19;\n\n  onnx____Reshape_20 [shape=box label=\"onnx____Reshape_20\" fontsize=10];\n  Add_3 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_3)\" fontsize=10];\n  onnx____Add_19 -> Add_3;\n  _operators_0_tree_indices -> Add_3;\n  Add_3 -> onnx____Reshape_20;\n\n  onnx____Reshape_21 [shape=box label=\"onnx____Reshape_21\" fontsize=10];\n  Constant_4 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_4)\nvalue=[-1]\" fontsize=10];\n  Constant_4 -> onnx____Reshape_21;\n\n  onnx____Gather_22 [shape=box label=\"onnx____Gather_22\" fontsize=10];\n  Reshape_5 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_5)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_20 -> Reshape_5;\n  onnx____Reshape_21 -> Reshape_5;\n  Reshape_5 -> onnx____Gather_22;\n\n  onnx____Reshape_23 [shape=box label=\"onnx____Reshape_23\" fontsize=10];\n  Gather_6 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_6)\naxis=0\" fontsize=10];\n  _operators_0_nodes_0 -> Gather_6;\n  onnx____Gather_22 -> Gather_6;\n  Gather_6 -> onnx____Reshape_23;\n\n  onnx____Reshape_24 [shape=box label=\"onnx____Reshape_24\" fontsize=10];\n  Constant_7 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_7)\nvalue=[-1  1]\" fontsize=10];\n  Constant_7 -> onnx____Reshape_24;\n\n  onnx____GatherElements_25 [shape=box label=\"onnx____GatherElements_25\" fontsize=10];\n  Reshape_8 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_8)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_23 -> Reshape_8;\n  onnx____Reshape_24 -> Reshape_8;\n  Reshape_8 -> onnx____GatherElements_25;\n\n  onnx____Reshape_26 [shape=box label=\"onnx____Reshape_26\" fontsize=10];\n  GatherElements_9 [shape=box style=\"filled,rounded\" color=orange label=\"GatherElements\n(GatherElements_9)\naxis=1\" fontsize=10];\n  X -> GatherElements_9;\n  onnx____GatherElements_25 -> GatherElements_9;\n  GatherElements_9 -> onnx____Reshape_26;\n\n  onnx____Reshape_27 [shape=box label=\"onnx____Reshape_27\" fontsize=10];\n  Constant_10 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_10)\nvalue=[-1]\" fontsize=10];\n  Constant_10 -> onnx____Reshape_27;\n\n  onnx____LessOrEqual_28 [shape=box label=\"onnx____LessOrEqual_28\" fontsize=10];\n  Reshape_11 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_11)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_26 -> Reshape_11;\n  onnx____Reshape_27 -> Reshape_11;\n  Reshape_11 -> onnx____LessOrEqual_28;\n\n  onnx____Mul_29 [shape=box label=\"onnx____Mul_29\" fontsize=10];\n  Constant_12 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_12)\nvalue=2\" fontsize=10];\n  Constant_12 -> onnx____Mul_29;\n\n  onnx____Add_30 [shape=box label=\"onnx____Add_30\" fontsize=10];\n  Mul_13 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul_13)\" fontsize=10];\n  onnx____Gather_22 -> Mul_13;\n  onnx____Mul_29 -> Mul_13;\n  Mul_13 -> onnx____Add_30;\n\n  onnx____LessOrEqual_31 [shape=box label=\"onnx____LessOrEqual_31\" fontsize=10];\n  Gather_14 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_14)\naxis=0\" fontsize=10];\n  _operators_0_biases_0 -> Gather_14;\n  onnx____Gather_22 -> Gather_14;\n  Gather_14 -> onnx____LessOrEqual_31;\n\n  onnx____Cast_32 [shape=box label=\"onnx____Cast_32\" fontsize=10];\n  LessOrEqual_15 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_15)\" fontsize=10];\n  onnx____LessOrEqual_28 -> LessOrEqual_15;\n  onnx____LessOrEqual_31 -> LessOrEqual_15;\n  LessOrEqual_15 -> onnx____Cast_32;\n\n  onnx____Add_33 [shape=box label=\"onnx____Add_33\" fontsize=10];\n  Cast_16 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_16)\nto=7\" fontsize=10];\n  onnx____Cast_32 -> Cast_16;\n  Cast_16 -> onnx____Add_33;\n\n  onnx____Gather_34 [shape=box label=\"onnx____Gather_34\" fontsize=10];\n  Add_17 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_17)\" fontsize=10];\n  onnx____Add_30 -> Add_17;\n  onnx____Add_33 -> Add_17;\n  Add_17 -> onnx____Gather_34;\n\n  onnx____Reshape_35 [shape=box label=\"onnx____Reshape_35\" fontsize=10];\n  Gather_18 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_18)\naxis=0\" fontsize=10];\n  _operators_0_nodes_1 -> Gather_18;\n  onnx____Gather_34 -> Gather_18;\n  Gather_18 -> onnx____Reshape_35;\n\n  onnx____Reshape_36 [shape=box label=\"onnx____Reshape_36\" fontsize=10];\n  Constant_19 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_19)\nvalue=[-1  1]\" fontsize=10];\n  Constant_19 -> onnx____Reshape_36;\n\n  onnx____GatherElements_37 [shape=box label=\"onnx____GatherElements_37\" fontsize=10];\n  Reshape_20 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_20)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_35 -> Reshape_20;\n  onnx____Reshape_36 -> Reshape_20;\n  Reshape_20 -> onnx____GatherElements_37;\n\n  onnx____Reshape_38 [shape=box label=\"onnx____Reshape_38\" fontsize=10];\n  GatherElements_21 [shape=box style=\"filled,rounded\" color=orange label=\"GatherElements\n(GatherElements_21)\naxis=1\" fontsize=10];\n  X -> GatherElements_21;\n  onnx____GatherElements_37 -> GatherElements_21;\n  GatherElements_21 -> onnx____Reshape_38;\n\n  onnx____Reshape_39 [shape=box label=\"onnx____Reshape_39\" fontsize=10];\n  Constant_22 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_22)\nvalue=[-1]\" fontsize=10];\n  Constant_22 -> onnx____Reshape_39;\n\n  onnx____LessOrEqual_40 [shape=box label=\"onnx____LessOrEqual_40\" fontsize=10];\n  Reshape_23 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_23)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_38 -> Reshape_23;\n  onnx____Reshape_39 -> Reshape_23;\n  Reshape_23 -> onnx____LessOrEqual_40;\n\n  onnx____Mul_41 [shape=box label=\"onnx____Mul_41\" fontsize=10];\n  Constant_24 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_24)\nvalue=2\" fontsize=10];\n  Constant_24 -> onnx____Mul_41;\n\n  onnx____Add_42 [shape=box label=\"onnx____Add_42\" fontsize=10];\n  Mul_25 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul_25)\" fontsize=10];\n  onnx____Gather_34 -> Mul_25;\n  onnx____Mul_41 -> Mul_25;\n  Mul_25 -> onnx____Add_42;\n\n  onnx____LessOrEqual_43 [shape=box label=\"onnx____LessOrEqual_43\" fontsize=10];\n  Gather_26 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_26)\naxis=0\" fontsize=10];\n  _operators_0_biases_1 -> Gather_26;\n  onnx____Gather_34 -> Gather_26;\n  Gather_26 -> onnx____LessOrEqual_43;\n\n  onnx____Cast_44 [shape=box label=\"onnx____Cast_44\" fontsize=10];\n  LessOrEqual_27 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_27)\" fontsize=10];\n  onnx____LessOrEqual_40 -> LessOrEqual_27;\n  onnx____LessOrEqual_43 -> LessOrEqual_27;\n  LessOrEqual_27 -> onnx____Cast_44;\n\n  onnx____Add_45 [shape=box label=\"onnx____Add_45\" fontsize=10];\n  Cast_28 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_28)\nto=7\" fontsize=10];\n  onnx____Cast_44 -> Cast_28;\n  Cast_28 -> onnx____Add_45;\n\n  onnx____Gather_46 [shape=box label=\"onnx____Gather_46\" fontsize=10];\n  Add_29 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_29)\" fontsize=10];\n  onnx____Add_42 -> Add_29;\n  onnx____Add_45 -> Add_29;\n  Add_29 -> onnx____Gather_46;\n\n  onnx____Reshape_47 [shape=box label=\"onnx____Reshape_47\" fontsize=10];\n  Gather_30 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_30)\naxis=0\" fontsize=10];\n  _operators_0_nodes_2 -> Gather_30;\n  onnx____Gather_46 -> Gather_30;\n  Gather_30 -> onnx____Reshape_47;\n\n  onnx____Reshape_48 [shape=box label=\"onnx____Reshape_48\" fontsize=10];\n  Constant_31 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_31)\nvalue=[-1  1]\" fontsize=10];\n  Constant_31 -> onnx____Reshape_48;\n\n  onnx____GatherElements_49 [shape=box label=\"onnx____GatherElements_49\" fontsize=10];\n  Reshape_32 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_32)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_47 -> Reshape_32;\n  onnx____Reshape_48 -> Reshape_32;\n  Reshape_32 -> onnx____GatherElements_49;\n\n  onnx____Reshape_50 [shape=box label=\"onnx____Reshape_50\" fontsize=10];\n  GatherElements_33 [shape=box style=\"filled,rounded\" color=orange label=\"GatherElements\n(GatherElements_33)\naxis=1\" fontsize=10];\n  X -> GatherElements_33;\n  onnx____GatherElements_49 -> GatherElements_33;\n  GatherElements_33 -> onnx____Reshape_50;\n\n  onnx____Reshape_51 [shape=box label=\"onnx____Reshape_51\" fontsize=10];\n  Constant_34 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_34)\nvalue=[-1]\" fontsize=10];\n  Constant_34 -> onnx____Reshape_51;\n\n  onnx____LessOrEqual_52 [shape=box label=\"onnx____LessOrEqual_52\" fontsize=10];\n  Reshape_35 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_35)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_50 -> Reshape_35;\n  onnx____Reshape_51 -> Reshape_35;\n  Reshape_35 -> onnx____LessOrEqual_52;\n\n  onnx____Mul_53 [shape=box label=\"onnx____Mul_53\" fontsize=10];\n  Constant_36 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_36)\nvalue=2\" fontsize=10];\n  Constant_36 -> onnx____Mul_53;\n\n  onnx____Add_54 [shape=box label=\"onnx____Add_54\" fontsize=10];\n  Mul_37 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul_37)\" fontsize=10];\n  onnx____Gather_46 -> Mul_37;\n  onnx____Mul_53 -> Mul_37;\n  Mul_37 -> onnx____Add_54;\n\n  onnx____LessOrEqual_55 [shape=box label=\"onnx____LessOrEqual_55\" fontsize=10];\n  Gather_38 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_38)\naxis=0\" fontsize=10];\n  _operators_0_biases_2 -> Gather_38;\n  onnx____Gather_46 -> Gather_38;\n  Gather_38 -> onnx____LessOrEqual_55;\n\n  onnx____Cast_56 [shape=box label=\"onnx____Cast_56\" fontsize=10];\n  LessOrEqual_39 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_39)\" fontsize=10];\n  onnx____LessOrEqual_52 -> LessOrEqual_39;\n  onnx____LessOrEqual_55 -> LessOrEqual_39;\n  LessOrEqual_39 -> onnx____Cast_56;\n\n  onnx____Add_57 [shape=box label=\"onnx____Add_57\" fontsize=10];\n  Cast_40 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_40)\nto=7\" fontsize=10];\n  onnx____Cast_56 -> Cast_40;\n  Cast_40 -> onnx____Add_57;\n\n  onnx____Gather_58 [shape=box label=\"onnx____Gather_58\" fontsize=10];\n  Add_41 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_41)\" fontsize=10];\n  onnx____Add_54 -> Add_41;\n  onnx____Add_57 -> Add_41;\n  Add_41 -> onnx____Gather_58;\n\n  onnx____Reshape_59 [shape=box label=\"onnx____Reshape_59\" fontsize=10];\n  Gather_42 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_42)\naxis=0\" fontsize=10];\n  _operators_0_nodes_3 -> Gather_42;\n  onnx____Gather_58 -> Gather_42;\n  Gather_42 -> onnx____Reshape_59;\n\n  onnx____Reshape_60 [shape=box label=\"onnx____Reshape_60\" fontsize=10];\n  Constant_43 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_43)\nvalue=[-1  1]\" fontsize=10];\n  Constant_43 -> onnx____Reshape_60;\n\n  onnx____GatherElements_61 [shape=box label=\"onnx____GatherElements_61\" fontsize=10];\n  Reshape_44 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_44)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_59 -> Reshape_44;\n  onnx____Reshape_60 -> Reshape_44;\n  Reshape_44 -> onnx____GatherElements_61;\n\n  onnx____Reshape_62 [shape=box label=\"onnx____Reshape_62\" fontsize=10];\n  GatherElements_45 [shape=box style=\"filled,rounded\" color=orange label=\"GatherElements\n(GatherElements_45)\naxis=1\" fontsize=10];\n  X -> GatherElements_45;\n  onnx____GatherElements_61 -> GatherElements_45;\n  GatherElements_45 -> onnx____Reshape_62;\n\n  onnx____Reshape_63 [shape=box label=\"onnx____Reshape_63\" fontsize=10];\n  Constant_46 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_46)\nvalue=[-1]\" fontsize=10];\n  Constant_46 -> onnx____Reshape_63;\n\n  onnx____LessOrEqual_64 [shape=box label=\"onnx____LessOrEqual_64\" fontsize=10];\n  Reshape_47 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_47)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_62 -> Reshape_47;\n  onnx____Reshape_63 -> Reshape_47;\n  Reshape_47 -> onnx____LessOrEqual_64;\n\n  onnx____Mul_65 [shape=box label=\"onnx____Mul_65\" fontsize=10];\n  Constant_48 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_48)\nvalue=2\" fontsize=10];\n  Constant_48 -> onnx____Mul_65;\n\n  onnx____Add_66 [shape=box label=\"onnx____Add_66\" fontsize=10];\n  Mul_49 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul_49)\" fontsize=10];\n  onnx____Gather_58 -> Mul_49;\n  onnx____Mul_65 -> Mul_49;\n  Mul_49 -> onnx____Add_66;\n\n  onnx____LessOrEqual_67 [shape=box label=\"onnx____LessOrEqual_67\" fontsize=10];\n  Gather_50 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_50)\naxis=0\" fontsize=10];\n  _operators_0_biases_3 -> Gather_50;\n  onnx____Gather_58 -> Gather_50;\n  Gather_50 -> onnx____LessOrEqual_67;\n\n  onnx____Cast_68 [shape=box label=\"onnx____Cast_68\" fontsize=10];\n  LessOrEqual_51 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_51)\" fontsize=10];\n  onnx____LessOrEqual_64 -> LessOrEqual_51;\n  onnx____LessOrEqual_67 -> LessOrEqual_51;\n  LessOrEqual_51 -> onnx____Cast_68;\n\n  onnx____Add_69 [shape=box label=\"onnx____Add_69\" fontsize=10];\n  Cast_52 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_52)\nto=7\" fontsize=10];\n  onnx____Cast_68 -> Cast_52;\n  Cast_52 -> onnx____Add_69;\n\n  onnx____Gather_70 [shape=box label=\"onnx____Gather_70\" fontsize=10];\n  Add_53 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_53)\" fontsize=10];\n  onnx____Add_66 -> Add_53;\n  onnx____Add_69 -> Add_53;\n  Add_53 -> onnx____Gather_70;\n\n  onnx____Reshape_71 [shape=box label=\"onnx____Reshape_71\" fontsize=10];\n  Gather_54 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_54)\naxis=0\" fontsize=10];\n  _operators_0_nodes_4 -> Gather_54;\n  onnx____Gather_70 -> Gather_54;\n  Gather_54 -> onnx____Reshape_71;\n\n  onnx____Reshape_72 [shape=box label=\"onnx____Reshape_72\" fontsize=10];\n  Constant_55 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_55)\nvalue=[-1  1]\" fontsize=10];\n  Constant_55 -> onnx____Reshape_72;\n\n  onnx____GatherElements_73 [shape=box label=\"onnx____GatherElements_73\" fontsize=10];\n  Reshape_56 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_56)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_71 -> Reshape_56;\n  onnx____Reshape_72 -> Reshape_56;\n  Reshape_56 -> onnx____GatherElements_73;\n\n  onnx____Reshape_74 [shape=box label=\"onnx____Reshape_74\" fontsize=10];\n  GatherElements_57 [shape=box style=\"filled,rounded\" color=orange label=\"GatherElements\n(GatherElements_57)\naxis=1\" fontsize=10];\n  X -> GatherElements_57;\n  onnx____GatherElements_73 -> GatherElements_57;\n  GatherElements_57 -> onnx____Reshape_74;\n\n  onnx____Reshape_75 [shape=box label=\"onnx____Reshape_75\" fontsize=10];\n  Constant_58 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_58)\nvalue=[-1]\" fontsize=10];\n  Constant_58 -> onnx____Reshape_75;\n\n  onnx____LessOrEqual_76 [shape=box label=\"onnx____LessOrEqual_76\" fontsize=10];\n  Reshape_59 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_59)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_74 -> Reshape_59;\n  onnx____Reshape_75 -> Reshape_59;\n  Reshape_59 -> onnx____LessOrEqual_76;\n\n  onnx____Mul_77 [shape=box label=\"onnx____Mul_77\" fontsize=10];\n  Constant_60 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_60)\nvalue=2\" fontsize=10];\n  Constant_60 -> onnx____Mul_77;\n\n  onnx____Add_78 [shape=box label=\"onnx____Add_78\" fontsize=10];\n  Mul_61 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul_61)\" fontsize=10];\n  onnx____Gather_70 -> Mul_61;\n  onnx____Mul_77 -> Mul_61;\n  Mul_61 -> onnx____Add_78;\n\n  onnx____LessOrEqual_79 [shape=box label=\"onnx____LessOrEqual_79\" fontsize=10];\n  Gather_62 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_62)\naxis=0\" fontsize=10];\n  _operators_0_biases_4 -> Gather_62;\n  onnx____Gather_70 -> Gather_62;\n  Gather_62 -> onnx____LessOrEqual_79;\n\n  onnx____Cast_80 [shape=box label=\"onnx____Cast_80\" fontsize=10];\n  LessOrEqual_63 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_63)\" fontsize=10];\n  onnx____LessOrEqual_76 -> LessOrEqual_63;\n  onnx____LessOrEqual_79 -> LessOrEqual_63;\n  LessOrEqual_63 -> onnx____Cast_80;\n\n  onnx____Add_81 [shape=box label=\"onnx____Add_81\" fontsize=10];\n  Cast_64 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_64)\nto=7\" fontsize=10];\n  onnx____Cast_80 -> Cast_64;\n  Cast_64 -> onnx____Add_81;\n\n  onnx____Gather_82 [shape=box label=\"onnx____Gather_82\" fontsize=10];\n  Add_65 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_65)\" fontsize=10];\n  onnx____Add_78 -> Add_65;\n  onnx____Add_81 -> Add_65;\n  Add_65 -> onnx____Gather_82;\n\n  onnx____Reshape_83 [shape=box label=\"onnx____Reshape_83\" fontsize=10];\n  Gather_66 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_66)\naxis=0\" fontsize=10];\n  _operators_0_nodes_5 -> Gather_66;\n  onnx____Gather_82 -> Gather_66;\n  Gather_66 -> onnx____Reshape_83;\n\n  onnx____Reshape_84 [shape=box label=\"onnx____Reshape_84\" fontsize=10];\n  Constant_67 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_67)\nvalue=[-1  1]\" fontsize=10];\n  Constant_67 -> onnx____Reshape_84;\n\n  onnx____GatherElements_85 [shape=box label=\"onnx____GatherElements_85\" fontsize=10];\n  Reshape_68 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_68)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_83 -> Reshape_68;\n  onnx____Reshape_84 -> Reshape_68;\n  Reshape_68 -> onnx____GatherElements_85;\n\n  onnx____Reshape_86 [shape=box label=\"onnx____Reshape_86\" fontsize=10];\n  GatherElements_69 [shape=box style=\"filled,rounded\" color=orange label=\"GatherElements\n(GatherElements_69)\naxis=1\" fontsize=10];\n  X -> GatherElements_69;\n  onnx____GatherElements_85 -> GatherElements_69;\n  GatherElements_69 -> onnx____Reshape_86;\n\n  onnx____Reshape_87 [shape=box label=\"onnx____Reshape_87\" fontsize=10];\n  Constant_70 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_70)\nvalue=[-1]\" fontsize=10];\n  Constant_70 -> onnx____Reshape_87;\n\n  onnx____LessOrEqual_88 [shape=box label=\"onnx____LessOrEqual_88\" fontsize=10];\n  Reshape_71 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_71)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_86 -> Reshape_71;\n  onnx____Reshape_87 -> Reshape_71;\n  Reshape_71 -> onnx____LessOrEqual_88;\n\n  onnx____Mul_89 [shape=box label=\"onnx____Mul_89\" fontsize=10];\n  Constant_72 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_72)\nvalue=2\" fontsize=10];\n  Constant_72 -> onnx____Mul_89;\n\n  onnx____Add_90 [shape=box label=\"onnx____Add_90\" fontsize=10];\n  Mul_73 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul_73)\" fontsize=10];\n  onnx____Gather_82 -> Mul_73;\n  onnx____Mul_89 -> Mul_73;\n  Mul_73 -> onnx____Add_90;\n\n  onnx____LessOrEqual_91 [shape=box label=\"onnx____LessOrEqual_91\" fontsize=10];\n  Gather_74 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_74)\naxis=0\" fontsize=10];\n  _operators_0_biases_5 -> Gather_74;\n  onnx____Gather_82 -> Gather_74;\n  Gather_74 -> onnx____LessOrEqual_91;\n\n  onnx____Cast_92 [shape=box label=\"onnx____Cast_92\" fontsize=10];\n  LessOrEqual_75 [shape=box style=\"filled,rounded\" color=orange label=\"LessOrEqual\n(LessOrEqual_75)\" fontsize=10];\n  onnx____LessOrEqual_88 -> LessOrEqual_75;\n  onnx____LessOrEqual_91 -> LessOrEqual_75;\n  LessOrEqual_75 -> onnx____Cast_92;\n\n  onnx____Add_93 [shape=box label=\"onnx____Add_93\" fontsize=10];\n  Cast_76 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\n(Cast_76)\nto=7\" fontsize=10];\n  onnx____Cast_92 -> Cast_76;\n  Cast_76 -> onnx____Add_93;\n\n  onnx____Gather_94 [shape=box label=\"onnx____Gather_94\" fontsize=10];\n  Add_77 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Add_77)\" fontsize=10];\n  onnx____Add_90 -> Add_77;\n  onnx____Add_93 -> Add_77;\n  Add_77 -> onnx____Gather_94;\n\n  onnx____Reshape_95 [shape=box label=\"onnx____Reshape_95\" fontsize=10];\n  Gather_78 [shape=box style=\"filled,rounded\" color=orange label=\"Gather\n(Gather_78)\naxis=0\" fontsize=10];\n  _operators_0_leaf_nodes -> Gather_78;\n  onnx____Gather_94 -> Gather_78;\n  Gather_78 -> onnx____Reshape_95;\n\n  onnx____Reshape_96 [shape=box label=\"onnx____Reshape_96\" fontsize=10];\n  Constant_79 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_79)\nvalue=[-1  1  1]\" fontsize=10];\n  Constant_79 -> onnx____Reshape_96;\n\n  output [shape=box label=\"output\" fontsize=10];\n  Reshape_80 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(Reshape_80)\nallowzero=0\" fontsize=10];\n  onnx____Reshape_95 -> Reshape_80;\n  onnx____Reshape_96 -> Reshape_80;\n  Reshape_80 -> output;\n\n  onnx____ReduceSum_98 [shape=box label=\"onnx____ReduceSum_98\" fontsize=10];\n  Constant_81 [shape=box style=\"filled,rounded\" color=orange label=\"Constant\n(Constant_81)\nvalue=[1]\" fontsize=10];\n  Constant_81 -> onnx____ReduceSum_98;\n\n  ReduceSum_82 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(ReduceSum_82)\nkeepdims=0\" fontsize=10];\n  output -> ReduceSum_82;\n  onnx____ReduceSum_98 -> ReduceSum_82;\n  ReduceSum_82 -> variable;\n}");
document.getElementById('M383513f79aa048579be42d593ab48485').innerHTML = svgGraph; });

</script></div>
</div>
<p>La librairie réimplémente la décision d’un arbre décision à partir d’un produit matriciel pour chaque niveau de l’arbre. Tous les seuils sont évalués. Les matrices n’ont pas besoin d’être sparses car les features nécessaires sont récupérées. Le seuil de décision est implémenté avec un test et non une sigmoïde. Ce modèle est donc identique en terme de prédiction au modèle initial.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oinfh</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">onxh</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime1&quot;</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_exp</span><span class="p">)</span>

<span class="n">got</span> <span class="o">=</span> <span class="n">oinfh</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">x_exp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.7421041873949668
</pre></div></div>
</div>
<p>La conversion reste imparfaite également.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> oinfh.run({&#39;X&#39;: x_exp32})[&#39;variable&#39;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.13 ms ± 445 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div></div>
</div>
<p>Et le temps de calcul est aussi plus long.</p>
</section>
<section id="Apprentissage">
<h2>Apprentissage<a class="headerlink" href="#Apprentissage" title="Link to this heading">#</a></h2>
<p>L’idée derrière tout cela est aussi de pouvoir réestimer les coefficients du réseau de neurones une fois converti.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">NeuralTreeNetRegressor</span><span class="p">(</span><span class="n">trees</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">got</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1.0246115055833722, 0.24094382754240642)
</pre></div></div>
</div>
<p>La différence est grande.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0/10: loss: 3.201 lr=0.0001 max(coef): 6.5 l1=0/1.5e+03 l2=0/2.5e+03
1/10: loss: 2.593 lr=9.95e-06 max(coef): 6.5 l1=2e+03/1.5e+03 l2=1.3e+03/2.5e+03
2/10: loss: 2.506 lr=7.05e-06 max(coef): 6.5 l1=1.4e+02/1.5e+03 l2=6.2/2.5e+03
3/10: loss: 2.461 lr=5.76e-06 max(coef): 6.5 l1=1.2e+03/1.5e+03 l2=6.8e+02/2.5e+03
4/10: loss: 2.429 lr=4.99e-06 max(coef): 6.5 l1=6.5e+02/1.5e+03 l2=2.1e+02/2.5e+03
5/10: loss: 2.405 lr=4.47e-06 max(coef): 6.5 l1=1.9e+02/1.5e+03 l2=13/2.5e+03
6/10: loss: 2.392 lr=4.08e-06 max(coef): 6.5 l1=1.6e+02/1.5e+03 l2=6.8/2.5e+03
7/10: loss: 2.375 lr=3.78e-06 max(coef): 6.5 l1=1.8e+02/1.5e+03 l2=9.5/2.5e+03
8/10: loss: 2.358 lr=3.53e-06 max(coef): 6.5 l1=1.1e+02/1.5e+03 l2=7/2.5e+03
9/10: loss: 2.345 lr=3.33e-06 max(coef): 6.5 l1=3.7e+02/1.5e+03 l2=56/2.5e+03
10/10: loss: 2.333 lr=3.16e-06 max(coef): 6.5 l1=6.1e+02/1.5e+03 l2=1.3e+02/2.5e+03
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>NeuralTreeNetRegressor(estimator=None, lr=0.0001, max_iter=10, verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">NeuralTreeNetRegressor</label><div class="sk-toggleable__content"><pre>NeuralTreeNetRegressor(estimator=None, lr=0.0001, max_iter=10, verbose=1)</pre></div></div></div></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">got</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">got</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1.256860512819292, 0.25663312220721907)
</pre></div></div>
</div>
<p>Ca ne marche pas aussi bien que prévu. Il faudrait sans doute plusieurs itérations et jouer avec les paramètres d’apprentissage.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="neural_tree.html"
       title="page précédente">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Un arbre de décision en réseaux de neurones</p>
      </div>
    </a>
    <a class="right-next"
       href="neural_tree_cost.html"
       title="page suivante">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title">NeuralTreeNet et coût</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Sur cette page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Jeu-de-données">Jeu de données</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Partie-scikit-learn">Partie scikit-learn</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Caler-un-arbre-de-décision">Caler un arbre de décision</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Conversion-au-format-ONNX">Conversion au format ONNX</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Après-la-conversion-en-un-réseau-de-neurones">Après la conversion en un réseau de neurones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Conversion-en-un-réseau-de-neurones">Conversion en un réseau de neurones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Conversion au format ONNX</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Temps-de-calcul">Temps de calcul</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Hummingbird">Hummingbird</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Apprentissage">Apprentissage</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/notebooks/ml/neural_tree_onnx.ipynb">
      <i class="fa-solid fa-file-lines"></i> Montrer le code source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2016-2024, Xavier Dupré.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Créé en utilisant <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Construit avec le <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">Thème PyData Sphinx</a> 0.15.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>