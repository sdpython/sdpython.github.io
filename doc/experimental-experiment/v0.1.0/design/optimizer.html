<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Dynamo Backends" href="backends.html" /><link rel="prev" title="Custom Exporter" href="exporter.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Pattern Optimizer - experimental-experiment 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">experimental-experiment 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">experimental-experiment 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Design</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="exporter.html">Custom Exporter</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Pattern Optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="backends.html">Dynamo Backends</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/pytorch.html">pytorch and onnx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/onnx.html">onnx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/exported.html">Exported Programs</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/exporter_recipes.html">Exporter Recipes</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Exporter Recipes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/exporter_recipes_custom.html">Recipes with to_onnx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/exporter_recipes_onnx_export.html">Recipes with torch.onnx.export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/errors.html">Frequent Exceptions or Errors with the Exporter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/exporter_strict.html">Parameter torch.export.export(…, strict: bool)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/docker.html">Start from a docker</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/gradient/index.html">experimental_experiment.gradient</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of experimental_experiment.gradient</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/gradient/ops/index.html">experimental_experiment.gradient.ops</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of experimental_experiment.gradient.ops</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/gradient/ops/op_broadcast_gradient_args.html">experimental_experiment.gradient.ops.op_broadcast_gradient_args</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/gradient/grad_helper.html">experimental_experiment.gradient.grad_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/gradient/loss_helper.html">experimental_experiment.gradient.loss_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/reference/index.html">experimental_experiment.reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of experimental_experiment.reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/reference/ops/index.html">experimental_experiment.reference.ops</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of experimental_experiment.reference.ops</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_add_add_mul_mul.html">experimental_experiment.reference.ops.op_add_add_mul_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_average_pool_grad.html">experimental_experiment.reference.ops.op_average_pool_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_cast_like.html">experimental_experiment.reference.ops.op_cast_like</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_concat.html">experimental_experiment.reference.ops.op_concat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_constant_of_shape.html">experimental_experiment.reference.ops.op_constant_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_fused_matmul.html">experimental_experiment.reference.ops.op_fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_gather_grad.html">experimental_experiment.reference.ops.op_gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_memcpy_host.html">experimental_experiment.reference.ops.op_memcpy_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_mul_sigmoid.html">experimental_experiment.reference.ops.op_mul_sigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_negxplus1.html">experimental_experiment.reference.ops.op_negxplus1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_quick_gelu.html">experimental_experiment.reference.ops.op_quick_gelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_replace_zero.html">experimental_experiment.reference.ops.op_replace_zero</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_rotary.html">experimental_experiment.reference.ops.op_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatter_elements.html">experimental_experiment.reference.ops.op_scatter_elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatternd_of_shape.html">experimental_experiment.reference.ops.op_scatternd_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_simplified_layer_normalization.html">experimental_experiment.reference.ops.op_simplified_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_slice.html">experimental_experiment.reference.ops.op_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_transpose_cast.html">experimental_experiment.reference.ops.op_transpose_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_tri_matrix.html">experimental_experiment.reference.ops.op_tri_matrix</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/evaluator.html">experimental_experiment.reference.evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/ort_evaluator.html">experimental_experiment.reference.ort_evaluator</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/convert/index.html">experimental_experiment.convert</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of experimental_experiment.convert</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/convert/convert_helper.html">experimental_experiment.convert.convert_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/convert/ort_helper.html">experimental_experiment.convert.ort_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/plotting/index.html">experimental_experiment.plotting</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of experimental_experiment.plotting</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/plotting/data.html">experimental_experiment.plotting.data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/plotting/memory.html">experimental_experiment.plotting.memory</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_interpreter/index.html">experimental_experiment.torch_interpreter</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of experimental_experiment.torch_interpreter</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_functions.html">experimental_experiment.torch_interpreter._aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_functions_attention.html">experimental_experiment.torch_interpreter._aten_functions_attention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_methods.html">experimental_experiment.torch_interpreter._aten_methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_doc_.html">experimental_experiment.torch_interpreter._doc_</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_exceptions.html">experimental_experiment.torch_interpreter._exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_prims_functions.html">experimental_experiment.torch_interpreter._prims_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_torch_helper.html">experimental_experiment.torch_interpreter._torch_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/aten_functions.html">experimental_experiment.torch_interpreter.aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/aten_methods.html">experimental_experiment.torch_interpreter.aten_methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/dispatcher.html">experimental_experiment.torch_interpreter.dispatcher</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/torch_interpreter/eval/index.html">experimental_experiment.torch_interpreter.eval</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of experimental_experiment.torch_interpreter.eval</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_interpreter/eval/model_cases.html">experimental_experiment.torch_interpreter.eval.model_cases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/export_options.html">experimental_experiment.torch_interpreter.export_options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/interpreter.html">experimental_experiment.torch_interpreter.interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/onnx_export.html">experimental_experiment.torch_interpreter.onnx_export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/onnx_export_errors.html">experimental_experiment.torch_interpreter.onnx_export_errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/oxs_dispatcher.html">experimental_experiment.torch_interpreter.oxs_dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/oxs_opset.html">experimental_experiment.torch_interpreter.oxs_opset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/tracing.html">experimental_experiment.torch_interpreter.tracing</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_models/index.html">experimental_experiment.torch_models</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of experimental_experiment.torch_models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/diffusion_model_helper.html">experimental_experiment.torch_models.diffusion_model_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/dump_helper.html">experimental_experiment.torch_models.dump_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/llama_helper.html">experimental_experiment.torch_models.llama_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/llm_model_helper.html">experimental_experiment.torch_models.llm_model_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/mistral_helper.html">experimental_experiment.torch_models.mistral_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/phi3_helper.html">experimental_experiment.torch_models.phi3_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/phi_helper.html">experimental_experiment.torch_models.phi_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/training_helper.html">experimental_experiment.torch_models.training_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xbuilder/index.html">experimental_experiment.xbuilder</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of experimental_experiment.xbuilder</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/_dtype_helper.html">experimental_experiment.xbuilder._dtype_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/_graph_builder_runtime.html">experimental_experiment.xbuilder._graph_builder_runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/_onnx_helper.html">experimental_experiment.xbuilder._onnx_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/_shape_helper.html">experimental_experiment.xbuilder._shape_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/expression_dimension.html">experimental_experiment.xbuilder.expression_dimension</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/graph_builder.html">experimental_experiment.xbuilder.graph_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/graph_builder_opset.html">experimental_experiment.xbuilder.graph_builder_opset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/model_container.html">experimental_experiment.xbuilder.model_container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/optimization_options.html">experimental_experiment.xbuilder.optimization_options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/shape_type_compute.html">experimental_experiment.xbuilder.shape_type_compute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/type_inference.html">experimental_experiment.xbuilder.type_inference</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xoptim/index.html">experimental_experiment.xoptim</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_investigation/index.html">experimental_experiment.xoptim.patterns_investigation</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim.patterns_investigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_investigation/element_wise.html">experimental_experiment.xoptim.patterns_investigation.element_wise</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_ml/index.html">experimental_experiment.xoptim.patterns_ml</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim.patterns_ml</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ml/tree_ensemble.html">experimental_experiment.xoptim.patterns_ml.tree_ensemble</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_exp/index.html">experimental_experiment.xoptim.patterns_exp</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim.patterns_exp</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/binary_operators.html">experimental_experiment.xoptim.patterns_exp.binary_operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/constant_of_shape_scatter_nd.html">experimental_experiment.xoptim.patterns_exp.constant_of_shape_scatter_nd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/constants.html">experimental_experiment.xoptim.patterns_exp.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/simple_rotary.html">experimental_experiment.xoptim.patterns_exp.simple_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/unary_operators.html">experimental_experiment.xoptim.patterns_exp.unary_operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/where_replace.html">experimental_experiment.xoptim.patterns_exp.where_replace</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns/index.html">experimental_experiment.xoptim.patterns</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim.patterns</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_any.html">experimental_experiment.xoptim.patterns.onnx_any</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_cast.html">experimental_experiment.xoptim.patterns.onnx_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_clip.html">experimental_experiment.xoptim.patterns.onnx_clip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_conv.html">experimental_experiment.xoptim.patterns.onnx_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_dropout.html">experimental_experiment.xoptim.patterns.onnx_dropout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_equal.html">experimental_experiment.xoptim.patterns.onnx_equal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_expand.html">experimental_experiment.xoptim.patterns.onnx_expand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_functions.html">experimental_experiment.xoptim.patterns.onnx_functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_layer_normalization.html">experimental_experiment.xoptim.patterns.onnx_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_matmul.html">experimental_experiment.xoptim.patterns.onnx_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_mul.html">experimental_experiment.xoptim.patterns.onnx_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_reduce.html">experimental_experiment.xoptim.patterns.onnx_reduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_reshape.html">experimental_experiment.xoptim.patterns.onnx_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_rotary.html">experimental_experiment.xoptim.patterns.onnx_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_slice.html">experimental_experiment.xoptim.patterns.onnx_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_split.html">experimental_experiment.xoptim.patterns.onnx_split</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_sub.html">experimental_experiment.xoptim.patterns.onnx_sub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_sequence.html">experimental_experiment.xoptim.patterns.onnx_sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_transpose.html">experimental_experiment.xoptim.patterns.onnx_transpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_unsqueeze.html">experimental_experiment.xoptim.patterns.onnx_unsqueeze</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_ort/index.html">experimental_experiment.xoptim.patterns_ort</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim.patterns_ort</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/activation.html">experimental_experiment.xoptim.patterns_ort.activation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/activation_grad.html">experimental_experiment.xoptim.patterns_ort.activation_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/fused_conv.html">experimental_experiment.xoptim.patterns_ort.fused_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/fused_matmul.html">experimental_experiment.xoptim.patterns_ort.fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/gather_grad.html">experimental_experiment.xoptim.patterns_ort.gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/simplified_layer_normalization.html">experimental_experiment.xoptim.patterns_ort.simplified_layer_normalization</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_fix/index.html">experimental_experiment.xoptim.patterns_fix</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of experimental_experiment.xoptim.patterns_fix</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_fix/add_reduction_scatter_nd.html">experimental_experiment.xoptim.patterns_fix.add_reduction_scatter_nd</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/graph_builder_optim.html">experimental_experiment.xoptim.graph_builder_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/order_optim.html">experimental_experiment.xoptim.order_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/patterns_api.html">experimental_experiment.xoptim.patterns_api</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_dynamo/index.html">experimental_experiment.torch_dynamo</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of experimental_experiment.torch_dynamo</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/_dynamo_exporter.html">experimental_experiment.torch_dynamo._dynamo_exporter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/backend_helper.html">experimental_experiment.torch_dynamo.backend_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/debug_backend.html">experimental_experiment.torch_dynamo.debug_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/fast_backend.html">experimental_experiment.torch_dynamo.fast_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/partition.html">experimental_experiment.torch_dynamo.partition</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_bench/index.html">experimental_experiment.torch_bench</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of experimental_experiment.torch_bench</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner_agg.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner_agg</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner_agg_helper.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner_agg_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_cmd.html">experimental_experiment.torch_bench._bash_bench_cmd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_model_runner.html">experimental_experiment.torch_bench._bash_bench_model_runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_models_helper.html">experimental_experiment.torch_bench._bash_bench_models_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_dummies.html">experimental_experiment.torch_bench._bash_bench_set_dummies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_explicit.html">experimental_experiment.torch_bench._bash_bench_set_explicit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_huggingface.html">experimental_experiment.torch_bench._bash_bench_set_huggingface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_huggingface_big.html">experimental_experiment.torch_bench._bash_bench_set_huggingface_big</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_issues.html">experimental_experiment.torch_bench._bash_bench_set_issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_timm.html">experimental_experiment.torch_bench._bash_bench_set_timm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_torchbench.html">experimental_experiment.torch_bench._bash_bench_set_torchbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_torchbench_ado.html">experimental_experiment.torch_bench._bash_bench_set_torchbench_ado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_suites.html">experimental_experiment.torch_bench._bash_bench_suites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_dort_cmd_common.html">experimental_experiment.torch_bench._dort_cmd_common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_dort_cmd_common_models.html">experimental_experiment.torch_bench._dort_cmd_common_models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_agg.html">experimental_experiment.torch_bench.bash_bench_agg</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_explicit.html">experimental_experiment.torch_bench.bash_bench_explicit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_huggingface.html">experimental_experiment.torch_bench.bash_bench_huggingface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_huggingface_big.html">experimental_experiment.torch_bench.bash_bench_huggingface_big</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_issues.html">experimental_experiment.torch_bench.bash_bench_issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_timm.html">experimental_experiment.torch_bench.bash_bench_timm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_torchbench.html">experimental_experiment.torch_bench.bash_bench_torchbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_torchbench_ado.html">experimental_experiment.torch_bench.bash_bench_torchbench_ado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_untrained.html">experimental_experiment.torch_bench.bash_bench_untrained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/check_model.html">experimental_experiment.torch_bench.check_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/dort_bench.html">experimental_experiment.torch_bench.dort_bench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/dort_bench_profile.html">experimental_experiment.torch_bench.dort_bench_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/dort_profile.html">experimental_experiment.torch_bench.dort_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/export_model.html">experimental_experiment.torch_bench.export_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/export_model_helper.html">experimental_experiment.torch_bench.export_model_helper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/_bench_test.html">experimental_experiment._bench_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/_command_lines_parser.html">experimental_experiment._command_lines_parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/args.html">experimental_experiment.args</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/bench_run.html">experimental_experiment.bench_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/checks.html">experimental_experiment.checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ext_test_case.html">experimental_experiment.ext_test_case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/helpers.html">experimental_experiment.helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/memory_peak.html">experimental_experiment.memory_peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/mini_onnx_builder.html">experimental_experiment.mini_onnx_builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/model_run.html">experimental_experiment.model_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/onnx_tools.html">experimental_experiment.onnx_tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/torch_test_helper.html">experimental_experiment.torch_test_helper</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../galleries.html">Galleries of Examples and Recipes</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of Galleries of Examples and Recipes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of Examples Gallery</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_optimize_101.html">101: Graph Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_linreg_101.html">101: Linear Regression and export to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_rewrite_101.html">101: Onnx Model Rewriting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_profile_existing_onnx_101.html">101: Profile an existing model with onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_101.html">101: Some dummy examples with torch.export.export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_convolutation_matmul_102.html">102: Convolution and Matrix Multiplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_onnxscript_102.html">102: Examples with onnxscript</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_llama_bench_102.html">102: Measure LLAMA speed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_compile_102.html">102: Tweak onnx export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_dort_201.html">201: Evaluate DORT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_aot_201.html">201: Evaluate DORT Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_201.html">201: Evaluate different ways to export a torch model to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_llama_diff_export_301.html">301: Compares LLAMA exporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_llama_diff_dort_301.html">301: Compares LLAMA exporters for onnxrt backend</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_recipes/index.html">Exporter Recipes Gallery</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of Exporter Recipes Gallery</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_coverage.html">Measures the exporter success on many test cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_scan_pdist.html">to_onnx and a model with a loop (scan)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_cond.html">to_onnx and a model with a test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_modules.html">to_onnx and submodules from LLMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_oe_cond.html">torch.onnx.export and a model with a test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../command_lines.html">Command Lines</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of Command Lines</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../bench/index.html">Benchmarks from the command line</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle navigation of Benchmarks from the command line</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../bench/dort_bench.html">experimental_experiment.torch_bench.dort_bench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/dort_profile.html">experimental_experiment.torch_bench.dort_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/scripts.html">Interesting scripts or command lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/bash_bench.html">Measuring the exporters on a short list of sets of models</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tools/index.html">Tools from the command line</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle navigation of Tools from the command line</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/lighten.html">python -m experimental_experiment lighten and unlighten</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/optimize.html">python -m experimental_experiment optimize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/run.html">python -m experimental_experiment run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle navigation of Miscellaneous</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous/export_times.html">Export Times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous/long_outputs.html">Long Outputs uneasy to read</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../miscellaneous/models/index.html">Supported Models By the Custom Backend</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle navigation of Supported Models By the Custom Backend</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous/models/llama.html">LLaMa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous/models/mistral.html">Mistral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous/models/phi.html">Phi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous/models/phi3.html">Phi3</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOGS.html">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/design/optimizer.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="pattern-optimizer">
<span id="l-design-pattern-optimizer"></span><h1>Pattern Optimizer<a class="headerlink" href="#pattern-optimizer" title="Link to this heading">¶</a></h1>
<p>The pattern optimizer is implemented by class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>.
It searches for a specific sequence of nodes in the graph and
replaces it by another one without changing the inputs or the long_outputs
of the graph. The goal of the optimizer is to make the whole computation
graph more efficient. The goal of this implementation is to make this
optimization as fast as possible.
Assuming the nodes in an onnx graph are ordered in a way every input of a
node was created by previous nodes, the optimizer must not require
any global reordering. The cost should be in <img class="math" src="../_images/math/ee2fa8e8c79fa606e3168c3d6332beb096b05426.svg" alt="O(N P I)"/> in the worst
case where <em>N</em> is the number of nodes, <em>P</em> is the number of patterns,
<em>I</em> is the number of iterations.</p>
<p>It is difficult to foresee what a pattern needs in order to rewrite a part
of the graph. This API tries to give as much freedom as it can without
leaving too much to do to the developper which tries to add a new pattern.</p>
<section id="patterns">
<h2>Patterns<a class="headerlink" href="#patterns" title="Link to this heading">¶</a></h2>
<p>Patterns must inherit from <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.PatternOptimization" title="experimental_experiment.xoptim.PatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">PatternOptimization</span></code></a>.
This class defines two methods.</p>
<section id="patternoptimization-match">
<h3>PatternOptimization.match<a class="headerlink" href="#patternoptimization-match" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">match</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">g</span><span class="p">:</span> <span class="s2">&quot;GraphBuilderPatternOptimization&quot;</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">NodeProto</span><span class="p">,</span>
    <span class="n">matched</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">]:</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code> is a <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>,
it holds all the existing nodes, is able to return any information
about type, shape, the node before, the node after another one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code>: the matching must determine if some nodes around this one
are part of set of nodes this pattern optimizer can rewrite.
From there, the function explores wherever it needs,
checking any condition it needs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matched</span></code>: usually unused, it returns of nodes already matching
a pattern</p></li>
</ul>
<p>The method must not modify the graph.
The method returns None if no match is found or an instance of class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.MatchResult" title="experimental_experiment.xoptim.MatchResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatchResult</span></code></a>. It must contain:</p>
<ul class="simple">
<li><p>a list of nodes involved in the rewriting. It does not mean all of them will be
removed but all of them are needed to do the rewriting and must
not be impacted by other pattern optimizer.</p></li>
<li><p>A function doing the rewriting (usually method <em>apply</em> of the pattern class).</p></li>
<li><p>An existing node where the rewritten nodes can be inserted.
Knowing it makes it faster to rewriter. If not specified, the optimizer
will automatically determine the position of the new nodes.</p></li>
</ul>
<p><em>Debugging: method none</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">none</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lineno</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
</pre></div>
</div>
<p>It may be useful which reason made a pattern matching fail.
Instead of returning None, method <em>match</em> can return the following
expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">none</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
</pre></div>
</div>
<p>By setting the verbosity (see next Section), the user may then know
which lines in the code returned None and which condition failed.</p>
</section>
<section id="patternoptimization-apply">
<h3>PatternOptimization.apply<a class="headerlink" href="#patternoptimization-apply" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="s2">&quot;GraphBuilder&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">nodes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]:</span>
</pre></div>
</div>
<p>The method does the rewriting. It assumes it can happen.
It takes a list of nodes impacted by the rewriting. It assumes no other
pattern optimizer modified them or will modify them.
It receives the list of nodes
returned by method <em>apply</em>. Since it is a list of argument, method
<em>match</em> can include None values. The method returns the new nodes.
The optimizer considers that any node given to this function is removed
from the graph, and any node returned by it are added.
If a received node must be kept, it must be added to the list of returned node.</p>
</section>
</section>
<section id="optimization-algorithm">
<h2>Optimization Algorithm<a class="headerlink" href="#optimization-algorithm" title="Link to this heading">¶</a></h2>
<p>It is implemented in method <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.optimize" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">remove_identity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</pre></div>
</div>
<p>The algorithm runs multiple iteration until the graph is not evolving
or <cite>max_iter</cite> is reached. By default, it is equal to the number of nodes.
An iteration is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">builds</span> <span class="nb">all</span> <span class="n">successors</span> <span class="ow">and</span> <span class="n">predecessors</span>

<span class="c1"># Step 1: match</span>

<span class="k">for</span> <span class="nb">all</span> <span class="n">patterns</span> <span class="n">P</span><span class="p">:</span>

    <span class="k">for</span> <span class="nb">all</span> <span class="n">nodes</span> <span class="n">n</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">no</span> <span class="n">node</span> <span class="n">already</span> <span class="n">scheduled</span> <span class="n">to</span> <span class="n">be</span> <span class="n">rewritten</span> <span class="n">by</span> <span class="n">another</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c1"># Step 2: apply</span>

<span class="k">for</span> <span class="nb">all</span> <span class="n">matches</span> <span class="n">r</span><span class="p">:</span>
    <span class="n">apply</span> <span class="n">the</span> <span class="n">match</span> <span class="n">r</span>

<span class="c1"># Step 3: clean</span>

<span class="n">remove</span> <span class="n">unused</span> <span class="n">nodes</span>
<span class="n">remove</span> <span class="n">identity</span> <span class="n">nodes</span>
</pre></div>
</div>
<p>This algorithm may apply more than one rewriting at each iteration
but it guarantees the local structure when applying the rewriting was
not altered by another one.</p>
</section>
<section id="adding-a-pattern">
<h2>Adding a pattern<a class="headerlink" href="#adding-a-pattern" title="Link to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://github.com/sdpython/experimental-experiment/pull/80">#80</a> about the addition of a new pattern.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<section id="simple-api">
<h3>Simple API<a class="headerlink" href="#simple-api" title="Link to this heading">¶</a></h3>
<p>We consider the following simple model:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.helpers</span> <span class="kn">import</span> <span class="n">pretty_onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">OptimizationOptions</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.torch_interpreter</span> <span class="kn">import</span> <span class="n">to_onnx</span>


<span class="k">class</span> <span class="nc">MLP</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">onx</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">MLP</span><span class="p">(),</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pretty_onnx</span><span class="p">(</span><span class="n">onx</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">18</span>
    <span class="n">doc_string</span><span class="p">:</span> <span class="n">large_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">external_threshold</span><span class="o">=</span><span class="mf">102.</span><span class="o">..</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.weight&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>              <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                   <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.weight&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>               <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.013</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span><span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">Transpose</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_onx_transpose0</span>
      <span class="n">MatMul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_onx_transpose0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul0</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">_onx_matmul0</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">linear</span>
          <span class="n">Relu</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relu</span>
    <span class="n">Transpose</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_onx_transpose02</span>
      <span class="n">MatMul</span><span class="p">(</span><span class="n">relu</span><span class="p">,</span> <span class="n">_onx_transpose02</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul02</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">_onx_matmul02</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">output_0</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;output_0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Which we can renders as follows:</p>
<div class="graphviz"><img src="../_images/graphviz-a7facf8e2e0e12bc1e6227bb9e347802be98a54e.png" alt="digraph{
  orientation=portrait;
  size=7;
  ranksep=0.25;
  nodesep=0.05;

  x [shape=box color=red label=&quot;x\nTensorProto.FLOAT\nshape=[3, 10]&quot; fontsize=10];

  output_0 [shape=box color=green label=&quot;output_0\nTensorProto.FLOAT\nshape=[3, 1]&quot; fontsize=10];

  layers_0_weight [shape=box label=&quot;layers_0_weight\nfloat32((32, 10))\n[[ 0.008 -0.192  0.219  0.008  0.154 -0.065  0.013...&quot; fontsize=10];
  layers_0_bias [shape=box label=&quot;layers_0_bias\nfloat32((32,))\n[ 0.028 -0.209 -0.152 -0.196 -0.151  0.097 -0.188 ...&quot; fontsize=10];
  layers_2_weight [shape=box label=&quot;layers_2_weight\nfloat32((1, 32))\n[[ 0.098 -0.027  0.155 -0.004  0.166  0.117  0.129...&quot; fontsize=10];
  layers_2_bias [shape=box label=&quot;layers_2_bias\nfloat32((1,))\n[0.013]&quot; fontsize=10];

  _onx_transpose0 [shape=box label=&quot;_onx_transpose0&quot; fontsize=10];
  linear [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Transpose\nperm=[1, 0]&quot; fontsize=10];
  layers_0_weight -&gt; linear;
  linear -&gt; _onx_transpose0;

  _onx_matmul0 [shape=box label=&quot;_onx_matmul0&quot; fontsize=10];
  Opset [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;MatMul&quot; fontsize=10];
  x -&gt; Opset;
  _onx_transpose0 -&gt; Opset;
  Opset -&gt; _onx_matmul0;

  linear [shape=box label=&quot;linear&quot; fontsize=10];
  Opset2 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Add&quot; fontsize=10];
  _onx_matmul0 -&gt; Opset2;
  layers_0_bias -&gt; Opset2;
  Opset2 -&gt; linear;

  relu [shape=box label=&quot;relu&quot; fontsize=10];
  relu [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Relu&quot; fontsize=10];
  linear -&gt; relu;
  relu -&gt; relu;

  _onx_transpose02 [shape=box label=&quot;_onx_transpose02&quot; fontsize=10];
  linear2 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Transpose\nperm=[1, 0]&quot; fontsize=10];
  layers_2_weight -&gt; linear2;
  linear2 -&gt; _onx_transpose02;

  _onx_matmul02 [shape=box label=&quot;_onx_matmul02&quot; fontsize=10];
  Opset3 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;MatMul&quot; fontsize=10];
  relu -&gt; Opset3;
  _onx_transpose02 -&gt; Opset3;
  Opset3 -&gt; _onx_matmul02;

  Opset4 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Add&quot; fontsize=10];
  _onx_matmul02 -&gt; Opset4;
  layers_2_bias -&gt; Opset4;
  Opset4 -&gt; output_0;
}" class="graphviz" /></div>
<p>We then apply the optimizations by writing the following code:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.helpers</span> <span class="kn">import</span> <span class="n">pretty_onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="c1"># The model is placed in a GraphBuilder.</span>
<span class="c1"># It creates dictionnaires to store shapes, ranks, types</span>
<span class="c1"># to make it easier to the optimizers to find the information</span>
<span class="c1"># they need. It still uses NodeProto to store nodes</span>
<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Let&#39;s optimize.</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp_opt.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">opt_onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pretty_onnx</span><span class="p">(</span><span class="n">opt_onx</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">18</span>
    <span class="n">doc_string</span><span class="p">:</span> <span class="n">large_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">external_threshold</span><span class="o">=</span><span class="mf">102.</span><span class="o">..</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.weight&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>              <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                   <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.weight&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>               <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.013</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span><span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">Gemm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">linear</span>
      <span class="n">Relu</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relu</span>
        <span class="n">Gemm</span><span class="p">(</span><span class="n">relu</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">output_0</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;output_0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Which renders as follows:</p>
<div class="graphviz"><img src="../_images/graphviz-eb11b268f8e2cd828031ac6641969ac050470f83.png" alt="digraph{
  orientation=portrait;
  size=7;
  ranksep=0.25;
  nodesep=0.05;

  x [shape=box color=red label=&quot;x\nTensorProto.FLOAT\nshape=[3, 10]&quot; fontsize=10];

  output_0 [shape=box color=green label=&quot;output_0\nTensorProto.FLOAT\nshape=[3, 1]&quot; fontsize=10];

  layers_0_weight [shape=box label=&quot;layers_0_weight\nfloat32((32, 10))\n[[ 0.008 -0.192  0.219  0.008  0.154 -0.065  0.013...&quot; fontsize=10];
  layers_0_bias [shape=box label=&quot;layers_0_bias\nfloat32((32,))\n[ 0.028 -0.209 -0.152 -0.196 -0.151  0.097 -0.188 ...&quot; fontsize=10];
  layers_2_weight [shape=box label=&quot;layers_2_weight\nfloat32((1, 32))\n[[ 0.098 -0.027  0.155 -0.004  0.166  0.117  0.129...&quot; fontsize=10];
  layers_2_bias [shape=box label=&quot;layers_2_bias\nfloat32((1,))\n[0.013]&quot; fontsize=10];

  linear [shape=box label=&quot;linear&quot; fontsize=10];
  GemmTransposePattern__MatMulAddPattern__Opset2 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Gemm\ntransB=1&quot; fontsize=10];
  x -&gt; GemmTransposePattern__MatMulAddPattern__Opset2;
  layers_0_weight -&gt; GemmTransposePattern__MatMulAddPattern__Opset2;
  layers_0_bias -&gt; GemmTransposePattern__MatMulAddPattern__Opset2;
  GemmTransposePattern__MatMulAddPattern__Opset2 -&gt; linear;

  relu [shape=box label=&quot;relu&quot; fontsize=10];
  relu [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Relu&quot; fontsize=10];
  linear -&gt; relu;
  relu -&gt; relu;

  GemmTransposePattern__MatMulAddPattern__Opset32 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Gemm\ntransB=1&quot; fontsize=10];
  relu -&gt; GemmTransposePattern__MatMulAddPattern__Opset32;
  layers_2_weight -&gt; GemmTransposePattern__MatMulAddPattern__Opset32;
  layers_2_bias -&gt; GemmTransposePattern__MatMulAddPattern__Opset32;
  GemmTransposePattern__MatMulAddPattern__Opset32 -&gt; output_0;
}" class="graphviz" /></div>
</section>
<section id="verbosity">
<h3>Verbosity<a class="headerlink" href="#verbosity" title="Link to this heading">¶</a></h3>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=44</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">44</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TransposeTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">5</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.007</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.008</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">BLO</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">]</span> <span class="n">make_model</span> <span class="mi">4</span> <span class="n">inits</span> <span class="mi">0</span> <span class="n">params</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">BLO</span><span class="o">.</span><span class="n">time_evaluation_constants_</span><span class="p">]</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">BLO</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="n">large_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">external_threshold</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">BLO</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">switch</span> <span class="n">low</span><span class="o">/</span><span class="n">high</span> <span class="n">order</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">BLO</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">done</span> <span class="ow">in</span> <span class="mf">8.370006980840117e-07</span><span class="n">s</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">0</span> <span class="n">large</span> <span class="n">initializers</span>
</pre></div>
</div>
<p>With more verbosity:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    [GraphBuilder._update_structures_with_proto] starts with 7 nodes
    [GraphBuilder-TBC.set_shape] layers.0.weight:(32, 10)
    [GraphBuilder-TBC.set_rank] layers.0.weight:2
    [GraphBuilder-TBC.set_type] layers.0.weight:1
    [GraphBuilder-TBC.make_initializer] layers.0.weight[1:(32, 10)]
    [GraphBuilder.update_node_constant] new constant &#39;layers.0.weight&#39;, node=None
    [GraphBuilder-TBC.set_shape] layers.0.bias:(32,)
    [GraphBuilder-TBC.set_rank] layers.0.bias:1
    [GraphBuilder-TBC.set_type] layers.0.bias:1
    [GraphBuilder-TBC.make_initializer] layers.0.bias[1:(32,)]
    [GraphBuilder.update_node_constant] new constant &#39;layers.0.bias&#39;, node=None
    [GraphBuilder-TBC.set_shape] layers.2.weight:(1, 32)
    [GraphBuilder-TBC.set_rank] layers.2.weight:2
    [GraphBuilder-TBC.set_type] layers.2.weight:1
    [GraphBuilder-TBC.make_initializer] layers.2.weight[1:(1, 32)]
    [GraphBuilder.update_node_constant] new constant &#39;layers.2.weight&#39;, node=None
    [GraphBuilder-TBC.set_shape] layers.2.bias:(1,)
    [GraphBuilder-TBC.set_rank] layers.2.bias:1
    [GraphBuilder-TBC.set_type] layers.2.bias:1
    [GraphBuilder-TBC.make_initializer] layers.2.bias[1:(1,)]
    [GraphBuilder.update_node_constant] new constant &#39;layers.2.bias&#39;, node=None
    [GraphBuilder-TBC.set_type] x:1
    [GraphBuilder-TBC.set_shape] x:(3, 10)
    [GraphBuilder-TBC.set_rank] x:2
    [GraphBuilder-TBC.set_type] output_0:1
    [GraphBuilder-TBC.set_shape] output_0:(3, 1)
    [GraphBuilder-TBC.set_rank] output_0:2
    [GraphBuilder.update_node_constant] new constant &#39;_onx_transpose0&#39;, node=Transpose
    [GraphBuilder-TBC.set_type] _onx_transpose0:1
    [GraphBuilder-TBC.set_shape] _onx_transpose0:(10, 32)
    [GraphBuilder-TBC.set_rank] _onx_transpose0:2
    [GraphBuilder-TBC.set_type] _onx_transpose0:1
    [GraphBuilder-TBC.set_type] _onx_matmul0:1
    [GraphBuilder-TBC.set_shape] _onx_matmul0:(3, 32)
    [GraphBuilder-TBC.set_rank] _onx_matmul0:2
    [GraphBuilder-TBC.set_type] _onx_matmul0:1
    [GraphBuilder-TBC.set_type] linear:1
    [GraphBuilder-TBC.set_shape] linear:(3, 32)
    [GraphBuilder-TBC.set_rank] linear:2
    [GraphBuilder-TBC.set_type] linear:1
    [GraphBuilder-TBC.set_type] relu:1
    [GraphBuilder-TBC.set_shape] relu:(3, 32)
    [GraphBuilder-TBC.set_rank] relu:2
    [GraphBuilder-TBC.set_type] relu:1
    [GraphBuilder.update_node_constant] new constant &#39;_onx_transpose02&#39;, node=Transpose
    [GraphBuilder-TBC.set_type] _onx_transpose02:1
    [GraphBuilder-TBC.set_shape] _onx_transpose02:(32, 1)
    [GraphBuilder-TBC.set_rank] _onx_transpose02:2
    [GraphBuilder-TBC.set_type] _onx_transpose02:1
    [GraphBuilder-TBC.set_type] _onx_matmul02:1
    [GraphBuilder-TBC.set_shape] _onx_matmul02:(3, 1)
    [GraphBuilder-TBC.set_rank] _onx_matmul02:2
    [GraphBuilder-TBC.set_type] _onx_matmul02:1
    [GraphBuilder-TBC.set_type] output_0:1
    [GraphBuilder._update_structures_with_proto] ends with 7 nodes in 0.0006945059976715129
    [GraphBuilder.constant_folding] starts with 6 constants and 7 nodes.
    [GraphBuilder.constant_folding] cst:: . :: _onx_matmul02
    [GraphBuilder.constant_folding] cst:: 1 :: _onx_transpose0
    [GraphBuilder.constant_folding] cst:: . :: _onx_matmul0
    [GraphBuilder.constant_folding] cst:: 1 :: layers.2.bias
    [GraphBuilder.constant_folding] cst:: . :: output_0
    [GraphBuilder.constant_folding] cst:: 1 :: layers.0.bias
    [GraphBuilder.constant_folding] cst:: 1 :: layers.2.weight
    [GraphBuilder.constant_folding] cst:: . :: relu
    [GraphBuilder.constant_folding] cst:: . :: x
    [GraphBuilder.constant_folding] cst:: 1 :: layers.0.weight
    [GraphBuilder.constant_folding] cst:: . :: linear
    [GraphBuilder.constant_folding] cst:: 1 :: _onx_transpose02
    [GraphBuilder.constant_folding] initializer: layers.0.weight
    [GraphBuilder.constant_folding] initializer: layers.0.bias
    [GraphBuilder.constant_folding] initializer: layers.2.weight
    [GraphBuilder.constant_folding] initializer: layers.2.bias
    [GraphBuilder.constant_folding] from: Transpose(_onx_transpose0)
    [GraphBuilder.constant_folding] fold_constant:Transpose:_onx_transpose0[torch.float32:torch.Size([10, 32])]:from:layers.0.weight
    [GraphBuilder.constant_folding] from: Transpose(_onx_transpose02)
    [GraphBuilder.constant_folding] fold_constant:Transpose:_onx_transpose02[torch.float32:torch.Size([32, 1])]:from:layers.2.weight
    [GraphBuilder.update_node_constant] new constant &#39;_onx_transpose0&#39;, node=Transpose
    [GraphBuilder.update_node_constant] new constant &#39;_onx_transpose02&#39;, node=Transpose
    [GraphBuilder.constant_folding] ends with 6 constants and 7 nodes in 0.0003197229998477269 seconds
    [GraphBuilder._update_shape_types_with_proto] starts with 7 nodes and 11 shapes.
    [GraphBuilder._update_shape_types_with_proto] infer shapes
    [GraphBuilder._update_shape_types_with_proto] infer shapes done 0.0003379400004632771 seconds
    [GraphBuilder._update_shape_types_with_proto] _clean_shapes after 0.0004058300000906456 seconds
    [GraphBuilder._update_shape_types_with_proto] walk through 11 shapes.
    [GraphBuilder-TBC.set_type] p_layers_0_weight:1
    [GraphBuilder-TBC.set_shape] p_layers_0_weight:(32, 10)
    [GraphBuilder-TBC.set_rank] p_layers_0_weight:2
    [GraphBuilder-TBC.set_type] _onx_matmul02:1
    [GraphBuilder-TBC.set_type] _onx_transpose0:1
    [GraphBuilder-TBC.set_type] _onx_matmul0:1
    [GraphBuilder-TBC.set_type] p_layers_2_weight:1
    [GraphBuilder-TBC.set_shape] p_layers_2_weight:(1, 32)
    [GraphBuilder-TBC.set_rank] p_layers_2_weight:2
    [GraphBuilder-TBC.set_type] relu:1
    [GraphBuilder-TBC.set_type] p_layers_0_bias:1
    [GraphBuilder-TBC.set_shape] p_layers_0_bias:(32,)
    [GraphBuilder-TBC.set_rank] p_layers_0_bias:1
    [GraphBuilder-TBC.set_type] p_layers_2_bias:1
    [GraphBuilder-TBC.set_shape] p_layers_2_bias:(1,)
    [GraphBuilder-TBC.set_rank] p_layers_2_bias:1
    [GraphBuilder-TBC.set_type] linear:1
    [GraphBuilder-TBC.set_type] linear_1:1
    [GraphBuilder-TBC.set_shape] linear_1:(3, 1)
    [GraphBuilder-TBC.set_rank] linear_1:2
    [GraphBuilder-TBC.set_type] _onx_transpose02:1
    [GraphBuilder._update_shape_types_with_proto] ends in 0.0001459359991713427 seconds.
    [GraphBuilder.optimize] start with 7 nodes
    [GraphBuilder.optimize] options=OptimizationOptions(remove_unused=True, remove_identity=True,
        constant_folding=False, constant_size=1024, constant_fusing=True,
        verbose=11, max_iter=-1, recursive=False, processor=CPU, order=None,
        patterns=[&#39;BatchNormalizationPattern&#39;, &#39;BatchNormalizationTrainingPattern&#39;,
        &#39;CastLayerNormalizationCastPattern&#39;, &#39;CastPattern&#39;, &#39;CastCastBinaryPattern&#39;,
        &#39;CastOpCastPattern&#39;, &#39;ClipClipPattern&#39;, &#39;ComputationCastOpCastPattern&#39;,
        &#39;ConvBiasNullPattern&#39;, &#39;DropoutPattern&#39;, &#39;ExpandPattern&#39;,
        &#39;ExpandBroadcastPattern&#39;, &#39;ExpandSwapPattern&#39;, &#39;GeluPattern&#39;,
        &#39;IdentityPattern&#39;, &#39;LayerNormalizationPattern&#39;,
        &#39;LayerNormalizationScalePattern&#39;, &#39;LeakyReluPattern&#39;,
        &#39;MulMulMulScalarPattern&#39;, &#39;ReduceReshapePattern&#39;,
        &#39;ReduceSumNormalizePattern&#39;, &#39;ReshapePattern&#39;,
        &#39;ReshapeMatMulReshapePattern&#39;, &#39;Reshape2Of3Pattern&#39;,
        &#39;ReshapeReshapeBinaryPattern&#39;, &#39;MatMulAddPattern&#39;, &#39;GemmTransposePattern&#39;,
        &#39;MatMulReshape2Of3Pattern&#39;, &#39;MulMulMatMulPattern&#39;, &#39;ReshapeReshapePattern&#39;,
        &#39;RotaryConcatPartPattern&#39;, &#39;SameChildrenPattern&#39;,
        &#39;SequenceConstructAtPattern&#39;, &#39;SliceSlicePattern&#39;, &#39;SlicesSplitPattern&#39;,
        &#39;SoftmaxCrossEntropyLossCastPattern&#39;, &#39;Sub1MulPattern&#39;,
        &#39;SwitchOrderBinaryPattern&#39;, &#39;TransposeMatMulPattern&#39;,
        &#39;TransposeReshapeMatMulPattern&#39;, &#39;TransposeReshapeTransposePattern&#39;,
        &#39;TransposeTransposePattern&#39;, &#39;UnsqueezeEqualPattern&#39;,
        &#39;UnsqueezeUnsqueezePattern&#39;])
    [GraphBuilder.remove_identity_nodes] starts with 7
    [GraphBuilder.remove_identity_nodes] found 0 replacements
    [GraphBuilder.remove_identity_nodes] kept 7 nodes
    [GraphBuilder.remove_identity_nodes] ends with 7 nodes in 2.7557001885725185e-05 seconds
    [GraphBuilderPatternOptimization.optimize] start with 7 nodes, 4 initializers, 44 patterns, priorities=[0, 1]
    [GraphBuilderPatternOptimization.optimize] use pattern   1/44 - P0 - BatchNormalizationPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   2/44 - P0 - BatchNormalizationTrainingPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   3/44 - P0 - CastPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   4/44 - P0 - ConvBiasNullPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   5/44 - P0 - ExpandPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   6/44 - P0 - GeluPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   7/44 - P0 - IdentityPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   8/44 - P0 - LeakyReluPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern   9/44 - P0 - ReshapePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  10/44 - P0 - ReshapeReshapePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  11/44 - P0 - SameChildrenPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  12/44 - P0 - SoftmaxCrossEntropyLossCastPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  13/44 - P0 - TransposeReshapeTransposePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  14/44 - P0 - TransposeTransposePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  15/44 - P0 - UnsqueezeUnsqueezePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  16/44 - P1 - CastCastBinaryPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  17/44 - P1 - CastLayerNormalizationCastPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  18/44 - P1 - CastOpCastPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  19/44 - P1 - ClipClipPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  20/44 - P1 - ComputationCastOpCastPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  21/44 - P1 - DropoutPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  22/44 - P1 - ExpandBroadcastPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  23/44 - P1 - ExpandSwapPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  24/44 - P1 - GemmTransposePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  25/44 - P1 - LayerNormalizationPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  26/44 - P1 - LayerNormalizationScalePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  27/44 - P1 - MatMulAddPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  28/44 - P1 - MatMulReshape2Of3Pattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  29/44 - P1 - MulMulMatMulPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  30/44 - P1 - MulMulMulScalarPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  31/44 - P1 - ReduceReshapePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  32/44 - P1 - ReduceSumNormalizePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  33/44 - P1 - Reshape2Of3Pattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  34/44 - P1 - ReshapeMatMulReshapePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  35/44 - P1 - ReshapeReshapeBinaryPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  36/44 - P1 - RotaryConcatPartPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  37/44 - P1 - SequenceConstructAtPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  38/44 - P1 - SliceSlicePattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  39/44 - P1 - SlicesSplitPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  40/44 - P1 - Sub1MulPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  41/44 - P1 - SwitchOrderBinaryPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  42/44 - P1 - TransposeMatMulPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  43/44 - P1 - TransposeReshapeMatMulPattern()
    [GraphBuilderPatternOptimization.optimize] use pattern  44/44 - P1 - UnsqueezeEqualPattern()
    --
    
    opset: : 18
    init: layers.0.weight: ?: ?                                            -- GraphBuilder._update_structures_with_proto.1/from(layers.0.weight)
    init: layers.0.bias: ?: ?                                              -- GraphBuilder._update_structures_with_proto.1/from(layers.0.bias)
    init: layers.2.weight: ?: ?                                            -- GraphBuilder._update_structures_with_proto.1/from(layers.2.weight)
    init: layers.2.bias: ?: ?                                              -- GraphBuilder._update_structures_with_proto.1/from(layers.2.bias)
    input:: x                                                                       |T1: 3 x 10
    Transpose: layers.0.weight -&gt; _onx_transpose0                                   |T1: 10 x 32                  - linear
    MatMul: x, _onx_transpose0 -&gt; _onx_matmul0                                      |T1: 3 x 32                   - Opset
    Add: _onx_matmul0, layers.0.bias -&gt; linear                                      |T1: 3 x 32                   - Opset2
    Relu: linear -&gt; relu                                                            |T1: 3 x 32                   - relu
    Transpose: layers.2.weight -&gt; _onx_transpose02                                  |T1: 32 x 1                   - linear2
    MatMul: relu, _onx_transpose02 -&gt; _onx_matmul02                                 |T1: 3 x 1                    - Opset3
    Add: _onx_matmul02, layers.2.bias -&gt; output_0                                   |T1: 3 x 1                    - Opset4
    output:: output_0                                                               |T1: 3 x 1
    --
    [GraphBuilderPatternOptimization.optimize] iteration 0: 7 nodes, priority=0
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear
    [IdentityPattern.match] NONE - line: 197:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset2
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear2
    [IdentityPattern.match] NONE - line: 210:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset4
    [GraphBuilder-OXK.make_tensor_input] x[0:None] -- marker=_build_pattern1_x
    [GraphBuilder-OXK.set_type] x:-1
    [GraphBuilder-OXK.make_tensor_input] zero[0:None] -- marker=_build_pattern1_zero
    [GraphBuilder-OXK.set_type] zero:-1
    [GraphBuilder-OXK.make_tensor_input] slope[0:None] -- marker=_build_pattern1_slope
    [GraphBuilder-OXK.set_type] slope:-1
    [GraphBuilder-OXK.make_node] [TT:-] Greater: [&#39;x&#39;, &#39;zero&#39;]-&gt;[&#39;_onx_greater0&#39;]
    [GraphBuilder-OXK.set_type] _onx_greater0:9
    [GraphBuilder-OXK.make_node] [TT:-] Mul: [&#39;x&#39;, &#39;slope&#39;]-&gt;[&#39;_onx_mul0&#39;]
    [GraphBuilder-OXK.set_type] _onx_mul0:-1
    [GraphBuilder-OXK.make_node] [TTT:-] Where: [&#39;_onx_greater0&#39;, &#39;x&#39;, &#39;_onx_mul0&#39;]-&gt;[&#39;_onx_where0&#39;]
    [GraphBuilder-OXK.set_type] _onx_where0:-1
    [GraphBuilder-OXK.make_tensor_output] _onx_where0[0: None]
    [GraphBuilder-PVK.make_tensor_input] X[0:None] -- marker=_build_pattern1_X
    [GraphBuilder-PVK.set_type] X:-1
    [GraphBuilder-PVK.make_tensor_input] indices[0:None] -- marker=_build_pattern1_indices
    [GraphBuilder-PVK.set_type] indices:-1
    [GraphBuilder-PVK.make_tensor_input] axis[0:None] -- marker=_build_pattern1_axis
    [GraphBuilder-PVK.set_type] axis:-1
    [GraphBuilder-PVK.make_tensor_input] zerof[0:None] -- marker=_build_pattern1_zerof
    [GraphBuilder-PVK.set_type] zerof:-1
    [GraphBuilder-PVK.make_tensor_input] zeroi[0:None] -- marker=_build_pattern1_zeroi
    [GraphBuilder-PVK.set_type] zeroi:-1
    [GraphBuilder-PVK.make_tensor_input] b[0:None] -- marker=_build_pattern1_b
    [GraphBuilder-PVK.set_type] b:-1
    [GraphBuilder-PVK.make_node] [TT:-] Equal: [&#39;indices&#39;, &#39;b&#39;]-&gt;[&#39;_onx_equal0&#39;]
    [GraphBuilder-PVK.set_type] _onx_equal0:9
    [GraphBuilder-PVK.make_node] [T:-] Not: [&#39;_onx_equal0&#39;]-&gt;[&#39;_onx_not0&#39;]
    [GraphBuilder-PVK.set_type] _onx_not0:9
    [GraphBuilder-PVK.make_node] [TTT:-] Where: [&#39;_onx_not0&#39;, &#39;indices&#39;, &#39;zeroi&#39;]-&gt;[&#39;_onx_where0&#39;]
    [GraphBuilder-PVK.set_type] _onx_where0:-1
    [GraphBuilder-PVK.make_node] [TT:-] Unsqueeze: [&#39;_onx_where0&#39;, &#39;axis&#39;]-&gt;[&#39;_onx_unsqueeze0&#39;]
    [GraphBuilder-PVK.set_type] _onx_unsqueeze0:-1
    [GraphBuilder-PVK.make_node] [T:-] LogSoftmax: [&#39;X&#39;]-&gt;[&#39;_onx_logsoftmax0&#39;]
    [GraphBuilder-PVK.set_type] _onx_logsoftmax0:-1
    [GraphBuilder-PVK.set_type] _onx_gatherelements0:-1
    [GraphBuilder-PVK.make_node] [TT:T] GatherElements: [&#39;_onx_logsoftmax0&#39;, &#39;_onx_unsqueeze0&#39;]-&gt;[&#39;_onx_gatherelements0&#39;]
    [GraphBuilder-PVK.set_type] _onx_gatherelements0:-1
    [GraphBuilder-PVK.make_node] [TT:-] Squeeze: [&#39;_onx_gatherelements0&#39;, &#39;axis&#39;]-&gt;[&#39;_onx_squeeze0&#39;]
    [GraphBuilder-PVK.set_type] _onx_squeeze0:-1
    [GraphBuilder-PVK.make_node] [T:-] Neg: [&#39;_onx_squeeze0&#39;]-&gt;[&#39;_onx_neg0&#39;]
    [GraphBuilder-PVK.set_type] _onx_neg0:-1
    [GraphBuilder-PVK.make_node] [TTT:-] Where: [&#39;_onx_not0&#39;, &#39;_onx_neg0&#39;, &#39;zerof&#39;]-&gt;[&#39;_onx_where02&#39;]
    [GraphBuilder-PVK.set_type] _onx_where02:-1
    [GraphBuilder-PVK.make_node] [T:-] Cast: [&#39;_onx_not0&#39;]-&gt;[&#39;_onx_cast0&#39;]
    [GraphBuilder-PVK.set_type] _onx_cast0:1
    [GraphBuilder-PVK.make_node] [T:-] ReduceSum: [&#39;_onx_cast0&#39;]-&gt;[&#39;_onx_reducesum0&#39;]
    [GraphBuilder-PVK.set_type] _onx_reducesum0:1
    [GraphBuilder-PVK.set_shape] _onx_reducesum0:()
    [GraphBuilder-PVK.set_rank] _onx_reducesum0:0
    [GraphBuilder-PVK.make_node] [#:-] Cast: [&#39;_onx_reducesum0&#39;]-&gt;[&#39;_onx_cast02&#39;]
    [GraphBuilder-PVK.set_type] _onx_cast02:10
    [GraphBuilder-PVK.set_shape] _onx_cast02:()
    [GraphBuilder-PVK.set_rank] _onx_cast02:0
    [GraphBuilder-PVK.make_node] [T:-] Cast: [&#39;_onx_where02&#39;]-&gt;[&#39;_onx_cast03&#39;]
    [GraphBuilder-PVK.set_type] _onx_cast03:1
    [GraphBuilder-PVK.make_node] [T:-] ReduceSum: [&#39;_onx_cast03&#39;]-&gt;[&#39;_onx_reducesum02&#39;]
    [GraphBuilder-PVK.set_type] _onx_reducesum02:1
    [GraphBuilder-PVK.set_shape] _onx_reducesum02:()
    [GraphBuilder-PVK.set_rank] _onx_reducesum02:0
    [GraphBuilder-PVK.make_node] [#:-] Cast: [&#39;_onx_reducesum02&#39;]-&gt;[&#39;_onx_cast04&#39;]
    [GraphBuilder-PVK.set_type] _onx_cast04:10
    [GraphBuilder-PVK.set_shape] _onx_cast04:()
    [GraphBuilder-PVK.set_rank] _onx_cast04:0
    [GraphBuilder-PVK.make_node] [##:-] Div: [&#39;_onx_cast04&#39;, &#39;_onx_cast02&#39;]-&gt;[&#39;_onx_div0&#39;]
    [GraphBuilder-PVK.set_type] _onx_div0:10
    [GraphBuilder-PVK.set_shape] _onx_div0:()
    [GraphBuilder-PVK.set_rank] _onx_div0:0
    [GraphBuilder-PVK.make_tensor_output] _onx_div0[0: None]
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [GraphBuilderPatternOptimization.optimize] done all: -0 +0 nodes
    [GraphBuilder.remove_identity_nodes] starts with 7
    [GraphBuilder.remove_identity_nodes] found 0 replacements
    [GraphBuilder.remove_identity_nodes] kept 7 nodes
    [GraphBuilder.remove_identity_nodes] ends with 7 nodes in 3.063800249947235e-05 seconds
    [GraphBuilderPatternOptimization.optimize] increase priority to 1
    [GraphBuilderPatternOptimization.optimize] iteration 1: 7 nodes, priority=1
    [CastCastBinaryPattern.match] NONE - line: 86:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2
    [CastCastBinaryPattern.match] NONE - line: 86:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4
    [CastOpCastPattern.match] NONE - line: 162:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2
    [CastOpCastPattern.match] NONE - line: 159:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4
    [ComputationCastOpCastPattern.match] NONE - line: 303:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2
    [ComputationCastOpCastPattern.match] NONE - line: 303:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear
    [IdentityPattern.match] NONE - line: 197:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset2
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear2
    [IdentityPattern.match] NONE - line: 210:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset4
    [ReshapeMatMulReshapePattern.match] NONE - line: 738:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset
    [ReshapeMatMulReshapePattern.match] NONE - line: 738:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3
    [Reshape2Of3Pattern.match] NONE - line: 227:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset2
    [Reshape2Of3Pattern.match] NONE - line: 227:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset4
    [ReshapeReshapeBinaryPattern.match] NONE - line: 389:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset2
    [ReshapeReshapeBinaryPattern.match] NONE - line: 389:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset4
    [GraphBuilderPatternOptimization.optimize] match=MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
    [GraphBuilderPatternOptimization.optimize] match=MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
    [MatMulReshape2Of3Pattern.match] NONE - line: 373:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset
    [MatMulReshape2Of3Pattern.match] NONE - line: 373:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3
    [MulMulMatMulPattern.match] NONE - line: 674:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset
    [MulMulMatMulPattern.match] NONE - line: 677:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3
    [GraphBuilderPatternOptimization.match] OVERLAP match=MatchResult: TransposeMatMulPattern replaces [&#39;Transpose&#39;, &#39;MatMul&#39;] #marked: 4)
    [GraphBuilderPatternOptimization.match] OVERLAP match=MatchResult: TransposeMatMulPattern replaces [&#39;Transpose&#39;, &#39;MatMul&#39;] #marked: 4)
    [TransposeReshapeMatMulPattern.match] NONE - line: 991:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset
    [TransposeReshapeMatMulPattern.match] NONE - line: 991:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [GraphBuilderPatternOptimization.optimize] applies 2 matches, 2*MatMulAddPattern - time=0.001 | max_time=IdentityPattern:0.000
    [GraphBuilderPatternOptimization.optimize] apply MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;], inputs: {&#39;x&#39;, &#39;_onx_transpose0&#39;, &#39;layers.0.bias&#39;, &#39;_onx_matmul0&#39;}, outputs: {&#39;linear&#39;, &#39;_onx_matmul0&#39;}
    [GraphBuilderPatternOptimization.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
      - MatMul: [&#39;x&#39;, &#39;_onx_transpose0&#39;] -&gt; [&#39;_onx_matmul0&#39;]
      - Add: [&#39;_onx_matmul0&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
      + Gemm: [&#39;x&#39;, &#39;_onx_transpose0&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
    [GraphBuilder-TBC.set_type] linear:1
    [GraphBuilderPatternOptimization.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;] applied.
    [GraphBuilderPatternOptimization.optimize] - add [&#39;Gemm&#39;]
    [GraphBuilderPatternOptimization.optimize] done MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]: -2 +1 nodes
    [GraphBuilderPatternOptimization.optimize] removed outputs {&#39;_onx_matmul0&#39;}
    [GraphBuilderPatternOptimization.optimize] apply MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;], inputs: {&#39;_onx_transpose02&#39;, &#39;_onx_matmul02&#39;, &#39;relu&#39;, &#39;layers.2.bias&#39;}, outputs: {&#39;_onx_matmul02&#39;, &#39;output_0&#39;}
    [GraphBuilderPatternOptimization.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
      - MatMul: [&#39;relu&#39;, &#39;_onx_transpose02&#39;] -&gt; [&#39;_onx_matmul02&#39;]
      - Add: [&#39;_onx_matmul02&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
      + Gemm: [&#39;relu&#39;, &#39;_onx_transpose02&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
    [GraphBuilder-TBC.set_type] output_0:1
    [GraphBuilderPatternOptimization.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;] applied.
    [GraphBuilderPatternOptimization.optimize] - add [&#39;Gemm&#39;]
    [GraphBuilderPatternOptimization.optimize] done MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]: -2 +1 nodes
    [GraphBuilderPatternOptimization.optimize] removed outputs {&#39;_onx_matmul02&#39;}
    [GraphBuilderPatternOptimization.optimize] done all: -4 +2 nodes
    [GraphBuilder.remove_identity_nodes] starts with 5
    [GraphBuilder.remove_identity_nodes] found 0 replacements
    [GraphBuilder.remove_identity_nodes] kept 5 nodes
    [GraphBuilder.remove_identity_nodes] ends with 5 nodes in 1.9203998817829415e-05 seconds
    [GraphBuilderPatternOptimization.optimize] iteration 2: 5 nodes, priority=1
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear2
    [MatMulAddPattern.match] NONE - line: 48:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=MatMulAddPattern--Opset
    [MatMulAddPattern.match] NONE - line: 45:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=MatMulAddPattern--Opset3
    [GraphBuilderPatternOptimization.optimize] match=MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
    [GraphBuilderPatternOptimization.optimize] match=MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
    [GraphBuilderPatternOptimization.match] OVERLAP match=MatchResult: TransposeMatMulPattern replaces [&#39;Transpose&#39;, &#39;Gemm&#39;] #marked: 2)
    [GraphBuilderPatternOptimization.match] OVERLAP match=MatchResult: TransposeMatMulPattern replaces [&#39;Transpose&#39;, &#39;Gemm&#39;] #marked: 2)
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [GraphBuilderPatternOptimization.optimize] applies 2 matches, 2*GemmTransposePattern - time=0.000 | max_time=TransposeMatMulPattern:0.000
    [GraphBuilderPatternOptimization.optimize] apply MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;], inputs: {&#39;x&#39;, &#39;_onx_transpose0&#39;, &#39;layers.0.bias&#39;}, outputs: {&#39;linear&#39;}
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose0&#39;, node=Transpose
    [GraphBuilderPatternOptimization.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
      - Gemm: [&#39;x&#39;, &#39;_onx_transpose0&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
      + Transpose: [&#39;_onx_transpose0&#39;] -&gt; [&#39;GemmTransposePattern--_onx_transpose0&#39;]
      + Gemm: [&#39;x&#39;, &#39;GemmTransposePattern--_onx_transpose0&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose0&#39;, node=Transpose
    [GraphBuilder-TBC.set_type] GemmTransposePattern--_onx_transpose0:1
    [GraphBuilder-TBC.set_shape] GemmTransposePattern--_onx_transpose0:(32, 10)
    [GraphBuilder-TBC.set_rank] GemmTransposePattern--_onx_transpose0:2
    [GraphBuilder-TBC.set_type] linear:1
    [GraphBuilderPatternOptimization.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;] applied.
    [GraphBuilderPatternOptimization.optimize] - add [&#39;Transpose&#39;, &#39;Gemm&#39;]
    [GraphBuilderPatternOptimization.optimize] done MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]: -1 +2 nodes
    [GraphBuilderPatternOptimization.optimize] apply MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;], inputs: {&#39;_onx_transpose02&#39;, &#39;relu&#39;, &#39;layers.2.bias&#39;}, outputs: {&#39;output_0&#39;}
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose02&#39;, node=Transpose
    [GraphBuilderPatternOptimization.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
      - Gemm: [&#39;relu&#39;, &#39;_onx_transpose02&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
      + Transpose: [&#39;_onx_transpose02&#39;] -&gt; [&#39;GemmTransposePattern--_onx_transpose02&#39;]
      + Gemm: [&#39;relu&#39;, &#39;GemmTransposePattern--_onx_transpose02&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose02&#39;, node=Transpose
    [GraphBuilder-TBC.set_type] GemmTransposePattern--_onx_transpose02:1
    [GraphBuilder-TBC.set_shape] GemmTransposePattern--_onx_transpose02:(1, 32)
    [GraphBuilder-TBC.set_rank] GemmTransposePattern--_onx_transpose02:2
    [GraphBuilder-TBC.set_type] output_0:1
    [GraphBuilderPatternOptimization.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;] applied.
    [GraphBuilderPatternOptimization.optimize] - add [&#39;Transpose&#39;, &#39;Gemm&#39;]
    [GraphBuilderPatternOptimization.optimize] done MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]: -1 +2 nodes
    [GraphBuilderPatternOptimization.optimize] done all: -2 +4 nodes
    [GraphBuilder.remove_identity_nodes] starts with 7
    [GraphBuilder.remove_identity_nodes] found 0 replacements
    [GraphBuilder.remove_identity_nodes] kept 7 nodes
    [GraphBuilder.remove_identity_nodes] ends with 7 nodes in 2.3068998416420072e-05 seconds
    [GraphBuilderPatternOptimization.optimize] iteration 3: 7 nodes, priority=1
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=linear2
    [IdentityPattern.match] NONE - line: 165:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3
    [MatMulAddPattern.match] NONE - line: 48:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2
    [MatMulAddPattern.match] NONE - line: 45:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32
    [GemmTransposePattern.match] NONE - line: 284:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2
    [GemmTransposePattern.match] NONE - line: 284:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32
    [TransposeMatMulPattern.match] NONE - line: 886:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2
    [TransposeMatMulPattern.match] NONE - line: 886:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=linear2
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3
    [GraphBuilderPatternOptimization.optimize] match=MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;]
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset
    [GraphBuilderPatternOptimization.optimize] match=MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;]
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3
    [GraphBuilderPatternOptimization.optimize] applies 2 matches, 2*TransposeTransposePattern - time=0.000 | max_time=TransposeTransposePattern:0.000
    [GraphBuilderPatternOptimization.optimize] apply MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;], inputs: {&#39;_onx_transpose0&#39;, &#39;layers.0.weight&#39;}, outputs: {&#39;_onx_transpose0&#39;, &#39;GemmTransposePattern--_onx_transpose0&#39;}
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose0&#39;, node=Identity
    [GraphBuilderPatternOptimization.apply_match] MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;]
      - Transpose: [&#39;layers.0.weight&#39;] -&gt; [&#39;_onx_transpose0&#39;]
      - Transpose: [&#39;_onx_transpose0&#39;] -&gt; [&#39;GemmTransposePattern--_onx_transpose0&#39;]
      + Identity: [&#39;layers.0.weight&#39;] -&gt; [&#39;GemmTransposePattern--_onx_transpose0&#39;]
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose0&#39;, node=Identity
    [GraphBuilder-TBC.set_type] GemmTransposePattern--_onx_transpose0:1
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose0&#39;, node=Identity
    [GraphBuilderPatternOptimization.apply_match] MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;] applied.
    [GraphBuilderPatternOptimization.optimize] - add [&#39;Identity&#39;]
    [GraphBuilderPatternOptimization.optimize] done MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;]: -2 +1 nodes
    [GraphBuilderPatternOptimization.optimize] removed outputs {&#39;_onx_transpose0&#39;}
    [GraphBuilderPatternOptimization.optimize] apply MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;], inputs: {&#39;_onx_transpose02&#39;, &#39;layers.2.weight&#39;}, outputs: {&#39;_onx_transpose02&#39;, &#39;GemmTransposePattern--_onx_transpose02&#39;}
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose02&#39;, node=Identity
    [GraphBuilderPatternOptimization.apply_match] MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;]
      - Transpose: [&#39;layers.2.weight&#39;] -&gt; [&#39;_onx_transpose02&#39;]
      - Transpose: [&#39;_onx_transpose02&#39;] -&gt; [&#39;GemmTransposePattern--_onx_transpose02&#39;]
      + Identity: [&#39;layers.2.weight&#39;] -&gt; [&#39;GemmTransposePattern--_onx_transpose02&#39;]
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose02&#39;, node=Identity
    [GraphBuilder-TBC.set_type] GemmTransposePattern--_onx_transpose02:1
    [GraphBuilder.update_node_constant] new constant &#39;GemmTransposePattern--_onx_transpose02&#39;, node=Identity
    [GraphBuilderPatternOptimization.apply_match] MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;] applied.
    [GraphBuilderPatternOptimization.optimize] - add [&#39;Identity&#39;]
    [GraphBuilderPatternOptimization.optimize] done MatchResult: TransposeTransposePattern replaces [&#39;Transpose&#39;, &#39;Transpose&#39;]: -2 +1 nodes
    [GraphBuilderPatternOptimization.optimize] removed outputs {&#39;_onx_transpose02&#39;}
    [GraphBuilderPatternOptimization.optimize] done all: -4 +2 nodes
    [GraphBuilder.remove_identity_nodes] starts with 5
    [GraphBuilder.remove_identity_nodes] found 2 replacements
    [GraphBuilder.remove_identity_nodes] kept 3 nodes
    [GraphBuilder.remove_identity_nodes] node Gemm-GemmTransposePattern--MatMulAddPattern--Opset2:[&#39;x&#39;, &#39;GemmTransposePattern--_onx_transpose0&#39;, &#39;layers.0.bias&#39;]-&gt;[&#39;x&#39;, &#39;layers.0.weight&#39;, &#39;layers.0.bias&#39;]:[&#39;linear&#39;]-&gt;[&#39;linear&#39;]
    [GraphBuilder.remove_identity_nodes] node Gemm-GemmTransposePattern--MatMulAddPattern--Opset32:[&#39;relu&#39;, &#39;GemmTransposePattern--_onx_transpose02&#39;, &#39;layers.2.bias&#39;]-&gt;[&#39;relu&#39;, &#39;layers.2.weight&#39;, &#39;layers.2.bias&#39;]:[&#39;output_0&#39;]-&gt;[&#39;output_0&#39;]
    [GraphBuilder.remove_identity_nodes] ends with 3 nodes in 6.21190010861028e-05 seconds
    [GraphBuilderPatternOptimization.optimize] iteration 4: 3 nodes, priority=1
    [MatMulAddPattern.match] NONE - line: 48:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2
    [MatMulAddPattern.match] NONE - line: 45:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32
    [GemmTransposePattern.match] NONE - line: 284:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2
    [GemmTransposePattern.match] NONE - line: 284:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32
    [TransposeMatMulPattern.match] NONE - line: 848:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2
    [TransposeMatMulPattern.match] NONE - line: 848:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32
    [GraphBuilderPatternOptimization.optimize] done all: -0 +0 nodes
    [GraphBuilderPatternOptimization.optimize] done after 5 iterations with 3 nodes in 0.006
        STAT apply_GemmTransposePattern +4 -2 #it=1 maxmatch=1 i=2 - time=0.0003327369995531626
        STAT apply_MatMulAddPattern +2 -4 #it=1 maxmatch=1 i=2 - time=0.00020908800070174038
        STAT apply_TransposeTransposePattern +2 -4 #it=1 maxmatch=1 i=2 - time=0.00022536699907504953
        STAT build_graph_for_pattern +0 -0 #it=5 maxmatch=0 i=0 - time=0.00014327100143418647
        STAT check_pattern_00 +0 -0 #it=1 maxmatch=0 i=0 - time=1.605400029802695e-05
        STAT check_pattern_A0 +0 -0 #it=3 maxmatch=0 i=0 - time=8.254599379142746e-05
        STAT check_pattern_B0 +0 -0 #it=4 maxmatch=0 i=0 - time=5.0224000005982816e-05
        STAT match_BatchNormalizationPattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.306400296627544e-05
        STAT match_BatchNormalizationTrainingPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.4255001335404813e-05
        STAT match_CastCastBinaryPattern +0 -0 #it=4 maxmatch=0 i=0 - time=4.104700201423839e-05
        STAT match_CastLayerNormalizationCastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.0181003492325544e-05
        STAT match_CastOpCastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=3.865600228891708e-05
        STAT match_CastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.383299943176098e-05
        STAT match_ClipClipPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.9169998267898336e-05
        STAT match_ComputationCastOpCastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=0.0001033730004564859
        STAT match_ConvBiasNullPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.7209000108996406e-05
        STAT match_DropoutPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.6662004782119766e-05
        STAT match_ExpandBroadcastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.6551002772757784e-05
        STAT match_ExpandPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.3043998226057738e-05
        STAT match_ExpandSwapPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.6948000848060474e-05
        STAT match_GeluPattern +0 -0 #it=5 maxmatch=0 i=0 - time=3.5999983083456755e-06
        STAT match_GemmTransposePattern +0 -0 #it=4 maxmatch=2 i=2 - time=7.471699427696876e-05
        STAT match_IdentityPattern +0 -0 #it=5 maxmatch=0 i=0 - time=0.00042024600043077953
        STAT match_LayerNormalizationPattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.0667001081164926e-05
        STAT match_LayerNormalizationScalePattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.8404000002192333e-05
        STAT match_LeakyReluPattern +0 -0 #it=5 maxmatch=0 i=0 - time=0.0007750050026515964
        STAT match_MatMulAddPattern +0 -0 #it=4 maxmatch=2 i=2 - time=0.00011396699846955016
        STAT match_MatMulReshape2Of3Pattern +0 -0 #it=4 maxmatch=2 i=0 - time=3.724699854501523e-05
        STAT match_MulMulMatMulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=3.2002004445530474e-05
        STAT match_MulMulMulScalarPattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.10210018849466e-05
        STAT match_ReduceReshapePattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.295699596288614e-05
        STAT match_ReduceSumNormalizePattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.929100471897982e-05
        STAT match_Reshape2Of3Pattern +0 -0 #it=4 maxmatch=0 i=0 - time=4.199899922241457e-05
        STAT match_ReshapeMatMulReshapePattern +0 -0 #it=4 maxmatch=0 i=0 - time=3.7881000025663525e-05
        STAT match_ReshapePattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.580499858595431e-05
        STAT match_ReshapeReshapeBinaryPattern +0 -0 #it=4 maxmatch=0 i=0 - time=3.5246001061750576e-05
        STAT match_ReshapeReshapePattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.27799937420059e-05
        STAT match_RotaryConcatPartPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.9571001757867634e-05
        STAT match_SameChildrenPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.7129997255979106e-05
        STAT match_SequenceConstructAtPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.7833997844718397e-05
        STAT match_SliceSlicePattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.87539953913074e-05
        STAT match_SlicesSplitPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.723600144032389e-05
        STAT match_SoftmaxCrossEntropyLossCastPattern +0 -0 #it=5 maxmatch=2 i=0 - time=0.0018088959986926056
        STAT match_Sub1MulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.909900311147794e-05
        STAT match_SwitchOrderBinaryPattern +0 -0 #it=4 maxmatch=2 i=0 - time=2.3594995582243428e-05
        STAT match_TransposeMatMulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=0.00014759800251340494
        STAT match_TransposeReshapeMatMulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=3.168400144204497e-05
        STAT match_TransposeReshapeTransposePattern +0 -0 #it=5 maxmatch=2 i=0 - time=8.608399730292149e-05
        STAT match_TransposeTransposePattern +0 -0 #it=5 maxmatch=2 i=2 - time=9.404599768458866e-05
        STAT match_UnsqueezeEqualPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.855400114436634e-05
        STAT match_UnsqueezeUnsqueezePattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.4615997972432524e-05
        STAT remove_identity_nodes +2 -4 #it=4 maxmatch=0 i=0 - time=0.00019398500080569647
    --MODEL: 3 nodes, 1 inputs, 1 outputs, 4 initializers--
         INPUT:   1 x 1t
        OUTPUT:   1 x 1t
          INIT:   4 x 1t
          NODE:   2 x Gemm
          NODE:   1 x Relu
    --MODEL: 3 nodes, 1 inputs, 1 outputs, 4 initializers--DETAILED--
         INPUT:   1 x 1t[3x10]
        OUTPUT:   1 x 1t[3x1]
          INIT:   1 x 1t[1]
          INIT:   1 x 1t[1x32]
          INIT:   1 x 1t[32]
          INIT:   1 x 1t[32x10]
          NODE:   1 x Gemm -SIG- 1t[3x10], 1t[32x10], 1t[32]
          NODE:   1 x Gemm -SIG- 1t[3x32], 1t[1x32], 1t[1]
          NODE:   1 x Relu -SIG- 1t[3x32]
    [GraphBuilder.optimize] done with 3 nodes in 0.008
        STAT apply_GemmTransposePattern +4 -2 #it=1 maxmatch=1 i=2 - time=0.0003327369995531626
        STAT apply_MatMulAddPattern +2 -4 #it=1 maxmatch=1 i=2 - time=0.00020908800070174038
        STAT apply_TransposeTransposePattern +2 -4 #it=1 maxmatch=1 i=2 - time=0.00022536699907504953
        STAT build_graph_for_pattern +0 -0 #it=5 maxmatch=0 i=0 - time=0.00014327100143418647
        STAT check_A +0 -0 #it=0 maxmatch=0 i=0 - time=2.4860997655196115e-05
        STAT check_B +0 -0 #it=0 maxmatch=0 i=0 - time=1.4296001609181985e-05
        STAT check_C +0 -0 #it=0 maxmatch=0 i=0 - time=1.2853997759521008e-05
        STAT check_F +0 -0 #it=0 maxmatch=0 i=0 - time=1.466499816160649e-05
        STAT check_G +0 -0 #it=0 maxmatch=0 i=0 - time=9.174997103400528e-06
        STAT check_pattern_00 +0 -0 #it=1 maxmatch=0 i=0 - time=1.605400029802695e-05
        STAT check_pattern_A0 +0 -0 #it=3 maxmatch=0 i=0 - time=8.254599379142746e-05
        STAT check_pattern_B0 +0 -0 #it=4 maxmatch=0 i=0 - time=5.0224000005982816e-05
        STAT match_BatchNormalizationPattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.306400296627544e-05
        STAT match_BatchNormalizationTrainingPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.4255001335404813e-05
        STAT match_CastCastBinaryPattern +0 -0 #it=4 maxmatch=0 i=0 - time=4.104700201423839e-05
        STAT match_CastLayerNormalizationCastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.0181003492325544e-05
        STAT match_CastOpCastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=3.865600228891708e-05
        STAT match_CastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.383299943176098e-05
        STAT match_ClipClipPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.9169998267898336e-05
        STAT match_ComputationCastOpCastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=0.0001033730004564859
        STAT match_ConvBiasNullPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.7209000108996406e-05
        STAT match_DropoutPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.6662004782119766e-05
        STAT match_ExpandBroadcastPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.6551002772757784e-05
        STAT match_ExpandPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.3043998226057738e-05
        STAT match_ExpandSwapPattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.6948000848060474e-05
        STAT match_GeluPattern +0 -0 #it=5 maxmatch=0 i=0 - time=3.5999983083456755e-06
        STAT match_GemmTransposePattern +0 -0 #it=4 maxmatch=2 i=2 - time=7.471699427696876e-05
        STAT match_IdentityPattern +0 -0 #it=5 maxmatch=0 i=0 - time=0.00042024600043077953
        STAT match_LayerNormalizationPattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.0667001081164926e-05
        STAT match_LayerNormalizationScalePattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.8404000002192333e-05
        STAT match_LeakyReluPattern +0 -0 #it=5 maxmatch=0 i=0 - time=0.0007750050026515964
        STAT match_MatMulAddPattern +0 -0 #it=4 maxmatch=2 i=2 - time=0.00011396699846955016
        STAT match_MatMulReshape2Of3Pattern +0 -0 #it=4 maxmatch=2 i=0 - time=3.724699854501523e-05
        STAT match_MulMulMatMulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=3.2002004445530474e-05
        STAT match_MulMulMulScalarPattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.10210018849466e-05
        STAT match_ReduceReshapePattern +0 -0 #it=4 maxmatch=0 i=0 - time=2.295699596288614e-05
        STAT match_ReduceSumNormalizePattern +0 -0 #it=4 maxmatch=0 i=0 - time=1.929100471897982e-05
        STAT match_Reshape2Of3Pattern +0 -0 #it=4 maxmatch=0 i=0 - time=4.199899922241457e-05
        STAT match_ReshapeMatMulReshapePattern +0 -0 #it=4 maxmatch=0 i=0 - time=3.7881000025663525e-05
        STAT match_ReshapePattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.580499858595431e-05
        STAT match_ReshapeReshapeBinaryPattern +0 -0 #it=4 maxmatch=0 i=0 - time=3.5246001061750576e-05
        STAT match_ReshapeReshapePattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.27799937420059e-05
        STAT match_RotaryConcatPartPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.9571001757867634e-05
        STAT match_SameChildrenPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.7129997255979106e-05
        STAT match_SequenceConstructAtPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.7833997844718397e-05
        STAT match_SliceSlicePattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.87539953913074e-05
        STAT match_SlicesSplitPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.723600144032389e-05
        STAT match_SoftmaxCrossEntropyLossCastPattern +0 -0 #it=5 maxmatch=2 i=0 - time=0.0018088959986926056
        STAT match_Sub1MulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.909900311147794e-05
        STAT match_SwitchOrderBinaryPattern +0 -0 #it=4 maxmatch=2 i=0 - time=2.3594995582243428e-05
        STAT match_TransposeMatMulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=0.00014759800251340494
        STAT match_TransposeReshapeMatMulPattern +0 -0 #it=4 maxmatch=2 i=0 - time=3.168400144204497e-05
        STAT match_TransposeReshapeTransposePattern +0 -0 #it=5 maxmatch=2 i=0 - time=8.608399730292149e-05
        STAT match_TransposeTransposePattern +0 -0 #it=5 maxmatch=2 i=2 - time=9.404599768458866e-05
        STAT match_UnsqueezeEqualPattern +0 -0 #it=4 maxmatch=2 i=0 - time=1.855400114436634e-05
        STAT match_UnsqueezeUnsqueezePattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.4615997972432524e-05
        STAT pattern_optimization +0 -4 #it=0 maxmatch=0 i=0 - time=0.007263799998327158
        STAT remove_identity_nodes +2 -4 #it=4 maxmatch=0 i=0 - time=0.00023608799892826937
        STAT remove_unused +0 -0 #it=0 maxmatch=0 i=0 - time=7.145300332922488e-05
    --MODEL: 3 nodes, 1 inputs, 1 outputs, 4 initializers--
         INPUT:   1 x 1t
        OUTPUT:   1 x 1t
          INIT:   4 x 1t
          NODE:   2 x Gemm
          NODE:   1 x Relu
    --MODEL: 3 nodes, 1 inputs, 1 outputs, 4 initializers--DETAILED--
         INPUT:   1 x 1t[3x10]
        OUTPUT:   1 x 1t[3x1]
          INIT:   1 x 1t[1]
          INIT:   1 x 1t[1x32]
          INIT:   1 x 1t[32]
          INIT:   1 x 1t[32x10]
          NODE:   1 x Gemm -SIG- 1t[3x10], 1t[32x10], 1t[32]
          NODE:   1 x Gemm -SIG- 1t[3x32], 1t[1x32], 1t[1]
          NODE:   1 x Relu -SIG- 1t[3x32]
    [GraphBuilder-TBC.to_onnx] make_model 4 inits 0 params
    [GraphBuilder-TBC.time_evaluation_constants_] 0
    [GraphBuilder-TBC._build_initializers] start with 4 initializers, large_model=False, external_threshold=1024
    [GraphBuilder-TBC._build_initializers] switch low/high order
    [GraphBuilder-TBC._build_initializers] TensorProto-layers.0.weight:1[(32, 10)]
    [GraphBuilder-TBC._build_initializers] TensorProto-layers.0.bias:1[(32,)]
    [GraphBuilder-TBC._build_initializers] TensorProto-layers.2.weight:1[(1, 32)]
    [GraphBuilder-TBC._build_initializers] TensorProto-layers.2.bias:1[(1,)]
    [GraphBuilder-TBC._build_initializers] done in 8.729984983801842e-07s with 4 initializers, 0 large initializers
</pre></div>
</div>
</section>
<section id="select-the-pattern-to-use">
<h3>Select the pattern to use<a class="headerlink" href="#select-the-pattern-to-use" title="Link to this heading">¶</a></h3>
<p>Class <a class="reference internal" href="../api/xbuilder/index.html#experimental_experiment.xbuilder.OptimizationOptions" title="experimental_experiment.xbuilder.OptimizationOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizationOptions</span></code></a>
is used to enable or disable patterns.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span>
        <span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;TransposeTranspose,TransposeMatMul&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">2</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TransposeMatMulPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">3</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.001</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.001</span>
</pre></div>
</div>
<p>There exists some predefined lists of patterns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code>: includes all patterns using only standard onnx patterns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onnxruntime</span></code>: patterns specific to <a class="reference external" href="https://onnxruntime.ai/">onnxruntime</a>, the final model
may be executed by onnxruntime and possibly only onnxruntime as it may
introduce patterns from <a class="reference external" href="https://github.com/microsoft/onnxruntime/blob/main/docs/OperatorKernels.md">Supported Operators and Data Types</a>.</p></li>
</ul>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default+onnxruntime&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=56</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">56</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">7</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TransposeTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">7</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.008</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.009</span>
</pre></div>
</div>
</section>
<section id="statistics">
<h3>Statistics<a class="headerlink" href="#statistics" title="Link to this heading">¶</a></h3>
<p>This can be used to see when a pattern is applied and how long it takes.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stat</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                         <span class="n">pattern</span>   <span class="n">time_in</span>  <span class="n">removed</span>  <span class="n">added</span>  <span class="n">iteration</span>  <span class="n">instances</span>  <span class="n">match_index</span>
    <span class="mi">0</span>                    <span class="n">check_A</span>  <span class="mf">0.000022</span>      <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">1</span>      <span class="n">remove_identity_nodes</span>  <span class="mf">0.000035</span>      <span class="mf">0.0</span>    <span class="mf">0.0</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">2</span>                    <span class="n">check_B</span>  <span class="mf">0.000013</span>      <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">3</span>              <span class="n">remove_unused</span>  <span class="mf">0.000036</span>      <span class="mf">0.0</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">4</span>                    <span class="n">check_C</span>  <span class="mf">0.000012</span>      <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="o">..</span>                       <span class="o">...</span>       <span class="o">...</span>      <span class="o">...</span>    <span class="o">...</span>        <span class="o">...</span>        <span class="o">...</span>          <span class="o">...</span>
    <span class="mi">221</span>  <span class="n">build_graph_for_pattern</span>  <span class="mf">0.000017</span>      <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="mf">4.0</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">222</span>     <span class="n">pattern_optimization</span>  <span class="mf">0.004985</span>      <span class="mf">4.0</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">223</span>                  <span class="n">check_F</span>  <span class="mf">0.000010</span>      <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">224</span>            <span class="n">remove_unused</span>  <span class="mf">0.000024</span>      <span class="mf">0.0</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    <span class="mi">225</span>                  <span class="n">check_G</span>  <span class="mf">0.000008</span>      <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>
    
    <span class="p">[</span><span class="mi">226</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">7</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>It can be aggregated:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">aggs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;time_in&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;added&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;removed&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;match_index&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggs</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                               <span class="n">time_in</span>  <span class="n">added</span>  <span class="n">removed</span>  <span class="n">iteration</span>  <span class="n">match_index</span>  <span class="n">instances</span>
    <span class="n">pattern</span>                                                                                              
    <span class="n">apply_GemmTransposePattern</span>                <span class="mf">0.000714</span>      <span class="mi">4</span>        <span class="mi">2</span>          <span class="mi">2</span>            <span class="mi">1</span>          <span class="mi">2</span>
    <span class="n">apply_MatMulAddPattern</span>                    <span class="mf">0.000471</span>      <span class="mi">2</span>        <span class="mi">4</span>          <span class="mi">1</span>            <span class="mi">1</span>          <span class="mi">2</span>
    <span class="n">apply_TransposeTransposePattern</span>           <span class="mf">0.000511</span>      <span class="mi">2</span>        <span class="mi">4</span>          <span class="mi">3</span>            <span class="mi">1</span>          <span class="mi">2</span>
    <span class="n">build_graph_for_pattern</span>                   <span class="mf">0.000334</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_A</span>                                   <span class="mf">0.000046</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_B</span>                                   <span class="mf">0.000028</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_C</span>                                   <span class="mf">0.000026</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_F</span>                                   <span class="mf">0.000022</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_G</span>                                   <span class="mf">0.000018</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_pattern_00</span>                          <span class="mf">0.000042</span>      <span class="mi">0</span>        <span class="mi">0</span>         <span class="o">-</span><span class="mi">1</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_pattern_A0</span>                          <span class="mf">0.000186</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">3</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">check_pattern_B0</span>                          <span class="mf">0.000106</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">3</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_BatchNormalizationPattern</span>           <span class="mf">0.000095</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_BatchNormalizationTrainingPattern</span>   <span class="mf">0.000053</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_CastCastBinaryPattern</span>               <span class="mf">0.000414</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_CastLayerNormalizationCastPattern</span>   <span class="mf">0.000045</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_CastOpCastPattern</span>                   <span class="mf">0.000140</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_CastPattern</span>                         <span class="mf">0.000050</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ClipClipPattern</span>                     <span class="mf">0.000059</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ComputationCastOpCastPattern</span>        <span class="mf">0.000084</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ConvBiasNullPattern</span>                 <span class="mf">0.000063</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_DropoutPattern</span>                      <span class="mf">0.000047</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ExpandBroadcastPattern</span>              <span class="mf">0.000047</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ExpandPattern</span>                       <span class="mf">0.000061</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ExpandSwapPattern</span>                   <span class="mf">0.000047</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_GeluPattern</span>                         <span class="mf">0.000009</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_GemmTransposePattern</span>                <span class="mf">0.000154</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">2</span>
    <span class="n">match_IdentityPattern</span>                     <span class="mf">0.000805</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_LayerNormalizationPattern</span>           <span class="mf">0.000054</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_LayerNormalizationScalePattern</span>      <span class="mf">0.000050</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_LeakyReluPattern</span>                    <span class="mf">0.001209</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_MatMulAddPattern</span>                    <span class="mf">0.000366</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">2</span>
    <span class="n">match_MatMulReshape2Of3Pattern</span>            <span class="mf">0.000119</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_MulMulMatMulPattern</span>                 <span class="mf">0.000108</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_MulMulMulScalarPattern</span>              <span class="mf">0.000055</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ReduceReshapePattern</span>                <span class="mf">0.000062</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ReduceSumNormalizePattern</span>           <span class="mf">0.000050</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_Reshape2Of3Pattern</span>                  <span class="mf">0.000106</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ReshapeMatMulReshapePattern</span>         <span class="mf">0.000087</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ReshapePattern</span>                      <span class="mf">0.000059</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ReshapeReshapeBinaryPattern</span>         <span class="mf">0.000081</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">match_ReshapeReshapePattern</span>               <span class="mf">0.000060</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_RotaryConcatPartPattern</span>             <span class="mf">0.000060</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_SameChildrenPattern</span>                 <span class="mf">0.000133</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_SequenceConstructAtPattern</span>          <span class="mf">0.000103</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_SliceSlicePattern</span>                   <span class="mf">0.000069</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_SlicesSplitPattern</span>                  <span class="mf">0.000055</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_SoftmaxCrossEntropyLossCastPattern</span>  <span class="mf">0.003354</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_Sub1MulPattern</span>                      <span class="mf">0.000063</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_SwitchOrderBinaryPattern</span>            <span class="mf">0.000065</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_TransposeMatMulPattern</span>              <span class="mf">0.000533</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_TransposeReshapeMatMulPattern</span>       <span class="mf">0.000254</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_TransposeReshapeTransposePattern</span>    <span class="mf">0.000141</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_TransposeTransposePattern</span>           <span class="mf">0.000163</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">2</span>
    <span class="n">match_UnsqueezeEqualPattern</span>               <span class="mf">0.000043</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">match_UnsqueezeUnsqueezePattern</span>           <span class="mf">0.000050</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">4</span>            <span class="mi">2</span>          <span class="mi">0</span>
    <span class="n">pattern_optimization</span>                      <span class="mf">0.013868</span>      <span class="mi">0</span>        <span class="mi">4</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">remove_identity_nodes</span>                     <span class="mf">0.000476</span>      <span class="mi">2</span>        <span class="mi">4</span>          <span class="mi">3</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">remove_unused</span>                             <span class="mf">0.000124</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
</pre></div>
</div>
</section>
</section>
<section id="shape-inference">
<h2>Shape inference<a class="headerlink" href="#shape-inference" title="Link to this heading">¶</a></h2>
<p>The optimizers require to know the shapes to ensure they can rewrite
some nodes and avoid producing a model which does not return the
same results. If it is missing, some patterns cannot match for sure
and they will not match.</p>
<p>This information can be built by running shape inference
on the onnx models. That’s what is done is the previous examples.
However, the best case is when this information comes from torch.</p>
<p>Function <a class="reference internal" href="../api/torch_interpreter/index.html#experimental_experiment.torch_interpreter.to_onnx" title="experimental_experiment.torch_interpreter.to_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_onnx</span></code></a>
converts a torch model into ONNX. While doing so, it stores the shape
information coming from torch. There is no need to run shape inference
on the onnx model it generates before optimizing it.</p>
</section>
<section id="available-patterns-and-api">
<h2>Available Patterns and API<a class="headerlink" href="#available-patterns-and-api" title="Link to this heading">¶</a></h2>
<p>All patterns may be found at <a class="reference internal" href="../api/xoptim/patterns/index.html#l-pattern-optimization-onnx"><span class="std std-ref">experimental_experiment.xoptim.patterns</span></a>
and <a class="reference internal" href="../api/xoptim/patterns_ort/index.html#l-pattern-optimization-ort"><span class="std std-ref">experimental_experiment.xoptim.patterns_ort</span></a>.</p>
<p>When writing a pattern, walking along the graph or checking the shape
is very common. Class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>
provides the following methods.</p>
<section id="opsets">
<h3>Opsets<a class="headerlink" href="#opsets" title="Link to this heading">¶</a></h3>
<p>Patterns must rewrite using the nodes of the opset defined in the model.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.main_opset" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.main_opset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">main_opset</span></code></a>: returns the opset</p></li>
</ul>
</section>
<section id="shapes-types">
<h3>Shapes, Types<a class="headerlink" href="#shapes-types" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_type</span></code></a>: tells if a result type is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_type</span></code></a>: returns a result type, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_shape</span></code></a>: tells if a result shape is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_shape</span></code></a>: returns a result shape, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_rank" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_rank</span></code></a>: tells if a result rank is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_rank" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_rank</span></code></a>: returns a result rank, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_infer_type</span></code></a>: returns a type if it can be guessed</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_infer_shape</span></code></a>: returns a shape if it can be guessed</p></li>
</ul>
</section>
<section id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_constant</span></code></a>:
tells if a node is a constant (it may be a constant, an initializer or any value built on other constants)</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant_scalar" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant_scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_constant_scalar</span></code></a>:
checks a constant is a scalar and compares its value to a number</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_computed_constant" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_computed_constant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_computed_constant</span></code></a>:
returns the constant, computes it is a constant built from other constants</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_attribute" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_attribute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_attribute</span></code></a>:
returns an attribute of a node</p></li>
</ul>
</section>
<section id="graph">
<h3>Graph<a class="headerlink" href="#graph" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_node" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">next_node</span></code></a>:
returns the next node only if there is only one</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_nodes" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_nodes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">next_nodes</span></code></a>:
returns the node consuming this result</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.node_before" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.node_before"><code class="xref py py-meth docutils literal notranslate"><span class="pre">node_before</span></code></a>:
returns the node producing the result</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_output" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_output"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_output</span></code></a>:
tells if a result is an output</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_by_subgraph" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_by_subgraph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_by_subgraph</span></code></a>:
tells if a result is used by a subgraph</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_more_than_once" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_more_than_once"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_more_than_once</span></code></a>:
tells if a result is used more than once</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_only_by" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_only_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_only_by</span></code></a>:
tells if a result is only used by specific nodes</p></li>
</ul>
</section>
<section id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_node</span></code></a>:
creates a node without adding it to the graph</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node_check_opset" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node_check_opset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_node_check_opset</span></code></a>:
creates a node without adding it to the graph, deals with some constraints
related to opset version</p></li>
</ul>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="backends.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Dynamo Backends</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="exporter.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Custom Exporter</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Pattern Optimizer</a><ul>
<li><a class="reference internal" href="#patterns">Patterns</a><ul>
<li><a class="reference internal" href="#patternoptimization-match">PatternOptimization.match</a></li>
<li><a class="reference internal" href="#patternoptimization-apply">PatternOptimization.apply</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimization-algorithm">Optimization Algorithm</a></li>
<li><a class="reference internal" href="#adding-a-pattern">Adding a pattern</a></li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#simple-api">Simple API</a></li>
<li><a class="reference internal" href="#verbosity">Verbosity</a></li>
<li><a class="reference internal" href="#select-the-pattern-to-use">Select the pattern to use</a></li>
<li><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shape-inference">Shape inference</a></li>
<li><a class="reference internal" href="#available-patterns-and-api">Available Patterns and API</a><ul>
<li><a class="reference internal" href="#opsets">Opsets</a></li>
<li><a class="reference internal" href="#shapes-types">Shapes, Types</a></li>
<li><a class="reference internal" href="#constants">Constants</a></li>
<li><a class="reference internal" href="#graph">Graph</a></li>
<li><a class="reference internal" href="#nodes">Nodes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=a1637f0b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>