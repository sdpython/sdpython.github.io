<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Linear Regression" href="plot_torch_linreg.html" /><link rel="prev" title="To ignore" href="bug_dort.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Profile an existing model - experimental-experiment 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">experimental-experiment 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">experimental-experiment 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/gradient.html">gradient</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/graph_builder.html">graph_builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interpreter.html">interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/onnx_export.html">onnx_export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/aten_function.html">aten_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/convert.html">convert</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Example gallery</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Example gallery</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bug_dort.html">To ignore</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Profile an existing model</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_linreg.html">Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_llama_diff_export.html">Compares LLAMA exporters</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_convolutation_matmul.html">Convolution and Matrix Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_dort.html">Evaluate DORT</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_aot.html">Evaluate DORT Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_export.html">Evaluate different ways to export a torch model to ONNX</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOGS.html">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-plot-profile-existing-onnx-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="profile-an-existing-model">
<span id="sphx-glr-auto-examples-plot-profile-existing-onnx-py"></span><h1>Profile an existing model<a class="headerlink" href="#profile-an-existing-model" title="Link to this heading">#</a></h1>
<p>Profiles any onnx model on CPU.</p>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.ext_test_case</span> <span class="kn">import</span> <span class="n">get_parsed_args</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">onnx_extended.tools.js_profile</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">js_profile_to_dataframe</span><span class="p">,</span>
        <span class="n">plot_ort_profile</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">js_profile_to_dataframe</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span>
        <a href="https://docs.python.org/3/library/os.path.html#os.path.dirname" title="os.path.dirname" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span></a><span class="p">(</span><span class="vm">__file__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;example_4700-CPUep-opt.onnx&quot;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <span class="s2">&quot;example_4700-CPUep-opt.onnx&quot;</span>

<a href="https://docs.python.org/3/library/argparse.html#argparse.Namespace" title="argparse.Namespace" class="sphx-glr-backref-module-argparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span></a> <span class="o">=</span> <span class="n">get_parsed_args</span><span class="p">(</span>
    <span class="s2">&quot;plot_profile_existing_onnx&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="o">=</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="s2">&quot;input file&quot;</span><span class="p">),</span>
    <span class="n">repeat</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">expose</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">for</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">att</span></a> <span class="ow">in</span> <span class="s2">&quot;filename,repeat&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">att</span></a><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><a href="https://docs.python.org/3/library/argparse.html#argparse.Namespace" title="argparse.Namespace" class="sphx-glr-backref-module-argparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span></a><span class="p">,</span><span class="w"> </span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">att</span></a><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>filename=example_4700-CPUep-opt.onnx
repeat=10
</pre></div>
</div>
<p>Random inputs.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_random_input</span><span class="p">(</span><span class="n">sess</span><span class="p">):</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span></a> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">():</span>
        <span class="n">shape</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span><span class="o">.</span><span class="n">shape</span></a>
        <span class="n">ot</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span><span class="o">.</span><span class="n">type</span></a>
        <span class="k">if</span> <span class="n">ot</span> <span class="o">==</span> <span class="s2">&quot;tensor(float)&quot;</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="numpy.float32" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">np</span><span class="o">.</span><span class="n">float32</span></a>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupposed onnx type </span><span class="si">{</span><span class="n">ot</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.rand.html#numpy.random.rand" title="numpy.random.rand" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span></a><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span><span class="o">.</span><span class="n">name</span></a><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">return</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a>


<span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">profiling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">InferenceSession</span><span class="p">,</span> <span class="n">SessionOptions</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">profiling</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">InferenceSession</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">SessionOptions</span><span class="p">()</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">enable_profiling</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">InferenceSession</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>


<span class="n">sess</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span><span class="o">.</span><span class="n">filename</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a> <span class="o">=</span> <span class="n">create_random_input</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[2024-02-06 01:26:08,735] [INFO] [real_accelerator.py:158:get_accelerator] Setting ds_accelerator to cuda (auto detect)

[array([[0.22716433, 0.642355  , 0.08302658, ..., 0.39913985, 0.925505  ,
        0.37640023],
       [0.98648435, 0.30556285, 0.70134234, ..., 0.5551272 , 0.7741102 ,
        0.82418686],
       [0.54042584, 0.2549982 , 0.21614042, ..., 0.34107348, 0.8963622 ,
        0.85447156],
       ...,
       [0.16653132, 0.4208267 , 0.36833766, ..., 0.5799534 , 0.33223665,
        0.9883498 ],
       [0.3402977 , 0.8929004 , 0.34544024, ..., 0.85223544, 0.888768  ,
        0.5457919 ],
       [0.35579878, 0.83379334, 0.44058108, ..., 0.03338636, 0.29458284,
        0.64561576]], dtype=float32), array([[0.09106781, 0.5738359 , 0.01990874, ..., 0.6155384 , 0.36685556,
        0.9759759 ],
       [0.43439332, 0.25673133, 0.987796  , ..., 0.55825776, 0.3004231 ,
        0.37847072],
       [0.02802572, 0.1841006 , 0.40066758, ..., 0.65733844, 0.14516748,
        0.47570494],
       ...,
       [0.10898405, 0.99316627, 0.4932495 , ..., 0.58059764, 0.73531157,
        0.30616608],
       [0.01364807, 0.36755332, 0.24891606, ..., 0.37868112, 0.35123128,
        0.14378183],
       [0.9581462 , 0.33972782, 0.7094195 , ..., 0.06950174, 0.6516847 ,
        0.0626073 ]], dtype=float32), array([[0.92268085, 0.40554526, 0.01055187, ..., 0.80893236, 0.23773211,
        0.4128545 ],
       [0.43957782, 0.4506987 , 0.18714654, ..., 0.36704278, 0.57260996,
        0.23477083],
       [0.41005483, 0.10182983, 0.13185838, ..., 0.08146195, 0.84076273,
        0.49762738],
       ...,
       [0.5869092 , 0.09400484, 0.21671255, ..., 0.47720975, 0.78601557,
        0.932834  ],
       [0.6833752 , 0.91461116, 0.41884148, ..., 0.6385049 , 0.92720515,
        0.0303773 ],
       [0.54649824, 0.00458358, 0.06905705, ..., 0.9754046 , 0.82303196,
        0.0397622 ]], dtype=float32), array([[[[6.8780403, 6.922937 , 7.748275 , ..., 6.710476 , 6.7517147,
          7.872851 ],
         [5.7637534, 7.5714693, 7.324022 , ..., 7.072465 , 6.8969245,
          8.010185 ],
         [5.337053 , 6.039088 , 6.4656215, ..., 7.8429794, 7.082104 ,
          6.200628 ],
         ...,
         [5.8470325, 6.1076107, 6.0052204, ..., 5.4582853, 6.699426 ,
          6.0897584],
         [5.0187297, 6.0542912, 5.002329 , ..., 7.0357985, 6.549265 ,
          6.310928 ],
         [6.4206095, 5.526001 , 6.040769 , ..., 6.6257615, 7.194505 ,
          7.6466403]],

        [[6.231985 , 7.450508 , 8.216831 , ..., 6.643682 , 7.3244076,
          8.491497 ],
         [7.0527964, 7.442278 , 7.64947  , ..., 7.284844 , 7.5847063,
          7.731652 ],
         [6.252473 , 6.2814717, 6.5782247, ..., 7.2594323, 7.4862375,
          7.6282215],
         ...,
         [6.7830114, 6.3609276, 4.8467107, ..., 6.9470267, 5.9190516,
          5.311853 ],
         [6.2354236, 6.0229917, 5.059861 , ..., 7.6256175, 7.0199776,
          6.2080045],
         [5.717794 , 6.2387934, 6.4225817, ..., 7.0477624, 8.032475 ,
          6.6974397]],

        [[4.103054 , 5.1147637, 4.99063  , ..., 4.630738 , 4.593536 ,
          5.863354 ],
         [5.22707  , 4.508402 , 5.7145743, ..., 4.5707235, 5.663673 ,
          4.9612966],
         [3.912483 , 4.3669643, 4.3416023, ..., 5.0296316, 5.398714 ,
          4.49631  ],
         ...,
         [4.0542717, 3.949836 , 4.0732965, ..., 4.679947 , 3.8705037,
          4.070305 ],
         [4.4870095, 3.2206733, 4.045558 , ..., 4.441333 , 4.003667 ,
          4.6800528],
         [3.654995 , 4.2490377, 4.2205462, ..., 4.896993 , 5.087123 ,
          5.021636 ]],

        ...,

        [[5.6349735, 6.2968016, 6.740759 , ..., 5.622659 , 6.4690475,
          7.077789 ],
         [5.826725 , 7.2487874, 6.915916 , ..., 6.1781063, 5.7085676,
          6.0724316],
         [4.679414 , 5.320134 , 5.3783517, ..., 6.0525894, 5.74466  ,
          6.169994 ],
         ...,
         [4.6904416, 4.9037924, 4.824571 , ..., 5.122126 , 5.0232625,
          4.4206424],
         [5.483167 , 5.383672 , 4.4564004, ..., 6.0094495, 5.7195907,
          5.5536394],
         [6.393601 , 5.129305 , 5.3777404, ..., 7.2529216, 5.96471  ,
          6.1345067]],

        [[6.031075 , 5.7553926, 7.0703893, ..., 5.757337 , 6.848085 ,
          7.6742845],
         [6.390192 , 6.7332697, 7.17021  , ..., 6.2188416, 6.520779 ,
          6.4045324],
         [5.555749 , 5.8363366, 6.270012 , ..., 6.987903 , 7.5714793,
          6.333626 ],
         ...,
         [5.1482944, 4.679238 , 5.4918456, ..., 5.338304 , 5.0398684,
          5.9022617],
         [5.5966754, 5.1993675, 4.7779675, ..., 6.5200872, 5.0649242,
          5.722456 ],
         [5.347056 , 4.8695793, 5.832191 , ..., 6.23902  , 6.274536 ,
          7.011941 ]],

        [[6.781167 , 7.8541136, 7.8276687, ..., 6.5935783, 7.867651 ,
          8.799418 ],
         [6.971402 , 8.251391 , 7.979444 , ..., 7.6337605, 7.381488 ,
          6.9452147],
         [6.001371 , 7.0008926, 7.084465 , ..., 7.379814 , 7.120801 ,
          7.1995964],
         ...,
         [5.4307947, 5.7537346, 5.73609  , ..., 6.189144 , 5.86736  ,
          6.3033104],
         [6.1996675, 5.4867315, 5.43501  , ..., 6.4758677, 6.8239803,
          6.429833 ],
         [6.9226165, 6.5803227, 6.553292 , ..., 8.628633 , 7.0443993,
          6.975088 ]]]], dtype=float32), array([[[[    3,   254,   259, ...,   238,   366,   247],
         [  871,   627,   629, ...,   611,   614,   989],
         [  993,  1121,  1000, ...,  1476,  1482,  1238],
         ...,
         [14261, 14018, 14023, ..., 14248, 14377, 14256],
         [14633, 14762, 14395, ..., 14499, 14500, 14507],
         [15252, 14885, 15012, ..., 15367, 15369, 15375]],

        [[    2,   128,    11, ...,   487,   240,   123],
         [  870,   751,   629, ...,   611,   614,   989],
         [ 1119,   998,  1001, ...,  1476,  1110,  1362],
         ...,
         [13891, 14141, 13899, ..., 14249, 14379, 14256],
         [14634, 14391, 14395, ..., 14499, 14624, 14631],
         [15004, 14886, 15136, ..., 14992, 15369, 15374]],

        [[  126,     4,   383, ...,   363,   365,   123],
         [  869,   751,   630, ...,   611,   986,   617],
         [  995,  1121,  1001, ...,  1228,  1110,  1362],
         ...,
         [13891, 14019, 14270, ..., 14000, 14378, 14256],
         [14757, 14390, 14395, ..., 14499, 14872, 14505],
         [14880, 14886, 15136, ..., 15366, 15369, 15248]],

        ...,

        [[  125,   379,   258, ...,   114,   243,   123],
         [  870,   751,   629, ...,   611,   738,   991],
         [  993,  1121,  1375, ...,  1476,  1482,  1486],
         ...,
         [13889, 13893, 14147, ..., 14000, 14377, 14380],
         [14385, 14760, 14392, ..., 14623, 14874, 14631],
         [15252, 14884, 15260, ..., 15367, 14997, 15372]],

        [[  126,     4,    11, ...,   239,   366,   123],
         [  871,   751,   629, ...,   611,   614,   617],
         [  993,  1122,  1001, ...,  1230,  1111,  1362],
         ...,
         [13891, 13893, 14020, ..., 14248, 14379, 14256],
         [14757, 14639, 14395, ..., 14871, 14872, 14630],
         [15254, 15008, 15012, ..., 14992, 15369, 15375]],

        [[  125,   378,   381, ...,   362,   366,   123],
         [  871,   750,   629, ...,   735,   738,   991],
         [  993,  1121,  1001, ...,  1476,  1483,  1486],
         ...,
         [13891, 13893, 14145, ..., 14248, 14377, 14132],
         [14385, 14391, 14392, ..., 14499, 14624, 14631],
         [15252, 14884, 15012, ..., 15364, 15368, 15373]]]], dtype=int64), array([[7.838498 , 7.39933  , 7.7474947, ..., 7.9107575, 8.485791 ,
        8.628633 ]], dtype=float32), array([[121365.61 , 120056.6  , 120989.07 , ..., 120560.18 , 121034.195,
        120783.984]], dtype=float32), array([[61305940., 63596052., 63139048., 62665136., 60499864., 61596768.,
        61334536., 60487936., 60504844., 60102636., 61622720., 62280472.,
        61784572., 63577688., 60817824., 60779592., 62232836., 61562788.,
        61272488., 62549816., 60899964., 59960540., 63336328., 61951816.,
        62460560., 61074376., 62385040., 61746444., 61746832., 62330428.,
        61988352., 62434008., 60377896., 62476076., 61614016., 61638724.,
        62359928., 62444192., 60581688., 61336784., 62479152., 61392660.,
        61569496., 62327720., 63544184., 61451504., 61955276., 60560864.,
        63404888., 59793604., 62459888., 60843664., 63592016., 61765844.,
        62220672., 62158368., 62475880., 62079372., 60825328., 62307676.,
        61572736., 62401972., 62009704., 61363984., 59238692., 61781584.,
        62204128., 62092248., 62001428., 61308112., 63799912., 64250084.,
        61407036., 62756040., 63584984., 62274372., 61160088., 63993044.,
        62177576., 62556688., 62085828., 61739652., 61424704., 62849776.,
        62201908., 63332212., 60778412., 60564044., 62404944., 62332528.,
        60168680., 61624068., 60783980., 64076328., 61149308., 63458280.,
        63019048., 60543308., 60451008., 63321128., 63573496., 60311128.,
        61289204., 62364580., 59637852., 62541732., 62482776., 62766688.,
        61787536., 62316840., 61222064., 63281576., 61415776., 62792420.,
        61798592., 63249744., 61826224., 62256340., 61402120., 61171264.,
        60957648., 64344236., 60087296., 62237408., 62238088., 62165724.,
        61705672., 63156680.]], dtype=float32), array([[4.1425592e+09, 3.8903332e+09, 3.8953073e+09, 4.1128643e+09,
        4.0044083e+09, 3.7200154e+09, 3.8498808e+09, 4.2442683e+09,
        3.9724616e+09, 3.7540160e+09]], dtype=float32)]
</pre></div>
</div>
</section>
<section id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span><span class="o">.</span><span class="n">filename</span></a><span class="p">,</span> <span class="n">profiling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span><span class="o">.</span><span class="n">repeat</span></a><span class="p">):</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a><span class="p">)</span>

<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">prof</span></a> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">end_profiling</span><span class="p">()</span>
<span class="k">if</span> <span class="n">js_profile_to_dataframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.core.frame.DataFrame" class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a> <span class="o">=</span> <span class="n">js_profile_to_dataframe</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">prof</span></a><span class="p">,</span> <span class="n">first_it_out</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html#pandas.DataFrame.to_csv" title="pandas.DataFrame.to_csv" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span></a><span class="p">(</span><span class="s2">&quot;plot_profile_existing_onnx.csv&quot;</span><span class="p">)</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_excel.html#pandas.DataFrame.to_excel" title="pandas.DataFrame.to_excel" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span></a><span class="p">(</span><span class="s2">&quot;plot_profile_existing_onnx.xlsx&quot;</span><span class="p">)</span>
    <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">plot_ort_profile</span><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.core.frame.DataFrame" class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;dort&quot;</span><span class="p">)</span>
    <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.savefig" title="matplotlib.figure.Figure.savefig" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span></a><span class="p">(</span><span class="s2">&quot;plot_profile_existing_onnx.png&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Install onnx-extended first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_profile_existing_onnx_001.png" srcset="../_images/sphx_glr_plot_profile_existing_onnx_001.png" alt="dort, n occurences" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 9.157 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-profile-existing-onnx-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/4fec96388348572170cab364cc442b36/plot_profile_existing_onnx.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_profile_existing_onnx.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/eb59dedf5d41bf260f513c7fb2201abb/plot_profile_existing_onnx.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_profile_existing_onnx.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="plot_torch_linreg.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Linear Regression</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="bug_dort.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">To ignore</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Profile an existing model</a><ul>
<li><a class="reference internal" href="#preparation">Preparation</a></li>
<li><a class="reference internal" href="#profiling">Profiling</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=a1637f0b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>