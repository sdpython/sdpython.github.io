<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Design" href="../design/index.html" /><link rel="prev" title="onnx" href="../tutorial/onnx.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>101: Profile an existing model with onnxruntime - experimental-experiment 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">experimental-experiment 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">experimental-experiment 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/pytorch.html">pytorch and onnx</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of pytorch and onnx</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_torch_linreg_101.html">101: Linear Regression and export to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_torch_custom_backend_101.html">101: A custom backend for torch</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_optimize_101.html">101: Graph Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_convolutation_matmul_102.html">102: Convolution and Matrix Multiplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_llama_bench_102.html">102: Measure LLAMA speed</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_torch_export_201.html">201: Evaluate different ways to export a torch model to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_torch_dort_201.html">201: Evaluate DORT</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_torch_aot_201.html">201: Evaluate DORT Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_llama_diff_export_301.html">301: Compares LLAMA exporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_llama_diff_dort_301.html">301: Compares LLAMA exporters for onnxrt backend</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../tutorial/onnx.html">onnx</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of onnx</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">101: Profile an existing model with onnxruntime</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../design/index.html">Design</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Design</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/optimizer.html">Pattern Optimizer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/gradient.html">gradient</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/reference.html">reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/graph_builder.html">graph_builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/graph_builder_pattern.html">graph_builder_optim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interpreter.html">interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/onnx_export.html">onnx_export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/aten_function.html">aten_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/aten_method.html">aten_methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/convert.html">convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/torch_helper.html">torch_helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/torch_dynamo.html">torch_dynamo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/misc.html">Othersâ€¦</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Example gallery</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Example gallery</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_optimize_101.html">101: Graph Optimization</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">101: Profile an existing model with onnxruntime</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_linreg_101.html">101: Linear Regression and export to ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_custom_backend_101.html">101: A custom backend for torch</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_convolutation_matmul_102.html">102: Convolution and Matrix Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_llama_diff_export_301.html">301: Compares LLAMA exporters</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_llama_bench_102.html">102: Measure LLAMA speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_llama_diff_dort_301.html">301: Compares LLAMA exporters for onnxrt backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_aot_201.html">201: Evaluate DORT Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_dort_201.html">201: Evaluate DORT</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_torch_export_201.html">201: Evaluate different ways to export a torch model to ONNX</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOGS.html">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../long_outputs.html">Long Outputs uneasy to read</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-plot-profile-existing-onnx-101-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="profile-an-existing-model-with-onnxruntime">
<span id="sphx-glr-auto-examples-plot-profile-existing-onnx-101-py"></span><h1>101: Profile an existing model with onnxruntime<a class="headerlink" href="#profile-an-existing-model-with-onnxruntime" title="Link to this heading">#</a></h1>
<p>Profiles any onnx model on CPU.</p>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.args</span> <span class="kn">import</span> <span class="n">get_parsed_args</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">onnx_extended.tools.js_profile</span> <span class="kn">import</span> <span class="p">(</span>
        <a href="https://sdpython.github.io/doc/onnx-extended/dev/api/tools_other.html#onnx_extended.tools.js_profile.js_profile_to_dataframe" title="onnx_extended.tools.js_profile.js_profile_to_dataframe" class="sphx-glr-backref-module-onnx_extended-tools-js_profile sphx-glr-backref-type-py-function"><span class="n">js_profile_to_dataframe</span></a><span class="p">,</span>
        <a href="https://sdpython.github.io/doc/onnx-extended/dev/api/tools_other.html#onnx_extended.tools.js_profile.plot_ort_profile" title="onnx_extended.tools.js_profile.plot_ort_profile" class="sphx-glr-backref-module-onnx_extended-tools-js_profile sphx-glr-backref-type-py-function"><span class="n">plot_ort_profile</span></a><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <a href="https://sdpython.github.io/doc/onnx-extended/dev/api/tools_other.html#onnx_extended.tools.js_profile.js_profile_to_dataframe" title="onnx_extended.tools.js_profile.js_profile_to_dataframe" class="sphx-glr-backref-module-onnx_extended-tools-js_profile sphx-glr-backref-type-py-function"><span class="n">js_profile_to_dataframe</span></a> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span>
        <a href="https://docs.python.org/3/library/os.path.html#os.path.dirname" title="os.path.dirname" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span></a><span class="p">(</span><span class="vm">__file__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;example_4700-CPUep-opt.onnx&quot;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <span class="s2">&quot;data/example_4700-CPUep-opt.onnx&quot;</span>

<a href="https://docs.python.org/3/library/argparse.html#argparse.Namespace" title="argparse.Namespace" class="sphx-glr-backref-module-argparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span></a> <span class="o">=</span> <span class="n">get_parsed_args</span><span class="p">(</span>
    <span class="s2">&quot;plot_profile_existing_onnx&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="o">=</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="s2">&quot;input file&quot;</span><span class="p">),</span>
    <span class="n">repeat</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">expose</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">for</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">att</span></a> <span class="ow">in</span> <span class="s2">&quot;filename,repeat&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">att</span></a><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><a href="https://docs.python.org/3/library/argparse.html#argparse.Namespace" title="argparse.Namespace" class="sphx-glr-backref-module-argparse sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span></a><span class="p">,</span><span class="w"> </span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">att</span></a><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>filename=data/example_4700-CPUep-opt.onnx
repeat=10
</pre></div>
</div>
<p>Random inputs.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_random_input</span><span class="p">(</span><span class="n">sess</span><span class="p">):</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span></a> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">():</span>
        <span class="n">shape</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span><span class="o">.</span><span class="n">shape</span></a>
        <span class="n">ot</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span><span class="o">.</span><span class="n">type</span></a>
        <span class="k">if</span> <span class="n">ot</span> <span class="o">==</span> <span class="s2">&quot;tensor(float)&quot;</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="numpy.float32" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">np</span><span class="o">.</span><span class="n">float32</span></a>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupposed onnx type </span><span class="si">{</span><span class="n">ot</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.rand.html#numpy.random.rand" title="numpy.random.rand" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span></a><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span><span class="o">.</span><span class="n">name</span></a><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">return</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a>


<span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">profiling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">InferenceSession</span><span class="p">,</span> <span class="n">SessionOptions</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">profiling</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">InferenceSession</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">SessionOptions</span><span class="p">()</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">enable_profiling</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">InferenceSession</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">])</span>


<span class="n">sess</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span><span class="o">.</span><span class="n">filename</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a> <span class="o">=</span> <span class="n">create_random_input</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[array([[0.17941934, 0.58423746, 0.9684669 , ..., 0.26645088, 0.3594053 ,
        0.06060913],
       [0.02414158, 0.7199389 , 0.7637111 , ..., 0.807055  , 0.08170549,
        0.70959574],
       [0.70735466, 0.22848178, 0.06038982, ..., 0.00927741, 0.64439297,
        0.56834084],
       ...,
       [0.13349287, 0.00605646, 0.74318933, ..., 0.7913498 , 0.03297814,
        0.3570097 ],
       [0.63795596, 0.7086203 , 0.00574563, ..., 0.18575275, 0.5732937 ,
        0.02239586],
       [0.5118097 , 0.91168505, 0.21044217, ..., 0.15010859, 0.1982363 ,
        0.41354376]], dtype=float32), array([[0.39096105, 0.15058059, 0.9336235 , ..., 0.71558475, 0.09193175,
        0.47122976],
       [0.81525415, 0.20814438, 0.45353088, ..., 0.39550757, 0.10144959,
        0.5926132 ],
       [0.16991182, 0.23635596, 0.84896433, ..., 0.4915527 , 0.20256186,
        0.65354574],
       ...,
       [0.745976  , 0.15624249, 0.20387043, ..., 0.1676855 , 0.5493695 ,
        0.66530496],
       [0.37092015, 0.71862054, 0.85757864, ..., 0.27967474, 0.29991752,
        0.10933784],
       [0.15677722, 0.63569707, 0.63368744, ..., 0.22413671, 0.65825903,
        0.78271025]], dtype=float32), array([[0.06943461, 0.23722823, 0.01658306, ..., 0.29018664, 0.04859344,
        0.4506191 ],
       [0.15482917, 0.35008428, 0.18315595, ..., 0.805919  , 0.75286835,
        0.2434745 ],
       [0.7074043 , 0.8392447 , 0.3395206 , ..., 0.122213  , 0.15224458,
        0.34642106],
       ...,
       [0.58297825, 0.03204551, 0.54677355, ..., 0.2712899 , 0.11607264,
        0.02731874],
       [0.39250907, 0.26260677, 0.63150716, ..., 0.49784127, 0.18708824,
        0.94954294],
       [0.43426603, 0.19433138, 0.36597046, ..., 0.5881714 , 0.7123913 ,
        0.88135105]], dtype=float32), array([[[[6.913034 , 7.627439 , 7.1577673, ..., 6.448167 , 6.32725  ,
          6.947029 ],
         [6.8126097, 6.465428 , 6.607421 , ..., 7.316976 , 6.9604545,
          7.2446632],
         [7.4379153, 7.840347 , 7.6108475, ..., 6.651315 , 6.345866 ,
          5.9103594],
         ...,
         [5.2517757, 6.1189547, 5.8020897, ..., 6.640719 , 7.664767 ,
          6.1874304],
         [6.1968455, 5.1932163, 6.1423326, ..., 7.2839084, 7.1575212,
          7.3212295],
         [6.293101 , 5.949526 , 6.930832 , ..., 7.503963 , 6.626497 ,
          6.868553 ]],

        [[8.018354 , 6.977619 , 6.737436 , ..., 6.937288 , 6.695413 ,
          6.9194355],
         [7.0245013, 6.805128 , 6.635628 , ..., 7.2728076, 6.5203657,
          7.1132393],
         [6.869961 , 6.57384  , 6.681792 , ..., 7.2817297, 6.1086235,
          6.8421216],
         ...,
         [5.8282366, 4.950675 , 6.3092546, ..., 6.659675 , 6.242525 ,
          6.4811463],
         [6.2574105, 5.8598213, 6.100187 , ..., 7.2911615, 7.4072204,
          7.036535 ],
         [5.8667884, 6.3999853, 6.1582084, ..., 6.707766 , 7.875745 ,
          8.0378065]],

        [[7.4850016, 7.443721 , 7.392293 , ..., 7.515023 , 6.1629667,
          6.7826076],
         [5.5322056, 7.5272317, 6.4480276, ..., 6.9267964, 7.454609 ,
          5.845664 ],
         [7.3864756, 6.8953786, 7.1873827, ..., 7.278972 , 6.8842034,
          6.3269944],
         ...,
         [6.572537 , 5.062208 , 5.0629745, ..., 7.0827446, 6.294973 ,
          6.5169835],
         [6.12274  , 5.324853 , 6.3002167, ..., 7.2280006, 7.851905 ,
          6.4545236],
         [6.327434 , 6.4180355, 6.5080814, ..., 6.4318237, 7.2734237,
          7.031698 ]],

        ...,

        [[8.170887 , 7.8867726, 7.1503277, ..., 6.6231337, 7.0438123,
          6.858321 ],
         [7.310727 , 6.957301 , 6.9041696, ..., 7.745513 , 6.9908557,
          6.543031 ],
         [7.501943 , 7.5816994, 7.8745675, ..., 7.525765 , 7.002867 ,
          6.0303245],
         ...,
         [5.224099 , 6.170009 , 6.646031 , ..., 6.3070364, 7.637196 ,
          6.9826   ],
         [6.200954 , 5.697075 , 6.7760735, ..., 6.8991323, 7.756779 ,
          7.053116 ],
         [7.3011665, 5.7205167, 6.810979 , ..., 7.281095 , 7.5518007,
          6.729165 ]],

        [[6.3375525, 5.832569 , 5.7236195, ..., 5.8541636, 4.4841805,
          5.5088716],
         [5.2807713, 5.328113 , 4.7039847, ..., 5.806849 , 5.891303 ,
          5.1546874],
         [6.3585935, 6.263441 , 5.5422797, ..., 5.37864  , 5.234054 ,
          4.676743 ],
         ...,
         [4.854669 , 4.4390893, 4.3426547, ..., 6.14759  , 4.778657 ,
          5.8509426],
         [4.1214056, 4.9278765, 5.192247 , ..., 5.429103 , 6.089204 ,
          6.516312 ],
         [4.887899 , 4.83667  , 5.2757173, ..., 4.7873516, 5.6609063,
          5.7959595]],

        [[7.0627193, 6.6299634, 6.56494  , ..., 6.4657707, 5.8695173,
          5.9044504],
         [6.4571857, 5.6474414, 5.55863  , ..., 6.5343356, 6.326534 ,
          6.4981728],
         [6.1754313, 6.095109 , 6.644445 , ..., 6.6706266, 5.937945 ,
          5.993662 ],
         ...,
         [5.093571 , 5.1381087, 5.279818 , ..., 5.439849 , 5.8122478,
          6.4429836],
         [5.0801764, 5.3014555, 5.1973996, ..., 5.9131494, 6.6934705,
          6.4826784],
         [5.492219 , 5.2740307, 6.2762012, ..., 5.774991 , 6.703846 ,
          6.646743 ]]]], dtype=float32), array([[[[  249,   254,   134, ...,   362,   242,   368],
         [  623,   624,   878, ...,   610,   612,   619],
         [ 1118,  1371,  1372, ...,  1104,  1483,  1239],
         ...,
         [14261, 14267, 13898, ..., 14248, 14379, 14257],
         [14758, 14390, 14765, ..., 14747, 14873, 14504],
         [15131, 15134, 14889, ..., 15119, 15120, 15126]],

        [[    0,   253,     9, ...,   237,   365,   244],
         [  747,   748,   630, ...,   980,   987,   619],
         [ 1365,  1370,  1373, ...,  1228,  1481,  1487],
         ...,
         [14260, 14266, 13898, ..., 14000, 14379, 14380],
         [14384, 14637, 14764, ..., 14623, 14624, 14504],
         [15255, 15135, 14888, ..., 15119, 15120, 15375]],

        [[  125,   378,    10, ...,   362,   119,   244],
         [  623,   748,   504, ...,   611,   984,   619],
         [ 1365,  1370,  1127, ...,  1353,  1481,  1363],
         ...,
         [14261, 14266, 14270, ..., 14248, 14379, 14382],
         [14758, 14763, 14765, ..., 14623, 14624, 14504],
         [15007, 15134, 14889, ..., 15119, 15121, 15250]],

        ...,

        [[    0,   254,     8, ...,   239,   489,   368],
         [  744,   624,   755, ...,   609,   613,   619],
         [ 1366,   996,  1372, ...,  1229,  1483,  1239],
         ...,
         [14260, 14264, 13899, ..., 14000, 14378, 14381],
         [14384, 14639, 14764, ..., 14623, 14624, 14504],
         [15131, 15134, 15013, ..., 15117, 15121, 15250]],

        [[  248,   253,   257, ...,   237,   119,   368],
         [  744,   748,   507, ...,   980,   737,   619],
         [ 1366,  1370,  1373, ...,  1228,  1483,  1363],
         ...,
         [14263, 13894, 13899, ..., 14249, 14379, 14257],
         [14758, 14638, 14392, ..., 14747, 14503, 14878],
         [15255, 15133, 14888, ..., 15118, 15120, 15251]],

        [[    0,   377,     9, ...,   237,   240,   244],
         [  869,   503,   507, ...,   732,   987,   743],
         [ 1366,  1369,  1373, ...,  1104,  1483,  1484],
         ...,
         [14261, 13892, 13899, ..., 14125, 14255, 14258],
         [14384, 14761, 14764, ..., 14871, 14503, 14504],
         [15254, 15135, 15014, ..., 15118, 15120, 15374]]]], dtype=int64), array([[7.840347 , 8.202351 , 8.016446 , ..., 7.5161533, 7.4379396,
        6.703846 ]], dtype=float32), array([[119276.74, 118883.24, 118666.18, ..., 118926.13, 119107.63,
        120173.89]], dtype=float32), array([[61880328., 59686904., 59332812., 60929256., 61651744., 62588944.,
        62143288., 62456296., 61420348., 63593560., 60992408., 61934828.,
        61360032., 61239292., 61835488., 60903136., 62037204., 59301080.,
        62347256., 63083584., 60854828., 61898848., 61592616., 62565512.,
        61418548., 61740224., 61152720., 60583960., 60500672., 60946944.,
        59636248., 62394100., 60698824., 59720696., 60266600., 61619448.,
        60671960., 60128560., 59888256., 60904312., 60326688., 61901688.,
        62965560., 62009216., 60979208., 61594304., 59152384., 62910332.,
        59301864., 61490192., 61184728., 62397064., 58185164., 61140112.,
        61048000., 61401844., 61324640., 61319960., 60785816., 60849252.,
        60169760., 58993836., 59024400., 60359192., 61506692., 61082516.,
        60804224., 61407408., 60243320., 60339776., 61554172., 60376040.,
        61567960., 61313232., 60147624., 60341508., 59490968., 61162156.,
        60609792., 60975824., 59596208., 58843848., 63388664., 64010056.,
        60129744., 60413040., 62380952., 60298528., 59371552., 60453296.,
        62025580., 58589704., 61064312., 60811376., 60464008., 62746604.,
        61610408., 59902332., 62302332., 60974184., 62731160., 59725984.,
        60077368., 61348064., 62315028., 61652660., 62052668., 61159976.,
        61820052., 62393176., 60257328., 60374008., 60390656., 60830540.,
        61924860., 61745416., 59598568., 61450376., 61799448., 62112360.,
        61037616., 61921152., 62586456., 62533788., 63333604., 61615680.,
        60751848., 59977952.]], dtype=float32), array([[3.8297016e+09, 4.2909855e+09, 3.5820959e+09, 3.7485007e+09,
        3.1843794e+09, 4.0040924e+09, 4.4376909e+09, 3.7276616e+09,
        4.0180736e+09, 3.9357304e+09]], dtype=float32)]
</pre></div>
</div>
</section>
<section id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span><span class="o">.</span><span class="n">filename</span></a><span class="p">,</span> <span class="n">profiling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">script_args</span><span class="o">.</span><span class="n">repeat</span></a><span class="p">):</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feeds</span></a><span class="p">)</span>

<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">prof</span></a> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">end_profiling</span><span class="p">()</span>
<span class="k">if</span> <a href="https://sdpython.github.io/doc/onnx-extended/dev/api/tools_other.html#onnx_extended.tools.js_profile.js_profile_to_dataframe" title="onnx_extended.tools.js_profile.js_profile_to_dataframe" class="sphx-glr-backref-module-onnx_extended-tools-js_profile sphx-glr-backref-type-py-function"><span class="n">js_profile_to_dataframe</span></a> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.core.frame.DataFrame" class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-extended/dev/api/tools_other.html#onnx_extended.tools.js_profile.js_profile_to_dataframe" title="onnx_extended.tools.js_profile.js_profile_to_dataframe" class="sphx-glr-backref-module-onnx_extended-tools-js_profile sphx-glr-backref-type-py-function"><span class="n">js_profile_to_dataframe</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">prof</span></a><span class="p">,</span> <span class="n">first_it_out</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html#pandas.Index" title="pandas.core.indexes.base.Index" class="sphx-glr-backref-module-pandas-core-indexes-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span><span class="o">.</span><span class="n">columns</span></a><span class="p">)</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html#pandas.DataFrame.to_csv" title="pandas.DataFrame.to_csv" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span></a><span class="p">(</span><span class="s2">&quot;plot_profile_existing_onnx.csv&quot;</span><span class="p">)</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_excel.html#pandas.DataFrame.to_excel" title="pandas.DataFrame.to_excel" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span></a><span class="p">(</span><span class="s2">&quot;plot_profile_existing_onnx.xlsx&quot;</span><span class="p">)</span>
    <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <a href="https://sdpython.github.io/doc/onnx-extended/dev/api/tools_other.html#onnx_extended.tools.js_profile.plot_ort_profile" title="onnx_extended.tools.js_profile.plot_ort_profile" class="sphx-glr-backref-module-onnx_extended-tools-js_profile sphx-glr-backref-type-py-function"><span class="n">plot_ort_profile</span></a><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.core.frame.DataFrame" class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;dort&quot;</span><span class="p">)</span>
    <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.tight_layout" title="matplotlib.figure.Figure.tight_layout" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>
    <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.savefig" title="matplotlib.figure.Figure.savefig" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span></a><span class="p">(</span><span class="s2">&quot;plot_profile_existing_onnx.png&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Install onnx-extended first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_profile_existing_onnx_101_001.png" srcset="../_images/sphx_glr_plot_profile_existing_onnx_101_001.png" alt="dort, n occurences" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;cat&#39;, &#39;pid&#39;, &#39;tid&#39;, &#39;dur&#39;, &#39;ts&#39;, &#39;ph&#39;, &#39;name&#39;, &#39;args_op_name&#39;,
       &#39;op_name&#39;, &#39;args_thread_scheduling_stats&#39;, &#39;args_output_size&#39;,
       &#39;args_parameter_size&#39;, &#39;args_activation_size&#39;, &#39;args_node_index&#39;,
       &#39;args_provider&#39;, &#39;event_name&#39;, &#39;iteration&#39;, &#39;it==0&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 6.167 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-profile-existing-onnx-101-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ffdfee2fba3d908f2e65593209074196/plot_profile_existing_onnx_101.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_profile_existing_onnx_101.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/0b111c2248459915b586b8ee6c0b0424/plot_profile_existing_onnx_101.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_profile_existing_onnx_101.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../design/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Design</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../tutorial/onnx.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">onnx</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">101: Profile an existing model with onnxruntime</a><ul>
<li><a class="reference internal" href="#preparation">Preparation</a></li>
<li><a class="reference internal" href="#profiling">Profiling</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=a1637f0b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>