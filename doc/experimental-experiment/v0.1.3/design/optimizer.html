<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Dynamo Backends" href="backends.html"><link rel="prev" title="Custom Exporter" href="exporter.html">
        <link rel="prefetch" href="../_static/logo.png" as="image">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>Pattern Optimizer - experimental-experiment 0.1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">experimental-experiment 0.1.3 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">experimental-experiment 0.1.3 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design</a><input aria-label="Toggle navigation of Design" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="exporter.html">Custom Exporter</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Pattern Optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="backends.html">Dynamo Backends</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><input aria-label="Toggle navigation of Tutorial" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/shape.html">ShapeBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/to_onnx.html">to_onnx: another export to investigate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/errors.html">Unexpected Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/docker.html">Start from a docker</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API</a><input aria-label="Toggle navigation of API" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/gradient/index.html">.gradient</a><input aria-label="Toggle navigation of .gradient" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/gradient/ops/index.html">.gradient.ops</a><input aria-label="Toggle navigation of .gradient.ops" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/gradient/ops/op_broadcast_gradient_args.html">.gradient.ops.op_broadcast_gradient_args</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/gradient/grad_helper.html">.gradient.grad_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/gradient/loss_helper.html">.gradient.loss_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/reference/index.html">.reference</a><input aria-label="Toggle navigation of .reference" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/reference/ops/index.html">.reference.ops</a><input aria-label="Toggle navigation of .reference.ops" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_add_add_mul_mul.html">.reference.ops.op_add_add_mul_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_average_pool_grad.html">.reference.ops.op_average_pool_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_cast_like.html">.reference.ops.op_cast_like</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_complex.html">.reference.ops.op_complex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_concat.html">.reference.ops.op_concat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_constant_of_shape.html">.reference.ops.op_constant_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_fused_matmul.html">.reference.ops.op_fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_gather_grad.html">.reference.ops.op_gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_memcpy_host.html">.reference.ops.op_memcpy_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_mul_sigmoid.html">.reference.ops.op_mul_sigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_negxplus1.html">.reference.ops.op_negxplus1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_quick_gelu.html">.reference.ops.op_quick_gelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_replace_zero.html">.reference.ops.op_replace_zero</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_rotary.html">.reference.ops.op_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_qlinear_average_pool.html">.reference.ops.op_qlinear_average_pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_qlinear_conv.html">.reference.ops.op_qlinear_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatter_elements.html">.reference.ops.op_scatter_elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatternd_of_shape.html">.reference.ops.op_scatternd_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_simplified_layer_normalization.html">.reference.ops.op_simplified_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_skip_layer_normalization.html">.reference.ops.op_skip_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_slice.html">.reference.ops.op_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_transpose_cast.html">.reference.ops.op_transpose_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_tri_matrix.html">.reference.ops.op_tri_matrix</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/evaluator.html">.reference.evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/ort_evaluator.html">.reference.ort_evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/quantized_tensor.html">.reference.quantized_tensor</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/convert/index.html">.convert</a><input aria-label="Toggle navigation of .convert" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/convert/convert_helper.html">.convert.convert_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/convert/ort_helper.html">.convert.ort_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/plotting/index.html">.plotting</a><input aria-label="Toggle navigation of .plotting" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/plotting/data.html">.plotting.data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/plotting/memory.html">.plotting.memory</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/skl/index.html">.skl</a><input aria-label="Toggle navigation of .skl" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/skl/convert.html">.skl.convert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/skl/helpers.html">.skl.helpers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_interpreter/index.html">.torch_interpreter</a><input aria-label="Toggle navigation of .torch_interpreter" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_functions.html">.torch_interpreter._aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_functions_attention.html">.torch_interpreter._aten_functions_attention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_non_aten_functions.html">.torch_interpreter._non_aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_methods.html">.torch_interpreter._aten_methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_doc_.html">.torch_interpreter._doc_</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_exceptions.html">.torch_interpreter._exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_prims_functions.html">.torch_interpreter._prims_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_torch_helper.html">.torch_interpreter._torch_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/aten_functions.html">.torch_interpreter.aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/aten_methods.html">.torch_interpreter.aten_methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/dispatcher.html">.torch_interpreter.dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/export_options.html">.torch_interpreter.export_options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/interpreter.html">.torch_interpreter.interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/investigate_helper.html">.torch_interpreter.investigate_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/onnx_export.html">.torch_interpreter.onnx_export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/oxs_dispatcher.html">.torch_interpreter.oxs_dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/oxs_opset.html">.torch_interpreter.oxs_opset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/piece_by_piece.html">.torch_interpreter.piece_by_piece</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/piece_by_piece_serialize.html">.torch_interpreter.piece_by_piece_serialize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/tracing.html">.torch_interpreter.tracing</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_models/index.html">.torch_models</a><input aria-label="Toggle navigation of .torch_models" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/dump_helper.html">.torch_models.dump_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/training_helper.html">.torch_models.training_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xbuilder/index.html">.xbuilder</a><input aria-label="Toggle navigation of .xbuilder" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/_onnx_helper.html">.xbuilder._onnx_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/graph_builder.html">.xbuilder.graph_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/graph_builder_opset.html">.xbuilder.graph_builder_opset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/model_container.html">.xbuilder.model_container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/optimization_options.html">.xbuilder.optimization_options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/reverse_graph_builder.html">.xbuilder.reverse_graph_builder</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xoptim/index.html">.xoptim</a><input aria-label="Toggle navigation of .xoptim" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_investigation/index.html">.xoptim.patterns_investigation</a><input aria-label="Toggle navigation of .xoptim.patterns_investigation" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_investigation/element_wise.html">.xoptim.patterns_investigation.element_wise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_investigation/llm_patterns.html">.xoptim.patterns_investigation.llm_patterns</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_ml/index.html">.xoptim.patterns_ml</a><input aria-label="Toggle navigation of .xoptim.patterns_ml" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ml/tree_ensemble.html">.xoptim.patterns_ml.tree_ensemble</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_exp/index.html">.xoptim.patterns_exp</a><input aria-label="Toggle navigation of .xoptim.patterns_exp" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/binary_operators.html">.xoptim.patterns_exp.binary_operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/constant_of_shape_scatter_nd.html">.xoptim.patterns_exp.constant_of_shape_scatter_nd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/constants.html">.xoptim.patterns_exp.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/simple_rotary.html">.xoptim.patterns_exp.simple_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/unary_operators.html">.xoptim.patterns_exp.unary_operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/where_replace.html">.xoptim.patterns_exp.where_replace</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns/index.html">.xoptim.patterns</a><input aria-label="Toggle navigation of .xoptim.patterns" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_any.html">.xoptim.patterns.onnx_any</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_attention.html">.xoptim.patterns.onnx_attention</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_cast.html">.xoptim.patterns.onnx_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_clip.html">.xoptim.patterns.onnx_clip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_constants.html">.xoptim.patterns.onnx_constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_conv.html">.xoptim.patterns.onnx_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_concat.html">.xoptim.patterns.onnx_concat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_dropout.html">.xoptim.patterns.onnx_dropout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_equal.html">.xoptim.patterns.onnx_equal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_expand.html">.xoptim.patterns.onnx_expand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_functions.html">.xoptim.patterns.onnx_functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_layer_normalization.html">.xoptim.patterns.onnx_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_matmul.html">.xoptim.patterns.onnx_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_mul.html">.xoptim.patterns.onnx_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_reduce.html">.xoptim.patterns.onnx_reduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_reshape.html">.xoptim.patterns.onnx_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_rotary.html">.xoptim.patterns.onnx_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_shape.html">.xoptim.patterns.onnx_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_slice.html">.xoptim.patterns.onnx_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_split.html">.xoptim.patterns.onnx_split</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_sub.html">.xoptim.patterns.onnx_sub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_sequence.html">.xoptim.patterns.onnx_sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_transpose.html">.xoptim.patterns.onnx_transpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_unsqueeze.html">.xoptim.patterns.onnx_unsqueeze</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_ort/index.html">.xoptim.patterns_ort</a><input aria-label="Toggle navigation of .xoptim.patterns_ort" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/activation.html">.xoptim.patterns_ort.activation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/activation_grad.html">.xoptim.patterns_ort.activation_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/batch_normalization.html">.xoptim.patterns_ort.batch_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/fused_conv.html">.xoptim.patterns_ort.fused_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/fused_matmul.html">.xoptim.patterns_ort.fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/gather_grad.html">.xoptim.patterns_ort.gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/llm_optim.html">.xoptim.patterns_ort.llm_optim</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/missing_kernels.html">.xoptim.patterns_ort.missing_kernels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/simplified_layer_normalization.html">.xoptim.patterns_ort.simplified_layer_normalization</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_fix/index.html">.xoptim.patterns_fix</a><input aria-label="Toggle navigation of .xoptim.patterns_fix" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_fix/add_reduction_scatter_nd.html">.xoptim.patterns_fix.add_reduction_scatter_nd</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/graph_builder_optim.html">.xoptim.graph_builder_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/order_optim.html">.xoptim.order_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/patterns_api.html">.xoptim.patterns_api</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/repeated_optim.html">.xoptim.repeated_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/unfused.html">.xoptim.unfused</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xshape/index.html">.xshape</a><input aria-label="Toggle navigation of .xshape" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/expressions_torch.html">.xshape.expressions_torch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/evaluate_expressions.html">.xshape.evaluate_expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/rename_expressions.html">.xshape.rename_expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/simplify_expressions.html">.xshape.simplify_expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_builder_runtime.html">.xshape._builder_runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_inference_runtime.html">.xshape._inference_runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_shape_runtime.html">.xshape._shape_runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_shape_helper.html">.xshape._shape_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_onnx_helper.html">.xshape._onnx_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/shape_builder.html">.xshape.shape_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/shape_builder_impl.html">.xshape.shape_builder_impl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/shape_type_compute.html">.xshape.shape_type_compute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/type_inference.html">.xshape.type_inference</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_dynamo/index.html">.torch_dynamo</a><input aria-label="Toggle navigation of .torch_dynamo" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/_dynamo_exporter.html">.torch_dynamo._dynamo_exporter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/backend_helper.html">.torch_dynamo.backend_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/compiled_model.html">.torch_dynamo.compiled_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/debug_backend.html">.torch_dynamo.debug_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/fast_backend.html">.torch_dynamo.fast_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/partition.html">experimental_experiment.torch_dynamo.partition</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_bench/index.html">.torch_bench</a><input aria-label="Toggle navigation of .torch_bench" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner_agg.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner_agg</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner_agg_helper.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner_agg_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_cmd.html">experimental_experiment.torch_bench._bash_bench_cmd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_model_runner.html">experimental_experiment.torch_bench._bash_bench_model_runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_models_helper.html">experimental_experiment.torch_bench._bash_bench_models_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_dummies.html">experimental_experiment.torch_bench._bash_bench_set_dummies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_explicit.html">experimental_experiment.torch_bench._bash_bench_set_explicit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_huggingface.html">experimental_experiment.torch_bench._bash_bench_set_huggingface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_timm.html">experimental_experiment.torch_bench._bash_bench_set_timm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_torchbench.html">experimental_experiment.torch_bench._bash_bench_set_torchbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_torchbench_ado.html">experimental_experiment.torch_bench._bash_bench_set_torchbench_ado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_untrained.html">experimental_experiment.torch_bench._bash_bench_untrained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_agg.html">.torch_bench.bash_bench_agg</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_explicit.html">.torch_bench.bash_bench_explicit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_huggingface.html">.torch_bench.bash_bench_huggingface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_timm.html">.torch_bench.bash_bench_timm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_torchbench.html">.torch_bench.bash_bench_torchbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_torchbench_ado.html">.torch_bench.bash_bench_torchbench_ado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_untrained.html">.torch_bench.bash_bench_untrained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/check_model.html">.torch_bench.check_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/export_model.html">.torch_bench.export_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/export_model_helper.html">.torch_bench.export_model_helper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/_bench_test.html">._bench_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/_command_lines_parser.html">._command_lines_parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/args.html">.args</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/bench_run.html">.bench_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/checks.html">.checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/export_helpers.html">.export_helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ext_test_case.html">.ext_test_case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/helpers.html">.helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/memory_peak.html">.memory_peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/model_run.html">.model_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/onnx_tools.html">.onnx_tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ort_session.html">.ort_session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/torch_test_helper.html">.torch_test_helper</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../galleries.html">Galleries of Examples and Recipes</a><input aria-label="Toggle navigation of Galleries of Examples and Recipes" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a><input aria-label="Toggle navigation of Examples Gallery" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_custom_backend_101.html">101: A custom backend for torch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_linreg_101.html">101: Linear Regression and export to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_optimize_101.html">101: Onnx Model Optimization based on Pattern Rewriting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_rewrite_101.html">101: Onnx Model Rewriting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_profile_existing_onnx_101.html">101: Profile an existing model with onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_101.html">101: Some dummy examples with torch.export.export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_onnxscript_102.html">102: Examples with onnxscript</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_executorch_102.html">102: First test with ExecuTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_compile_102.html">102: Tweak onnx export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_shape_inference.html">201: Better shape inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_201.html">201: Evaluate different ways to export a torch model to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_sklearn_201.html">201: Use torch to export a scikit-learn model into ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_model_to_python.html">Playground for big optimization pattern</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_recipes/index.html">Exporter Recipes Gallery</a><input aria-label="Toggle navigation of Exporter Recipes Gallery" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_untrained_tinyllm.html">Check the exporter on a dummy from HuggingFace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_phi35_piece.html">Export Phi-3.5-mini-instruct piece by piece</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_draft_mode.html">Export Phi-3.5-mini-instruct with draft_export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_reportibility.html">Export Phi-3.5-mini-instruct with report_exportability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_scan_pdist.html">Export a model with a loop (scan)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_custom_ops_inplace.html">to_onnx and a custom operator inplace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_custom_ops_fct.html">to_onnx and a custom operator registered with a function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_cond.html">to_onnx and a model with a test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_dynpad.html">to_onnx and padding one dimension to a mulitple of a constant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_modules.html">to_onnx and submodules from LLMs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../command_lines.html">Command Lines</a><input aria-label="Toggle navigation of Command Lines" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../bench/index.html">Benchmarks from the command line</a><input aria-label="Toggle navigation of Benchmarks from the command line" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../bench/dort_bench.html">experimental_experiment.torch_bench.dort_bench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/dort_profile.html">experimental_experiment.torch_bench.dort_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/scripts.html">Interesting scripts or command lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/bash_bench.html">Measuring the exporters on a short list of sets of models</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tools/index.html">Tools from the command line</a><input aria-label="Toggle navigation of Tools from the command line" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/lighten.html">python -m experimental_experiment lighten and unlighten</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/optimize.html">python -m experimental_experiment optimize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/print.html">python -m experimental_experiment print</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/run.html">python -m experimental_experiment run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a><input aria-label="Toggle navigation of Miscellaneous" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous/export_times.html">Export Times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous/long_outputs.html">Long Outputs uneasy to read</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/design/optimizer.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="pattern-optimizer">
<span id="l-design-pattern-optimizer"></span><h1>Pattern Optimizer<a class="headerlink" href="#pattern-optimizer" title="Link to this heading"></a></h1>
<p>The pattern optimizer is implemented by class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>.
It searches for a specific sequence of nodes in the graph and
replaces it by another one without changing the inputs or the long_outputs
of the graph. The goal of the optimizer is to make the whole computation
graph more efficient. The goal of this implementation is to make this
optimization as fast as possible.
Assuming the nodes in an onnx graph are ordered in a way every input of a
node was created by previous nodes, the optimizer must not require
any global reordering. The cost should be in <img class="math" src="../_images/math/ee2fa8e8c79fa606e3168c3d6332beb096b05426.svg" alt="O(N P I)"/> in the worst
case where <em>N</em> is the number of nodes, <em>P</em> is the number of patterns,
<em>I</em> is the number of iterations.</p>
<p>It is difficult to foresee what a pattern needs in order to rewrite a part
of the graph. This API tries to give as much freedom as it can without
leaving too much to do to the developper which tries to add a new pattern.</p>
<section id="patterns">
<h2>Patterns<a class="headerlink" href="#patterns" title="Link to this heading"></a></h2>
<p>Patterns must inherit from <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.PatternOptimization" title="experimental_experiment.xoptim.PatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">PatternOptimization</span></code></a>.
This class defines two methods.</p>
<section id="patternoptimization-match">
<h3>PatternOptimization.match<a class="headerlink" href="#patternoptimization-match" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">g</span><span class="p">:</span> <span class="s2">&quot;GraphBuilderPatternOptimization&quot;</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">NodeProto</span><span class="p">,</span>
    <span class="n">matched</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">]:</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code> is a <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>,
it holds all the existing nodes, is able to return any information
about type, shape, the node before, the node after another one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code>: the matching must determine if some nodes around this one
are part of set of nodes this pattern optimizer can rewrite.
From there, the function explores wherever it needs,
checking any condition it needs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matched</span></code>: usually unused, it returns of nodes already matching
a pattern</p></li>
</ul>
<p>The method must not modify the graph.
The method returns None if no match is found or an instance of class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.MatchResult" title="experimental_experiment.xoptim.MatchResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatchResult</span></code></a>. It must contain:</p>
<ul class="simple">
<li><p>a list of nodes involved in the rewriting. It does not mean all of them will be
removed but all of them are needed to do the rewriting and must
not be impacted by other pattern optimizer.</p></li>
<li><p>A function doing the rewriting (usually method <em>apply</em> of the pattern class).</p></li>
<li><p>An existing node where the rewritten nodes can be inserted.
Knowing it makes it faster to rewriter. If not specified, the optimizer
will automatically determine the position of the new nodes.</p></li>
</ul>
<p><em>Debugging: method none</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">none</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lineno</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
</pre></div>
</div>
<p>It may be useful which reason made a pattern matching fail.
Instead of returning None, method <em>match</em> can return the following
expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">none</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
</pre></div>
</div>
<p>By setting the verbosity (see next Section), the user may then know
which lines in the code returned None and which condition failed.</p>
</section>
<section id="patternoptimization-apply">
<h3>PatternOptimization.apply<a class="headerlink" href="#patternoptimization-apply" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="s2">&quot;GraphBuilder&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">nodes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]:</span>
</pre></div>
</div>
<p>The method does the rewriting. It assumes it can happen.
It takes a list of nodes impacted by the rewriting. It assumes no other
pattern optimizer modified them or will modify them.
It receives the list of nodes
returned by method <em>apply</em>. Since it is a list of argument, method
<em>match</em> can include None values. The method returns the new nodes.
The optimizer considers that any node given to this function is removed
from the graph, and any node returned by it are added.
If a received node must be kept, it must be added to the list of returned node.</p>
</section>
</section>
<section id="optimization-algorithm">
<h2>Optimization Algorithm<a class="headerlink" href="#optimization-algorithm" title="Link to this heading"></a></h2>
<p>It is implemented in method <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.optimize" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">optimize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">remove_identity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</pre></div>
</div>
<p>The algorithm runs multiple iteration until the graph is not evolving
or <cite>max_iter</cite> is reached. By default, it is equal to the number of nodes.
An iteration is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">builds</span> <span class="nb">all</span> <span class="n">successors</span> <span class="ow">and</span> <span class="n">predecessors</span>

<span class="c1"># Step 1: match</span>

<span class="k">for</span> <span class="nb">all</span> <span class="n">patterns</span> <span class="n">P</span><span class="p">:</span>

    <span class="k">for</span> <span class="nb">all</span> <span class="n">nodes</span> <span class="n">n</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">no</span> <span class="n">node</span> <span class="n">already</span> <span class="n">scheduled</span> <span class="n">to</span> <span class="n">be</span> <span class="n">rewritten</span> <span class="n">by</span> <span class="n">another</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c1"># Step 2: apply</span>

<span class="k">for</span> <span class="nb">all</span> <span class="n">matches</span> <span class="n">r</span><span class="p">:</span>
    <span class="n">apply</span> <span class="n">the</span> <span class="n">match</span> <span class="n">r</span>

<span class="c1"># Step 3: clean</span>

<span class="n">remove</span> <span class="n">unused</span> <span class="n">nodes</span>
<span class="n">remove</span> <span class="n">identity</span> <span class="n">nodes</span>
</pre></div>
</div>
<p>This algorithm may apply more than one rewriting at each iteration
but it guarantees the local structure when applying the rewriting was
not altered by another one.</p>
</section>
<section id="adding-a-pattern">
<h2>Adding a pattern<a class="headerlink" href="#adding-a-pattern" title="Link to this heading"></a></h2>
<p>See <a class="reference external" href="https://github.com/sdpython/experimental-experiment/pull/80">#80</a> about the addition of a new pattern.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<section id="simple-api">
<h3>Simple API<a class="headerlink" href="#simple-api" title="Link to this heading"></a></h3>
<p>We consider the following simple model:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">pretty_onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimizationOptions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.torch_interpreter</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_onnx</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MLP</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">onx</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">MLP</span><span class="p">(),</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pretty_onnx</span><span class="p">(</span><span class="n">onx</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">18</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;p_layers_0_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>       <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">p_layers_0_weight</span><span class="p">)</span><span class="c1">##p_layers_0_weight/DynamoInterpret.placeholder.1/P(layers.0.weight)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;p_layers_2_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>        <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">p_layers_2_weight</span><span class="p">)</span><span class="c1">##p_layers_2_weight/DynamoInterpret.placeholder.1/P(layers.2.weight)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                   <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.06</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span><span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">MatMul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_x</span>
      <span class="n">Add</span><span class="p">(</span><span class="n">_onx_matmul_x</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">linear</span>
        <span class="n">Relu</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relu</span>
          <span class="n">MatMul</span><span class="p">(</span><span class="n">relu</span><span class="p">,</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_relu</span>
            <span class="n">Add</span><span class="p">(</span><span class="n">_onx_matmul_relu</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">output_0</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;output_0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Which we can renders as follows:</p>
<div class="graphviz"><img src="../_images/graphviz-e5c902f48e27bc70f25410e894211b170746fcca.png" alt="digraph {
  graph [rankdir=TB, splines=true, overlap=false, nodesep=0.2, ranksep=0.2, fontsize=8];
  node [style=&quot;rounded,filled&quot;, color=&quot;#888888&quot;, fontcolor=&quot;#222222&quot;, shape=box];
  edge [arrowhead=vee, fontsize=7, labeldistance=-5, labelangle=0];
  I_0 [label=&quot;x\nFLOAT(3,10)&quot;, fillcolor=&quot;#aaeeaa&quot;];
  i_1 [label=&quot;p_layers_0_weight::T10\nFLOAT(10, 32)&quot;, fillcolor=&quot;#cccc00&quot;];
  i_2 [label=&quot;p_layers_2_weight::T10\nFLOAT(32, 1)&quot;, fillcolor=&quot;#cccc00&quot;];
  i_3 [label=&quot;layers.0.bias\nFLOAT(32)&quot;, fillcolor=&quot;#cccc00&quot;];
  MatMul_4 [label=&quot;MatMul(., .)&quot;, fillcolor=&quot;#ee9999&quot;];
  Add_5 [label=&quot;Add(., .)&quot;, fillcolor=&quot;#cccccc&quot;];
  Relu_6 [label=&quot;Relu(.)&quot;, fillcolor=&quot;#cccccc&quot;];
  MatMul_7 [label=&quot;MatMul(., .)&quot;, fillcolor=&quot;#ee9999&quot;];
  Add_8 [label=&quot;Add(., [0.059960067])&quot;, fillcolor=&quot;#cccccc&quot;];
  I_0 -&gt; MatMul_4 [label=&quot;FLOAT(3,10)&quot;];
  i_1 -&gt; MatMul_4 [label=&quot;FLOAT(10, 32)&quot;];
  MatMul_4 -&gt; Add_5 [label=&quot;FLOAT(3,32)&quot;];
  i_3 -&gt; Add_5 [label=&quot;FLOAT(32)&quot;];
  Add_5 -&gt; Relu_6 [label=&quot;FLOAT(3,32)&quot;];
  Relu_6 -&gt; MatMul_7 [label=&quot;FLOAT(3,32)&quot;];
  i_2 -&gt; MatMul_7 [label=&quot;FLOAT(32, 1)&quot;];
  MatMul_7 -&gt; Add_8 [label=&quot;FLOAT(3,1)&quot;];
  O_9 [label=&quot;output_0\nFLOAT(3,1)&quot;, fillcolor=&quot;#aaaaee&quot;];
  Add_8 -&gt; O_9;
}" class="graphviz" /></div>
<p>We then apply the optimizations by writing the following code:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">pretty_onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="c1"># The model is placed in a GraphBuilder.</span>
<span class="c1"># It creates dictionnaires to store shapes, ranks, types</span>
<span class="c1"># to make it easier to the optimizers to find the information</span>
<span class="c1"># they need. It still uses NodeProto to store nodes</span>
<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Let&#39;s optimize.</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp_opt.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">opt_onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pretty_onnx</span><span class="p">(</span><span class="n">opt_onx</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">18</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                   <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.06</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span><span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span><span class="c1">##p_layers_0_weight::T10/GraphBuilder._update_structures_with_proto.1/from(p_layers_0_weight::T10)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span><span class="c1">##p_layers_2_weight::T10/GraphBuilder._update_structures_with_proto.1/from(p_layers_2_weight::T10)##init7_s2_1_-1/TransposeEqualReshapePattern.apply.new_shape</span>
    <span class="n">Gemm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">linear</span>
      <span class="n">Relu</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relu</span>
        <span class="n">Gemm</span><span class="p">(</span><span class="n">relu</span><span class="p">,</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">output_0</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;output_0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Which renders as follows:</p>
<div class="graphviz"><img src="../_images/graphviz-ec46cca9b984d004e5f0cf69a4d32796141e8698.png" alt="digraph {
  graph [rankdir=TB, splines=true, overlap=false, nodesep=0.2, ranksep=0.2, fontsize=8];
  node [style=&quot;rounded,filled&quot;, color=&quot;#888888&quot;, fontcolor=&quot;#222222&quot;, shape=box];
  edge [arrowhead=vee, fontsize=7, labeldistance=-5, labelangle=0];
  I_0 [label=&quot;x\nFLOAT(3,10)&quot;, fillcolor=&quot;#aaeeaa&quot;];
  i_1 [label=&quot;layers.0.bias\nFLOAT(32)&quot;, fillcolor=&quot;#cccc00&quot;];
  i_2 [label=&quot;GemmTransposePattern--p_layers_0_weight::T10\nFLOAT(32, 10)&quot;, fillcolor=&quot;#cccc00&quot;];
  i_3 [label=&quot;GemmTransposePattern--p_layers_2_weight::T10\nFLOAT(1, 32)&quot;, fillcolor=&quot;#cccc00&quot;];
  Gemm_4 [label=&quot;Gemm(., ., .)&quot;, fillcolor=&quot;#cccccc&quot;];
  Relu_5 [label=&quot;Relu(.)&quot;, fillcolor=&quot;#cccccc&quot;];
  Gemm_6 [label=&quot;Gemm(., ., [0.059960067])&quot;, fillcolor=&quot;#cccccc&quot;];
  I_0 -&gt; Gemm_4 [label=&quot;FLOAT(3,10)&quot;];
  i_2 -&gt; Gemm_4 [label=&quot;FLOAT(32, 10)&quot;];
  i_1 -&gt; Gemm_4 [label=&quot;FLOAT(32)&quot;];
  Gemm_4 -&gt; Relu_5 [label=&quot;FLOAT(3,32)&quot;];
  Relu_5 -&gt; Gemm_6 [label=&quot;FLOAT(3,32)&quot;];
  i_3 -&gt; Gemm_6 [label=&quot;FLOAT(1, 32)&quot;];
  O_7 [label=&quot;output_0\nFLOAT(3,1)&quot;, fillcolor=&quot;#aaaaee&quot;];
  Gemm_6 -&gt; O_7;
}" class="graphviz" /></div>
</section>
<section id="verbosity">
<h3>Verbosity<a class="headerlink" href="#verbosity" title="Link to this heading"></a></h3>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">_add_shape_information</span><span class="p">]</span> <span class="n">dynamic</span> <span class="n">shapes</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=84</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="n">subgraphs</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="n">subgraphs</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">84</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">30</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">same</span> <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SameChildrenFromInputPattern&#39;</span><span class="p">,</span> <span class="s1">&#39;SameChildrenPattern&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.002</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">1</span> <span class="n">matches</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">6</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.019</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">ALGO</span><span class="o">-</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">random_order</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">shape_order</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="ow">in</span> <span class="mf">3.5637996916193515e-05</span><span class="n">s</span> <span class="k">with</span> <span class="n">changed</span><span class="o">=</span><span class="mi">0</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.021</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">]</span> <span class="n">make_model</span> <span class="mi">4</span> <span class="n">inits</span> <span class="mi">0</span> <span class="n">params</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">time_evaluation_constants_</span><span class="p">]</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="n">large_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">external_threshold</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">switch</span> <span class="n">low</span><span class="o">/</span><span class="n">high</span> <span class="n">order</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">done</span> <span class="ow">in</span> <span class="mf">1.6939993656706065e-06</span><span class="n">s</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">0</span> <span class="n">large</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">JLW</span><span class="o">.</span><span class="n">_add_shape_information</span><span class="p">]</span> <span class="n">dynamic</span> <span class="n">shapes</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}</span>
</pre></div>
</div>
<p>With more verbosity:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">:(</span><span class="mi">32</span><span class="p">,)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="mi">32</span><span class="p">,)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">:(</span><span class="mi">1</span><span class="p">,)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="mi">1</span><span class="p">,)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">x</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">x</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">x</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">output_0</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">output_0</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">output_0</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_matmul_x</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_matmul_x</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_matmul_x</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">linear</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">linear</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">linear</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">relu</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">relu</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">relu</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_matmul_relu</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_matmul_relu</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_matmul_relu</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">output_0</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.0005624810000881553</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">constants</span> <span class="ow">and</span> <span class="mi">5</span> <span class="n">nodes</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">_onx_matmul_x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">linear</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">relu</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">_onx_matmul_relu</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">output_0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">constants</span> <span class="ow">and</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">3.3787000575102866e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_update_shape_types_with_proto</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="mi">0</span> <span class="n">shapes</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_shape_types_with_proto</span><span class="p">]</span> <span class="n">infer</span> <span class="n">shapes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_shape_types_with_proto</span><span class="p">]</span> <span class="n">infer</span> <span class="n">shapes</span> <span class="n">done</span> <span class="mf">0.0002553329977672547</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_shape_types_with_proto</span><span class="p">]</span> <span class="n">_clean_shapes</span> <span class="n">after</span> <span class="mf">0.0002792329978547059</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_update_shape_types_with_proto</span><span class="p">]</span> <span class="n">walk</span> <span class="n">through</span> <span class="mi">0</span> <span class="n">shapes</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_matmul_x</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">_update_shape_types_with_proto_one_result</span><span class="p">]</span> <span class="n">update</span> <span class="n">shape</span><span class="p">(</span><span class="n">_onx_matmul_x</span><span class="p">)</span> <span class="k">with</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">linear</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">_update_shape_types_with_proto_one_result</span><span class="p">]</span> <span class="n">update</span> <span class="n">shape</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="k">with</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">relu</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">_update_shape_types_with_proto_one_result</span><span class="p">]</span> <span class="n">update</span> <span class="n">shape</span><span class="p">(</span><span class="n">relu</span><span class="p">)</span> <span class="k">with</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_matmul_relu</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">_update_shape_types_with_proto_one_result</span><span class="p">]</span> <span class="n">update</span> <span class="n">shape</span><span class="p">(</span><span class="n">_onx_matmul_relu</span><span class="p">)</span> <span class="k">with</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_update_shape_types_with_proto</span><span class="p">]</span> <span class="n">ends</span> <span class="ow">in</span> <span class="mf">7.161399844335392e-05</span> <span class="n">seconds</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_add_shape_information</span><span class="p">]</span> <span class="n">dynamic</span> <span class="n">shapes</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">constant_folding</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Concat&#39;</span><span class="p">,</span> <span class="s1">&#39;Transpose&#39;</span><span class="p">,</span> <span class="s1">&#39;Reshape&#39;</span><span class="p">,</span> <span class="s1">&#39;Sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;Unsqueeze&#39;</span><span class="p">,</span> <span class="s1">&#39;Reciprocal&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp&#39;</span><span class="p">,</span> <span class="s1">&#39;Div&#39;</span><span class="p">,</span> <span class="s1">&#39;Cast&#39;</span><span class="p">,</span> <span class="s1">&#39;Sub&#39;</span><span class="p">,</span> <span class="s1">&#39;Squeeze&#39;</span><span class="p">,</span> <span class="s1">&#39;Mul&#39;</span><span class="p">},</span> <span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="n">BatchNormalizationPattern</span><span class="p">(),</span> <span class="n">BatchNormalizationTrainingPattern</span><span class="p">(),</span> <span class="n">CastLayerNormalizationCastPattern</span><span class="p">(),</span> <span class="n">CastPattern</span><span class="p">(),</span> <span class="n">CastCastBinaryPattern</span><span class="p">(),</span> <span class="n">CastCastPattern</span><span class="p">(),</span> <span class="n">CastOpCastPattern</span><span class="p">(),</span> <span class="n">ClipClipPattern</span><span class="p">(),</span> <span class="n">ConcatEmptyPattern</span><span class="p">(),</span> <span class="n">ConcatGatherPattern</span><span class="p">(),</span> <span class="n">ConcatReshapePattern</span><span class="p">(),</span> <span class="n">ConcatTwiceUnaryPattern</span><span class="p">(),</span> <span class="n">ConstantToInitializerPattern</span><span class="p">(),</span> <span class="n">ConvBiasNullPattern</span><span class="p">(),</span> <span class="n">DropoutPattern</span><span class="p">(),</span> <span class="n">ExpandPattern</span><span class="p">(),</span> <span class="n">ExpandBroadcastPattern</span><span class="p">(),</span> <span class="n">ExpandSwapPattern</span><span class="p">(),</span> <span class="n">GathersSplitPattern</span><span class="p">(),</span> <span class="n">GeluPattern</span><span class="p">(),</span> <span class="n">IdentityPattern</span><span class="p">(),</span> <span class="n">LayerNormalizationPattern</span><span class="p">(),</span> <span class="n">LayerNormalizationScalePattern</span><span class="p">(),</span> <span class="n">LeakyReluPattern</span><span class="p">(),</span> <span class="n">MulMulMulScalarPattern</span><span class="p">(),</span> <span class="n">ReduceReshapePattern</span><span class="p">(),</span> <span class="n">ReduceSumNormalizePattern</span><span class="p">(),</span> <span class="n">ReshapePattern</span><span class="p">(),</span> <span class="n">ReshapeMatMulReshapePattern</span><span class="p">(),</span> <span class="n">Reshape2Of3Pattern</span><span class="p">(),</span> <span class="n">ReshapeReshapeBinaryPattern</span><span class="p">(),</span> <span class="n">MatMulAddPattern</span><span class="p">(),</span> <span class="n">GemmTransposePattern</span><span class="p">(),</span> <span class="n">MatMulReshape2Of3Pattern</span><span class="p">(),</span> <span class="n">MulMulMatMulPattern</span><span class="p">(),</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span><span class="p">(),</span> <span class="n">ShapeBasedStaticExpandPattern</span><span class="p">(),</span> <span class="n">ShapeBasedConcatExpandPattern</span><span class="p">(),</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span><span class="p">(),</span> <span class="n">ShapeBasedIdentityPattern</span><span class="p">(),</span> <span class="n">ShapeBasedExpandBroadcastPattern</span><span class="p">(),</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="p">(),</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span><span class="p">(),</span> <span class="n">ShapeBasedExpandSwapPattern</span><span class="p">(),</span> <span class="n">ShapeBasedMatMulToMulPattern</span><span class="p">(),</span> <span class="n">ShapedBasedReshapePattern</span><span class="p">(),</span> <span class="n">ShapeBasedSameChildrenPattern</span><span class="p">(),</span> <span class="n">ShapeBasedShapeShapeAddPattern</span><span class="p">(),</span> <span class="n">ReshapeReshapePattern</span><span class="p">(),</span> <span class="n">RotaryEmbeddingPattern</span><span class="p">(),</span> <span class="n">SameChildrenPattern</span><span class="p">(),</span> <span class="n">SameChildrenFromInputPattern</span><span class="p">(),</span> <span class="n">SequenceConstructAtPattern</span><span class="p">(),</span> <span class="n">SliceSlicePattern</span><span class="p">(),</span> <span class="n">SlicesSplitPattern</span><span class="p">(),</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span><span class="p">(),</span> <span class="n">SplitConcatPattern</span><span class="p">(),</span> <span class="n">SqueezeAddPattern</span><span class="p">(),</span> <span class="n">SqueezeBinaryUnsqueezePattern</span><span class="p">(),</span> <span class="n">SqueezeUnsqueezePattern</span><span class="p">(),</span> <span class="n">StaticConcatReshapePattern</span><span class="p">(),</span> <span class="n">Sub1MulPattern</span><span class="p">(),</span> <span class="n">SwapExpandReshapePattern</span><span class="p">(),</span> <span class="n">SwapUnaryPattern</span><span class="p">(),</span> <span class="n">SwapUnsqueezeTransposePattern</span><span class="p">(),</span> <span class="n">SwitchOrderBinaryPattern</span><span class="p">(),</span> <span class="n">SwitchReshapeActivationPattern</span><span class="p">(),</span> <span class="n">TransposeEqualReshapePattern</span><span class="p">(),</span> <span class="n">TransposeGatherPattern</span><span class="p">(),</span> <span class="n">TransposeMatMulPattern</span><span class="p">(),</span> <span class="n">TransposeReshapeMatMulPattern</span><span class="p">(),</span> <span class="n">TransposeReshapeTransposePattern</span><span class="p">(),</span> <span class="n">TransposeTransposePattern</span><span class="p">(),</span> <span class="n">UnsqueezeEqualPattern</span><span class="p">(),</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span><span class="p">(),</span> <span class="n">UnsqueezeReshapePattern</span><span class="p">(),</span> <span class="n">UnsqueezeUnsqueezePattern</span><span class="p">(),</span> <span class="n">RotaryConcatPartPattern</span><span class="p">(),</span> <span class="n">FunctionAttentionPattern</span><span class="p">(),</span> <span class="n">FunctionCausalMaskPattern</span><span class="p">(),</span> <span class="n">FunctionCausalMaskMulAddPattern</span><span class="p">(),</span> <span class="n">FunctionCosSinCachePattern</span><span class="p">(),</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span><span class="p">(),</span> <span class="n">RMSNormalizationPattern</span><span class="p">()],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="o">--</span> <span class="n">GRAPH</span> <span class="n">BEFORE</span> <span class="n">OPTIMIZATON</span> <span class="o">--</span>
    
    <span class="n">opset</span><span class="p">:</span> <span class="p">:</span> <span class="mi">18</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>                            <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                             <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                                        <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>                                         <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">::</span> <span class="n">x</span>                                                                       <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">10</span>
    <span class="n">MatMul</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_x</span>                              <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">32</span>                   <span class="o">-</span> <span class="n">Opset</span>
    <span class="n">Add</span><span class="p">:</span> <span class="n">_onx_matmul_x</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span> <span class="o">-&gt;</span> <span class="n">linear</span>                                     <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">32</span>                   <span class="o">-</span> <span class="n">Opset2</span>
    <span class="n">Relu</span><span class="p">:</span> <span class="n">linear</span> <span class="o">-&gt;</span> <span class="n">relu</span>                                                            <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">32</span>                   <span class="o">-</span> <span class="n">relu</span>
    <span class="n">MatMul</span><span class="p">:</span> <span class="n">relu</span><span class="p">,</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_relu</span>                        <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>                    <span class="o">-</span> <span class="n">Opset3</span>
    <span class="n">Add</span><span class="p">:</span> <span class="n">_onx_matmul_relu</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span> <span class="o">-&gt;</span> <span class="n">output_0</span>                                <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>                    <span class="o">-</span> <span class="n">Opset4</span>
    <span class="n">output</span><span class="p">::</span> <span class="n">output_0</span>                                                               <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>
    <span class="o">--</span> <span class="n">END</span> <span class="o">--</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="n">subgraphs</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="n">subgraphs</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.7362999389879405e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">constants</span> <span class="ow">and</span> <span class="mi">5</span> <span class="n">nodes</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">_onx_matmul_x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">linear</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">relu</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">_onx_matmul_relu</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">output_0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">constants</span> <span class="ow">and</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.53630023507867e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">84</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">30</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">BatchNormalizationPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">2</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">BatchNormalizationTrainingPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">CastCastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">4</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">CastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">5</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ConcatGatherPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">6</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ConcatReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">7</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ConvBiasNullPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">8</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ExpandPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>   <span class="mi">9</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">FunctionAttentionPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">10</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">GeluPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">11</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">IdentityPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">12</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">LeakyReluPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">13</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">14</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ReshapeReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">15</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SameChildrenFromInputPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">16</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SameChildrenPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">17</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">18</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapeBasedIdentityPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">19</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">20</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapeBasedSameChildrenPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">21</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapeBasedShapeShapeAddPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">22</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapeBasedStaticExpandPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">23</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">ShapedBasedReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">24</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">25</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SqueezeAddPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">26</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SqueezeBinaryUnsqueezePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">27</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SqueezeUnsqueezePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">28</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">StaticConcatReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">29</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SwapExpandReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">30</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SwapUnaryPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">31</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">SwapUnsqueezeTransposePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">32</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">TransposeGatherPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">33</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">TransposeReshapeTransposePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">34</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">TransposeTransposePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">35</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">36</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">UnsqueezeReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">37</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">UnsqueezeUnsqueezePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">38</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">CastCastBinaryPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">39</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">CastLayerNormalizationCastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">40</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">CastOpCastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">41</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ClipClipPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">42</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ConcatEmptyPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">43</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ConcatTwiceUnaryPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">44</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ConstantToInitializerPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">45</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">DropoutPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">46</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ExpandBroadcastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">47</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ExpandSwapPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">48</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">FunctionCausalMaskMulAddPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">49</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">FunctionCausalMaskPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">50</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">FunctionCosSinCachePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">51</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">52</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">GathersSplitPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">53</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">GemmTransposePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">54</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">LayerNormalizationPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">55</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">LayerNormalizationScalePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">56</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">MatMulReshape2Of3Pattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">57</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">MulMulMatMulPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">58</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">MulMulMulScalarPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">59</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">RMSNormalizationPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">60</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ReduceReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">61</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ReduceSumNormalizePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">62</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">Reshape2Of3Pattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">63</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ReshapeMatMulReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">64</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ReshapeReshapeBinaryPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">65</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">RotaryConcatPartPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">66</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">RotaryEmbeddingPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">67</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">SequenceConstructAtPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">68</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ShapeBasedConcatExpandPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">69</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">70</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ShapeBasedExpandBroadcastPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">71</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">72</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ShapeBasedExpandSwapPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">73</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">ShapeBasedMatMulToMulPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">74</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">SliceSlicePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">75</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">SlicesSplitPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">76</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">SplitConcatPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">77</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">Sub1MulPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">78</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">SwitchOrderBinaryPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">79</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">SwitchReshapeActivationPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">80</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">TransposeEqualReshapePattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">81</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">TransposeMatMulPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">82</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">TransposeReshapeMatMulPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">83</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">UnsqueezeEqualPattern</span><span class="p">()</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">use</span> <span class="n">pattern</span>  <span class="mi">84</span><span class="o">/</span><span class="mi">84</span> <span class="o">-</span> <span class="n">P3</span> <span class="o">-</span> <span class="n">MatMulAddPattern</span><span class="p">()</span>
    <span class="o">--</span> <span class="n">optimize</span> <span class="n">starts</span> <span class="k">with</span><span class="o">...</span>
    
    <span class="n">opset</span><span class="p">:</span> <span class="p">:</span> <span class="mi">18</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>                            <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                             <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                                        <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span> <span class="n">CP1</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>                                         <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">::</span> <span class="n">x</span>                                                                       <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">10</span>
    <span class="n">MatMul</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_x</span>                              <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">32</span>                   <span class="o">-</span> <span class="n">Opset</span>
    <span class="n">Add</span><span class="p">:</span> <span class="n">_onx_matmul_x</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span> <span class="o">-&gt;</span> <span class="n">linear</span>                                     <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">32</span>                   <span class="o">-</span> <span class="n">Opset2</span>
    <span class="n">Relu</span><span class="p">:</span> <span class="n">linear</span> <span class="o">-&gt;</span> <span class="n">relu</span>                                                            <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">32</span>                   <span class="o">-</span> <span class="n">relu</span>
    <span class="n">MatMul</span><span class="p">:</span> <span class="n">relu</span><span class="p">,</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_relu</span>                        <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>                    <span class="o">-</span> <span class="n">Opset3</span>
    <span class="n">Add</span><span class="p">:</span> <span class="n">_onx_matmul_relu</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span> <span class="o">-&gt;</span> <span class="n">output_0</span>                                <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>                    <span class="o">-</span> <span class="n">Opset4</span>
    <span class="n">output</span><span class="p">::</span> <span class="n">output_0</span>                                                               <span class="o">|</span><span class="n">T1</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span>
    <span class="o">--</span> <span class="n">starts</span> <span class="n">optimization</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">same</span> <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SameChildrenFromInputPattern&#39;</span><span class="p">,</span> <span class="s1">&#39;SameChildrenPattern&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationTrainingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">CastLayerNormalizationCastPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">CastCastBinaryPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">CastOpCastPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ClipClipPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ConcatEmptyPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ConcatTwiceUnaryPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ConstantToInitializerPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConvBiasNullPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">DropoutPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ExpandBroadcastPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ExpandSwapPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">GathersSplitPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GeluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">IdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">879</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">921</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">LayerNormalizationPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">LayerNormalizationScalePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LeakyReluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">6</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">x</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">x</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">zero</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_zero</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">zero</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">zero</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">slope</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_slope</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">slope</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">slope</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">tt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Greater</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_greater_x&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_greater_x</span><span class="p">:</span><span class="mi">9</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">tt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Mul</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_mul_x&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_mul_x</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">ttt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Where</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_greater_x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;_onx_mul_x&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_where_greater_x&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_where_greater_x</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">VUU</span><span class="o">.</span><span class="n">make_tensor_output</span><span class="p">]</span> <span class="n">_onx_where_greater_x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">MulMulMulScalarPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ReduceReshapePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ReduceSumNormalizePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ReshapeMatMulReshapePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">Reshape2Of3Pattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ReshapeReshapeBinaryPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">MatMulAddPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">GemmTransposePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">MatMulReshape2Of3Pattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">MulMulMatMulPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedStaticExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ShapeBasedConcatExpandPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedIdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ShapeBasedExpandBroadcastPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ShapeBasedExpandSwapPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">ShapeBasedMatMulToMulPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapedBasedReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedSameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedShapeShapeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedShapeShapeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">25</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_shape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedShapeShapeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">25</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_shape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">RotaryEmbeddingPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenFromInputPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">SequenceConstructAtPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">SliceSlicePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">SlicesSplitPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_X</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">X</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">X</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_indices</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">indices</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">indices</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_axis</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">axis</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">axis</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">zerof</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_zerof</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">zerof</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">zerof</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">zeroi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_zeroi</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">zeroi</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">zeroi</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_input</span><span class="p">]</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="kc">None</span><span class="p">]</span> <span class="o">--</span> <span class="n">marker</span><span class="o">=</span><span class="n">_build_pattern1_b</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">b</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">b</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">tt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Equal</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_equal_indices&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_equal_indices</span><span class="p">:</span><span class="mi">9</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Not</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_equal_indices&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_not_equal_indices&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_not_equal_indices</span><span class="p">:</span><span class="mi">9</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">ttt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Where</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_not_equal_indices&#39;</span><span class="p">,</span> <span class="s1">&#39;indices&#39;</span><span class="p">,</span> <span class="s1">&#39;zeroi&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_where_not_equal_indices</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">tt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Unsqueeze</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices&#39;</span><span class="p">,</span> <span class="s1">&#39;axis&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices::UnSq&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_where_not_equal_indices</span><span class="p">::</span><span class="n">UnSq</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">LogSoftmax</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_logsoftmax_X&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_logsoftmax_X</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_gatherelements_logsoftmax_X</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">]</span> <span class="n">GatherElements</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_logsoftmax_X&#39;</span><span class="p">,</span> <span class="s1">&#39;_onx_where_not_equal_indices::UnSq&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_gatherelements_logsoftmax_X&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_gatherelements_logsoftmax_X</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">tt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Squeeze</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_gatherelements_logsoftmax_X&#39;</span><span class="p">,</span> <span class="s1">&#39;axis&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_gatherelements_logsoftmax_X::Sq&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_gatherelements_logsoftmax_X</span><span class="p">::</span><span class="n">Sq</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Neg</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_gatherelements_logsoftmax_X::Sq&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_neg_gatherelements_logsoftmax_X::Sq&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_neg_gatherelements_logsoftmax_X</span><span class="p">::</span><span class="n">Sq</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">ttt</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Where</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_not_equal_indices&#39;</span><span class="p">,</span> <span class="s1">&#39;_onx_neg_gatherelements_logsoftmax_X::Sq&#39;</span><span class="p">,</span> <span class="s1">&#39;zerof&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices2&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_where_not_equal_indices2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Cast</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_not_equal_indices&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_not_equal_indices::C1&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">ReduceSum</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_not_equal_indices::C1&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_reducesum_not_equal_indices::C1&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_reducesum_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_reducesum_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">:()</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_reducesum_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="c1">#:-] Cast: [&#39;_onx_reducesum_not_equal_indices::C1&#39;]-&gt;[&#39;_onx_reducesum_not_equal_indices::C1::C10&#39;]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_reducesum_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:</span><span class="mi">10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_reducesum_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:()</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_reducesum_not_equal_indices</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">Cast</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices2&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices2::C1&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="o">-</span><span class="p">]</span> <span class="n">ReduceSum</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_where_not_equal_indices2::C1&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="s1">&#39;_onx_reducesum_where_not_equal_indices2::C1&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">:()</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="c1">#:-] Cast: [&#39;_onx_reducesum_where_not_equal_indices2::C1&#39;]-&gt;[&#39;_onx_reducesum_where_not_equal_indices2::C1::C10&#39;]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:</span><span class="mi">10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:()</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="mf">.3</span><span class="o">.</span><span class="n">make_node</span><span class="p">]</span> <span class="p">[</span><span class="c1">##:-] Div: [&#39;_onx_reducesum_where_not_equal_indices2::C1::C10&#39;, &#39;_onx_reducesum_not_equal_indices::C1::C10&#39;]-&gt;[&#39;_onx_div_reducesum_where_not_equal_indices2::C1::C10&#39;]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">_onx_div_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:</span><span class="mi">10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">_onx_div_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:()</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">_onx_div_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MAI</span><span class="o">.</span><span class="n">make_tensor_output</span><span class="p">]</span> <span class="n">_onx_div_reducesum_where_not_equal_indices2</span><span class="p">::</span><span class="n">C1</span><span class="p">::</span><span class="n">C10</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">SplitConcatPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SqueezeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">533</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_unsqueeze</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">SqueezeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">533</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_unsqueeze</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeBinaryUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">StaticConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">Sub1MulPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapExpandReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnsqueezeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">SwitchOrderBinaryPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">SwitchReshapeActivationPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">TransposeEqualReshapePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">TransposeMatMulPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">TransposeReshapeMatMulPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">UnsqueezeEqualPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">RotaryConcatPartPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionAttentionPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">FunctionCausalMaskPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">FunctionCausalMaskMulAddPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">FunctionCosSinCachePattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">RMSNormalizationPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span> <span class="n">done</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">apply_step</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">matches</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">applied</span> <span class="n">patterns</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="nb">all</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_identity</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.640400271047838e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_identity</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_unused</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_unused</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="n">C1F0</span> <span class="o">-</span> <span class="nb">next</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationTrainingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastLayerNormalizationCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">CastCastBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">412</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">CastCastBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">412</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastOpCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">CastOpCastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">592</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">CastOpCastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">589</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ClipClipPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatEmptyPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatTwiceUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConstantToInitializerPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConvBiasNullPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">DropoutPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GathersSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GeluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">IdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">879</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">921</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationScalePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LeakyReluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">6</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMulScalarPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceSumNormalizePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeMatMulReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ReshapeMatMulReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1352</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ReshapeMatMulReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1352</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Reshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">Reshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">831</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">Reshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">831</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapeBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ReshapeReshapeBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1112</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ReshapeReshapeBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1112</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">skips</span> <span class="n">MatMulAddPattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">priorities</span><span class="p">[</span><span class="n">current_priority_index</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulReshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatMulReshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">754</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">MatMulReshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">754</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MulMulMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1173</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">MulMulMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1173</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedStaticExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedConcatExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedIdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">437</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">437</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1288</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1288</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandSwapPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1047</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandSwapPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1047</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedMatMulToMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedMatMulToMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2235</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ShapeBasedMatMulToMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2235</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapedBasedReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedSameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedShapeShapeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedShapeShapeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">25</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_shape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedShapeShapeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">25</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_shape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenFromInputPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SequenceConstructAtPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SliceSlicePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SlicesSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SplitConcatPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SqueezeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">533</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_unsqueeze</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">SqueezeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">533</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_unsqueeze</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeBinaryUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">StaticConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Sub1MulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapExpandReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnsqueezeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchOrderBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchReshapeActivationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwitchReshapeActivationPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2051</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">linear</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeEqualReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeReshapeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1802</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">TransposeReshapeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1802</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeEqualPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryConcatPartPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionAttentionPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">FunctionCausalMaskMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1804</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_rotary</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">FunctionCausalMaskMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1804</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_rotary</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCosSinCachePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RMSNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span> <span class="n">done</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">apply_step</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">matches</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">applied</span> <span class="n">patterns</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="nb">all</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_identity</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.650700116646476e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_identity</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_unused</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_unused</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">1</span><span class="n">C1F0</span> <span class="o">-</span> <span class="nb">next</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationTrainingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastLayerNormalizationCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">CastCastBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">412</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">CastCastBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">412</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastOpCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">CastOpCastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">592</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">CastOpCastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">589</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_cast</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ClipClipPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatEmptyPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatTwiceUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConstantToInitializerPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConvBiasNullPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">DropoutPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GathersSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GeluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">IdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">879</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">921</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationScalePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LeakyReluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">6</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMulScalarPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceSumNormalizePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeMatMulReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ReshapeMatMulReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1352</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ReshapeMatMulReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1352</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Reshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">Reshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">831</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">Reshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">831</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapeBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ReshapeReshapeBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1112</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ReshapeReshapeBinaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1112</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatchResult</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">MATCH</span> <span class="n">MatMulAddPattern</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">types</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">[]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">MatchResult</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">MATCH</span> <span class="n">MatMulAddPattern</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">types</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">[]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulReshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatMulReshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">754</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">MatMulReshape2Of3Pattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">754</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MulMulMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1173</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">MulMulMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1173</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedStaticExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedConcatExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedIdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">437</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">437</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1288</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandBroadcastMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1288</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandSwapPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1047</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedExpandSwapPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1047</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedMatMulToMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedMatMulToMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2235</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ShapeBasedMatMulToMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2235</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapedBasedReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedSameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedShapeShapeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedShapeShapeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">25</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_shape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">ShapeBasedShapeShapeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">25</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_shape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenFromInputPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SequenceConstructAtPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SliceSlicePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SlicesSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SplitConcatPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SqueezeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">533</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_unsqueeze</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">SqueezeAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">533</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_unsqueeze</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeBinaryUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">StaticConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Sub1MulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapExpandReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnsqueezeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchOrderBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchReshapeActivationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwitchReshapeActivationPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2051</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">linear</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeEqualReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeReshapeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1802</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">TransposeReshapeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1802</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">MatMul</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeEqualPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryConcatPartPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionAttentionPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">FunctionCausalMaskMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1804</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_rotary</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_x</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">FunctionCausalMaskMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1804</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_rotary</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Opset4</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_onx_matmul_relu</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCosSinCachePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RMSNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span> <span class="n">done</span> <span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C0F1</span> <span class="o">-</span> <span class="n">apply_step</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">matches</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">apply</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">],</span> <span class="n">inputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;_onx_matmul_x&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_matmul_x&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">MatMul</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;_onx_matmul_x&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">Add</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_matmul_x&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Gemm</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">linear</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="o">-</span> <span class="n">add</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">removed</span> <span class="n">outputs</span> <span class="p">{</span><span class="s1">&#39;_onx_matmul_x&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">apply</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">],</span> <span class="n">inputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;_onx_matmul_relu&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_matmul_relu&#39;</span><span class="p">,</span> <span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">MatMul</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;_onx_matmul_relu&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">Add</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_onx_matmul_relu&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Gemm</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">output_0</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="o">-</span> <span class="n">add</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">MatMulAddPattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;MatMul&#39;</span><span class="p">,</span> <span class="s1">&#39;Add&#39;</span><span class="p">]:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">removed</span> <span class="n">outputs</span> <span class="p">{</span><span class="s1">&#39;_onx_matmul_relu&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">applied</span> <span class="n">patterns</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="nb">all</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span> <span class="o">+</span><span class="mi">2</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span> <span class="n">done</span> <span class="o">-</span><span class="mi">4</span> <span class="o">+</span><span class="mi">2</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_identity</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">3</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.1826999727636576e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_identity</span> <span class="n">done</span> <span class="o">-</span><span class="mi">4</span> <span class="o">+</span><span class="mi">2</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_unused</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_unused</span> <span class="n">done</span> <span class="o">-</span><span class="mi">4</span> <span class="o">+</span><span class="mi">2</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">2</span><span class="n">C1F1</span> <span class="o">-</span> <span class="nb">next</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationTrainingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastLayerNormalizationCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastOpCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ClipClipPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatEmptyPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatTwiceUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConstantToInitializerPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConvBiasNullPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">DropoutPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GathersSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GeluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">IdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationScalePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LeakyReluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">6</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMulScalarPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceSumNormalizePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeMatMulReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Reshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapeBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">204</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">MatMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">201</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatchResult</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">MATCH</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="mi">1</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">types</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">[]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">MatchResult</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">MATCH</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="mi">1</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">types</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">[]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulReshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedStaticExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedConcatExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedIdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedMatMulToMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapedBasedReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedSameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedShapeShapeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenFromInputPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SequenceConstructAtPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SliceSlicePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SlicesSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SplitConcatPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeBinaryUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">StaticConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Sub1MulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapExpandReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnsqueezeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchOrderBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchReshapeActivationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwitchReshapeActivationPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2051</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">linear</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeEqualReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeEqualPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryConcatPartPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionAttentionPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCosSinCachePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RMSNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span> <span class="n">done</span> <span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C0F1</span> <span class="o">-</span> <span class="n">apply_step</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">matches</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">apply</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">],</span> <span class="n">inputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Transpose</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">Gemm</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Transpose</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p_layers_0_weight::T10&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Gemm</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.0.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Transpose</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">linear</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="o">-</span> <span class="n">add</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">,</span> <span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">apply</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">],</span> <span class="n">inputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Transpose</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">Gemm</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Transpose</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Gemm</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;layers.2.bias&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Transpose</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">output_0</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="o">-</span> <span class="n">add</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">,</span> <span class="s1">&#39;Gemm&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">GemmTransposePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Gemm&#39;</span><span class="p">]:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">applied</span> <span class="n">patterns</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="nb">all</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">4</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span> <span class="n">done</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">4</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_identity</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.3213997337734327e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_identity</span> <span class="n">done</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">4</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_unused</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_unused</span> <span class="n">done</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">4</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">3</span><span class="n">C1F1</span> <span class="o">-</span> <span class="nb">next</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationTrainingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastLayerNormalizationCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastOpCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ClipClipPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatEmptyPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatTwiceUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConstantToInitializerPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConvBiasNullPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">DropoutPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GathersSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GeluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">IdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">798</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">798</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationScalePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LeakyReluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">6</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMulScalarPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceSumNormalizePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeMatMulReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Reshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapeBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">204</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">MatMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">201</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset32</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GemmTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">536</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GemmTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">536</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset32</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulReshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedStaticExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedConcatExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedIdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedIdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1075</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">ShapeBasedIdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1075</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedMatMulToMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapedBasedReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedSameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedShapeShapeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenFromInputPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SequenceConstructAtPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SliceSlicePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SlicesSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SplitConcatPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeBinaryUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">StaticConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Sub1MulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapExpandReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwapUnaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1222</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">SwapUnaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1222</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnsqueezeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwapUnsqueezeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">965</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">SwapUnsqueezeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">965</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchOrderBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchReshapeActivationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwitchReshapeActivationPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2051</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">linear</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeEqualReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeEqualReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">656</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">MatchResult</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">MATCH</span> <span class="n">TransposeEqualReshapePattern</span> <span class="k">with</span> <span class="mi">1</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">types</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">[]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1575</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1575</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset32</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeReshapeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">364</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">TransposeReshapeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">364</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">134</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">TransposeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">134</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeEqualPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryConcatPartPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionAttentionPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCosSinCachePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RMSNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span> <span class="n">done</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">1</span> <span class="n">matches</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C0F1</span> <span class="o">-</span> <span class="n">apply_step</span> <span class="k">with</span> <span class="mi">1</span> <span class="n">matches</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">apply</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">],</span> <span class="n">inputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_shape</span><span class="p">]</span> <span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">:(</span><span class="mi">2</span><span class="p">,)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_rank</span><span class="p">]</span> <span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">[</span><span class="mi">7</span><span class="p">:(</span><span class="mi">2</span><span class="p">,)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;init7_s2_1_-1&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Reshape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span>
      <span class="o">-</span> <span class="n">Transpose</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">]</span>
      <span class="o">+</span> <span class="n">Reshape</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="s1">&#39;init7_s2_1_-1&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">Reshape</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">apply_match</span><span class="p">]</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="o">-</span> <span class="n">add</span> <span class="p">[</span><span class="s1">&#39;Reshape&#39;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">1</span> <span class="n">applied</span> <span class="n">patterns</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="nb">all</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span> <span class="n">done</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_identity</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.1980002202326432e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_identity</span> <span class="n">done</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_unused</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="n">remove_unused</span> <span class="n">done</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">1</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">4</span><span class="n">C1F1</span> <span class="o">-</span> <span class="nb">next</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">BatchNormalizationTrainingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastLayerNormalizationCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">CastOpCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ClipClipPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatEmptyPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ConcatReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1298</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConcatTwiceUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConstantToInitializerPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ConvBiasNullPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">DropoutPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GathersSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GeluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">IdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">IdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">798</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LayerNormalizationScalePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">LeakyReluPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">6</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMulScalarPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReduceSumNormalizePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">37</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeMatMulReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Reshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapeBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">MatMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">204</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">MatMulAddPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">201</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset32</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">GemmTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GemmTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">536</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GemmTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">536</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset32</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MatMulReshape2Of3Pattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">MulMulMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedReshapeIsSqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedReshapeIsSqueezePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1997</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedStaticExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedConcatExpandPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedEditDistanceReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedEditDistanceReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1812</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedIdentityPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapeBasedIdentityPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1075</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandBroadcastMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandCastWhereSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedExpandSwapPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedMatMulToMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapedBasedReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ShapedBasedReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">170</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedSameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ShapeBasedShapeShapeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">ReshapeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">ReshapeReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">473</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SameChildrenFromInputPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SequenceConstructAtPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SliceSlicePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SlicesSplitPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SoftmaxCrossEntropyLossCastPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">14</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SplitConcatPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeBinaryUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">StaticConcatReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">StaticConcatReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1505</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">Sub1MulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapExpandReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwapExpandReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1876</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_expand</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwapUnaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1222</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">SwapUnaryPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1222</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_any</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwapUnsqueezeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwapUnsqueezeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">965</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchOrderBinaryPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">SwitchReshapeActivationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">SwitchReshapeActivationPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2051</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">linear</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeEqualReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeEqualReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">656</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeGatherPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1575</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">TransposeMatMulPattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1537</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_matmul</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Gemm</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset32</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeMatMulPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeReshapeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeReshapeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">364</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">TransposeTransposePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">TransposeTransposePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">134</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_transpose</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Transpose</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeEqualPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeOrSqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">UnsqueezeOrSqueezeReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2327</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeReshapePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">UnsqueezeReshapePattern</span><span class="o">.</span><span class="n">match</span><span class="p">]</span> <span class="n">NONE</span> <span class="o">-</span> <span class="n">line</span><span class="p">:</span> <span class="mi">2156</span><span class="p">:</span><span class="n">experimental_experiment</span><span class="o">.</span><span class="n">xoptim</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">onnx_reshape</span><span class="p">,</span> <span class="n">op_type</span><span class="o">=</span><span class="n">Reshape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">TransposeEqualReshapePattern</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">MatMulAddPattern</span><span class="o">--</span><span class="n">Opset3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">UnsqueezeUnsqueezePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RotaryConcatPartPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionAttentionPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCausalMaskMulAddPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionCosSinCachePattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">FunctionHalfRotaryEmbeddingPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">PatternOptimization</span><span class="o">.</span><span class="n">enumerate_matches</span><span class="p">]</span> <span class="n">start</span> <span class="n">RMSNormalizationPattern</span> <span class="k">with</span> <span class="n">main_opset</span><span class="o">=</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">min_opset</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0</span> <span class="o">-</span> <span class="n">matching_step</span> <span class="n">done</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">apply_step</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">matches</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">applied</span> <span class="n">patterns</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="nb">all</span><span class="p">:</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_duplicated_shape</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_identity</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">4.69839978904929e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_identity</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_unused</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">it</span><span class="o">=</span><span class="mi">5</span><span class="n">C0F0</span> <span class="o">-</span> <span class="n">remove_unused</span> <span class="n">done</span> <span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">6</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.013</span>
        <span class="n">STAT</span> <span class="n">apply_GemmTransposePattern</span> <span class="o">+</span><span class="mi">4</span> <span class="o">-</span><span class="mi">2</span> <span class="c1">#it=1 maxmatch=1 i=2 - time=0.00043924900455749594</span>
        <span class="n">STAT</span> <span class="n">apply_MatMulAddPattern</span> <span class="o">+</span><span class="mi">2</span> <span class="o">-</span><span class="mi">4</span> <span class="c1">#it=1 maxmatch=1 i=2 - time=0.00037632200110238045</span>
        <span class="n">STAT</span> <span class="n">apply_TransposeEqualReshapePattern</span> <span class="o">+</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#it=1 maxmatch=0 i=1 - time=0.00037777699981234036</span>
        <span class="n">STAT</span> <span class="n">build_graph_for_pattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0002423550031380728</span>
        <span class="n">STAT</span> <span class="n">check_pattern_00</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=1.8677998014027253e-05</span>
        <span class="n">STAT</span> <span class="n">check_pattern_A10</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=3 maxmatch=0 i=0 - time=4.380999598652124e-06</span>
        <span class="n">STAT</span> <span class="n">check_pattern_A20</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0001147940056398511</span>
        <span class="n">STAT</span> <span class="n">check_pattern_BD0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=7.532000017818063e-05</span>
        <span class="n">STAT</span> <span class="n">check_pattern_BI0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.00012085900016245432</span>
        <span class="n">STAT</span> <span class="n">check_pattern_BU0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.00010046600073110312</span>
        <span class="n">STAT</span> <span class="n">insert_and_remove_nodes</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=0.0005494389952218626</span>
        <span class="n">STAT</span> <span class="n">iteration_0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0046305869982461445</span>
        <span class="n">STAT</span> <span class="n">iteration_1</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0018816140000126325</span>
        <span class="n">STAT</span> <span class="n">iteration_2</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.00248079700031667</span>
        <span class="n">STAT</span> <span class="n">iteration_3</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.001379498000460444</span>
        <span class="n">STAT</span> <span class="n">iteration_4</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0015759660018375143</span>
        <span class="n">STAT</span> <span class="n">match_BatchNormalizationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=5.6904998928075656e-05</span>
        <span class="n">STAT</span> <span class="n">match_BatchNormalizationTrainingPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.00013068099724478088</span>
        <span class="n">STAT</span> <span class="n">match_CastCastBinaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=0.00011874099800479598</span>
        <span class="n">STAT</span> <span class="n">match_CastCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=7.319700307562016e-05</span>
        <span class="n">STAT</span> <span class="n">match_CastLayerNormalizationCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.7707999581471086e-05</span>
        <span class="n">STAT</span> <span class="n">match_CastOpCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=0.00010851099796127528</span>
        <span class="n">STAT</span> <span class="n">match_CastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.572900459403172e-05</span>
        <span class="n">STAT</span> <span class="n">match_ClipClipPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.429500793572515e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConcatEmptyPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=0.00015810400145710446</span>
        <span class="n">STAT</span> <span class="n">match_ConcatGatherPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.574100264813751e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConcatReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=4.356499994173646e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConcatTwiceUnaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.9136004741303623e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConstantToInitializerPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.6530997274676338e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConvBiasNullPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.4958993637701496e-05</span>
        <span class="n">STAT</span> <span class="n">match_DropoutPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.546700125094503e-05</span>
        <span class="n">STAT</span> <span class="n">match_ExpandBroadcastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.5968998670578003e-05</span>
        <span class="n">STAT</span> <span class="n">match_ExpandPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.154599471599795e-05</span>
        <span class="n">STAT</span> <span class="n">match_ExpandSwapPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.3972999770194292e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionAttentionPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.0630002584075555e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionCausalMaskMulAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=4.394799907458946e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionCausalMaskPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4843997380230576e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionCosSinCachePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.3824999516364187e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionHalfRotaryEmbeddingPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.1914998797001317e-05</span>
        <span class="n">STAT</span> <span class="n">match_GathersSplitPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.666400177986361e-05</span>
        <span class="n">STAT</span> <span class="n">match_GeluPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=1.2212000001454726e-05</span>
        <span class="n">STAT</span> <span class="n">match_GemmTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=2 - time=0.00011590500434977002</span>
        <span class="n">STAT</span> <span class="n">match_IdentityPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0006953949996386655</span>
        <span class="n">STAT</span> <span class="n">match_LayerNormalizationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.492399991955608e-05</span>
        <span class="n">STAT</span> <span class="n">match_LayerNormalizationScalePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.8300997655605897e-05</span>
        <span class="n">STAT</span> <span class="n">match_LeakyReluPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0023210289982671384</span>
        <span class="n">STAT</span> <span class="n">match_MatMulAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=4 maxmatch=2 i=2 - time=0.000176045999978669</span>
        <span class="n">STAT</span> <span class="n">match_MatMulReshape2Of3Pattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=7.850399924791418e-05</span>
        <span class="n">STAT</span> <span class="n">match_MulMulMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.013000190956518e-05</span>
        <span class="n">STAT</span> <span class="n">match_MulMulMulScalarPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.237300188629888e-05</span>
        <span class="n">STAT</span> <span class="n">match_RMSNormalizationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.166999547625892e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReduceReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.198100966983475e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReduceSumNormalizePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.5705994630698115e-05</span>
        <span class="n">STAT</span> <span class="n">match_Reshape2Of3Pattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=7.306599945877679e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapeMatMulReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=6.052800017641857e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=5.495999721460976e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapeReshapeBinaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=7.044999802019447e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapeReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.5756005672737956e-05</span>
        <span class="n">STAT</span> <span class="n">match_RotaryConcatPartPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.7976002456853166e-05</span>
        <span class="n">STAT</span> <span class="n">match_RotaryEmbeddingPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.398599826847203e-05</span>
        <span class="n">STAT</span> <span class="n">match_SameChildrenFromInputPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=6.409100024029613e-05</span>
        <span class="n">STAT</span> <span class="n">match_SameChildrenPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=6.586599920410663e-05</span>
        <span class="n">STAT</span> <span class="n">match_SequenceConstructAtPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4834000214468688e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedConcatExpandPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.529100311221555e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedEditDistanceReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=8.721400081412867e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandBroadcastMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.3844996728003025e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandBroadcastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=6.215300163603388e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandCastWhereSwapPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.5191002350766212e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandSwapPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.42980051250197e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedIdentityPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.4486005208455026e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedMatMulToMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.366900222725235e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedReshapeIsSqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.914700548397377e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedSameChildrenPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.2202999136643484e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedShapeShapeAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=7.161500252550468e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedStaticExpandPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.35950062435586e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapedBasedReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.958200250053778e-05</span>
        <span class="n">STAT</span> <span class="n">match_SliceSlicePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.23460046981927e-05</span>
        <span class="n">STAT</span> <span class="n">match_SlicesSplitPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4909997591748834e-05</span>
        <span class="n">STAT</span> <span class="n">match_SoftmaxCrossEntropyLossCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=0.0015004309971118346</span>
        <span class="n">STAT</span> <span class="n">match_SplitConcatPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4103999749058858e-05</span>
        <span class="n">STAT</span> <span class="n">match_SqueezeAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=8.447399886790663e-05</span>
        <span class="n">STAT</span> <span class="n">match_SqueezeBinaryUnsqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=2.958899858640507e-05</span>
        <span class="n">STAT</span> <span class="n">match_SqueezeUnsqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.006000042660162e-05</span>
        <span class="n">STAT</span> <span class="n">match_StaticConcatReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.225500040571205e-05</span>
        <span class="n">STAT</span> <span class="n">match_Sub1MulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=4.251199425198138e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwapExpandReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.6978999560233206e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwapUnaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=0.00013072099318378605</span>
        <span class="n">STAT</span> <span class="n">match_SwapUnsqueezeTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.626400186680257e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwitchOrderBinaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=4.075500328326598e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwitchReshapeActivationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=6.724299964844249e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeEqualReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=1 - time=6.979100362514146e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeGatherPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=2.968400076497346e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=0.0001584049969096668</span>
        <span class="n">STAT</span> <span class="n">match_TransposeReshapeMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.630300074699335e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeReshapeTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.3221996747888625e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.9455997466575354e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeEqualPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.3594999220222235e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeOrSqueezeReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.2873005693545565e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.453499448369257e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeUnsqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=2.59629960055463e-05</span>
        <span class="n">STAT</span> <span class="n">remove_duplicated_shape</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=1.9336002878844738e-05</span>
        <span class="n">STAT</span> <span class="n">remove_identity_nodes</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0008676460020069499</span>
        <span class="n">STAT</span> <span class="n">remove_unused</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0007024959995760582</span>
    <span class="o">--</span><span class="n">MODEL</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">1</span> <span class="n">inputs</span><span class="p">,</span> <span class="mi">1</span> <span class="n">outputs</span><span class="p">,</span> <span class="mi">5</span> <span class="n">initializers</span><span class="o">--</span>
             <span class="n">INPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span>
         <span class="n">INPUT</span><span class="o">-</span><span class="n">SEQ</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Falset</span>
            <span class="n">OUTPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span>
        <span class="n">OUTPUT</span><span class="o">-</span><span class="n">SEQ</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Falset</span>
              <span class="n">INIT</span><span class="p">:</span>   <span class="mi">4</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span>
              <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">7</span><span class="n">t</span>
              <span class="n">NODE</span><span class="p">:</span>   <span class="mi">2</span> <span class="n">x</span> <span class="n">Gemm</span>
              <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Relu</span>
              <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Reshape</span>
              <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Transpose</span>
    <span class="o">--</span><span class="n">MODEL</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">1</span> <span class="n">inputs</span><span class="p">,</span> <span class="mi">1</span> <span class="n">outputs</span><span class="p">,</span> <span class="mi">5</span> <span class="n">initializers</span><span class="o">--</span><span class="n">DETAILED</span><span class="o">--</span>
         <span class="n">INPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x10</span><span class="p">]</span>
        <span class="n">OUTPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x1</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">10</span><span class="n">x32</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="n">x1</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">7</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Gemm</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x10</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="n">x10</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Gemm</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x32</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="n">x32</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Relu</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x32</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Reshape</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="n">x1</span><span class="p">],</span> <span class="mi">7</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Transpose</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">10</span><span class="n">x32</span><span class="p">]</span><span class="o">-</span><span class="n">perm</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">2.1806998120155185e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">constants</span> <span class="ow">and</span> <span class="mi">5</span> <span class="n">nodes</span><span class="o">.</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">_onx_matmul_x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">x</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">linear</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">relu</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">_onx_matmul_relu</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="o">.</span> <span class="p">::</span> <span class="n">output_0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">cst</span><span class="p">::</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">from</span><span class="p">:</span> <span class="n">Transpose</span><span class="p">(</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">fold_constant</span><span class="p">:</span><span class="n">Transpose</span><span class="p">:</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">])]:</span><span class="n">from</span><span class="p">:</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">from</span><span class="p">:</span> <span class="n">Reshape</span><span class="p">(</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">set_type</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">]</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">fold_constant</span><span class="p">:</span><span class="n">Reshape</span><span class="p">:</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">[</span><span class="n">float32</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)]:</span><span class="n">from</span><span class="p">:</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">update_node_constant</span><span class="p">]</span> <span class="n">new</span> <span class="n">constant</span> <span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">7</span> <span class="n">constants</span> <span class="ow">and</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.0004430469998624176</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_unused</span><span class="p">]</span> <span class="n">remove_initializer</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">/</span><span class="mi">7</span><span class="p">:</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_unused</span><span class="p">]</span> <span class="n">remove_initializer</span> <span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">7</span><span class="p">:</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_unused</span><span class="p">]</span> <span class="n">remove_initializer</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="o">/</span><span class="mi">7</span><span class="p">:</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">int64</span><span class="p">[(</span><span class="mi">2</span><span class="p">,)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">found</span> <span class="mi">0</span> <span class="n">replacements</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">kept</span> <span class="mi">3</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">remove_identity_nodes</span><span class="p">]</span> <span class="n">ends</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">1.7399997886968777e-05</span> <span class="n">seconds</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">ALGO</span><span class="o">-</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">random_order</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">shape_order</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="ow">in</span> <span class="mf">3.608399856602773e-05</span><span class="n">s</span> <span class="k">with</span> <span class="n">changed</span><span class="o">=</span><span class="mi">0</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.016</span>
        <span class="n">STAT</span> <span class="n">apply_GemmTransposePattern</span> <span class="o">+</span><span class="mi">4</span> <span class="o">-</span><span class="mi">2</span> <span class="c1">#it=1 maxmatch=1 i=2 - time=0.00043924900455749594</span>
        <span class="n">STAT</span> <span class="n">apply_MatMulAddPattern</span> <span class="o">+</span><span class="mi">2</span> <span class="o">-</span><span class="mi">4</span> <span class="c1">#it=1 maxmatch=1 i=2 - time=0.00037632200110238045</span>
        <span class="n">STAT</span> <span class="n">apply_TransposeEqualReshapePattern</span> <span class="o">+</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#it=1 maxmatch=0 i=1 - time=0.00037777699981234036</span>
        <span class="n">STAT</span> <span class="n">apply_constant_folding__Reshape</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0</span>
        <span class="n">STAT</span> <span class="n">apply_constant_folding__Transpose</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0</span>
        <span class="n">STAT</span> <span class="n">apply_constant_folding_new_inits</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0</span>
        <span class="n">STAT</span> <span class="n">build_graph_for_pattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0002423550031380728</span>
        <span class="n">STAT</span> <span class="n">check_A</span><span class="o">-</span><span class="n">dynamic_dimension_naming</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.3860000763088465e-05</span>
        <span class="n">STAT</span> <span class="n">check_A</span><span class="o">-</span><span class="n">opt</span><span class="o">-</span><span class="n">sub</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.5753001207485795e-05</span>
        <span class="n">STAT</span> <span class="n">check_constant_folding</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.3699998817173764e-05</span>
        <span class="n">STAT</span> <span class="n">check_constant_folding</span><span class="o">-</span><span class="mi">7</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.6270998457912356e-05</span>
        <span class="n">STAT</span> <span class="n">check_order</span><span class="o">-</span><span class="mi">12</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=9.949999366654083e-06</span>
        <span class="n">STAT</span> <span class="n">check_orderA</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.3728000340051949e-05</span>
        <span class="n">STAT</span> <span class="n">check_orderL</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=9.536997822578996e-06</span>
        <span class="n">STAT</span> <span class="n">check_pattern_00</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=1.8677998014027253e-05</span>
        <span class="n">STAT</span> <span class="n">check_pattern_A10</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=3 maxmatch=0 i=0 - time=4.380999598652124e-06</span>
        <span class="n">STAT</span> <span class="n">check_pattern_A20</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0001147940056398511</span>
        <span class="n">STAT</span> <span class="n">check_pattern_BD0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=7.532000017818063e-05</span>
        <span class="n">STAT</span> <span class="n">check_pattern_BI0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.00012085900016245432</span>
        <span class="n">STAT</span> <span class="n">check_pattern_BU0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.00010046600073110312</span>
        <span class="n">STAT</span> <span class="n">check_patterns</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.9802002498181537e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_duplicated_initializer</span><span class="o">-</span><span class="mi">9</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=9.131999831879511e-06</span>
        <span class="n">STAT</span> <span class="n">check_remove_identity</span><span class="o">-</span><span class="mi">0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.6079000488389283e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_identity</span><span class="o">-</span><span class="mi">10</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=7.659199764020741e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_identity</span><span class="o">-</span><span class="mi">6</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.4242999895941466e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_unused</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.551499735796824e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_unused</span><span class="o">-</span><span class="mi">11</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.4070999895920977e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_unused</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=3.9529000787297264e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_unused</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.616100053070113e-05</span>
        <span class="n">STAT</span> <span class="n">check_remove_unused</span><span class="o">-</span><span class="mi">8</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=1.2141998013248667e-05</span>
        <span class="n">STAT</span> <span class="n">constant_folding</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">2</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=0.0006067649992473889</span>
        <span class="n">STAT</span> <span class="n">dynamic_dimension_naming</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=2.3266999050974846e-05</span>
        <span class="n">STAT</span> <span class="n">insert_and_remove_nodes</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=0.0005494389952218626</span>
        <span class="n">STAT</span> <span class="n">iteration_0</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0046305869982461445</span>
        <span class="n">STAT</span> <span class="n">iteration_1</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0018816140000126325</span>
        <span class="n">STAT</span> <span class="n">iteration_2</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.00248079700031667</span>
        <span class="n">STAT</span> <span class="n">iteration_3</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.001379498000460444</span>
        <span class="n">STAT</span> <span class="n">iteration_4</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=1 maxmatch=0 i=0 - time=0.0015759660018375143</span>
        <span class="n">STAT</span> <span class="n">match_BatchNormalizationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=5.6904998928075656e-05</span>
        <span class="n">STAT</span> <span class="n">match_BatchNormalizationTrainingPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.00013068099724478088</span>
        <span class="n">STAT</span> <span class="n">match_CastCastBinaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=0.00011874099800479598</span>
        <span class="n">STAT</span> <span class="n">match_CastCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=7.319700307562016e-05</span>
        <span class="n">STAT</span> <span class="n">match_CastLayerNormalizationCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.7707999581471086e-05</span>
        <span class="n">STAT</span> <span class="n">match_CastOpCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=0.00010851099796127528</span>
        <span class="n">STAT</span> <span class="n">match_CastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.572900459403172e-05</span>
        <span class="n">STAT</span> <span class="n">match_ClipClipPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.429500793572515e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConcatEmptyPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=0.00015810400145710446</span>
        <span class="n">STAT</span> <span class="n">match_ConcatGatherPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.574100264813751e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConcatReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=4.356499994173646e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConcatTwiceUnaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.9136004741303623e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConstantToInitializerPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.6530997274676338e-05</span>
        <span class="n">STAT</span> <span class="n">match_ConvBiasNullPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.4958993637701496e-05</span>
        <span class="n">STAT</span> <span class="n">match_DropoutPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.546700125094503e-05</span>
        <span class="n">STAT</span> <span class="n">match_ExpandBroadcastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.5968998670578003e-05</span>
        <span class="n">STAT</span> <span class="n">match_ExpandPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=3.154599471599795e-05</span>
        <span class="n">STAT</span> <span class="n">match_ExpandSwapPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.3972999770194292e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionAttentionPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.0630002584075555e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionCausalMaskMulAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=4.394799907458946e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionCausalMaskPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4843997380230576e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionCosSinCachePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.3824999516364187e-05</span>
        <span class="n">STAT</span> <span class="n">match_FunctionHalfRotaryEmbeddingPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.1914998797001317e-05</span>
        <span class="n">STAT</span> <span class="n">match_GathersSplitPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.666400177986361e-05</span>
        <span class="n">STAT</span> <span class="n">match_GeluPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=1.2212000001454726e-05</span>
        <span class="n">STAT</span> <span class="n">match_GemmTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=2 - time=0.00011590500434977002</span>
        <span class="n">STAT</span> <span class="n">match_IdentityPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0006953949996386655</span>
        <span class="n">STAT</span> <span class="n">match_LayerNormalizationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.492399991955608e-05</span>
        <span class="n">STAT</span> <span class="n">match_LayerNormalizationScalePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.8300997655605897e-05</span>
        <span class="n">STAT</span> <span class="n">match_LeakyReluPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0023210289982671384</span>
        <span class="n">STAT</span> <span class="n">match_MatMulAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=4 maxmatch=2 i=2 - time=0.000176045999978669</span>
        <span class="n">STAT</span> <span class="n">match_MatMulReshape2Of3Pattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=7.850399924791418e-05</span>
        <span class="n">STAT</span> <span class="n">match_MulMulMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.013000190956518e-05</span>
        <span class="n">STAT</span> <span class="n">match_MulMulMulScalarPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.237300188629888e-05</span>
        <span class="n">STAT</span> <span class="n">match_RMSNormalizationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.166999547625892e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReduceReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=3.198100966983475e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReduceSumNormalizePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=2.5705994630698115e-05</span>
        <span class="n">STAT</span> <span class="n">match_Reshape2Of3Pattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=7.306599945877679e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapeMatMulReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=6.052800017641857e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=5.495999721460976e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapeReshapeBinaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=0 i=0 - time=7.044999802019447e-05</span>
        <span class="n">STAT</span> <span class="n">match_ReshapeReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.5756005672737956e-05</span>
        <span class="n">STAT</span> <span class="n">match_RotaryConcatPartPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.7976002456853166e-05</span>
        <span class="n">STAT</span> <span class="n">match_RotaryEmbeddingPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.398599826847203e-05</span>
        <span class="n">STAT</span> <span class="n">match_SameChildrenFromInputPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=6.409100024029613e-05</span>
        <span class="n">STAT</span> <span class="n">match_SameChildrenPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=6.586599920410663e-05</span>
        <span class="n">STAT</span> <span class="n">match_SequenceConstructAtPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4834000214468688e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedConcatExpandPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.529100311221555e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedEditDistanceReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=8.721400081412867e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandBroadcastMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.3844996728003025e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandBroadcastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=6.215300163603388e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandCastWhereSwapPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.5191002350766212e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedExpandSwapPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.42980051250197e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedIdentityPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.4486005208455026e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedMatMulToMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.366900222725235e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedReshapeIsSqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.914700548397377e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedSameChildrenPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.2202999136643484e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedShapeShapeAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=7.161500252550468e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapeBasedStaticExpandPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.35950062435586e-05</span>
        <span class="n">STAT</span> <span class="n">match_ShapedBasedReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.958200250053778e-05</span>
        <span class="n">STAT</span> <span class="n">match_SliceSlicePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.23460046981927e-05</span>
        <span class="n">STAT</span> <span class="n">match_SlicesSplitPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4909997591748834e-05</span>
        <span class="n">STAT</span> <span class="n">match_SoftmaxCrossEntropyLossCastPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=0.0015004309971118346</span>
        <span class="n">STAT</span> <span class="n">match_SplitConcatPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.4103999749058858e-05</span>
        <span class="n">STAT</span> <span class="n">match_SqueezeAddPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=8.447399886790663e-05</span>
        <span class="n">STAT</span> <span class="n">match_SqueezeBinaryUnsqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=2.958899858640507e-05</span>
        <span class="n">STAT</span> <span class="n">match_SqueezeUnsqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.006000042660162e-05</span>
        <span class="n">STAT</span> <span class="n">match_StaticConcatReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.225500040571205e-05</span>
        <span class="n">STAT</span> <span class="n">match_Sub1MulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=4.251199425198138e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwapExpandReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.6978999560233206e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwapUnaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=0.00013072099318378605</span>
        <span class="n">STAT</span> <span class="n">match_SwapUnsqueezeTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.626400186680257e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwitchOrderBinaryPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=4.075500328326598e-05</span>
        <span class="n">STAT</span> <span class="n">match_SwitchReshapeActivationPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=6.724299964844249e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeEqualReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=1 - time=6.979100362514146e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeGatherPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=2.968400076497346e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=0.0001584049969096668</span>
        <span class="n">STAT</span> <span class="n">match_TransposeReshapeMatMulPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=5.630300074699335e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeReshapeTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=4.3221996747888625e-05</span>
        <span class="n">STAT</span> <span class="n">match_TransposeTransposePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.9455997466575354e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeEqualPattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=5 maxmatch=2 i=0 - time=2.3594999220222235e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeOrSqueezeReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.2873005693545565e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeReshapePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=3.453499448369257e-05</span>
        <span class="n">STAT</span> <span class="n">match_UnsqueezeUnsqueezePattern</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=2 i=0 - time=2.59629960055463e-05</span>
        <span class="n">STAT</span> <span class="n">order</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=7.185699723777361e-05</span>
        <span class="n">STAT</span> <span class="n">patterns</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=0.014249683998059481</span>
        <span class="n">STAT</span> <span class="n">remove_duplicated_initializer</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=2.700499680940993e-05</span>
        <span class="n">STAT</span> <span class="n">remove_duplicated_shape</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=1.9336002878844738e-05</span>
        <span class="n">STAT</span> <span class="n">remove_identity</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=0.0002735600028245244</span>
        <span class="n">STAT</span> <span class="n">remove_identity_nodes</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0008676460020069499</span>
        <span class="n">STAT</span> <span class="n">remove_unused</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=6 maxmatch=0 i=0 - time=0.0011744490002456587</span>
        <span class="n">STAT</span> <span class="n">shape_order</span> <span class="o">+</span><span class="mi">0</span> <span class="o">-</span><span class="mi">0</span> <span class="c1">#it=0 maxmatch=0 i=0 - time=4.1387000237591565e-05</span>
    <span class="o">--</span><span class="n">MODEL</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">1</span> <span class="n">inputs</span><span class="p">,</span> <span class="mi">1</span> <span class="n">outputs</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="o">--</span>
             <span class="n">INPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span>
         <span class="n">INPUT</span><span class="o">-</span><span class="n">SEQ</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Falset</span>
            <span class="n">OUTPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span>
        <span class="n">OUTPUT</span><span class="o">-</span><span class="n">SEQ</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Falset</span>
              <span class="n">INIT</span><span class="p">:</span>   <span class="mi">4</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span>
              <span class="n">NODE</span><span class="p">:</span>   <span class="mi">2</span> <span class="n">x</span> <span class="n">Gemm</span>
              <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Relu</span>
    <span class="o">--</span><span class="n">MODEL</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">1</span> <span class="n">inputs</span><span class="p">,</span> <span class="mi">1</span> <span class="n">outputs</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="o">--</span><span class="n">DETAILED</span><span class="o">--</span>
         <span class="n">INPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x10</span><span class="p">]</span>
        <span class="n">OUTPUT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x1</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="n">x32</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span>
          <span class="n">INIT</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="n">x10</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Gemm</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x10</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="n">x10</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Gemm</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x32</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="n">x32</span><span class="p">],</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">NODE</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">x</span> <span class="n">Relu</span> <span class="o">-</span><span class="n">SIG</span><span class="o">-</span> <span class="mi">1</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="n">x32</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">]</span> <span class="n">make_model</span> <span class="mi">4</span> <span class="n">inits</span> <span class="mi">0</span> <span class="n">params</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">time_evaluation_constants_</span><span class="p">]</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="n">large_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">external_threshold</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">switch</span> <span class="n">low</span><span class="o">/</span><span class="n">high</span> <span class="n">order</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">TensorProto</span><span class="o">-</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span><span class="mi">1</span><span class="p">[(</span><span class="mi">32</span><span class="p">,)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">TensorProto</span><span class="o">-</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">:</span><span class="mi">1</span><span class="p">[(</span><span class="mi">1</span><span class="p">,)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;-</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">])]</span>
    <span class="p">[</span><span class="n">proto_from_array</span><span class="p">]</span> <span class="mi">1</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">])]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">ndarray</span><span class="o">&gt;-</span><span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">:</span><span class="n">float32</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">done</span> <span class="ow">in</span> <span class="mf">1.086002157535404e-06</span><span class="n">s</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">0</span> <span class="n">large</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBG</span><span class="o">.</span><span class="n">_add_shape_information</span><span class="p">]</span> <span class="n">dynamic</span> <span class="n">shapes</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}</span>
</pre></div>
</div>
</section>
<section id="select-the-pattern-to-use">
<h3>Select the pattern to use<a class="headerlink" href="#select-the-pattern-to-use" title="Link to this heading"></a></h3>
<p>Class <a class="reference internal" href="../api/xbuilder/index.html#experimental_experiment.xbuilder.OptimizationOptions" title="experimental_experiment.xbuilder.OptimizationOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizationOptions</span></code></a>
is used to enable or disable patterns.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span>
        <span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;TransposeTranspose,TransposeMatMul&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">2</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">2</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.001</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">ALGO</span><span class="o">-</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">random_order</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">shape_order</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="ow">in</span> <span class="mf">8.266300210379995e-05</span><span class="n">s</span> <span class="k">with</span> <span class="n">changed</span><span class="o">=</span><span class="mi">0</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">MHS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.002</span>
</pre></div>
</div>
<p>There exists some predefined lists of patterns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code>: includes all patterns using only standard onnx patterns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onnxruntime</span></code>: patterns specific to <a class="reference external" href="https://onnxruntime.ai/">onnxruntime</a>, the final model
may be executed by onnxruntime and possibly only onnxruntime as it may
introduce patterns from <a class="reference external" href="https://github.com/microsoft/onnxruntime/blob/main/docs/OperatorKernels.md">Supported Operators and Data Types</a>.</p></li>
</ul>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default+onnxruntime&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=110</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">110</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">40</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">same</span> <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SameChildrenFromInputPattern&#39;</span><span class="p">,</span> <span class="s1">&#39;SameChildrenPattern&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">1</span> <span class="n">matches</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">7</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.013</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">ALGO</span><span class="o">-</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">random_order</span><span class="p">]</span> <span class="o">--</span> <span class="n">starts</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">OrderOptimization</span><span class="o">.</span><span class="n">shape_order</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="ow">in</span> <span class="mf">3.197399928467348e-05</span><span class="n">s</span> <span class="k">with</span> <span class="n">changed</span><span class="o">=</span><span class="mi">0</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">IWE</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.014</span>
</pre></div>
</div>
</section>
<section id="statistics">
<h3>Statistics<a class="headerlink" href="#statistics" title="Link to this heading"></a></h3>
<p>This can be used to see when a pattern is applied and how long it takes.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stat</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                  <span class="n">pattern</span>  <span class="n">removed</span>  <span class="o">...</span>  <span class="n">scale</span>  <span class="n">algo</span>
    <span class="mi">0</span>            <span class="n">dynamic_dimension_naming</span>      <span class="mf">0.0</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="mi">1</span>    <span class="n">check_A</span><span class="o">-</span><span class="n">dynamic_dimension_naming</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="mi">2</span>                     <span class="n">check_A</span><span class="o">-</span><span class="n">opt</span><span class="o">-</span><span class="n">sub</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="mi">3</span>                     <span class="n">remove_identity</span>      <span class="mf">0.0</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="mi">4</span>             <span class="n">check_remove_identity</span><span class="o">-</span><span class="mi">0</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="o">..</span>                                <span class="o">...</span>      <span class="o">...</span>  <span class="o">...</span>    <span class="o">...</span>   <span class="o">...</span>
    <span class="mi">558</span>                      <span class="n">check_orderL</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="mi">559</span>                       <span class="n">shape_order</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="mf">0.0</span>   <span class="n">NaN</span>
    <span class="mi">560</span>                             <span class="n">order</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="n">NaN</span>     <span class="mi">2</span>
    <span class="mi">561</span>                    <span class="n">check_order</span><span class="o">-</span><span class="mi">12</span>      <span class="n">NaN</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    <span class="mi">562</span>                      <span class="n">optimization</span>      <span class="mf">2.0</span>  <span class="o">...</span>    <span class="n">NaN</span>   <span class="n">NaN</span>
    
    <span class="p">[</span><span class="mi">563</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">13</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>It can be aggregated:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">experimental_experiment.xbuilder</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s2">&quot;exit_point&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">aggs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;time_in&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;added&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;removed&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;match_index&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggs</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                         <span class="n">time_in</span>  <span class="o">...</span>  <span class="n">instances</span>
    <span class="n">pattern</span>                                       <span class="o">...</span>           
    <span class="n">apply_GemmTransposePattern</span>          <span class="mf">0.000327</span>  <span class="o">...</span>          <span class="mi">2</span>
    <span class="n">apply_MatMulAddPattern</span>              <span class="mf">0.000203</span>  <span class="o">...</span>          <span class="mi">2</span>
    <span class="n">apply_TransposeEqualReshapePattern</span>  <span class="mf">0.000293</span>  <span class="o">...</span>          <span class="mi">1</span>
    <span class="n">apply_constant_folding__Reshape</span>     <span class="mf">0.000000</span>  <span class="o">...</span>          <span class="mi">0</span>
    <span class="n">apply_constant_folding__Transpose</span>   <span class="mf">0.000000</span>  <span class="o">...</span>          <span class="mi">0</span>
    <span class="o">...</span>                                      <span class="o">...</span>  <span class="o">...</span>        <span class="o">...</span>
    <span class="n">remove_duplicated_shape</span>             <span class="mf">0.000014</span>  <span class="o">...</span>          <span class="mi">0</span>
    <span class="n">remove_identity</span>                     <span class="mf">0.000234</span>  <span class="o">...</span>          <span class="mi">0</span>
    <span class="n">remove_identity_nodes</span>               <span class="mf">0.000610</span>  <span class="o">...</span>          <span class="mi">0</span>
    <span class="n">remove_unused</span>                       <span class="mf">0.000840</span>  <span class="o">...</span>          <span class="mi">0</span>
    <span class="n">shape_order</span>                         <span class="mf">0.000033</span>  <span class="o">...</span>          <span class="mi">0</span>
    
    <span class="p">[</span><span class="mi">131</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">6</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="shape-inference">
<h2>Shape inference<a class="headerlink" href="#shape-inference" title="Link to this heading"></a></h2>
<p>The optimizers require to know the shapes to ensure they can rewrite
some nodes and avoid producing a model which does not return the
same results. If it is missing, some patterns cannot match for sure
and they will not match.</p>
<p>This information can be built by running shape inference
on the onnx models. Thats what is done is the previous examples.
However, the best case is when this information comes from torch.</p>
<p>Function <a class="reference internal" href="../api/torch_interpreter/index.html#experimental_experiment.torch_interpreter.to_onnx" title="experimental_experiment.torch_interpreter.to_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_onnx</span></code></a>
converts a torch model into ONNX. While doing so, it stores the shape
information coming from torch. There is no need to run shape inference
on the onnx model it generates before optimizing it.</p>
</section>
<section id="available-patterns-and-api">
<h2>Available Patterns and API<a class="headerlink" href="#available-patterns-and-api" title="Link to this heading"></a></h2>
<p>All patterns may be found at <a class="reference internal" href="../api/xoptim/patterns/index.html#l-pattern-optimization-onnx"><span class="std std-ref">.xoptim.patterns</span></a>
and <a class="reference internal" href="../api/xoptim/patterns_ort/index.html#l-pattern-optimization-ort"><span class="std std-ref">.xoptim.patterns_ort</span></a>.</p>
<p>When writing a pattern, walking along the graph or checking the shape
is very common. Class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>
provides the following methods.</p>
<section id="opsets">
<h3>Opsets<a class="headerlink" href="#opsets" title="Link to this heading"></a></h3>
<p>Patterns must rewrite using the nodes of the opset defined in the model.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.main_opset" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.main_opset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">main_opset</span></code></a>: returns the opset</p></li>
</ul>
</section>
<section id="shapes-types">
<h3>Shapes, Types<a class="headerlink" href="#shapes-types" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_type</span></code></a>: tells if a result type is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_type</span></code></a>: returns a result type, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_shape</span></code></a>: tells if a result shape is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_shape</span></code></a>: returns a result shape, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_rank" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_rank</span></code></a>: tells if a result rank is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_rank" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_rank</span></code></a>: returns a result rank, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_infer_type</span></code></a>: returns a type if it can be guessed</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_infer_shape</span></code></a>: returns a shape if it can be guessed</p></li>
</ul>
</section>
<section id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_constant</span></code></a>:
tells if a node is a constant (it may be a constant, an initializer or any value built on other constants)</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant_scalar" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant_scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_constant_scalar</span></code></a>:
checks a constant is a scalar and compares its value to a number</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_computed_constant" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_computed_constant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_computed_constant</span></code></a>:
returns the constant, computes it is a constant built from other constants</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_attribute" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_attribute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_attribute</span></code></a>:
returns an attribute of a node</p></li>
</ul>
</section>
<section id="graph">
<h3>Graph<a class="headerlink" href="#graph" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_node" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">next_node</span></code></a>:
returns the next node only if there is only one</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_nodes" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_nodes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">next_nodes</span></code></a>:
returns the node consuming this result</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.node_before" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.node_before"><code class="xref py py-meth docutils literal notranslate"><span class="pre">node_before</span></code></a>:
returns the node producing the result</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_output" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_output"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_output</span></code></a>:
tells if a result is an output</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_by_subgraph" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_by_subgraph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_by_subgraph</span></code></a>:
tells if a result is used by a subgraph</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_more_than_once" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_more_than_once"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_more_than_once</span></code></a>:
tells if a result is used more than once</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_only_by" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_only_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_only_by</span></code></a>:
tells if a result is only used by specific nodes</p></li>
</ul>
</section>
<section id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_node</span></code></a>:
creates a node without adding it to the graph</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node_check_opset" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node_check_opset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_node_check_opset</span></code></a>:
creates a node without adding it to the graph, deals with some constraints
related to opset version</p></li>
</ul>
</section>
</section>
<section id="examples-or-tools">
<h2>Examples or Tools<a class="headerlink" href="#examples-or-tools" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../auto_examples/plot_rewrite_101.html#l-plot-rewrite-101"><span class="std std-ref">101: Onnx Model Rewriting</span></a></p></li>
<li><p><a class="reference internal" href="../auto_examples/plot_optimize_101.html#l-plot-optimize-101"><span class="std std-ref">101: Onnx Model Optimization based on Pattern Rewriting</span></a></p></li>
<li><p><a class="reference internal" href="../auto_examples/plot_model_to_python.html#l-plot-model-to-code"><span class="std std-ref">Playground for big optimization pattern</span></a></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="backends.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Dynamo Backends</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="exporter.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Custom Exporter</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Pattern Optimizer</a><ul>
<li><a class="reference internal" href="#patterns">Patterns</a><ul>
<li><a class="reference internal" href="#patternoptimization-match">PatternOptimization.match</a></li>
<li><a class="reference internal" href="#patternoptimization-apply">PatternOptimization.apply</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimization-algorithm">Optimization Algorithm</a></li>
<li><a class="reference internal" href="#adding-a-pattern">Adding a pattern</a></li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#simple-api">Simple API</a></li>
<li><a class="reference internal" href="#verbosity">Verbosity</a></li>
<li><a class="reference internal" href="#select-the-pattern-to-use">Select the pattern to use</a></li>
<li><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shape-inference">Shape inference</a></li>
<li><a class="reference internal" href="#available-patterns-and-api">Available Patterns and API</a><ul>
<li><a class="reference internal" href="#opsets">Opsets</a></li>
<li><a class="reference internal" href="#shapes-types">Shapes, Types</a></li>
<li><a class="reference internal" href="#constants">Constants</a></li>
<li><a class="reference internal" href="#graph">Graph</a></li>
<li><a class="reference internal" href="#nodes">Nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples-or-tools">Examples or Tools</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=b617ff6d"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>