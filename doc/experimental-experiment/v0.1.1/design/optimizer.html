<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Dynamo Backends" href="backends.html"><link rel="prev" title="Custom Exporter" href="exporter.html">
        <link rel="prefetch" href="../_static/logo.png" as="image">

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.09.25 -->
        <title>Pattern Optimizer - experimental-experiment 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">experimental-experiment 0.1.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">experimental-experiment 0.1.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design</a><input aria-label="Toggle navigation of Design" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="exporter.html">Custom Exporter</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Pattern Optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="backends.html">Dynamo Backends</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><input aria-label="Toggle navigation of Tutorial" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/shape.html">ShapeBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/to_onnx.html">to_onnx: another export to investigate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/errors.html">Unexpected Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/docker.html">Start from a docker</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API</a><input aria-label="Toggle navigation of API" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/gradient/index.html">.gradient</a><input aria-label="Toggle navigation of .gradient" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/gradient/ops/index.html">.gradient.ops</a><input aria-label="Toggle navigation of .gradient.ops" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/gradient/ops/op_broadcast_gradient_args.html">.gradient.ops.op_broadcast_gradient_args</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/gradient/grad_helper.html">.gradient.grad_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/gradient/loss_helper.html">.gradient.loss_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/reference/index.html">.reference</a><input aria-label="Toggle navigation of .reference" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/reference/ops/index.html">.reference.ops</a><input aria-label="Toggle navigation of .reference.ops" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_add_add_mul_mul.html">.reference.ops.op_add_add_mul_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_average_pool_grad.html">.reference.ops.op_average_pool_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_cast_like.html">.reference.ops.op_cast_like</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_complex.html">.reference.ops.op_complex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_concat.html">.reference.ops.op_concat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_constant_of_shape.html">.reference.ops.op_constant_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_fused_matmul.html">.reference.ops.op_fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_gather_grad.html">.reference.ops.op_gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_memcpy_host.html">.reference.ops.op_memcpy_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_mul_sigmoid.html">.reference.ops.op_mul_sigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_negxplus1.html">.reference.ops.op_negxplus1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_quick_gelu.html">.reference.ops.op_quick_gelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_replace_zero.html">.reference.ops.op_replace_zero</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_rotary.html">.reference.ops.op_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_qlinear_average_pool.html">.reference.ops.op_qlinear_average_pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_qlinear_conv.html">.reference.ops.op_qlinear_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatter_elements.html">.reference.ops.op_scatter_elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatternd_of_shape.html">.reference.ops.op_scatternd_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_simplified_layer_normalization.html">.reference.ops.op_simplified_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_skip_layer_normalization.html">.reference.ops.op_skip_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_slice.html">.reference.ops.op_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_transpose_cast.html">.reference.ops.op_transpose_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_tri_matrix.html">.reference.ops.op_tri_matrix</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/evaluator.html">.reference.evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/ort_evaluator.html">.reference.ort_evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/quantized_tensor.html">.reference.quantized_tensor</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/convert/index.html">.convert</a><input aria-label="Toggle navigation of .convert" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/convert/convert_helper.html">.convert.convert_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/convert/ort_helper.html">.convert.ort_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/plotting/index.html">.plotting</a><input aria-label="Toggle navigation of .plotting" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/plotting/data.html">.plotting.data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/plotting/memory.html">.plotting.memory</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/skl/index.html">.skl</a><input aria-label="Toggle navigation of .skl" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/skl/convert.html">.skl.convert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/skl/helpers.html">.skl.helpers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_interpreter/index.html">.torch_interpreter</a><input aria-label="Toggle navigation of .torch_interpreter" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_functions.html">.torch_interpreter._aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_functions_attention.html">.torch_interpreter._aten_functions_attention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_non_aten_functions.html">.torch_interpreter._non_aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_aten_methods.html">.torch_interpreter._aten_methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_doc_.html">.torch_interpreter._doc_</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_exceptions.html">.torch_interpreter._exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_prims_functions.html">.torch_interpreter._prims_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/_torch_helper.html">.torch_interpreter._torch_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/aten_functions.html">.torch_interpreter.aten_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/aten_methods.html">.torch_interpreter.aten_methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/dispatcher.html">.torch_interpreter.dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/export_options.html">.torch_interpreter.export_options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/interpreter.html">.torch_interpreter.interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/investigate_helper.html">.torch_interpreter.investigate_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/onnx_export.html">.torch_interpreter.onnx_export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/oxs_dispatcher.html">.torch_interpreter.oxs_dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/oxs_opset.html">.torch_interpreter.oxs_opset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/piece_by_piece.html">.torch_interpreter.piece_by_piece</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/piece_by_piece_serialize.html">.torch_interpreter.piece_by_piece_serialize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_interpreter/tracing.html">.torch_interpreter.tracing</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_models/index.html">.torch_models</a><input aria-label="Toggle navigation of .torch_models" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/diffusion_model_helper.html">.torch_models.diffusion_model_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/dump_helper.html">.torch_models.dump_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/llama_helper.html">.torch_models.llama_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/llm_model_helper.html">.torch_models.llm_model_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/llm_model_setup.html">.torch_models.llm_model_setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/mistral_helper.html">.torch_models.mistral_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/phi3_helper.html">.torch_models.phi3_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/phi_helper.html">.torch_models.phi_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/training_helper.html">.torch_models.training_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xbuilder/index.html">.xbuilder</a><input aria-label="Toggle navigation of .xbuilder" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/_onnx_helper.html">.xbuilder._onnx_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/graph_builder.html">.xbuilder.graph_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/graph_builder_opset.html">.xbuilder.graph_builder_opset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/model_container.html">.xbuilder.model_container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/optimization_options.html">.xbuilder.optimization_options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xbuilder/reverse_graph_builder.html">.xbuilder.reverse_graph_builder</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xoptim/index.html">.xoptim</a><input aria-label="Toggle navigation of .xoptim" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_investigation/index.html">.xoptim.patterns_investigation</a><input aria-label="Toggle navigation of .xoptim.patterns_investigation" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_investigation/element_wise.html">.xoptim.patterns_investigation.element_wise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_investigation/llm_patterns.html">.xoptim.patterns_investigation.llm_patterns</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_ml/index.html">.xoptim.patterns_ml</a><input aria-label="Toggle navigation of .xoptim.patterns_ml" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ml/tree_ensemble.html">.xoptim.patterns_ml.tree_ensemble</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_exp/index.html">.xoptim.patterns_exp</a><input aria-label="Toggle navigation of .xoptim.patterns_exp" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/binary_operators.html">.xoptim.patterns_exp.binary_operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/constant_of_shape_scatter_nd.html">.xoptim.patterns_exp.constant_of_shape_scatter_nd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/constants.html">.xoptim.patterns_exp.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/simple_rotary.html">.xoptim.patterns_exp.simple_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/unary_operators.html">.xoptim.patterns_exp.unary_operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_exp/where_replace.html">.xoptim.patterns_exp.where_replace</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns/index.html">.xoptim.patterns</a><input aria-label="Toggle navigation of .xoptim.patterns" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_any.html">.xoptim.patterns.onnx_any</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_attention.html">.xoptim.patterns.onnx_attention</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_cast.html">.xoptim.patterns.onnx_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_clip.html">.xoptim.patterns.onnx_clip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_constants.html">.xoptim.patterns.onnx_constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_conv.html">.xoptim.patterns.onnx_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_dropout.html">.xoptim.patterns.onnx_dropout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_equal.html">.xoptim.patterns.onnx_equal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_expand.html">.xoptim.patterns.onnx_expand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_functions.html">.xoptim.patterns.onnx_functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_layer_normalization.html">.xoptim.patterns.onnx_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_matmul.html">.xoptim.patterns.onnx_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_mul.html">.xoptim.patterns.onnx_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_reduce.html">.xoptim.patterns.onnx_reduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_reshape.html">.xoptim.patterns.onnx_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_rotary.html">.xoptim.patterns.onnx_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_shape.html">.xoptim.patterns.onnx_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_slice.html">.xoptim.patterns.onnx_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_split.html">.xoptim.patterns.onnx_split</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_sub.html">.xoptim.patterns.onnx_sub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_sequence.html">.xoptim.patterns.onnx_sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_transpose.html">.xoptim.patterns.onnx_transpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns/onnx_unsqueeze.html">.xoptim.patterns.onnx_unsqueeze</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_ort/index.html">.xoptim.patterns_ort</a><input aria-label="Toggle navigation of .xoptim.patterns_ort" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/activation.html">.xoptim.patterns_ort.activation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/activation_grad.html">.xoptim.patterns_ort.activation_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/batch_normalization.html">.xoptim.patterns_ort.batch_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/fused_conv.html">.xoptim.patterns_ort.fused_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/fused_matmul.html">.xoptim.patterns_ort.fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/gather_grad.html">.xoptim.patterns_ort.gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/llm_optim.html">.xoptim.patterns_ort.llm_optim</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_ort/simplified_layer_normalization.html">.xoptim.patterns_ort.simplified_layer_normalization</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/xoptim/patterns_fix/index.html">.xoptim.patterns_fix</a><input aria-label="Toggle navigation of .xoptim.patterns_fix" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/xoptim/patterns_fix/add_reduction_scatter_nd.html">.xoptim.patterns_fix.add_reduction_scatter_nd</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/graph_builder_optim.html">.xoptim.graph_builder_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/order_optim.html">.xoptim.order_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/patterns_api.html">.xoptim.patterns_api</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/repeated_optim.html">.xoptim.repeated_optim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xoptim/unfused.html">.xoptim.unfused</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/xshape/index.html">.xshape</a><input aria-label="Toggle navigation of .xshape" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/evaluate_expressions.html">.xshape.evaluate_expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/rename_expressions.html">.xshape.rename_expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_builder_runtime.html">.xshape._builder_runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_shape_runtime.html">.xshape._shape_runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_shape_helper.html">.xbuilder._shape_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/_onnx_helper.html">.xshape._onnx_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/shape_builder.html">.xshape.shape_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/shape_builder_impl.html">.xshape.shape_builder_impl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/shape_type_compute.html">.xshape.shape_type_compute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/xshape/type_inference.html">.xshape.type_inference</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_dynamo/index.html">.torch_dynamo</a><input aria-label="Toggle navigation of .torch_dynamo" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/_dynamo_exporter.html">.torch_dynamo._dynamo_exporter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/backend_helper.html">.torch_dynamo.backend_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/debug_backend.html">.torch_dynamo.debug_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/fast_backend.html">.torch_dynamo.fast_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_dynamo/partition.html">experimental_experiment.torch_dynamo.partition</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_bench/index.html">.torch_bench</a><input aria-label="Toggle navigation of .torch_bench" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner_agg.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner_agg</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_benchmark_runner_agg_helper.html">experimental_experiment.torch_bench._bash_bench_benchmark_runner_agg_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_cmd.html">experimental_experiment.torch_bench._bash_bench_cmd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_model_runner.html">experimental_experiment.torch_bench._bash_bench_model_runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_models_helper.html">experimental_experiment.torch_bench._bash_bench_models_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_dummies.html">experimental_experiment.torch_bench._bash_bench_set_dummies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_explicit.html">experimental_experiment.torch_bench._bash_bench_set_explicit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_huggingface.html">experimental_experiment.torch_bench._bash_bench_set_huggingface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_timm.html">experimental_experiment.torch_bench._bash_bench_set_timm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_torchbench.html">experimental_experiment.torch_bench._bash_bench_set_torchbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_set_torchbench_ado.html">experimental_experiment.torch_bench._bash_bench_set_torchbench_ado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_bash_bench_untrained.html">experimental_experiment.torch_bench._bash_bench_untrained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_dort_cmd_common.html">experimental_experiment.torch_bench._dort_cmd_common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/_dort_cmd_common_models.html">experimental_experiment.torch_bench._dort_cmd_common_models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_agg.html">.torch_bench.bash_bench_agg</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_explicit.html">.torch_bench.bash_bench_explicit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_huggingface.html">.torch_bench.bash_bench_huggingface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_timm.html">.torch_bench.bash_bench_timm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_torchbench.html">.torch_bench.bash_bench_torchbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_torchbench_ado.html">.torch_bench.bash_bench_torchbench_ado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/bash_bench_untrained.html">.torch_bench.bash_bench_untrained</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/check_model.html">.torch_bench.check_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/dort_bench.html">.torch_bench.dort_bench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/dort_bench_profile.html">.torch_bench.dort_bench_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/dort_profile.html">.torch_bench.dort_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/export_model.html">.torch_bench.export_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_bench/export_model_helper.html">.torch_bench.export_model_helper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/_bench_test.html">._bench_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/_command_lines_parser.html">._command_lines_parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/args.html">.args</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/bench_run.html">.bench_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/checks.html">.checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/export_helpers.html">.export_helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ext_test_case.html">.ext_test_case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/helpers.html">.helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/memory_peak.html">.memory_peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/model_run.html">.model_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/onnx_tools.html">.onnx_tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ort_session.html">.ort_session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/torch_test_helper.html">.torch_test_helper</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../galleries.html">Galleries of Examples and Recipes</a><input aria-label="Toggle navigation of Galleries of Examples and Recipes" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a><input aria-label="Toggle navigation of Examples Gallery" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_custom_backend_101.html">101: A custom backend for torch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_linreg_101.html">101: Linear Regression and export to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_optimize_101.html">101: Onnx Model Optimization based on Pattern Rewriting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_rewrite_101.html">101: Onnx Model Rewriting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_profile_existing_onnx_101.html">101: Profile an existing model with onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_101.html">101: Some dummy examples with torch.export.export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_onnxscript_102.html">102: Examples with onnxscript</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_executorch_102.html">102: First test with ExecuTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_compile_102.html">102: Tweak onnx export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_shape_inference.html">201: Better shape inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_export_201.html">201: Evaluate different ways to export a torch model to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_torch_sklearn_201.html">201: Use torch to export a scikit-learn model into ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_model_to_python.html">Playground for big optimization pattern</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_recipes/index.html">Exporter Recipes Gallery</a><input aria-label="Toggle navigation of Exporter Recipes Gallery" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_untrained_tinyllm.html">Check the exporter on a dummy from HuggingFace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_phi35_piece.html">Export Phi-3.5-mini-instruct piece by piece</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_draft_mode.html">Export Phi-3.5-mini-instruct with draft_export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_reportibility.html">Export Phi-3.5-mini-instruct with report_exportability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_exporter_scan_pdist.html">Export a model with a loop (scan)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_custom_ops_inplace.html">to_onnx and a custom operator inplace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_custom_ops_fct.html">to_onnx and a custom operator registered with a function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_cond.html">to_onnx and a model with a test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_dynpad.html">to_onnx and padding one dimension to a mulitple of a constant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_recipes/plot_exporter_recipes_c_modules.html">to_onnx and submodules from LLMs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../command_lines.html">Command Lines</a><input aria-label="Toggle navigation of Command Lines" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../bench/index.html">Benchmarks from the command line</a><input aria-label="Toggle navigation of Benchmarks from the command line" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../bench/dort_bench.html">experimental_experiment.torch_bench.dort_bench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/dort_profile.html">experimental_experiment.torch_bench.dort_profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/scripts.html">Interesting scripts or command lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bench/bash_bench.html">Measuring the exporters on a short list of sets of models</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tools/index.html">Tools from the command line</a><input aria-label="Toggle navigation of Tools from the command line" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/lighten.html">python -m experimental_experiment lighten and unlighten</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/optimize.html">python -m experimental_experiment optimize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/print.html">python -m experimental_experiment print</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/run.html">python -m experimental_experiment run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a><input aria-label="Toggle navigation of Miscellaneous" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous/export_times.html">Export Times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous/long_outputs.html">Long Outputs uneasy to read</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../miscellaneous/models/index.html">Supported Models By the Custom Backend</a><input aria-label="Toggle navigation of Supported Models By the Custom Backend" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous/models/phi.html">Phi</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/design/optimizer.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="pattern-optimizer">
<span id="l-design-pattern-optimizer"></span><h1>Pattern Optimizer<a class="headerlink" href="#pattern-optimizer" title="Link to this heading">¶</a></h1>
<p>The pattern optimizer is implemented by class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>.
It searches for a specific sequence of nodes in the graph and
replaces it by another one without changing the inputs or the long_outputs
of the graph. The goal of the optimizer is to make the whole computation
graph more efficient. The goal of this implementation is to make this
optimization as fast as possible.
Assuming the nodes in an onnx graph are ordered in a way every input of a
node was created by previous nodes, the optimizer must not require
any global reordering. The cost should be in <img class="math" src="../_images/math/ee2fa8e8c79fa606e3168c3d6332beb096b05426.svg" alt="O(N P I)"/> in the worst
case where <em>N</em> is the number of nodes, <em>P</em> is the number of patterns,
<em>I</em> is the number of iterations.</p>
<p>It is difficult to foresee what a pattern needs in order to rewrite a part
of the graph. This API tries to give as much freedom as it can without
leaving too much to do to the developper which tries to add a new pattern.</p>
<section id="patterns">
<h2>Patterns<a class="headerlink" href="#patterns" title="Link to this heading">¶</a></h2>
<p>Patterns must inherit from <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.PatternOptimization" title="experimental_experiment.xoptim.PatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">PatternOptimization</span></code></a>.
This class defines two methods.</p>
<section id="patternoptimization-match">
<h3>PatternOptimization.match<a class="headerlink" href="#patternoptimization-match" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">match</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">g</span><span class="p">:</span> <span class="s2">&quot;GraphBuilderPatternOptimization&quot;</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">NodeProto</span><span class="p">,</span>
    <span class="n">matched</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">]:</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code> is a <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>,
it holds all the existing nodes, is able to return any information
about type, shape, the node before, the node after another one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code>: the matching must determine if some nodes around this one
are part of set of nodes this pattern optimizer can rewrite.
From there, the function explores wherever it needs,
checking any condition it needs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matched</span></code>: usually unused, it returns of nodes already matching
a pattern</p></li>
</ul>
<p>The method must not modify the graph.
The method returns None if no match is found or an instance of class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.MatchResult" title="experimental_experiment.xoptim.MatchResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatchResult</span></code></a>. It must contain:</p>
<ul class="simple">
<li><p>a list of nodes involved in the rewriting. It does not mean all of them will be
removed but all of them are needed to do the rewriting and must
not be impacted by other pattern optimizer.</p></li>
<li><p>A function doing the rewriting (usually method <em>apply</em> of the pattern class).</p></li>
<li><p>An existing node where the rewritten nodes can be inserted.
Knowing it makes it faster to rewriter. If not specified, the optimizer
will automatically determine the position of the new nodes.</p></li>
</ul>
<p><em>Debugging: method none</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">none</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lineno</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
</pre></div>
</div>
<p>It may be useful which reason made a pattern matching fail.
Instead of returning None, method <em>match</em> can return the following
expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">none</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
</pre></div>
</div>
<p>By setting the verbosity (see next Section), the user may then know
which lines in the code returned None and which condition failed.</p>
</section>
<section id="patternoptimization-apply">
<h3>PatternOptimization.apply<a class="headerlink" href="#patternoptimization-apply" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="s2">&quot;GraphBuilder&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">nodes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeProto</span><span class="p">]:</span>
</pre></div>
</div>
<p>The method does the rewriting. It assumes it can happen.
It takes a list of nodes impacted by the rewriting. It assumes no other
pattern optimizer modified them or will modify them.
It receives the list of nodes
returned by method <em>apply</em>. Since it is a list of argument, method
<em>match</em> can include None values. The method returns the new nodes.
The optimizer considers that any node given to this function is removed
from the graph, and any node returned by it are added.
If a received node must be kept, it must be added to the list of returned node.</p>
</section>
</section>
<section id="optimization-algorithm">
<h2>Optimization Algorithm<a class="headerlink" href="#optimization-algorithm" title="Link to this heading">¶</a></h2>
<p>It is implemented in method <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.optimize" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.optimize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimize</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">remove_identity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</pre></div>
</div>
<p>The algorithm runs multiple iteration until the graph is not evolving
or <cite>max_iter</cite> is reached. By default, it is equal to the number of nodes.
An iteration is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">builds</span> <span class="nb">all</span> <span class="n">successors</span> <span class="ow">and</span> <span class="n">predecessors</span>

<span class="c1"># Step 1: match</span>

<span class="k">for</span> <span class="nb">all</span> <span class="n">patterns</span> <span class="n">P</span><span class="p">:</span>

    <span class="k">for</span> <span class="nb">all</span> <span class="n">nodes</span> <span class="n">n</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">no</span> <span class="n">node</span> <span class="n">already</span> <span class="n">scheduled</span> <span class="n">to</span> <span class="n">be</span> <span class="n">rewritten</span> <span class="n">by</span> <span class="n">another</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c1"># Step 2: apply</span>

<span class="k">for</span> <span class="nb">all</span> <span class="n">matches</span> <span class="n">r</span><span class="p">:</span>
    <span class="n">apply</span> <span class="n">the</span> <span class="n">match</span> <span class="n">r</span>

<span class="c1"># Step 3: clean</span>

<span class="n">remove</span> <span class="n">unused</span> <span class="n">nodes</span>
<span class="n">remove</span> <span class="n">identity</span> <span class="n">nodes</span>
</pre></div>
</div>
<p>This algorithm may apply more than one rewriting at each iteration
but it guarantees the local structure when applying the rewriting was
not altered by another one.</p>
</section>
<section id="adding-a-pattern">
<h2>Adding a pattern<a class="headerlink" href="#adding-a-pattern" title="Link to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://github.com/sdpython/experimental-experiment/pull/80">#80</a> about the addition of a new pattern.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<section id="simple-api">
<h3>Simple API<a class="headerlink" href="#simple-api" title="Link to this heading">¶</a></h3>
<p>We consider the following simple model:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.helpers</span> <span class="kn">import</span> <span class="n">pretty_onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">OptimizationOptions</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.torch_interpreter</span> <span class="kn">import</span> <span class="n">to_onnx</span>


<span class="k">class</span> <span class="nc">MLP</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">onx</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">MLP</span><span class="p">(),</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pretty_onnx</span><span class="p">(</span><span class="n">onx</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">18</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;p_layers_0_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>       <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">p_layers_0_weight</span><span class="p">)</span><span class="c1">##p_layers_0_weight/DynamoInterpret.placeholder.1/P(layers.0.weight)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;p_layers_2_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>        <span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">p_layers_2_weight</span><span class="p">)</span><span class="c1">##p_layers_2_weight/DynamoInterpret.placeholder.1/P(layers.2.weight)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                   <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.11</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span><span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">MatMul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_x</span>
      <span class="n">Add</span><span class="p">(</span><span class="n">_onx_matmul_x</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">linear</span>
        <span class="n">Relu</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relu</span>
          <span class="n">MatMul</span><span class="p">(</span><span class="n">relu</span><span class="p">,</span> <span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_onx_matmul_relu</span>
            <span class="n">Add</span><span class="p">(</span><span class="n">_onx_matmul_relu</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">output_0</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;output_0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Which we can renders as follows:</p>
<div class="graphviz"><img src="../_images/graphviz-17ee9e314faa43a839344edbd487386591061d5d.png" alt="digraph{
  orientation=portrait;
  ranksep=0.25;
  size=7;
  nodesep=0.05;

  x [shape=box color=red label=&quot;x\nTensorProto.FLOAT\nshape=[3, 10]&quot; fontsize=10];

  output_0 [shape=box color=green label=&quot;output_0\nTensorProto.FLOAT\nshape=[3, 1]&quot; fontsize=10];

  p_layers_0_weight____T10 [shape=box label=&quot;p_layers_0_weight____T10\nfloat32((10, 32))\n[[-0.277  0.028  0.051 -0.123  0.283  0.057 -0.127...&quot; fontsize=10];
  p_layers_2_weight____T10 [shape=box label=&quot;p_layers_2_weight____T10\nfloat32((32, 1))\n[[ 0.099]\n [ 0.125]\n [ 0.033]\n [ 0.06 ]\n [-0.082]\n...&quot; fontsize=10];
  layers_0_bias [shape=box label=&quot;layers_0_bias\nfloat32((32,))\n[-0.102  0.029  0.228 -0.291  0.076  0.077  0.047 ...&quot; fontsize=10];
  layers_2_bias [shape=box label=&quot;layers_2_bias\nfloat32((1,))\n[0.11]&quot; fontsize=10];

  _onx_matmul_x [shape=box label=&quot;_onx_matmul_x&quot; fontsize=10];
  Opset [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;MatMul&quot; fontsize=10];
  x -&gt; Opset;
  p_layers_0_weight____T10 -&gt; Opset;
  Opset -&gt; _onx_matmul_x;

  linear [shape=box label=&quot;linear&quot; fontsize=10];
  Opset2 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Add&quot; fontsize=10];
  _onx_matmul_x -&gt; Opset2;
  layers_0_bias -&gt; Opset2;
  Opset2 -&gt; linear;

  relu [shape=box label=&quot;relu&quot; fontsize=10];
  relu [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Relu&quot; fontsize=10];
  linear -&gt; relu;
  relu -&gt; relu;

  _onx_matmul_relu [shape=box label=&quot;_onx_matmul_relu&quot; fontsize=10];
  Opset3 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;MatMul&quot; fontsize=10];
  relu -&gt; Opset3;
  p_layers_2_weight____T10 -&gt; Opset3;
  Opset3 -&gt; _onx_matmul_relu;

  Opset4 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Add&quot; fontsize=10];
  _onx_matmul_relu -&gt; Opset4;
  layers_2_bias -&gt; Opset4;
  Opset4 -&gt; output_0;
}" class="graphviz" /></div>
<p>We then apply the optimizations by writing the following code:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.helpers</span> <span class="kn">import</span> <span class="n">pretty_onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="c1"># The model is placed in a GraphBuilder.</span>
<span class="c1"># It creates dictionnaires to store shapes, ranks, types</span>
<span class="c1"># to make it easier to the optimizers to find the information</span>
<span class="c1"># they need. It still uses NodeProto to store nodes</span>
<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Let&#39;s optimize.</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp_opt.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">opt_onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pretty_onnx</span><span class="p">(</span><span class="n">opt_onx</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">18</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.0.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,)</span>                   <span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;layers.2.bias&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.11</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span><span class="o">--</span> <span class="n">DynamoInterpret</span><span class="o">.</span><span class="n">placeholder</span><span class="mf">.1</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span><span class="n">GraphBuilder</span><span class="o">.</span><span class="n">_update_structures_with_proto</span><span class="mf">.1</span><span class="o">/</span><span class="n">from</span><span class="p">(</span><span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span><span class="c1">##p_layers_0_weight::T10/GraphBuilder._update_structures_with_proto.1/from(p_layers_0_weight::T10)</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">float32</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="o">--</span> <span class="n">GraphBuilder</span><span class="o">.</span><span class="n">constant_folding</span><span class="o">.</span><span class="n">from</span><span class="o">/</span><span class="n">fold</span><span class="p">(</span><span class="n">init7_s2_1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">)</span><span class="c1">##p_layers_2_weight::T10/GraphBuilder._update_structures_with_proto.1/from(p_layers_2_weight::T10)##init7_s2_1_-1/TransposeEqualReshapePattern.apply.new_shape</span>
    <span class="n">Gemm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_0_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.0</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">linear</span>
      <span class="n">Relu</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">relu</span>
        <span class="n">Gemm</span><span class="p">(</span><span class="n">relu</span><span class="p">,</span> <span class="n">GemmTransposePattern</span><span class="o">--</span><span class="n">p_layers_2_weight</span><span class="p">::</span><span class="n">T10</span><span class="p">,</span> <span class="n">layers</span><span class="mf">.2</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">output_0</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;output_0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Which renders as follows:</p>
<div class="graphviz"><img src="../_images/graphviz-b6a2f9fcfa76018404703168a0a3f5380b179ad1.png" alt="digraph{
  orientation=portrait;
  ranksep=0.25;
  size=7;
  nodesep=0.05;

  x [shape=box color=red label=&quot;x\nTensorProto.FLOAT\nshape=[3, 10]&quot; fontsize=10];

  output_0 [shape=box color=green label=&quot;output_0\nTensorProto.FLOAT\nshape=[3, 1]&quot; fontsize=10];

  layers_0_bias [shape=box label=&quot;layers_0_bias\nfloat32((32,))\n[-0.102  0.029  0.228 -0.291  0.076  0.077  0.047 ...&quot; fontsize=10];
  layers_2_bias [shape=box label=&quot;layers_2_bias\nfloat32((1,))\n[0.11]&quot; fontsize=10];
  GemmTransposePattern__p_layers_0_weight____T10 [shape=box label=&quot;GemmTransposePattern__p_layers_0_weight____T10\nfloat32((32, 10))\n[[-0.277 -0.143 -0.127  0.119  0.174 -0.227  0.03 ...&quot; fontsize=10];
  GemmTransposePattern__p_layers_2_weight____T10 [shape=box label=&quot;GemmTransposePattern__p_layers_2_weight____T10\nfloat32((1, 32))\n[[ 0.099  0.125  0.033  0.06  -0.082  0.127  0.143...&quot; fontsize=10];

  linear [shape=box label=&quot;linear&quot; fontsize=10];
  GemmTransposePattern__MatMulAddPattern__Opset2 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Gemm\ntransB=1&quot; fontsize=10];
  x -&gt; GemmTransposePattern__MatMulAddPattern__Opset2;
  GemmTransposePattern__p_layers_0_weight____T10 -&gt; GemmTransposePattern__MatMulAddPattern__Opset2;
  layers_0_bias -&gt; GemmTransposePattern__MatMulAddPattern__Opset2;
  GemmTransposePattern__MatMulAddPattern__Opset2 -&gt; linear;

  relu [shape=box label=&quot;relu&quot; fontsize=10];
  relu [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Relu&quot; fontsize=10];
  linear -&gt; relu;
  relu -&gt; relu;

  GemmTransposePattern__MatMulAddPattern__Opset32 [shape=box style=&quot;filled,rounded&quot; color=orange label=&quot;Gemm\ntransB=1&quot; fontsize=10];
  relu -&gt; GemmTransposePattern__MatMulAddPattern__Opset32;
  GemmTransposePattern__p_layers_2_weight____T10 -&gt; GemmTransposePattern__MatMulAddPattern__Opset32;
  layers_2_bias -&gt; GemmTransposePattern__MatMulAddPattern__Opset32;
  GemmTransposePattern__MatMulAddPattern__Opset32 -&gt; output_0;
}" class="graphviz" /></div>
</section>
<section id="verbosity">
<h3>Verbosity<a class="headerlink" href="#verbosity" title="Link to this heading">¶</a></h3>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">_add_shape_information</span><span class="p">]</span> <span class="n">dynamic</span> <span class="n">shapes</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=78</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="n">subgraphs</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="n">subgraphs</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">78</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">30</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">same</span> <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SameChildrenFromInputPattern&#39;</span><span class="p">,</span> <span class="s1">&#39;SameChildrenPattern&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">1</span> <span class="n">matches</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">6</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.010</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.011</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">]</span> <span class="n">make_model</span> <span class="mi">4</span> <span class="n">inits</span> <span class="mi">0</span> <span class="n">params</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">time_evaluation_constants_</span><span class="p">]</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="n">large_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">external_threshold</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">switch</span> <span class="n">low</span><span class="o">/</span><span class="n">high</span> <span class="n">order</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">_build_initializers</span><span class="p">]</span> <span class="n">done</span> <span class="ow">in</span> <span class="mf">1.3369999578571878e-06</span><span class="n">s</span> <span class="k">with</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">0</span> <span class="n">large</span> <span class="n">initializers</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">UGM</span><span class="o">.</span><span class="n">_add_shape_information</span><span class="p">]</span> <span class="n">dynamic</span> <span class="n">shapes</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}</span>
</pre></div>
</div>
<p>With more verbosity:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span><span class="n">onx</span><span class="p">,</span> <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    [GraphBuilder-ESE._update_structures_with_proto] -- starts with 5 nodes
    [GraphBuilder-ESE.set_shape] p_layers_0_weight::T10:(10, 32)
    [GraphBuilder-ESE.set_rank] p_layers_0_weight::T10:2
    [GraphBuilder-ESE.set_type] p_layers_0_weight::T10:1
    [GraphBuilder-ESE.make_initializer] p_layers_0_weight::T10[1:(10, 32)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;p_layers_0_weight::T10&#39;, node=None
    [GraphBuilder-ESE.set_shape] p_layers_2_weight::T10:(32, 1)
    [GraphBuilder-ESE.set_rank] p_layers_2_weight::T10:2
    [GraphBuilder-ESE.set_type] p_layers_2_weight::T10:1
    [GraphBuilder-ESE.make_initializer] p_layers_2_weight::T10[1:(32, 1)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;p_layers_2_weight::T10&#39;, node=None
    [GraphBuilder-ESE.set_shape] layers.0.bias:(32,)
    [GraphBuilder-ESE.set_rank] layers.0.bias:1
    [GraphBuilder-ESE.set_type] layers.0.bias:1
    [GraphBuilder-ESE.make_initializer] layers.0.bias[1:(32,)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;layers.0.bias&#39;, node=None
    [GraphBuilder-ESE.set_shape] layers.2.bias:(1,)
    [GraphBuilder-ESE.set_rank] layers.2.bias:1
    [GraphBuilder-ESE.set_type] layers.2.bias:1
    [GraphBuilder-ESE.make_initializer] layers.2.bias[1:(1,)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;layers.2.bias&#39;, node=None
    [GraphBuilder-ESE.set_type] x:1
    [GraphBuilder-ESE.set_shape] x:(3, 10)
    [GraphBuilder-ESE.set_rank] x:2
    [GraphBuilder-ESE.set_type] output_0:1
    [GraphBuilder-ESE.set_shape] output_0:(3, 1)
    [GraphBuilder-ESE.set_rank] output_0:2
    [GraphBuilder-ESE.set_type] _onx_matmul_x:1
    [GraphBuilder-ESE.set_shape] _onx_matmul_x:(3, 32)
    [GraphBuilder-ESE.set_rank] _onx_matmul_x:2
    [GraphBuilder-ESE.set_type] linear:1
    [GraphBuilder-ESE.set_shape] linear:(3, 32)
    [GraphBuilder-ESE.set_rank] linear:2
    [GraphBuilder-ESE.set_type] relu:1
    [GraphBuilder-ESE.set_shape] relu:(3, 32)
    [GraphBuilder-ESE.set_rank] relu:2
    [GraphBuilder-ESE.set_type] _onx_matmul_relu:1
    [GraphBuilder-ESE.set_shape] _onx_matmul_relu:(3, 1)
    [GraphBuilder-ESE.set_rank] _onx_matmul_relu:2
    [GraphBuilder-ESE.set_type] output_0:1
    [GraphBuilder-ESE._update_structures_with_proto] ends with 5 nodes in 0.0004040140001961845
    [GraphBuilder-ESE.constant_folding] -- starts with 4 constants and 5 nodes.
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: layers.2.bias
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: . :: _onx_matmul_x
    [GraphBuilder-ESE.constant_folding] cst:: . :: output_0
    [GraphBuilder-ESE.constant_folding] cst:: . :: linear
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: . :: _onx_matmul_relu
    [GraphBuilder-ESE.constant_folding] cst:: . :: relu
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: layers.0.bias
    [GraphBuilder-ESE.constant_folding] cst:: . :: x
    [GraphBuilder-ESE.constant_folding] initializer: p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: layers.0.bias
    [GraphBuilder-ESE.constant_folding] initializer: layers.2.bias
    [GraphBuilder-ESE.constant_folding] ends with 4 constants and 5 nodes in 3.5352999475435354e-05 seconds
    [GraphBuilder-ESE._update_shape_types_with_proto] -- starts with 5 nodes and 0 shapes.
    [GraphBuilder._update_shape_types_with_proto] infer shapes
    [GraphBuilder._update_shape_types_with_proto] infer shapes done 0.0001891980000436888 seconds
    [GraphBuilder._update_shape_types_with_proto] _clean_shapes after 0.00021099999958096305 seconds
    [GraphBuilder-ESE._update_shape_types_with_proto] walk through 0 shapes.
    [GraphBuilder-ESE.set_type] _onx_matmul_x:1
    [_update_shape_types_with_proto_one_result] update shape(_onx_matmul_x) with (3, 32)
    [GraphBuilder-ESE.set_type] linear:1
    [_update_shape_types_with_proto_one_result] update shape(linear) with (3, 32)
    [GraphBuilder-ESE.set_type] relu:1
    [_update_shape_types_with_proto_one_result] update shape(relu) with (3, 32)
    [GraphBuilder-ESE.set_type] _onx_matmul_relu:1
    [_update_shape_types_with_proto_one_result] update shape(_onx_matmul_relu) with (3, 1)
    [GraphBuilder-ESE._update_shape_types_with_proto] ends in 8.877599975676276e-05 seconds.
    [GraphBuilder-ESE._add_shape_information] dynamic shapes replacements={}
    [GraphBuilder-ESE.optimize] start with 5 nodes
    [GraphBuilder-ESE.optimize] options=OptimizationOptions(constant_folding={&#39;Div&#39;, &#39;Transpose&#39;, &#39;Concat&#39;, &#39;Add&#39;, &#39;Sub&#39;, &#39;Squeeze&#39;, &#39;Unsqueeze&#39;, &#39;Exp&#39;, &#39;Reshape&#39;, &#39;Mul&#39;, &#39;Cast&#39;, &#39;Reciprocal&#39;, &#39;Sqrt&#39;}, patterns=[BatchNormalizationPattern(), BatchNormalizationTrainingPattern(), CastLayerNormalizationCastPattern(), CastPattern(), CastCastBinaryPattern(), CastCastPattern(), CastOpCastPattern(), ClipClipPattern(), ComputationCastOpCastPattern(), ConcatEmptyPattern(), ConcatGatherPattern(), ConcatReshapePattern(), ConcatTwiceUnaryPattern(), ConvBiasNullPattern(), DropoutPattern(), ExpandPattern(), ExpandBroadcastPattern(), ExpandSwapPattern(), GeluPattern(), IdentityPattern(), LayerNormalizationPattern(), LayerNormalizationScalePattern(), LeakyReluPattern(), MulMulMulScalarPattern(), ReduceReshapePattern(), ReduceSumNormalizePattern(), ReshapePattern(), ReshapeMatMulReshapePattern(), Reshape2Of3Pattern(), ReshapeReshapeBinaryPattern(), MatMulAddPattern(), GemmTransposePattern(), MatMulReshape2Of3Pattern(), MulMulMatMulPattern(), ShapeBasedReshapeIsSqueezePattern(), ShapeBasedStaticExpandPattern(), ShapeBasedConcatExpandPattern(), ShapeBasedEditDistanceReshapePattern(), ShapeBasedIdentityPattern(), ShapeBasedExpandBroadcastPattern(), ShapeBasedExpandBroadcastMatMulPattern(), ShapeBasedExpandCastWhereSwapPattern(), ShapeBasedExpandSwapPattern(), ShapeBasedMatMulToMulPattern(), ShapedBasedReshapePattern(), ShapeBasedSameChildrenPattern(), ShapeBasedShapeShapeAddPattern(), ReshapeReshapePattern(), RotaryEmbeddingPattern(), SameChildrenPattern(), SameChildrenFromInputPattern(), SequenceConstructAtPattern(), SliceSlicePattern(), SlicesSplitPattern(), SoftmaxCrossEntropyLossCastPattern(), SplitConcatPattern(), SqueezeAddPattern(), SqueezeBinaryUnsqueezePattern(), SqueezeUnsqueezePattern(), StaticConcatReshapePattern(), Sub1MulPattern(), SwapExpandReshapePattern(), SwitchOrderBinaryPattern(), SwitchReshapeActivationPattern(), TransposeEqualReshapePattern(), TransposeMatMulPattern(), TransposeReshapeMatMulPattern(), TransposeReshapeTransposePattern(), TransposeTransposePattern(), UnsqueezeEqualPattern(), UnsqueezeUnsqueezePattern(), RotaryConcatPartPattern(), FunctionAttentionPattern(), FunctionCausalMaskPattern(), FunctionCausalMaskMulAddPattern(), FunctionCosSinCachePattern(), FunctionHalfRotaryEmbeddingPattern(), RMSNormalizationPattern()], verbose=11)
    -- GRAPH BEFORE OPTIMIZATON --
    
    opset: : 18
    init: p_layers_0_weight::T10: ?: ?                                     -- GraphBuilder._update_structures_with_proto.1/from(p_layers_0_weight::T10)
    init: p_layers_2_weight::T10: ?: ?                                     -- GraphBuilder._update_structures_with_proto.1/from(p_layers_2_weight::T10)
    init: layers.0.bias: ?: ?                                              -- GraphBuilder._update_structures_with_proto.1/from(layers.0.bias)
    init: layers.2.bias: ?: ?                                              -- GraphBuilder._update_structures_with_proto.1/from(layers.2.bias)
    input:: x                                                                       |T1: 3 x 10
    MatMul: x, p_layers_0_weight::T10 -&gt; _onx_matmul_x                              |T1: 3 x 32                   - Opset
    Add: _onx_matmul_x, layers.0.bias -&gt; linear                                     |T1: 3 x 32                   - Opset2
    Relu: linear -&gt; relu                                                            |T1: 3 x 32                   - relu
    MatMul: relu, p_layers_2_weight::T10 -&gt; _onx_matmul_relu                        |T1: 3 x 1                    - Opset3
    Add: _onx_matmul_relu, layers.2.bias -&gt; output_0                                |T1: 3 x 1                    - Opset4
    output:: output_0                                                               |T1: 3 x 1
    -- END --
    [GraphBuilder-ESE.optimize] start with subgraphs
    [GraphBuilder-ESE.optimize] done with subgraphs
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 2.2331000764097553e-05 seconds
    [GraphBuilder-ESE.constant_folding] -- starts with 4 constants and 5 nodes.
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: layers.2.bias
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: . :: _onx_matmul_x
    [GraphBuilder-ESE.constant_folding] cst:: . :: output_0
    [GraphBuilder-ESE.constant_folding] cst:: . :: linear
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: . :: _onx_matmul_relu
    [GraphBuilder-ESE.constant_folding] cst:: . :: relu
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: layers.0.bias
    [GraphBuilder-ESE.constant_folding] cst:: . :: x
    [GraphBuilder-ESE.constant_folding] initializer: p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: layers.0.bias
    [GraphBuilder-ESE.constant_folding] initializer: layers.2.bias
    [GraphBuilder-ESE.constant_folding] ends with 4 constants and 5 nodes in 2.3082000552676618e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] start with 5 nodes, 4 initializers, 78 patterns, priorities=[0, 1, 3], max_iter=30
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   1/78 - P0 - BatchNormalizationPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   2/78 - P0 - BatchNormalizationTrainingPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   3/78 - P0 - CastCastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   4/78 - P0 - CastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   5/78 - P0 - ConcatGatherPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   6/78 - P0 - ConcatReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   7/78 - P0 - ConvBiasNullPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   8/78 - P0 - ExpandPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern   9/78 - P0 - FunctionAttentionPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  10/78 - P0 - GeluPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  11/78 - P0 - IdentityPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  12/78 - P0 - LeakyReluPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  13/78 - P0 - ReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  14/78 - P0 - ReshapeReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  15/78 - P0 - SameChildrenFromInputPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  16/78 - P0 - SameChildrenPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  17/78 - P0 - ShapeBasedEditDistanceReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  18/78 - P0 - ShapeBasedIdentityPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  19/78 - P0 - ShapeBasedReshapeIsSqueezePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  20/78 - P0 - ShapeBasedSameChildrenPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  21/78 - P0 - ShapeBasedShapeShapeAddPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  22/78 - P0 - ShapeBasedStaticExpandPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  23/78 - P0 - ShapedBasedReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  24/78 - P0 - SoftmaxCrossEntropyLossCastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  25/78 - P0 - SqueezeAddPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  26/78 - P0 - SqueezeBinaryUnsqueezePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  27/78 - P0 - SqueezeUnsqueezePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  28/78 - P0 - StaticConcatReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  29/78 - P0 - SwapExpandReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  30/78 - P0 - TransposeReshapeTransposePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  31/78 - P0 - TransposeTransposePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  32/78 - P0 - UnsqueezeUnsqueezePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  33/78 - P1 - CastCastBinaryPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  34/78 - P1 - CastLayerNormalizationCastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  35/78 - P1 - CastOpCastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  36/78 - P1 - ClipClipPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  37/78 - P1 - ComputationCastOpCastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  38/78 - P1 - ConcatEmptyPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  39/78 - P1 - ConcatTwiceUnaryPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  40/78 - P1 - DropoutPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  41/78 - P1 - ExpandBroadcastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  42/78 - P1 - ExpandSwapPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  43/78 - P1 - FunctionCausalMaskMulAddPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  44/78 - P1 - FunctionCausalMaskPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  45/78 - P1 - FunctionCosSinCachePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  46/78 - P1 - FunctionHalfRotaryEmbeddingPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  47/78 - P1 - GemmTransposePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  48/78 - P1 - LayerNormalizationPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  49/78 - P1 - LayerNormalizationScalePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  50/78 - P1 - MatMulReshape2Of3Pattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  51/78 - P1 - MulMulMatMulPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  52/78 - P1 - MulMulMulScalarPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  53/78 - P1 - RMSNormalizationPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  54/78 - P1 - ReduceReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  55/78 - P1 - ReduceSumNormalizePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  56/78 - P1 - Reshape2Of3Pattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  57/78 - P1 - ReshapeMatMulReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  58/78 - P1 - ReshapeReshapeBinaryPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  59/78 - P1 - RotaryConcatPartPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  60/78 - P1 - RotaryEmbeddingPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  61/78 - P1 - SequenceConstructAtPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  62/78 - P1 - ShapeBasedConcatExpandPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  63/78 - P1 - ShapeBasedExpandBroadcastMatMulPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  64/78 - P1 - ShapeBasedExpandBroadcastPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  65/78 - P1 - ShapeBasedExpandCastWhereSwapPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  66/78 - P1 - ShapeBasedExpandSwapPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  67/78 - P1 - ShapeBasedMatMulToMulPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  68/78 - P1 - SliceSlicePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  69/78 - P1 - SlicesSplitPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  70/78 - P1 - SplitConcatPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  71/78 - P1 - Sub1MulPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  72/78 - P1 - SwitchOrderBinaryPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  73/78 - P1 - SwitchReshapeActivationPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  74/78 - P1 - TransposeEqualReshapePattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  75/78 - P1 - TransposeMatMulPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  76/78 - P1 - TransposeReshapeMatMulPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  77/78 - P1 - UnsqueezeEqualPattern()
    [GraphBuilderPatternOptimization-ESE.optimize] use pattern  78/78 - P3 - MatMulAddPattern()
    -- optimize starts with...
    
    opset: : 18
    init: p_layers_0_weight::T10: ?: ?                                     -- GraphBuilder._update_structures_with_proto.1/from(p_layers_0_weight::T10)
    init: p_layers_2_weight::T10: ?: ?                                     -- GraphBuilder._update_structures_with_proto.1/from(p_layers_2_weight::T10)
    init: layers.0.bias: ?: ?                                              -- GraphBuilder._update_structures_with_proto.1/from(layers.0.bias)
    init: layers.2.bias: ?: ?                                              -- GraphBuilder._update_structures_with_proto.1/from(layers.2.bias)
    input:: x                                                                       |T1: 3 x 10
    MatMul: x, p_layers_0_weight::T10 -&gt; _onx_matmul_x                              |T1: 3 x 32                   - Opset
    Add: _onx_matmul_x, layers.0.bias -&gt; linear                                     |T1: 3 x 32                   - Opset2
    Relu: linear -&gt; relu                                                            |T1: 3 x 32                   - relu
    MatMul: relu, p_layers_2_weight::T10 -&gt; _onx_matmul_relu                        |T1: 3 x 1                    - Opset3
    Add: _onx_matmul_relu, layers.2.bias -&gt; output_0                                |T1: 3 x 1                    - Opset4
    output:: output_0                                                               |T1: 3 x 1
    -- starts optimization
    [GraphBuilderPatternOptimization-ESE.optimize] same children={&#39;SameChildrenFromInputPattern&#39;, &#39;SameChildrenPattern&#39;}
    [GraphBuilderPatternOptimization-ESE.optimize] iteration 0: 5 nodes, priority=0
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0 - matching_step
    [PatternOptimization.enumerate_matches] start BatchNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start BatchNormalizationTrainingPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips CastLayerNormalizationCastPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start CastPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips CastCastBinaryPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start CastCastPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips CastOpCastPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ClipClipPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ComputationCastOpCastPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ConcatEmptyPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ConcatGatherPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatReshapePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips ConcatTwiceUnaryPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ConvBiasNullPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips DropoutPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ExpandPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips ExpandBroadcastPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ExpandSwapPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start GeluPattern with main_opset=18 and min_opset=20
    [PatternOptimization.enumerate_matches] start IdentityPattern with main_opset=18 and min_opset=1
    [IdentityPattern.match] NONE - line: 337:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [IdentityPattern.match] NONE - line: 379:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [GraphBuilderPatternOptimization-ESE.optimize] skips LayerNormalizationPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips LayerNormalizationScalePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start LeakyReluPattern with main_opset=18 and min_opset=6
    [GraphBuilder-UHK.make_tensor_input] x[0:None] -- marker=_build_pattern1_x
    [GraphBuilder-UHK.set_type] x:0
    [GraphBuilder-UHK.set_type] x:-1
    [GraphBuilder-UHK.make_tensor_input] zero[0:None] -- marker=_build_pattern1_zero
    [GraphBuilder-UHK.set_type] zero:0
    [GraphBuilder-UHK.set_type] zero:-1
    [GraphBuilder-UHK.make_tensor_input] slope[0:None] -- marker=_build_pattern1_slope
    [GraphBuilder-UHK.set_type] slope:0
    [GraphBuilder-UHK.set_type] slope:-1
    [GraphBuilder-UHK.make_node] [TT:-] Greater: [&#39;x&#39;, &#39;zero&#39;]-&gt;[&#39;_onx_greater_x&#39;]
    [GraphBuilder-UHK.set_type] _onx_greater_x:9
    [GraphBuilder-UHK.make_node] [TT:-] Mul: [&#39;x&#39;, &#39;slope&#39;]-&gt;[&#39;_onx_mul_x&#39;]
    [GraphBuilder-UHK.set_type] _onx_mul_x:-1
    [GraphBuilder-UHK.make_node] [TTT:-] Where: [&#39;_onx_greater_x&#39;, &#39;x&#39;, &#39;_onx_mul_x&#39;]-&gt;[&#39;_onx_where_greater_x&#39;]
    [GraphBuilder-UHK.set_type] _onx_where_greater_x:-1
    [GraphBuilder-UHK.make_tensor_output] _onx_where_greater_x[0: None]
    [GraphBuilderPatternOptimization-ESE.optimize] skips MulMulMulScalarPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ReduceReshapePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ReduceSumNormalizePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ReshapePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips ReshapeMatMulReshapePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips Reshape2Of3Pattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ReshapeReshapeBinaryPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips MatMulAddPattern, pattern.priority=3, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips GemmTransposePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips MatMulReshape2Of3Pattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips MulMulMatMulPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ShapeBasedReshapeIsSqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedStaticExpandPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips ShapeBasedConcatExpandPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ShapeBasedEditDistanceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedIdentityPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips ShapeBasedExpandBroadcastPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ShapeBasedExpandBroadcastMatMulPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ShapeBasedExpandCastWhereSwapPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ShapeBasedExpandSwapPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips ShapeBasedMatMulToMulPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start ShapedBasedReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedSameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedShapeShapeAddPattern with main_opset=18 and min_opset=1
    [ShapeBasedShapeShapeAddPattern.match] NONE - line: 23:experimental_experiment.xoptim.patterns.onnx_shape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedShapeShapeAddPattern.match] NONE - line: 23:experimental_experiment.xoptim.patterns.onnx_shape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ReshapeReshapePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips RotaryEmbeddingPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start SameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenFromInputPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips SequenceConstructAtPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips SliceSlicePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips SlicesSplitPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start SoftmaxCrossEntropyLossCastPattern with main_opset=18 and min_opset=14
    [GraphBuilder-GUQ.make_tensor_input] X[0:None] -- marker=_build_pattern1_X
    [GraphBuilder-GUQ.set_type] X:0
    [GraphBuilder-GUQ.set_type] X:-1
    [GraphBuilder-GUQ.make_tensor_input] indices[0:None] -- marker=_build_pattern1_indices
    [GraphBuilder-GUQ.set_type] indices:0
    [GraphBuilder-GUQ.set_type] indices:-1
    [GraphBuilder-GUQ.make_tensor_input] axis[0:None] -- marker=_build_pattern1_axis
    [GraphBuilder-GUQ.set_type] axis:0
    [GraphBuilder-GUQ.set_type] axis:-1
    [GraphBuilder-GUQ.make_tensor_input] zerof[0:None] -- marker=_build_pattern1_zerof
    [GraphBuilder-GUQ.set_type] zerof:0
    [GraphBuilder-GUQ.set_type] zerof:-1
    [GraphBuilder-GUQ.make_tensor_input] zeroi[0:None] -- marker=_build_pattern1_zeroi
    [GraphBuilder-GUQ.set_type] zeroi:0
    [GraphBuilder-GUQ.set_type] zeroi:-1
    [GraphBuilder-GUQ.make_tensor_input] b[0:None] -- marker=_build_pattern1_b
    [GraphBuilder-GUQ.set_type] b:0
    [GraphBuilder-GUQ.set_type] b:-1
    [GraphBuilder-GUQ.make_node] [TT:-] Equal: [&#39;indices&#39;, &#39;b&#39;]-&gt;[&#39;_onx_equal_indices&#39;]
    [GraphBuilder-GUQ.set_type] _onx_equal_indices:9
    [GraphBuilder-GUQ.make_node] [T:-] Not: [&#39;_onx_equal_indices&#39;]-&gt;[&#39;_onx_not_equal_indices&#39;]
    [GraphBuilder-GUQ.set_type] _onx_not_equal_indices:9
    [GraphBuilder-GUQ.make_node] [TTT:-] Where: [&#39;_onx_not_equal_indices&#39;, &#39;indices&#39;, &#39;zeroi&#39;]-&gt;[&#39;_onx_where_not_equal_indices&#39;]
    [GraphBuilder-GUQ.set_type] _onx_where_not_equal_indices:-1
    [GraphBuilder-GUQ.make_node] [TT:-] Unsqueeze: [&#39;_onx_where_not_equal_indices&#39;, &#39;axis&#39;]-&gt;[&#39;_onx_where_not_equal_indices::UnSq&#39;]
    [GraphBuilder-GUQ.set_type] _onx_where_not_equal_indices::UnSq:-1
    [GraphBuilder-GUQ.make_node] [T:-] LogSoftmax: [&#39;X&#39;]-&gt;[&#39;_onx_logsoftmax_X&#39;]
    [GraphBuilder-GUQ.set_type] _onx_logsoftmax_X:-1
    [GraphBuilder-GUQ.set_type] _onx_gatherelements_logsoftmax_X:-1
    [GraphBuilder-GUQ.make_node] [TT:T] GatherElements: [&#39;_onx_logsoftmax_X&#39;, &#39;_onx_where_not_equal_indices::UnSq&#39;]-&gt;[&#39;_onx_gatherelements_logsoftmax_X&#39;]
    [GraphBuilder-GUQ.set_type] _onx_gatherelements_logsoftmax_X:-1
    [GraphBuilder-GUQ.make_node] [TT:-] Squeeze: [&#39;_onx_gatherelements_logsoftmax_X&#39;, &#39;axis&#39;]-&gt;[&#39;_onx_gatherelements_logsoftmax_X::Sq&#39;]
    [GraphBuilder-GUQ.set_type] _onx_gatherelements_logsoftmax_X::Sq:-1
    [GraphBuilder-GUQ.make_node] [T:-] Neg: [&#39;_onx_gatherelements_logsoftmax_X::Sq&#39;]-&gt;[&#39;_onx_neg_gatherelements_logsoftmax_X::Sq&#39;]
    [GraphBuilder-GUQ.set_type] _onx_neg_gatherelements_logsoftmax_X::Sq:-1
    [GraphBuilder-GUQ.make_node] [TTT:-] Where: [&#39;_onx_not_equal_indices&#39;, &#39;_onx_neg_gatherelements_logsoftmax_X::Sq&#39;, &#39;zerof&#39;]-&gt;[&#39;_onx_where_not_equal_indices2&#39;]
    [GraphBuilder-GUQ.set_type] _onx_where_not_equal_indices2:-1
    [GraphBuilder-GUQ.make_node] [T:-] Cast: [&#39;_onx_not_equal_indices&#39;]-&gt;[&#39;_onx_not_equal_indices::C1&#39;]
    [GraphBuilder-GUQ.set_type] _onx_not_equal_indices::C1:1
    [GraphBuilder-GUQ.make_node] [T:-] ReduceSum: [&#39;_onx_not_equal_indices::C1&#39;]-&gt;[&#39;_onx_reducesum_not_equal_indices::C1&#39;]
    [GraphBuilder-GUQ.set_type] _onx_reducesum_not_equal_indices::C1:1
    [GraphBuilder-GUQ.set_shape] _onx_reducesum_not_equal_indices::C1:()
    [GraphBuilder-GUQ.set_rank] _onx_reducesum_not_equal_indices::C1:0
    [GraphBuilder-GUQ.make_node] [#:-] Cast: [&#39;_onx_reducesum_not_equal_indices::C1&#39;]-&gt;[&#39;_onx_reducesum_not_equal_indices::C1::C10&#39;]
    [GraphBuilder-GUQ.set_type] _onx_reducesum_not_equal_indices::C1::C10:10
    [GraphBuilder-GUQ.set_shape] _onx_reducesum_not_equal_indices::C1::C10:()
    [GraphBuilder-GUQ.set_rank] _onx_reducesum_not_equal_indices::C1::C10:0
    [GraphBuilder-GUQ.make_node] [T:-] Cast: [&#39;_onx_where_not_equal_indices2&#39;]-&gt;[&#39;_onx_where_not_equal_indices2::C1&#39;]
    [GraphBuilder-GUQ.set_type] _onx_where_not_equal_indices2::C1:1
    [GraphBuilder-GUQ.make_node] [T:-] ReduceSum: [&#39;_onx_where_not_equal_indices2::C1&#39;]-&gt;[&#39;_onx_reducesum_where_not_equal_indices2::C1&#39;]
    [GraphBuilder-GUQ.set_type] _onx_reducesum_where_not_equal_indices2::C1:1
    [GraphBuilder-GUQ.set_shape] _onx_reducesum_where_not_equal_indices2::C1:()
    [GraphBuilder-GUQ.set_rank] _onx_reducesum_where_not_equal_indices2::C1:0
    [GraphBuilder-GUQ.make_node] [#:-] Cast: [&#39;_onx_reducesum_where_not_equal_indices2::C1&#39;]-&gt;[&#39;_onx_reducesum_where_not_equal_indices2::C1::C10&#39;]
    [GraphBuilder-GUQ.set_type] _onx_reducesum_where_not_equal_indices2::C1::C10:10
    [GraphBuilder-GUQ.set_shape] _onx_reducesum_where_not_equal_indices2::C1::C10:()
    [GraphBuilder-GUQ.set_rank] _onx_reducesum_where_not_equal_indices2::C1::C10:0
    [GraphBuilder-GUQ.make_node] [##:-] Div: [&#39;_onx_reducesum_where_not_equal_indices2::C1::C10&#39;, &#39;_onx_reducesum_not_equal_indices::C1::C10&#39;]-&gt;[&#39;_onx_div_reducesum_where_not_equal_indices2::C1::C10&#39;]
    [GraphBuilder-GUQ.set_type] _onx_div_reducesum_where_not_equal_indices2::C1::C10:10
    [GraphBuilder-GUQ.set_shape] _onx_div_reducesum_where_not_equal_indices2::C1::C10:()
    [GraphBuilder-GUQ.set_rank] _onx_div_reducesum_where_not_equal_indices2::C1::C10:0
    [GraphBuilder-GUQ.make_tensor_output] _onx_div_reducesum_where_not_equal_indices2::C1::C10[0: None]
    [GraphBuilderPatternOptimization-ESE.optimize] skips SplitConcatPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start SqueezeAddPattern with main_opset=18 and min_opset=1
    [SqueezeAddPattern.match] NONE - line: 203:experimental_experiment.xoptim.patterns.onnx_unsqueeze, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [SqueezeAddPattern.match] NONE - line: 203:experimental_experiment.xoptim.patterns.onnx_unsqueeze, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start SqueezeBinaryUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start StaticConcatReshapePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips Sub1MulPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start SwapExpandReshapePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips SwitchOrderBinaryPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips SwitchReshapeActivationPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips TransposeEqualReshapePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips TransposeMatMulPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips TransposeReshapeMatMulPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start TransposeReshapeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeTransposePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips UnsqueezeEqualPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start UnsqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips RotaryConcatPartPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start FunctionAttentionPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] skips FunctionCausalMaskPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips FunctionCausalMaskMulAddPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips FunctionCosSinCachePattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips FunctionHalfRotaryEmbeddingPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] skips RMSNormalizationPattern, pattern.priority=1, current_priority_index=0, priorities[current_priority_index]=0 priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0 - matching_step done 0
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - apply_step with 0 matches
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - done with 0 applied patterns
    [GraphBuilderPatternOptimization-ESE.optimize] done all: -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - remove_duplicated_shape
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - remove_duplicated_shape done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - remove_identity
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 4.9654000576992985e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - remove_identity done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - remove_unused
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C0F0 - remove_unused done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] increase priority to 1
    [GraphBuilderPatternOptimization-ESE.optimize] it=0C1F0 - next
    [GraphBuilderPatternOptimization-ESE.optimize] iteration 1: 5 nodes, priority=1
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0 - matching_step
    [PatternOptimization.enumerate_matches] start BatchNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start BatchNormalizationTrainingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastLayerNormalizationCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastBinaryPattern with main_opset=18 and min_opset=1
    [CastCastBinaryPattern.match] NONE - line: 164:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [CastCastBinaryPattern.match] NONE - line: 164:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start CastCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastOpCastPattern with main_opset=18 and min_opset=1
    [CastOpCastPattern.match] NONE - line: 255:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [CastOpCastPattern.match] NONE - line: 252:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ClipClipPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ComputationCastOpCastPattern with main_opset=18 and min_opset=1
    [ComputationCastOpCastPattern.match] NONE - line: 409:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ComputationCastOpCastPattern.match] NONE - line: 409:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ConcatEmptyPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatGatherPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatTwiceUnaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConvBiasNullPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start DropoutPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start GeluPattern with main_opset=18 and min_opset=20
    [PatternOptimization.enumerate_matches] start IdentityPattern with main_opset=18 and min_opset=1
    [IdentityPattern.match] NONE - line: 337:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [IdentityPattern.match] NONE - line: 379:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start LayerNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LayerNormalizationScalePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LeakyReluPattern with main_opset=18 and min_opset=6
    [PatternOptimization.enumerate_matches] start MulMulMulScalarPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceSumNormalizePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeMatMulReshapePattern with main_opset=18 and min_opset=1
    [ReshapeMatMulReshapePattern.match] NONE - line: 758:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [ReshapeMatMulReshapePattern.match] NONE - line: 758:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start Reshape2Of3Pattern with main_opset=18 and min_opset=1
    [Reshape2Of3Pattern.match] NONE - line: 413:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [Reshape2Of3Pattern.match] NONE - line: 413:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ReshapeReshapeBinaryPattern with main_opset=18 and min_opset=1
    [ReshapeReshapeBinaryPattern.match] NONE - line: 593:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ReshapeReshapeBinaryPattern.match] NONE - line: 593:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [GraphBuilderPatternOptimization-ESE.optimize] skips MatMulAddPattern, pattern.priority=3, current_priority_index=1, priorities[current_priority_index]=1 priorities=[0, 1, 3]
    [PatternOptimization.enumerate_matches] start GemmTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MatMulReshape2Of3Pattern with main_opset=18 and min_opset=1
    [MatMulReshape2Of3Pattern.match] NONE - line: 384:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [MatMulReshape2Of3Pattern.match] NONE - line: 384:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start MulMulMatMulPattern with main_opset=18 and min_opset=1
    [MulMulMatMulPattern.match] NONE - line: 694:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [MulMulMatMulPattern.match] NONE - line: 694:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapeBasedReshapeIsSqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedStaticExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedConcatExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedEditDistanceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedIdentityPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastPattern with main_opset=18 and min_opset=1
    [ShapeBasedExpandBroadcastPattern.match] NONE - line: 232:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedExpandBroadcastPattern.match] NONE - line: 232:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastMatMulPattern with main_opset=18 and min_opset=1
    [ShapeBasedExpandBroadcastMatMulPattern.match] NONE - line: 710:experimental_experiment.xoptim.patterns.onnx_expand, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [ShapeBasedExpandBroadcastMatMulPattern.match] NONE - line: 710:experimental_experiment.xoptim.patterns.onnx_expand, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandCastWhereSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandSwapPattern with main_opset=18 and min_opset=1
    [ShapeBasedExpandSwapPattern.match] NONE - line: 560:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedExpandSwapPattern.match] NONE - line: 560:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ShapeBasedMatMulToMulPattern with main_opset=18 and min_opset=1
    [ShapeBasedMatMulToMulPattern.match] NONE - line: 1229:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [ShapeBasedMatMulToMulPattern.match] NONE - line: 1229:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapedBasedReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedSameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedShapeShapeAddPattern with main_opset=18 and min_opset=1
    [ShapeBasedShapeShapeAddPattern.match] NONE - line: 23:experimental_experiment.xoptim.patterns.onnx_shape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedShapeShapeAddPattern.match] NONE - line: 23:experimental_experiment.xoptim.patterns.onnx_shape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ReshapeReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenFromInputPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SequenceConstructAtPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SliceSlicePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SlicesSplitPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SoftmaxCrossEntropyLossCastPattern with main_opset=18 and min_opset=14
    [PatternOptimization.enumerate_matches] start SplitConcatPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeAddPattern with main_opset=18 and min_opset=1
    [SqueezeAddPattern.match] NONE - line: 203:experimental_experiment.xoptim.patterns.onnx_unsqueeze, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [SqueezeAddPattern.match] NONE - line: 203:experimental_experiment.xoptim.patterns.onnx_unsqueeze, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start SqueezeBinaryUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start StaticConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Sub1MulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwapExpandReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchOrderBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchReshapeActivationPattern with main_opset=18 and min_opset=1
    [SwitchReshapeActivationPattern.match] NONE - line: 1152:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Relu, name=relu, inputs=linear
    [PatternOptimization.enumerate_matches] start TransposeEqualReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeReshapeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeReshapeMatMulPattern.match] NONE - line: 1007:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [TransposeReshapeMatMulPattern.match] NONE - line: 1007:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeReshapeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeEqualPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryConcatPartPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionAttentionPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskMulAddPattern with main_opset=18 and min_opset=1
    [FunctionCausalMaskMulAddPattern.match] NONE - line: 1149:experimental_experiment.xoptim.patterns.onnx_rotary, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [FunctionCausalMaskMulAddPattern.match] NONE - line: 1149:experimental_experiment.xoptim.patterns.onnx_rotary, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start FunctionCosSinCachePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionHalfRotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RMSNormalizationPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0 - matching_step done 0
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - apply_step with 0 matches
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - done with 0 applied patterns
    [GraphBuilderPatternOptimization-ESE.optimize] done all: -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - remove_duplicated_shape
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - remove_duplicated_shape done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - remove_identity
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 1.8561000615591183e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - remove_identity done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - remove_unused
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C0F0 - remove_unused done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] increase priority to 3
    [GraphBuilderPatternOptimization-ESE.optimize] it=1C1F0 - next
    [GraphBuilderPatternOptimization-ESE.optimize] iteration 2: 5 nodes, priority=3
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C0 - matching_step
    [PatternOptimization.enumerate_matches] start BatchNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start BatchNormalizationTrainingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastLayerNormalizationCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastBinaryPattern with main_opset=18 and min_opset=1
    [CastCastBinaryPattern.match] NONE - line: 164:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [CastCastBinaryPattern.match] NONE - line: 164:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start CastCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastOpCastPattern with main_opset=18 and min_opset=1
    [CastOpCastPattern.match] NONE - line: 255:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [CastOpCastPattern.match] NONE - line: 252:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ClipClipPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ComputationCastOpCastPattern with main_opset=18 and min_opset=1
    [ComputationCastOpCastPattern.match] NONE - line: 409:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ComputationCastOpCastPattern.match] NONE - line: 409:experimental_experiment.xoptim.patterns.onnx_cast, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ConcatEmptyPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatGatherPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatTwiceUnaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConvBiasNullPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start DropoutPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start GeluPattern with main_opset=18 and min_opset=20
    [PatternOptimization.enumerate_matches] start IdentityPattern with main_opset=18 and min_opset=1
    [IdentityPattern.match] NONE - line: 337:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [IdentityPattern.match] NONE - line: 379:experimental_experiment.xoptim.patterns.onnx_any, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start LayerNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LayerNormalizationScalePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LeakyReluPattern with main_opset=18 and min_opset=6
    [PatternOptimization.enumerate_matches] start MulMulMulScalarPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceSumNormalizePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeMatMulReshapePattern with main_opset=18 and min_opset=1
    [ReshapeMatMulReshapePattern.match] NONE - line: 758:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [ReshapeMatMulReshapePattern.match] NONE - line: 758:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start Reshape2Of3Pattern with main_opset=18 and min_opset=1
    [Reshape2Of3Pattern.match] NONE - line: 413:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [Reshape2Of3Pattern.match] NONE - line: 413:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ReshapeReshapeBinaryPattern with main_opset=18 and min_opset=1
    [ReshapeReshapeBinaryPattern.match] NONE - line: 593:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ReshapeReshapeBinaryPattern.match] NONE - line: 593:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start MatMulAddPattern with main_opset=18 and min_opset=1
    [MatchResult.match] MATCH MatMulAddPattern with 2 nodes and types [&#39;MatMul&#39;, &#39;Add&#39;] - []
    [GraphBuilderPatternOptimization-ESE.optimize] match=MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
    [MatchResult.match] MATCH MatMulAddPattern with 2 nodes and types [&#39;MatMul&#39;, &#39;Add&#39;] - []
    [GraphBuilderPatternOptimization-ESE.optimize] match=MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
    [PatternOptimization.enumerate_matches] start GemmTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MatMulReshape2Of3Pattern with main_opset=18 and min_opset=1
    [MatMulReshape2Of3Pattern.match] NONE - line: 384:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [MatMulReshape2Of3Pattern.match] NONE - line: 384:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start MulMulMatMulPattern with main_opset=18 and min_opset=1
    [MulMulMatMulPattern.match] NONE - line: 694:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [MulMulMatMulPattern.match] NONE - line: 694:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapeBasedReshapeIsSqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedStaticExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedConcatExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedEditDistanceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedIdentityPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastPattern with main_opset=18 and min_opset=1
    [ShapeBasedExpandBroadcastPattern.match] NONE - line: 232:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedExpandBroadcastPattern.match] NONE - line: 232:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastMatMulPattern with main_opset=18 and min_opset=1
    [ShapeBasedExpandBroadcastMatMulPattern.match] NONE - line: 710:experimental_experiment.xoptim.patterns.onnx_expand, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [ShapeBasedExpandBroadcastMatMulPattern.match] NONE - line: 710:experimental_experiment.xoptim.patterns.onnx_expand, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandCastWhereSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandSwapPattern with main_opset=18 and min_opset=1
    [ShapeBasedExpandSwapPattern.match] NONE - line: 560:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedExpandSwapPattern.match] NONE - line: 560:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ShapeBasedMatMulToMulPattern with main_opset=18 and min_opset=1
    [ShapeBasedMatMulToMulPattern.match] NONE - line: 1229:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [ShapeBasedMatMulToMulPattern.match] NONE - line: 1229:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapedBasedReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedSameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedShapeShapeAddPattern with main_opset=18 and min_opset=1
    [ShapeBasedShapeShapeAddPattern.match] NONE - line: 23:experimental_experiment.xoptim.patterns.onnx_shape, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [ShapeBasedShapeShapeAddPattern.match] NONE - line: 23:experimental_experiment.xoptim.patterns.onnx_shape, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start ReshapeReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenFromInputPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SequenceConstructAtPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SliceSlicePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SlicesSplitPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SoftmaxCrossEntropyLossCastPattern with main_opset=18 and min_opset=14
    [PatternOptimization.enumerate_matches] start SplitConcatPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeAddPattern with main_opset=18 and min_opset=1
    [SqueezeAddPattern.match] NONE - line: 203:experimental_experiment.xoptim.patterns.onnx_unsqueeze, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [SqueezeAddPattern.match] NONE - line: 203:experimental_experiment.xoptim.patterns.onnx_unsqueeze, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start SqueezeBinaryUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start StaticConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Sub1MulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwapExpandReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchOrderBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchReshapeActivationPattern with main_opset=18 and min_opset=1
    [SwitchReshapeActivationPattern.match] NONE - line: 1152:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Relu, name=relu, inputs=linear
    [PatternOptimization.enumerate_matches] start TransposeEqualReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeReshapeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeReshapeMatMulPattern.match] NONE - line: 1007:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset, inputs=x,p_layers_0_weight::T10
    [TransposeReshapeMatMulPattern.match] NONE - line: 1007:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=MatMul, name=Opset3, inputs=relu,p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeReshapeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeEqualPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryConcatPartPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionAttentionPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskMulAddPattern with main_opset=18 and min_opset=1
    [FunctionCausalMaskMulAddPattern.match] NONE - line: 1149:experimental_experiment.xoptim.patterns.onnx_rotary, op_type=Add, name=Opset2, inputs=_onx_matmul_x,layers.0.bias
    [FunctionCausalMaskMulAddPattern.match] NONE - line: 1149:experimental_experiment.xoptim.patterns.onnx_rotary, op_type=Add, name=Opset4, inputs=_onx_matmul_relu,layers.2.bias
    [PatternOptimization.enumerate_matches] start FunctionCosSinCachePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionHalfRotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RMSNormalizationPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C0 - matching_step done 2
    [GraphBuilderPatternOptimization-ESE.optimize] applies 2 matches, 2*MatMulAddPattern - time=0.001 | max_time=IdentityPattern:0.000
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C0F1 - apply_step with 2 matches
    [GraphBuilderPatternOptimization-ESE.optimize] apply MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;], inputs: [&#39;x&#39;, &#39;p_layers_0_weight::T10&#39;, &#39;_onx_matmul_x&#39;, &#39;layers.0.bias&#39;], outputs: [&#39;_onx_matmul_x&#39;, &#39;linear&#39;]
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
      - MatMul: [&#39;x&#39;, &#39;p_layers_0_weight::T10&#39;] -&gt; [&#39;_onx_matmul_x&#39;]
      - Add: [&#39;_onx_matmul_x&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
      + Gemm: [&#39;x&#39;, &#39;p_layers_0_weight::T10&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
    [GraphBuilder-ESE.set_type] linear:1
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;] applied.
    [GraphBuilderPatternOptimization-ESE.optimize] - add [&#39;Gemm&#39;]
    [GraphBuilderPatternOptimization-ESE.optimize] done MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]: -2 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] removed outputs {&#39;_onx_matmul_x&#39;}
    [GraphBuilderPatternOptimization-ESE.optimize] apply MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;], inputs: [&#39;relu&#39;, &#39;p_layers_2_weight::T10&#39;, &#39;_onx_matmul_relu&#39;, &#39;layers.2.bias&#39;], outputs: [&#39;_onx_matmul_relu&#39;, &#39;output_0&#39;]
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]
      - MatMul: [&#39;relu&#39;, &#39;p_layers_2_weight::T10&#39;] -&gt; [&#39;_onx_matmul_relu&#39;]
      - Add: [&#39;_onx_matmul_relu&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
      + Gemm: [&#39;relu&#39;, &#39;p_layers_2_weight::T10&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
    [GraphBuilder-ESE.set_type] output_0:1
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;] applied.
    [GraphBuilderPatternOptimization-ESE.optimize] - add [&#39;Gemm&#39;]
    [GraphBuilderPatternOptimization-ESE.optimize] done MatchResult: MatMulAddPattern replaces [&#39;MatMul&#39;, &#39;Add&#39;]: -2 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] removed outputs {&#39;_onx_matmul_relu&#39;}
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - done with 2 applied patterns
    [GraphBuilderPatternOptimization-ESE.optimize] done all: -4 +2 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - remove_duplicated_shape
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - remove_duplicated_shape done -4 +2 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - remove_identity
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 3
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 3 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 3 nodes in 1.4314000509330072e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - remove_identity done -4 +2 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - remove_unused
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - remove_unused done -4 +2 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=2C1F1 - next
    [GraphBuilderPatternOptimization-ESE.optimize] iteration 3: 3 nodes, priority=3
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C0 - matching_step
    [PatternOptimization.enumerate_matches] start BatchNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start BatchNormalizationTrainingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastLayerNormalizationCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastOpCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ClipClipPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ComputationCastOpCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatEmptyPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatGatherPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatTwiceUnaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConvBiasNullPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start DropoutPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start GeluPattern with main_opset=18 and min_opset=20
    [PatternOptimization.enumerate_matches] start IdentityPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LayerNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LayerNormalizationScalePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LeakyReluPattern with main_opset=18 and min_opset=6
    [PatternOptimization.enumerate_matches] start MulMulMulScalarPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceSumNormalizePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeMatMulReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Reshape2Of3Pattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeReshapeBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MatMulAddPattern with main_opset=18 and min_opset=1
    [MatMulAddPattern.match] NONE - line: 58:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=MatMulAddPattern--Opset, inputs=x,p_layers_0_weight::T10,layers.0.bias
    [MatMulAddPattern.match] NONE - line: 55:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=MatMulAddPattern--Opset3, inputs=relu,p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start GemmTransposePattern with main_opset=18 and min_opset=1
    [MatchResult.match] MATCH GemmTransposePattern with 1 nodes and types [&#39;Gemm&#39;] - []
    [GraphBuilderPatternOptimization-ESE.optimize] match=MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
    [MatchResult.match] MATCH GemmTransposePattern with 1 nodes and types [&#39;Gemm&#39;] - []
    [GraphBuilderPatternOptimization-ESE.optimize] match=MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
    [PatternOptimization.enumerate_matches] start MatMulReshape2Of3Pattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MulMulMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedReshapeIsSqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedStaticExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedConcatExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedEditDistanceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedIdentityPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandCastWhereSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedMatMulToMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapedBasedReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedSameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedShapeShapeAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenFromInputPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SequenceConstructAtPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SliceSlicePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SlicesSplitPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SoftmaxCrossEntropyLossCastPattern with main_opset=18 and min_opset=14
    [PatternOptimization.enumerate_matches] start SplitConcatPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeBinaryUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start StaticConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Sub1MulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwapExpandReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchOrderBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchReshapeActivationPattern with main_opset=18 and min_opset=1
    [SwitchReshapeActivationPattern.match] NONE - line: 1152:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Relu, name=relu, inputs=linear
    [PatternOptimization.enumerate_matches] start TransposeEqualReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=MatMulAddPattern--Opset, inputs=x,p_layers_0_weight::T10,layers.0.bias
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=MatMulAddPattern--Opset3, inputs=relu,p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start TransposeReshapeMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeReshapeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeTransposePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeEqualPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryConcatPartPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionAttentionPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskMulAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCosSinCachePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionHalfRotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RMSNormalizationPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C0 - matching_step done 2
    [GraphBuilderPatternOptimization-ESE.optimize] applies 2 matches, 2*GemmTransposePattern - time=0.000 | max_time=MatMulAddPattern:0.000
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C0F1 - apply_step with 2 matches
    [GraphBuilderPatternOptimization-ESE.optimize] apply MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;], inputs: [&#39;x&#39;, &#39;p_layers_0_weight::T10&#39;, &#39;layers.0.bias&#39;], outputs: [&#39;linear&#39;]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_0_weight::T10&#39;, node=Transpose
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
      - Gemm: [&#39;x&#39;, &#39;p_layers_0_weight::T10&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
      + Transpose: [&#39;p_layers_0_weight::T10&#39;] -&gt; [&#39;GemmTransposePattern--p_layers_0_weight::T10&#39;]
      + Gemm: [&#39;x&#39;, &#39;GemmTransposePattern--p_layers_0_weight::T10&#39;, &#39;layers.0.bias&#39;] -&gt; [&#39;linear&#39;]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_0_weight::T10&#39;, node=Transpose
    [GraphBuilder-ESE.set_type] GemmTransposePattern--p_layers_0_weight::T10:1
    [GraphBuilder-ESE.set_shape] GemmTransposePattern--p_layers_0_weight::T10:(32, 10)
    [GraphBuilder-ESE.set_rank] GemmTransposePattern--p_layers_0_weight::T10:2
    [GraphBuilder-ESE.set_type] linear:1
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;] applied.
    [GraphBuilderPatternOptimization-ESE.optimize] - add [&#39;Transpose&#39;, &#39;Gemm&#39;]
    [GraphBuilderPatternOptimization-ESE.optimize] done MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]: -1 +2 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] apply MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;], inputs: [&#39;relu&#39;, &#39;p_layers_2_weight::T10&#39;, &#39;layers.2.bias&#39;], outputs: [&#39;output_0&#39;]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, node=Transpose
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]
      - Gemm: [&#39;relu&#39;, &#39;p_layers_2_weight::T10&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
      + Transpose: [&#39;p_layers_2_weight::T10&#39;] -&gt; [&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;]
      + Gemm: [&#39;relu&#39;, &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, &#39;layers.2.bias&#39;] -&gt; [&#39;output_0&#39;]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, node=Transpose
    [GraphBuilder-ESE.set_type] GemmTransposePattern--p_layers_2_weight::T10:1
    [GraphBuilder-ESE.set_shape] GemmTransposePattern--p_layers_2_weight::T10:(1, 32)
    [GraphBuilder-ESE.set_rank] GemmTransposePattern--p_layers_2_weight::T10:2
    [GraphBuilder-ESE.set_type] output_0:1
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;] applied.
    [GraphBuilderPatternOptimization-ESE.optimize] - add [&#39;Transpose&#39;, &#39;Gemm&#39;]
    [GraphBuilderPatternOptimization-ESE.optimize] done MatchResult: GemmTransposePattern replaces [&#39;Gemm&#39;]: -1 +2 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - done with 2 applied patterns
    [GraphBuilderPatternOptimization-ESE.optimize] done all: -2 +4 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - remove_duplicated_shape
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - remove_duplicated_shape done -2 +4 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - remove_identity
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 1.851599972724216e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - remove_identity done -2 +4 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - remove_unused
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - remove_unused done -2 +4 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=3C1F1 - next
    [GraphBuilderPatternOptimization-ESE.optimize] iteration 4: 5 nodes, priority=3
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C0 - matching_step
    [PatternOptimization.enumerate_matches] start BatchNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start BatchNormalizationTrainingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastLayerNormalizationCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastOpCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ClipClipPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ComputationCastOpCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatEmptyPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatGatherPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatTwiceUnaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConvBiasNullPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start DropoutPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start GeluPattern with main_opset=18 and min_opset=20
    [PatternOptimization.enumerate_matches] start IdentityPattern with main_opset=18 and min_opset=1
    [IdentityPattern.match] NONE - line: 287:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [IdentityPattern.match] NONE - line: 287:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start LayerNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LayerNormalizationScalePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LeakyReluPattern with main_opset=18 and min_opset=6
    [PatternOptimization.enumerate_matches] start MulMulMulScalarPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceSumNormalizePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeMatMulReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Reshape2Of3Pattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeReshapeBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MatMulAddPattern with main_opset=18 and min_opset=1
    [MatMulAddPattern.match] NONE - line: 58:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2, inputs=x,GemmTransposePattern--p_layers_0_weight::T10,layers.0.bias
    [MatMulAddPattern.match] NONE - line: 55:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32, inputs=relu,GemmTransposePattern--p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start GemmTransposePattern with main_opset=18 and min_opset=1
    [GemmTransposePattern.match] NONE - line: 291:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2, inputs=x,GemmTransposePattern--p_layers_0_weight::T10,layers.0.bias
    [GemmTransposePattern.match] NONE - line: 291:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32, inputs=relu,GemmTransposePattern--p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start MatMulReshape2Of3Pattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MulMulMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedReshapeIsSqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedStaticExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedConcatExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedEditDistanceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedIdentityPattern with main_opset=18 and min_opset=1
    [ShapeBasedIdentityPattern.match] NONE - line: 441:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [ShapeBasedIdentityPattern.match] NONE - line: 441:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandCastWhereSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedMatMulToMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapedBasedReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedSameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedShapeShapeAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenFromInputPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SequenceConstructAtPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SliceSlicePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SlicesSplitPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SoftmaxCrossEntropyLossCastPattern with main_opset=18 and min_opset=14
    [PatternOptimization.enumerate_matches] start SplitConcatPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeBinaryUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start StaticConcatReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Sub1MulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwapExpandReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchOrderBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchReshapeActivationPattern with main_opset=18 and min_opset=1
    [SwitchReshapeActivationPattern.match] NONE - line: 1152:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Relu, name=relu, inputs=linear
    [PatternOptimization.enumerate_matches] start TransposeEqualReshapePattern with main_opset=18 and min_opset=1
    [TransposeEqualReshapePattern.match] NONE - line: 342:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [MatchResult.match] MATCH TransposeEqualReshapePattern with 1 nodes and types [&#39;Transpose&#39;] - []
    [GraphBuilderPatternOptimization-ESE.optimize] match=MatchResult: TransposeEqualReshapePattern replaces [&#39;Transpose&#39;]
    [PatternOptimization.enumerate_matches] start TransposeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeMatMulPattern.match] NONE - line: 904:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2, inputs=x,GemmTransposePattern--p_layers_0_weight::T10,layers.0.bias
    [TransposeMatMulPattern.match] NONE - line: 904:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32, inputs=relu,GemmTransposePattern--p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start TransposeReshapeMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeReshapeTransposePattern with main_opset=18 and min_opset=1
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeTransposePattern with main_opset=18 and min_opset=1
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10
    [PatternOptimization.enumerate_matches] start UnsqueezeEqualPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryConcatPartPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionAttentionPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskMulAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCosSinCachePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionHalfRotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RMSNormalizationPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C0 - matching_step done 1
    [GraphBuilderPatternOptimization-ESE.optimize] applies 1 matches, [0]=MatchResult: TransposeEqualReshapePattern replaces [&#39;Transpose&#39;] - time=0.001 | max_time=TransposeEqualReshapePattern:0.000
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C0F1 - apply_step with 1 matches
    [GraphBuilderPatternOptimization-ESE.optimize] apply MatchResult: TransposeEqualReshapePattern replaces [&#39;Transpose&#39;], inputs: [&#39;p_layers_2_weight::T10&#39;], outputs: [&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;]
    [GraphBuilder-ESE.set_shape] init7_s2_1_-1:(2,)
    [GraphBuilder-ESE.set_rank] init7_s2_1_-1:1
    [GraphBuilder-ESE.set_type] init7_s2_1_-1:7
    [GraphBuilder-ESE.make_initializer] init7_s2_1_-1[7:(2,)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;init7_s2_1_-1&#39;, node=None
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, node=Reshape
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: TransposeEqualReshapePattern replaces [&#39;Transpose&#39;]
      - Transpose: [&#39;p_layers_2_weight::T10&#39;] -&gt; [&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;]
      + Reshape: [&#39;p_layers_2_weight::T10&#39;, &#39;init7_s2_1_-1&#39;] -&gt; [&#39;GemmTransposePattern--p_layers_2_weight::T10&#39;]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, node=Reshape
    [GraphBuilder-ESE.set_type] GemmTransposePattern--p_layers_2_weight::T10:1
    [GraphBuilder-ESE.set_type] GemmTransposePattern--p_layers_2_weight::T10:1
    [GraphBuilderPatternOptimization-ESE.apply_match] MatchResult: TransposeEqualReshapePattern replaces [&#39;Transpose&#39;] applied.
    [GraphBuilderPatternOptimization-ESE.optimize] - add [&#39;Reshape&#39;]
    [GraphBuilderPatternOptimization-ESE.optimize] done MatchResult: TransposeEqualReshapePattern replaces [&#39;Transpose&#39;]: -1 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - done with 1 applied patterns
    [GraphBuilderPatternOptimization-ESE.optimize] done all: -1 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - remove_duplicated_shape
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - remove_duplicated_shape done -1 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - remove_identity
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 1.960099962161621e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - remove_identity done -1 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - remove_unused
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - remove_unused done -1 +1 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=4C1F1 - next
    [GraphBuilderPatternOptimization-ESE.optimize] iteration 5: 5 nodes, priority=3
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0 - matching_step
    [PatternOptimization.enumerate_matches] start BatchNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start BatchNormalizationTrainingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastLayerNormalizationCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start CastOpCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ClipClipPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ComputationCastOpCastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatEmptyPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatGatherPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConcatReshapePattern with main_opset=18 and min_opset=1
    [ConcatReshapePattern.match] NONE - line: 659:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start ConcatTwiceUnaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ConvBiasNullPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start DropoutPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start GeluPattern with main_opset=18 and min_opset=20
    [PatternOptimization.enumerate_matches] start IdentityPattern with main_opset=18 and min_opset=1
    [IdentityPattern.match] NONE - line: 287:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [PatternOptimization.enumerate_matches] start LayerNormalizationPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LayerNormalizationScalePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start LeakyReluPattern with main_opset=18 and min_opset=6
    [PatternOptimization.enumerate_matches] start MulMulMulScalarPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReduceSumNormalizePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapePattern with main_opset=18 and min_opset=1
    [ReshapePattern.match] NONE - line: 37:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start ReshapeMatMulReshapePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start Reshape2Of3Pattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeReshapeBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MatMulAddPattern with main_opset=18 and min_opset=1
    [MatMulAddPattern.match] NONE - line: 58:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2, inputs=x,GemmTransposePattern--p_layers_0_weight::T10,layers.0.bias
    [MatMulAddPattern.match] NONE - line: 55:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32, inputs=relu,GemmTransposePattern--p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start GemmTransposePattern with main_opset=18 and min_opset=1
    [GemmTransposePattern.match] NONE - line: 291:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2, inputs=x,GemmTransposePattern--p_layers_0_weight::T10,layers.0.bias
    [GemmTransposePattern.match] NONE - line: 291:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32, inputs=relu,GemmTransposePattern--p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start MatMulReshape2Of3Pattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start MulMulMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedReshapeIsSqueezePattern with main_opset=18 and min_opset=1
    [ShapeBasedReshapeIsSqueezePattern.match] NONE - line: 1081:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start ShapeBasedStaticExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedConcatExpandPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedEditDistanceReshapePattern with main_opset=18 and min_opset=1
    [ShapeBasedEditDistanceReshapePattern.match] NONE - line: 994:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start ShapeBasedIdentityPattern with main_opset=18 and min_opset=1
    [ShapeBasedIdentityPattern.match] NONE - line: 441:experimental_experiment.xoptim.patterns.onnx_any, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandBroadcastMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandCastWhereSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedExpandSwapPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedMatMulToMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapedBasedReshapePattern with main_opset=18 and min_opset=1
    [ShapedBasedReshapePattern.match] NONE - line: 76:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start ShapeBasedSameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ShapeBasedShapeShapeAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start ReshapeReshapePattern with main_opset=18 and min_opset=1
    [ReshapeReshapePattern.match] NONE - line: 193:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start RotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SameChildrenFromInputPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SequenceConstructAtPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SliceSlicePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SlicesSplitPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SoftmaxCrossEntropyLossCastPattern with main_opset=18 and min_opset=14
    [PatternOptimization.enumerate_matches] start SplitConcatPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeBinaryUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start StaticConcatReshapePattern with main_opset=18 and min_opset=1
    [StaticConcatReshapePattern.match] NONE - line: 771:experimental_experiment.xoptim.patterns.onnx_reshape, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start Sub1MulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwapExpandReshapePattern with main_opset=18 and min_opset=1
    [SwapExpandReshapePattern.match] NONE - line: 983:experimental_experiment.xoptim.patterns.onnx_expand, op_type=Reshape, name=TransposeEqualReshapePattern--B--GemmTransposePattern--MatMulAddPattern--Opset3, inputs=p_layers_2_weight::T10,init7_s2_1_-1
    [PatternOptimization.enumerate_matches] start SwitchOrderBinaryPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start SwitchReshapeActivationPattern with main_opset=18 and min_opset=1
    [SwitchReshapeActivationPattern.match] NONE - line: 1152:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Relu, name=relu, inputs=linear
    [PatternOptimization.enumerate_matches] start TransposeEqualReshapePattern with main_opset=18 and min_opset=1
    [TransposeEqualReshapePattern.match] NONE - line: 342:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeMatMulPattern with main_opset=18 and min_opset=1
    [TransposeMatMulPattern.match] NONE - line: 904:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset2, inputs=x,GemmTransposePattern--p_layers_0_weight::T10,layers.0.bias
    [TransposeMatMulPattern.match] NONE - line: 866:experimental_experiment.xoptim.patterns.onnx_matmul, op_type=Gemm, name=GemmTransposePattern--MatMulAddPattern--Opset32, inputs=relu,GemmTransposePattern--p_layers_2_weight::T10,layers.2.bias
    [PatternOptimization.enumerate_matches] start TransposeReshapeMatMulPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start TransposeReshapeTransposePattern with main_opset=18 and min_opset=1
    [TransposeReshapeTransposePattern.match] NONE - line: 140:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [PatternOptimization.enumerate_matches] start TransposeTransposePattern with main_opset=18 and min_opset=1
    [TransposeTransposePattern.match] NONE - line: 51:experimental_experiment.xoptim.patterns.onnx_transpose, op_type=Transpose, name=GemmTransposePattern--MatMulAddPattern--Opset, inputs=p_layers_0_weight::T10
    [PatternOptimization.enumerate_matches] start UnsqueezeEqualPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start UnsqueezeUnsqueezePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RotaryConcatPartPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionAttentionPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCausalMaskMulAddPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionCosSinCachePattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start FunctionHalfRotaryEmbeddingPattern with main_opset=18 and min_opset=1
    [PatternOptimization.enumerate_matches] start RMSNormalizationPattern with main_opset=18 and min_opset=1
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0 - matching_step done 0
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - apply_step with 0 matches
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - done with 0 applied patterns
    [GraphBuilderPatternOptimization-ESE.optimize] done all: -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - remove_duplicated_shape
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - remove_duplicated_shape done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - remove_identity
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 1.923099989653565e-05 seconds
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - remove_identity done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - remove_unused
    [GraphBuilderPatternOptimization-ESE.optimize] it=5C0F0 - remove_unused done -0 +0 nodes
    [GraphBuilderPatternOptimization-ESE.optimize] stops current_priority_index=3, priorities=[0, 1, 3]
    [GraphBuilderPatternOptimization-ESE.optimize] done after 6 iterations with 5 nodes in 0.008
        STAT apply_GemmTransposePattern +4 -2 #it=1 maxmatch=1 i=2 - time=0.000312101000417897
        STAT apply_MatMulAddPattern +2 -4 #it=1 maxmatch=1 i=2 - time=0.0002222299999630195
        STAT apply_TransposeEqualReshapePattern +1 -1 #it=1 maxmatch=0 i=1 - time=0.00027316599971527467
        STAT build_graph_for_pattern +0 -0 #it=6 maxmatch=0 i=0 - time=0.00012992799838684732
        STAT check_pattern_00 +0 -0 #it=1 maxmatch=0 i=0 - time=1.5593000171065796e-05
        STAT check_pattern_A0 +0 -0 #it=3 maxmatch=0 i=0 - time=7.352499960688874e-05
        STAT check_pattern_B0 +0 -0 #it=6 maxmatch=0 i=0 - time=0.0002345809998587356
        STAT insert_and_remove_nodes +0 -0 #it=0 maxmatch=0 i=0 - time=0.00036902600004395936
        STAT match_BatchNormalizationPattern +0 -0 #it=6 maxmatch=0 i=0 - time=3.9256999116332736e-05
        STAT match_BatchNormalizationTrainingPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.7915000828215852e-05
        STAT match_CastCastBinaryPattern +0 -0 #it=5 maxmatch=0 i=0 - time=6.416999895009212e-05
        STAT match_CastCastPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.3565999981656205e-05
        STAT match_CastLayerNormalizationCastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.2670999896945432e-05
        STAT match_CastOpCastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=5.331499960448127e-05
        STAT match_CastPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.360400048928568e-05
        STAT match_ClipClipPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0808000044780783e-05
        STAT match_ComputationCastOpCastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=3.573600042727776e-05
        STAT match_ConcatEmptyPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0828000742767472e-05
        STAT match_ConcatGatherPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.4762000975897536e-05
        STAT match_ConcatReshapePattern +0 -0 #it=6 maxmatch=0 i=0 - time=3.0255000638135243e-05
        STAT match_ConcatTwiceUnaryPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.073599989671493e-05
        STAT match_ConvBiasNullPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.1359000129450578e-05
        STAT match_DropoutPattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.6303999473166186e-05
        STAT match_ExpandBroadcastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.724399953673128e-05
        STAT match_ExpandPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.2002000150678214e-05
        STAT match_ExpandSwapPattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.8226000065624248e-05
        STAT match_FunctionAttentionPattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.2899999748915434e-05
        STAT match_FunctionCausalMaskMulAddPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.2472001294081565e-05
        STAT match_FunctionCausalMaskPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.081499926338438e-05
        STAT match_FunctionCosSinCachePattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.865800095401937e-05
        STAT match_FunctionHalfRotaryEmbeddingPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.836600040405756e-05
        STAT match_GeluPattern +0 -0 #it=6 maxmatch=0 i=0 - time=7.662998541491106e-06
        STAT match_GemmTransposePattern +0 -0 #it=5 maxmatch=2 i=2 - time=9.64760010901955e-05
        STAT match_IdentityPattern +0 -0 #it=6 maxmatch=0 i=0 - time=0.0002872180002668756
        STAT match_LayerNormalizationPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0836000658164266e-05
        STAT match_LayerNormalizationScalePattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0455000594665762e-05
        STAT match_LeakyReluPattern +0 -0 #it=6 maxmatch=0 i=0 - time=0.0006936760009921272
        STAT match_MatMulAddPattern +0 -0 #it=4 maxmatch=2 i=2 - time=0.0001439059988115332
        STAT match_MatMulReshape2Of3Pattern +0 -0 #it=5 maxmatch=2 i=0 - time=5.5678998251096345e-05
        STAT match_MulMulMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.759200080821756e-05
        STAT match_MulMulMulScalarPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.2541999896930065e-05
        STAT match_RMSNormalizationPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.7192000996146817e-05
        STAT match_ReduceReshapePattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0526000298559666e-05
        STAT match_ReduceSumNormalizePattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.877999966382049e-05
        STAT match_Reshape2Of3Pattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.85379996462143e-05
        STAT match_ReshapeMatMulReshapePattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.4193999201525e-05
        STAT match_ReshapePattern +0 -0 #it=6 maxmatch=0 i=0 - time=4.124100087210536e-05
        STAT match_ReshapeReshapeBinaryPattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.013400030089542e-05
        STAT match_ReshapeReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.787100129353348e-05
        STAT match_RotaryConcatPartPattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.1596000806312077e-05
        STAT match_RotaryEmbeddingPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.901900122902589e-05
        STAT match_SameChildrenFromInputPattern +0 -0 #it=6 maxmatch=2 i=0 - time=4.748500032292213e-05
        STAT match_SameChildrenPattern +0 -0 #it=6 maxmatch=2 i=0 - time=5.5206000070029404e-05
        STAT match_SequenceConstructAtPattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.046899953711545e-05
        STAT match_ShapeBasedConcatExpandPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.9904998225683812e-05
        STAT match_ShapeBasedEditDistanceReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=0.00010206699971604394
        STAT match_ShapeBasedExpandBroadcastMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.115299907425651e-05
        STAT match_ShapeBasedExpandBroadcastPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.528500085143605e-05
        STAT match_ShapeBasedExpandCastWhereSwapPattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.1471999389177654e-05
        STAT match_ShapeBasedExpandSwapPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.193099994154181e-05
        STAT match_ShapeBasedIdentityPattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.579399890440982e-05
        STAT match_ShapeBasedMatMulToMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.0748999708739575e-05
        STAT match_ShapeBasedReshapeIsSqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.775300046982011e-05
        STAT match_ShapeBasedSameChildrenPattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.4641001800773665e-05
        STAT match_ShapeBasedShapeShapeAddPattern +0 -0 #it=6 maxmatch=2 i=0 - time=5.005300045013428e-05
        STAT match_ShapeBasedStaticExpandPattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.1363998712331522e-05
        STAT match_ShapedBasedReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.508600002533058e-05
        STAT match_SliceSlicePattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.831600002333289e-05
        STAT match_SlicesSplitPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.9514000086928718e-05
        STAT match_SoftmaxCrossEntropyLossCastPattern +0 -0 #it=6 maxmatch=2 i=0 - time=0.0012094049989173072
        STAT match_SplitConcatPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.9189000340702478e-05
        STAT match_SqueezeAddPattern +0 -0 #it=6 maxmatch=2 i=0 - time=6.007699994370341e-05
        STAT match_SqueezeBinaryUnsqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.2562000594916753e-05
        STAT match_SqueezeUnsqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.3265001800609753e-05
        STAT match_StaticConcatReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.547999974922277e-05
        STAT match_Sub1MulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.911000163090648e-05
        STAT match_SwapExpandReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.6919001356873196e-05
        STAT match_SwitchOrderBinaryPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.150199972878909e-05
        STAT match_SwitchReshapeActivationPattern +0 -0 #it=5 maxmatch=2 i=0 - time=5.5998000789259095e-05
        STAT match_TransposeEqualReshapePattern +0 -0 #it=5 maxmatch=2 i=1 - time=0.00014202400052454323
        STAT match_TransposeMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=0.00012914200124214403
        STAT match_TransposeReshapeMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.850699977192562e-05
        STAT match_TransposeReshapeTransposePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.4209001569251996e-05
        STAT match_TransposeTransposePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.10969999191002e-05
        STAT match_UnsqueezeEqualPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.69809991348302e-05
        STAT match_UnsqueezeUnsqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.1964998268231284e-05
        STAT remove_duplicated_shape +0 -0 #it=6 maxmatch=0 i=0 - time=1.4145999557513278e-05
        STAT remove_identity_nodes +0 -0 #it=6 maxmatch=0 i=0 - time=0.0006559339999512304
        STAT remove_unused +0 -0 #it=6 maxmatch=0 i=0 - time=0.0004625169985956745
    --MODEL: 5 nodes, 1 inputs, 1 outputs, 5 initializers--
             INPUT:   1 x 1t
         INPUT-SEQ:   1 x Falset
            OUTPUT:   1 x 1t
        OUTPUT-SEQ:   1 x Falset
              INIT:   4 x 1t
              INIT:   1 x 7t
              NODE:   2 x Gemm
              NODE:   1 x Relu
              NODE:   1 x Reshape
              NODE:   1 x Transpose
    --MODEL: 5 nodes, 1 inputs, 1 outputs, 5 initializers--DETAILED--
         INPUT:   1 x 1t[3x10]
        OUTPUT:   1 x 1t[3x1]
          INIT:   1 x 1t[10x32]
          INIT:   1 x 1t[1]
          INIT:   1 x 1t[32]
          INIT:   1 x 1t[32x1]
          INIT:   1 x 7t[2]
          NODE:   1 x Gemm -SIG- 1t[3x10], 1t[32x10], 1t[32]
          NODE:   1 x Gemm -SIG- 1t[3x32], 1t[1x32], 1t[1]
          NODE:   1 x Relu -SIG- 1t[3x32]
          NODE:   1 x Reshape -SIG- 1t[32x1], 7t[2]
          NODE:   1 x Transpose -SIG- 1t[10x32]-perm=1;0
    [GraphBuilder-ESE.remove_identity_nodes] -- starts with 5
    [GraphBuilder-ESE.remove_identity_nodes] found 0 replacements
    [GraphBuilder-ESE.remove_identity_nodes] kept 5 nodes
    [GraphBuilder-ESE.remove_identity_nodes] ends with 5 nodes in 2.1576000108325388e-05 seconds
    [GraphBuilder-ESE.constant_folding] -- starts with 7 constants and 5 nodes.
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: layers.2.bias
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: GemmTransposePattern--p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: . :: _onx_matmul_x
    [GraphBuilder-ESE.constant_folding] cst:: . :: output_0
    [GraphBuilder-ESE.constant_folding] cst:: . :: linear
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: GemmTransposePattern--p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] cst:: . :: _onx_matmul_relu
    [GraphBuilder-ESE.constant_folding] cst:: . :: relu
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: layers.0.bias
    [GraphBuilder-ESE.constant_folding] cst:: 1 :: init7_s2_1_-1
    [GraphBuilder-ESE.constant_folding] cst:: . :: x
    [GraphBuilder-ESE.constant_folding] initializer: p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: layers.0.bias
    [GraphBuilder-ESE.constant_folding] initializer: layers.2.bias
    [GraphBuilder-ESE.constant_folding] from: Transpose(GemmTransposePattern--p_layers_0_weight::T10)
    [GraphBuilder-ESE.set_type] GemmTransposePattern--p_layers_0_weight::T10:1
    [GraphBuilder-ESE.make_initializer] GemmTransposePattern--p_layers_0_weight::T10[1:(32, 10)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_0_weight::T10&#39;, node=None
    [GraphBuilder-ESE.constant_folding] fold_constant:Transpose:GemmTransposePattern--p_layers_0_weight::T10[torch.float32:torch.Size([32, 10])]:from:p_layers_0_weight::T10
    [GraphBuilder-ESE.constant_folding] from: Reshape(GemmTransposePattern--p_layers_2_weight::T10)
    [GraphBuilder-ESE.set_type] GemmTransposePattern--p_layers_2_weight::T10:1
    [GraphBuilder-ESE.make_initializer] GemmTransposePattern--p_layers_2_weight::T10[1:(1, 32)]
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, node=None
    [GraphBuilder-ESE.constant_folding] fold_constant:Reshape:GemmTransposePattern--p_layers_2_weight::T10[float32:(1, 32)]:from:init7_s2_1_-1,p_layers_2_weight::T10
    [GraphBuilder-ESE.constant_folding] initializer: init7_s2_1_-1
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_0_weight::T10&#39;, node=None
    [GraphBuilder-ESE.update_node_constant] new constant &#39;GemmTransposePattern--p_layers_2_weight::T10&#39;, node=None
    [GraphBuilder-ESE.constant_folding] ends with 7 constants and 3 nodes in 0.0003385760001037852 seconds
    [GraphBuilder-ESE.remove_unused] remove_initializer 1:0/7:p_layers_0_weight::T10
    [GraphBuilder-ESE.remove_unused] remove_initializer 2:1/7:p_layers_2_weight::T10
    [GraphBuilder-ESE.remove_unused] remove_initializer 3:4/7:init7_s2_1_-1:int64[(2,)]
    [GraphBuilder-ESE.optimize] done with 3 nodes in 0.010
        STAT apply_GemmTransposePattern +4 -2 #it=1 maxmatch=1 i=2 - time=0.000312101000417897
        STAT apply_MatMulAddPattern +2 -4 #it=1 maxmatch=1 i=2 - time=0.0002222299999630195
        STAT apply_TransposeEqualReshapePattern +1 -1 #it=1 maxmatch=0 i=1 - time=0.00027316599971527467
        STAT apply_constant_folding +0 -2 #it=2 maxmatch=0 i=0 - time=0.00047877099950710544
        STAT apply_constant_folding__Reshape +0 -0 #it=1 maxmatch=0 i=0 - time=0.0
        STAT apply_constant_folding__Transpose +0 -0 #it=1 maxmatch=0 i=0 - time=0.0
        STAT apply_constant_folding_new_inits +0 -0 #it=2 maxmatch=0 i=0 - time=0.0
        STAT build_graph_for_pattern +0 -0 #it=6 maxmatch=0 i=0 - time=0.00012992799838684732
        STAT check_A-dynamic_dimension_naming +0 -0 #it=0 maxmatch=0 i=0 - time=1.8367999473412056e-05
        STAT check_A-opt-sub +0 -0 #it=0 maxmatch=0 i=0 - time=1.3822999790136237e-05
        STAT check_B-remove-identity +0 -0 #it=0 maxmatch=0 i=0 - time=1.3650000255438499e-05
        STAT check_C-remove-unused +0 -0 #it=0 maxmatch=0 i=0 - time=1.178700040327385e-05
        STAT check_Da-constant-folding +0 -0 #it=0 maxmatch=0 i=0 - time=1.164700006484054e-05
        STAT check_Db-constant-folding +0 -0 #it=0 maxmatch=0 i=0 - time=1.1582999832171481e-05
        STAT check_Ea-remove-unused +0 -0 #it=0 maxmatch=0 i=0 - time=1.0798999937833287e-05
        STAT check_Eb-remove-unused +0 -0 #it=0 maxmatch=0 i=0 - time=1.053200048772851e-05
        STAT check_F-patterns +0 -0 #it=0 maxmatch=0 i=0 - time=2.381899957981659e-05
        STAT check_G-remove-identity +0 -0 #it=0 maxmatch=0 i=0 - time=1.380300000164425e-05
        STAT check_G-remove-unused +0 -0 #it=0 maxmatch=0 i=0 - time=1.4556999303749762e-05
        STAT check_H-remove-duplicated-initializer +0 -0 #it=0 maxmatch=0 i=0 - time=8.510999577993061e-06
        STAT check_H-remove-unused +0 -0 #it=0 maxmatch=0 i=0 - time=8.852000064507592e-06
        STAT check_pattern_00 +0 -0 #it=1 maxmatch=0 i=0 - time=1.5593000171065796e-05
        STAT check_pattern_A0 +0 -0 #it=3 maxmatch=0 i=0 - time=7.352499960688874e-05
        STAT check_pattern_B0 +0 -0 #it=6 maxmatch=0 i=0 - time=0.0002345809998587356
        STAT dynamic_dimension_naming +0 -0 #it=0 maxmatch=0 i=0 - time=1.9157999304297846e-05
        STAT insert_and_remove_nodes +0 -0 #it=0 maxmatch=0 i=0 - time=0.00036902600004395936
        STAT match_BatchNormalizationPattern +0 -0 #it=6 maxmatch=0 i=0 - time=3.9256999116332736e-05
        STAT match_BatchNormalizationTrainingPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.7915000828215852e-05
        STAT match_CastCastBinaryPattern +0 -0 #it=5 maxmatch=0 i=0 - time=6.416999895009212e-05
        STAT match_CastCastPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.3565999981656205e-05
        STAT match_CastLayerNormalizationCastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.2670999896945432e-05
        STAT match_CastOpCastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=5.331499960448127e-05
        STAT match_CastPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.360400048928568e-05
        STAT match_ClipClipPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0808000044780783e-05
        STAT match_ComputationCastOpCastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=3.573600042727776e-05
        STAT match_ConcatEmptyPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0828000742767472e-05
        STAT match_ConcatGatherPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.4762000975897536e-05
        STAT match_ConcatReshapePattern +0 -0 #it=6 maxmatch=0 i=0 - time=3.0255000638135243e-05
        STAT match_ConcatTwiceUnaryPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.073599989671493e-05
        STAT match_ConvBiasNullPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.1359000129450578e-05
        STAT match_DropoutPattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.6303999473166186e-05
        STAT match_ExpandBroadcastPattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.724399953673128e-05
        STAT match_ExpandPattern +0 -0 #it=6 maxmatch=0 i=0 - time=2.2002000150678214e-05
        STAT match_ExpandSwapPattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.8226000065624248e-05
        STAT match_FunctionAttentionPattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.2899999748915434e-05
        STAT match_FunctionCausalMaskMulAddPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.2472001294081565e-05
        STAT match_FunctionCausalMaskPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.081499926338438e-05
        STAT match_FunctionCosSinCachePattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.865800095401937e-05
        STAT match_FunctionHalfRotaryEmbeddingPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.836600040405756e-05
        STAT match_GeluPattern +0 -0 #it=6 maxmatch=0 i=0 - time=7.662998541491106e-06
        STAT match_GemmTransposePattern +0 -0 #it=5 maxmatch=2 i=2 - time=9.64760010901955e-05
        STAT match_IdentityPattern +0 -0 #it=6 maxmatch=0 i=0 - time=0.0002872180002668756
        STAT match_LayerNormalizationPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0836000658164266e-05
        STAT match_LayerNormalizationScalePattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0455000594665762e-05
        STAT match_LeakyReluPattern +0 -0 #it=6 maxmatch=0 i=0 - time=0.0006936760009921272
        STAT match_MatMulAddPattern +0 -0 #it=4 maxmatch=2 i=2 - time=0.0001439059988115332
        STAT match_MatMulReshape2Of3Pattern +0 -0 #it=5 maxmatch=2 i=0 - time=5.5678998251096345e-05
        STAT match_MulMulMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.759200080821756e-05
        STAT match_MulMulMulScalarPattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.2541999896930065e-05
        STAT match_RMSNormalizationPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.7192000996146817e-05
        STAT match_ReduceReshapePattern +0 -0 #it=5 maxmatch=0 i=0 - time=2.0526000298559666e-05
        STAT match_ReduceSumNormalizePattern +0 -0 #it=5 maxmatch=0 i=0 - time=1.877999966382049e-05
        STAT match_Reshape2Of3Pattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.85379996462143e-05
        STAT match_ReshapeMatMulReshapePattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.4193999201525e-05
        STAT match_ReshapePattern +0 -0 #it=6 maxmatch=0 i=0 - time=4.124100087210536e-05
        STAT match_ReshapeReshapeBinaryPattern +0 -0 #it=5 maxmatch=0 i=0 - time=4.013400030089542e-05
        STAT match_ReshapeReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.787100129353348e-05
        STAT match_RotaryConcatPartPattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.1596000806312077e-05
        STAT match_RotaryEmbeddingPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.901900122902589e-05
        STAT match_SameChildrenFromInputPattern +0 -0 #it=6 maxmatch=2 i=0 - time=4.748500032292213e-05
        STAT match_SameChildrenPattern +0 -0 #it=6 maxmatch=2 i=0 - time=5.5206000070029404e-05
        STAT match_SequenceConstructAtPattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.046899953711545e-05
        STAT match_ShapeBasedConcatExpandPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.9904998225683812e-05
        STAT match_ShapeBasedEditDistanceReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=0.00010206699971604394
        STAT match_ShapeBasedExpandBroadcastMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.115299907425651e-05
        STAT match_ShapeBasedExpandBroadcastPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.528500085143605e-05
        STAT match_ShapeBasedExpandCastWhereSwapPattern +0 -0 #it=5 maxmatch=2 i=0 - time=2.1471999389177654e-05
        STAT match_ShapeBasedExpandSwapPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.193099994154181e-05
        STAT match_ShapeBasedIdentityPattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.579399890440982e-05
        STAT match_ShapeBasedMatMulToMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=4.0748999708739575e-05
        STAT match_ShapeBasedReshapeIsSqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.775300046982011e-05
        STAT match_ShapeBasedSameChildrenPattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.4641001800773665e-05
        STAT match_ShapeBasedShapeShapeAddPattern +0 -0 #it=6 maxmatch=2 i=0 - time=5.005300045013428e-05
        STAT match_ShapeBasedStaticExpandPattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.1363998712331522e-05
        STAT match_ShapedBasedReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.508600002533058e-05
        STAT match_SliceSlicePattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.831600002333289e-05
        STAT match_SlicesSplitPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.9514000086928718e-05
        STAT match_SoftmaxCrossEntropyLossCastPattern +0 -0 #it=6 maxmatch=2 i=0 - time=0.0012094049989173072
        STAT match_SplitConcatPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.9189000340702478e-05
        STAT match_SqueezeAddPattern +0 -0 #it=6 maxmatch=2 i=0 - time=6.007699994370341e-05
        STAT match_SqueezeBinaryUnsqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.2562000594916753e-05
        STAT match_SqueezeUnsqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.3265001800609753e-05
        STAT match_StaticConcatReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.547999974922277e-05
        STAT match_Sub1MulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.911000163090648e-05
        STAT match_SwapExpandReshapePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.6919001356873196e-05
        STAT match_SwitchOrderBinaryPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.150199972878909e-05
        STAT match_SwitchReshapeActivationPattern +0 -0 #it=5 maxmatch=2 i=0 - time=5.5998000789259095e-05
        STAT match_TransposeEqualReshapePattern +0 -0 #it=5 maxmatch=2 i=1 - time=0.00014202400052454323
        STAT match_TransposeMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=0.00012914200124214403
        STAT match_TransposeReshapeMatMulPattern +0 -0 #it=5 maxmatch=2 i=0 - time=3.850699977192562e-05
        STAT match_TransposeReshapeTransposePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.4209001569251996e-05
        STAT match_TransposeTransposePattern +0 -0 #it=6 maxmatch=2 i=0 - time=3.10969999191002e-05
        STAT match_UnsqueezeEqualPattern +0 -0 #it=5 maxmatch=2 i=0 - time=1.69809991348302e-05
        STAT match_UnsqueezeUnsqueezePattern +0 -0 #it=6 maxmatch=2 i=0 - time=2.1964998268231284e-05
        STAT pattern_optimization +0 -0 #it=0 maxmatch=0 i=0 - time=0.008893626999451953
        STAT remove_duplicated_initializer +0 -0 #it=0 maxmatch=0 i=0 - time=2.3862000489316415e-05
        STAT remove_duplicated_shape +0 -0 #it=6 maxmatch=0 i=0 - time=1.4145999557513278e-05
        STAT remove_identity_nodes +0 -0 #it=6 maxmatch=0 i=0 - time=0.0008794599998509511
        STAT remove_unused +0 -0 #it=6 maxmatch=0 i=0 - time=0.0008375209981750231
    --MODEL: 3 nodes, 1 inputs, 1 outputs, 4 initializers--
             INPUT:   1 x 1t
         INPUT-SEQ:   1 x Falset
            OUTPUT:   1 x 1t
        OUTPUT-SEQ:   1 x Falset
              INIT:   4 x 1t
              NODE:   2 x Gemm
              NODE:   1 x Relu
    --MODEL: 3 nodes, 1 inputs, 1 outputs, 4 initializers--DETAILED--
         INPUT:   1 x 1t[3x10]
        OUTPUT:   1 x 1t[3x1]
          INIT:   1 x 1t[1]
          INIT:   1 x 1t[1x32]
          INIT:   1 x 1t[32]
          INIT:   1 x 1t[32x10]
          NODE:   1 x Gemm -SIG- 1t[3x10], 1t[32x10], 1t[32]
          NODE:   1 x Gemm -SIG- 1t[3x32], 1t[1x32], 1t[1]
          NODE:   1 x Relu -SIG- 1t[3x32]
    [GraphBuilder-ESE.to_onnx] make_model 4 inits 0 params
    [GraphBuilder-ESE.time_evaluation_constants_] 0
    [GraphBuilder-ESE._build_initializers] start with 4 initializers, large_model=False, external_threshold=1024
    [GraphBuilder-ESE._build_initializers] switch low/high order
    [GraphBuilder-ESE._build_initializers] TensorProto-layers.0.bias:1[(32,)]
    [GraphBuilder-ESE._build_initializers] TensorProto-layers.2.bias:1[(1,)]
    [GraphBuilder-ESE._build_initializers] &lt;Tensor&gt;-GemmTransposePattern--p_layers_0_weight::T10:torch.float32[torch.Size([32, 10])]
    [proto_from_array] 1[torch.Size([32, 10])]
    [GraphBuilder-ESE._build_initializers] &lt;ndarray&gt;-GemmTransposePattern--p_layers_2_weight::T10:float32[(1, 32)]
    [GraphBuilder-ESE._build_initializers] done in 1.8089995137415826e-06s with 4 initializers, 0 large initializers
    [GraphBuilder-ESE._add_shape_information] dynamic shapes replacements={}
</pre></div>
</div>
</section>
<section id="select-the-pattern-to-use">
<h3>Select the pattern to use<a class="headerlink" href="#select-the-pattern-to-use" title="Link to this heading">¶</a></h3>
<p>Class <a class="reference internal" href="../api/xbuilder/index.html#experimental_experiment.xbuilder.OptimizationOptions" title="experimental_experiment.xbuilder.OptimizationOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizationOptions</span></code></a>
is used to enable or disable patterns.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span>
        <span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;TransposeTranspose,TransposeMatMul&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">2</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">2</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">SBO</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.001</span>
</pre></div>
</div>
<p>There exists some predefined lists of patterns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code>: includes all patterns using only standard onnx patterns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onnxruntime</span></code>: patterns specific to <a class="reference external" href="https://onnxruntime.ai/">onnxruntime</a>, the final model
may be executed by onnxruntime and possibly only onnxruntime as it may
introduce patterns from <a class="reference external" href="https://github.com/microsoft/onnxruntime/blob/main/docs/OperatorKernels.md">Supported Operators and Data Types</a>.</p></li>
</ul>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default+onnxruntime&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">opt_onx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="c1">#patterns=101</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="mi">4</span> <span class="n">initializers</span><span class="p">,</span> <span class="mi">101</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">40</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">same</span> <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SameChildrenFromInputPattern&#39;</span><span class="p">,</span> <span class="s1">&#39;SameChildrenPattern&#39;</span><span class="p">}</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">increase</span> <span class="n">priority</span> <span class="n">to</span> <span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">MatMulAddPattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">IdentityPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">2</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">GemmTransposePattern</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">GemmTransposePattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">applies</span> <span class="mi">1</span> <span class="n">matches</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">MatchResult</span><span class="p">:</span> <span class="n">TransposeEqualReshapePattern</span> <span class="n">replaces</span> <span class="p">[</span><span class="s1">&#39;Transpose&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.000</span> <span class="o">|</span> <span class="n">max_time</span><span class="o">=</span><span class="n">TransposeMatMulPattern</span><span class="p">:</span><span class="mf">0.000</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">iteration</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">5</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">stops</span> <span class="n">current_priority_index</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GraphBuilderPatternOptimization</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="n">after</span> <span class="mi">7</span> <span class="n">iterations</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.010</span>
    <span class="p">[</span><span class="n">GraphBuilder</span><span class="o">-</span><span class="n">EDS</span><span class="o">.</span><span class="n">optimize</span><span class="p">]</span> <span class="n">done</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="mf">0.011</span>
</pre></div>
</div>
</section>
<section id="statistics">
<h3>Statistics<a class="headerlink" href="#statistics" title="Link to this heading">¶</a></h3>
<p>This can be used to see when a pattern is applied and how long it takes.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stat</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                       <span class="n">pattern</span>  <span class="n">removed</span>  <span class="n">added</span>   <span class="n">time_in</span>  <span class="n">iteration</span>  <span class="n">value</span>  <span class="n">instances</span>  <span class="n">match_index</span> <span class="n">exit_point</span>
    <span class="mi">0</span>                 <span class="n">dynamic_dimension_naming</span>      <span class="mf">0.0</span>    <span class="mf">0.0</span>  <span class="mf">0.000017</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">1</span>         <span class="n">check_A</span><span class="o">-</span><span class="n">dynamic_dimension_naming</span>      <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mf">0.000017</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">2</span>                          <span class="n">check_A</span><span class="o">-</span><span class="n">opt</span><span class="o">-</span><span class="n">sub</span>      <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mf">0.000011</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">3</span>                    <span class="n">remove_identity_nodes</span>      <span class="mf">0.0</span>    <span class="mf">0.0</span>  <span class="mf">0.000086</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">4</span>                  <span class="n">check_B</span><span class="o">-</span><span class="n">remove</span><span class="o">-</span><span class="n">identity</span>      <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mf">0.000012</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="o">..</span>                                     <span class="o">...</span>      <span class="o">...</span>    <span class="o">...</span>       <span class="o">...</span>        <span class="o">...</span>    <span class="o">...</span>        <span class="o">...</span>          <span class="o">...</span>        <span class="o">...</span>
    <span class="mi">504</span>          <span class="n">remove_duplicated_initializer</span>      <span class="mf">0.0</span>    <span class="mf">0.0</span>  <span class="mf">0.000022</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">505</span>  <span class="n">check_H</span><span class="o">-</span><span class="n">remove</span><span class="o">-</span><span class="n">duplicated</span><span class="o">-</span><span class="n">initializer</span>      <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mf">0.000008</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">506</span>                  <span class="n">remove_identity_nodes</span>      <span class="mf">0.0</span>    <span class="mf">0.0</span>  <span class="mf">0.000031</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">507</span>                          <span class="n">remove_unused</span>      <span class="mf">0.0</span>    <span class="n">NaN</span>  <span class="mf">0.000036</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    <span class="mi">508</span>                  <span class="n">check_H</span><span class="o">-</span><span class="n">remove</span><span class="o">-</span><span class="n">unused</span>      <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mf">0.000009</span>        <span class="n">NaN</span>    <span class="n">NaN</span>        <span class="n">NaN</span>          <span class="n">NaN</span>        <span class="n">NaN</span>
    
    <span class="p">[</span><span class="mi">509</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>It can be aggregated:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">onnx</span>
<span class="kn">from</span> <span class="nn">experimental_experiment.xbuilder</span> <span class="kn">import</span> <span class="n">GraphBuilder</span><span class="p">,</span> <span class="n">OptimizationOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;temp_doc_mlp.onnx&quot;</span><span class="p">)</span>

<span class="n">gr</span> <span class="o">=</span> <span class="n">GraphBuilder</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span>
    <span class="n">infer_shapes_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">optimization_options</span><span class="o">=</span><span class="n">OptimizationOptions</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s2">&quot;exit_point&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">aggs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;time_in&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;added&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;removed&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;match_index&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggs</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                         <span class="n">time_in</span>  <span class="n">added</span>  <span class="n">removed</span>  <span class="n">iteration</span>  <span class="n">match_index</span>  <span class="n">instances</span>
    <span class="n">pattern</span>                                                                                        
    <span class="n">apply_GemmTransposePattern</span>          <span class="mf">0.000255</span>      <span class="mi">4</span>        <span class="mi">2</span>          <span class="mi">3</span>            <span class="mi">1</span>          <span class="mi">2</span>
    <span class="n">apply_MatMulAddPattern</span>              <span class="mf">0.000151</span>      <span class="mi">2</span>        <span class="mi">4</span>          <span class="mi">2</span>            <span class="mi">1</span>          <span class="mi">2</span>
    <span class="n">apply_TransposeEqualReshapePattern</span>  <span class="mf">0.000208</span>      <span class="mi">1</span>        <span class="mi">1</span>          <span class="mi">4</span>            <span class="mi">0</span>          <span class="mi">1</span>
    <span class="n">apply_constant_folding</span>              <span class="mf">0.000356</span>      <span class="mi">0</span>        <span class="mi">2</span>          <span class="mi">1</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">apply_constant_folding__Reshape</span>     <span class="mf">0.000000</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">1</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="o">...</span>                                      <span class="o">...</span>    <span class="o">...</span>      <span class="o">...</span>        <span class="o">...</span>          <span class="o">...</span>        <span class="o">...</span>
    <span class="n">pattern_optimization</span>                <span class="mf">0.006578</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">remove_duplicated_initializer</span>       <span class="mf">0.000022</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">remove_duplicated_shape</span>             <span class="mf">0.000012</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">5</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">remove_identity_nodes</span>               <span class="mf">0.000734</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">5</span>            <span class="mi">0</span>          <span class="mi">0</span>
    <span class="n">remove_unused</span>                       <span class="mf">0.000713</span>      <span class="mi">0</span>        <span class="mi">0</span>          <span class="mi">5</span>            <span class="mi">0</span>          <span class="mi">0</span>
    
    <span class="p">[</span><span class="mi">109</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">6</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="shape-inference">
<h2>Shape inference<a class="headerlink" href="#shape-inference" title="Link to this heading">¶</a></h2>
<p>The optimizers require to know the shapes to ensure they can rewrite
some nodes and avoid producing a model which does not return the
same results. If it is missing, some patterns cannot match for sure
and they will not match.</p>
<p>This information can be built by running shape inference
on the onnx models. That’s what is done is the previous examples.
However, the best case is when this information comes from torch.</p>
<p>Function <a class="reference internal" href="../api/torch_interpreter/index.html#experimental_experiment.torch_interpreter.to_onnx" title="experimental_experiment.torch_interpreter.to_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_onnx</span></code></a>
converts a torch model into ONNX. While doing so, it stores the shape
information coming from torch. There is no need to run shape inference
on the onnx model it generates before optimizing it.</p>
</section>
<section id="available-patterns-and-api">
<h2>Available Patterns and API<a class="headerlink" href="#available-patterns-and-api" title="Link to this heading">¶</a></h2>
<p>All patterns may be found at <a class="reference internal" href="../api/xoptim/patterns/index.html#l-pattern-optimization-onnx"><span class="std std-ref">.xoptim.patterns</span></a>
and <a class="reference internal" href="../api/xoptim/patterns_ort/index.html#l-pattern-optimization-ort"><span class="std std-ref">.xoptim.patterns_ort</span></a>.</p>
<p>When writing a pattern, walking along the graph or checking the shape
is very common. Class <a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphBuilderPatternOptimization</span></code></a>
provides the following methods.</p>
<section id="opsets">
<h3>Opsets<a class="headerlink" href="#opsets" title="Link to this heading">¶</a></h3>
<p>Patterns must rewrite using the nodes of the opset defined in the model.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.main_opset" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.main_opset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">main_opset</span></code></a>: returns the opset</p></li>
</ul>
</section>
<section id="shapes-types">
<h3>Shapes, Types<a class="headerlink" href="#shapes-types" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_type</span></code></a>: tells if a result type is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_type</span></code></a>: returns a result type, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_shape</span></code></a>: tells if a result shape is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_shape</span></code></a>: returns a result shape, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_rank" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.has_rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_rank</span></code></a>: tells if a result rank is known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_rank" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_rank</span></code></a>: returns a result rank, fails if not known</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_type" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_infer_type</span></code></a>: returns a type if it can be guessed</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_shape" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.try_infer_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">try_infer_shape</span></code></a>: returns a shape if it can be guessed</p></li>
</ul>
</section>
<section id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_constant</span></code></a>:
tells if a node is a constant (it may be a constant, an initializer or any value built on other constants)</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant_scalar" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_constant_scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_constant_scalar</span></code></a>:
checks a constant is a scalar and compares its value to a number</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_computed_constant" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_computed_constant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_computed_constant</span></code></a>:
returns the constant, computes it is a constant built from other constants</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_attribute" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.get_attribute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_attribute</span></code></a>:
returns an attribute of a node</p></li>
</ul>
</section>
<section id="graph">
<h3>Graph<a class="headerlink" href="#graph" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_node" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">next_node</span></code></a>:
returns the next node only if there is only one</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_nodes" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.next_nodes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">next_nodes</span></code></a>:
returns the node consuming this result</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.node_before" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.node_before"><code class="xref py py-meth docutils literal notranslate"><span class="pre">node_before</span></code></a>:
returns the node producing the result</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_output" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_output"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_output</span></code></a>:
tells if a result is an output</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_by_subgraph" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_by_subgraph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_by_subgraph</span></code></a>:
tells if a result is used by a subgraph</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_more_than_once" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_more_than_once"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_more_than_once</span></code></a>:
tells if a result is used more than once</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_only_by" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.is_used_only_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_used_only_by</span></code></a>:
tells if a result is only used by specific nodes</p></li>
</ul>
</section>
<section id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_node</span></code></a>:
creates a node without adding it to the graph</p></li>
<li><p><a class="reference internal" href="../api/xoptim/index.html#experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node_check_opset" title="experimental_experiment.xoptim.GraphBuilderPatternOptimization.make_node_check_opset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_node_check_opset</span></code></a>:
creates a node without adding it to the graph, deals with some constraints
related to opset version</p></li>
</ul>
</section>
</section>
<section id="examples-or-tools">
<h2>Examples or Tools<a class="headerlink" href="#examples-or-tools" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../auto_examples/plot_rewrite_101.html#l-plot-rewrite-101"><span class="std std-ref">101: Onnx Model Rewriting</span></a></p></li>
<li><p><a class="reference internal" href="../auto_examples/plot_optimize_101.html#l-plot-optimize-101"><span class="std std-ref">101: Onnx Model Optimization based on Pattern Rewriting</span></a></p></li>
<li><p><a class="reference internal" href="../auto_examples/plot_model_to_python.html#l-plot-model-to-code"><span class="std std-ref">Playground for big optimization pattern</span></a></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="backends.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Dynamo Backends</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="exporter.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Custom Exporter</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Pattern Optimizer</a><ul>
<li><a class="reference internal" href="#patterns">Patterns</a><ul>
<li><a class="reference internal" href="#patternoptimization-match">PatternOptimization.match</a></li>
<li><a class="reference internal" href="#patternoptimization-apply">PatternOptimization.apply</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimization-algorithm">Optimization Algorithm</a></li>
<li><a class="reference internal" href="#adding-a-pattern">Adding a pattern</a></li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#simple-api">Simple API</a></li>
<li><a class="reference internal" href="#verbosity">Verbosity</a></li>
<li><a class="reference internal" href="#select-the-pattern-to-use">Select the pattern to use</a></li>
<li><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shape-inference">Shape inference</a></li>
<li><a class="reference internal" href="#available-patterns-and-api">Available Patterns and API</a><ul>
<li><a class="reference internal" href="#opsets">Opsets</a></li>
<li><a class="reference internal" href="#shapes-types">Shapes, Types</a></li>
<li><a class="reference internal" href="#constants">Constants</a></li>
<li><a class="reference internal" href="#graph">Graph</a></li>
<li><a class="reference internal" href="#nodes">Nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples-or-tools">Examples or Tools</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=1a9ffd16"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>