<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="onnx_extended.tools.graph" href="tools_graph.html" /><link rel="prev" title="onnx_extended.tools.onnx_io" href="tools_io.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.04.27 -->
        <title>onnx_extended.tools.einsum - onnx-extended 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=437aa6ec" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">onnx-extended 0.3.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">onnx-extended 0.3.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/reference_evaluator.html">CReferenceEvaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/cython_binding.html">Cython Binding of onnxruntime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/custom_ops.html">Custom Kernels for onnxruntime</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/ops.html">Focus on operators optimization</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Focus on operators optimization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_op_conv_py_vs_c.html">Using C implementation of operator Conv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_op_conv_denorm.html">How float format has an impact on speed computation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_bench_gemm_f8.html">Measuring Gemm performance with different input and output tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_bench_gemm_ort.html">Measuring performance about Gemm with onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_profile_gemm_ort.html">Profiles a simple onnx graph including a singleGemm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_op_einsum.html">Compares implementations of Einsum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_op_mul_cuda.html">Fusing multiplication operators on CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_op_tree_ensemble_optim.html">TreeEnsemble optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_op_tree_ensemble_sparse.html">TreeEnsemble, dense, and sparse</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/many_tools.html">Many Tools to help investigating issues</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Many Tools to help investigating issues</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/external_data.html">External Data and Big Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/onnx_manipulations.html">Onnx Manipulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/quantize.html">Quantization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/statistics.html">Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/profiling.html">Profiling onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/ort_debug.html">Debug Intermediate Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/old_version.html">Compare multiple versions of onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/trees.html">Trees</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/build.html">Build from source</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Build from source</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/build_cython.html">Build with cython</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/build_pybind11.html">Build with pybind11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/build_cuda.html">Build with CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/build_ortext.html">Build with onnxruntime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/readings.html">Readings</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/parallelization.html">Experiments about parallelization</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Experiments about parallelization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/plot_bench_cpu.html">Measuring CPU performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../command_lines.html">command lines</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">API</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="check.html">onnx_extended.__init__.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext_test_case.html">onnx_extended.ext_test_case</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_peak.html">onnx_extended.memory_peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="helper.html">onnx_extended.helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="ortcy.html">onnx_extended.ortcy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="ortops.html">onnx_extended.ortops</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of onnx_extended.ortops</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="ortops_tutorial_cpu.html">onnx_extended.ortops.tutorial.cpu</a></li>
<li class="toctree-l3"><a class="reference internal" href="ortops_tutorial_cuda.html">onnx_extended.ortops.tutorial.cuda</a></li>
<li class="toctree-l3"><a class="reference internal" href="ortops_optim_cpu.html">onnx_extended.ortops.optim.cpu</a></li>
<li class="toctree-l3"><a class="reference internal" href="ortops_optim_cuda.html">onnx_extended.ortops.optim.cuda</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html">onnx_extended.plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">onnx_extended.reference</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="validation.html">validation</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of validation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="validation_cpu.html">validation.cpu</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation_cuda.html">validation.cuda</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation_sparse.html">validation.bench_trees</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation_trees.html">validation.bench_trees</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="tools.html">tools</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of tools</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tools_io.html">onnx_extended.tools.onnx_io</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">onnx_extended.tools.einsum</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools_graph.html">onnx_extended.tools.graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools_graph_transformer.html">onnx_extended.tools.graph.onnx_graph_transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools_inline.html">onnx_extended.tools.onnx_inline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools_nodes.html">onnx_extended.tools.onnx_nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools_stats.html">onnx_extended.tools.stats_nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools_other.html">onnx_extended.tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tech/index.html">Technical Details</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Technical Details</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tech/install_cuda_wsl.html">Install CUDA on WSL (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/usefulcmd.html">Useful commands on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/gemm.html">Gemm and storage order</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/2023-09-05-glibc.html">2023-09-05 - version GLIBCXX_3.4.30 not found</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">ONNX Benchmarks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Examples Gallery</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_bench_cpu.html">Measuring CPU performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_conv_py_vs_c.html">Using C implementation of operator Conv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_bench_cypy_ort.html">Measuring onnxruntime performance against a cython binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_bench_sparse_access.html">Evaluating random access for sparse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_tfidfvectorizer_sparse.html">Measuring performance of TfIdfVectorizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_bench_gemm_f8.html">Measuring Gemm performance with different input and output tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_transpose_2d_cast_cuda.html">Fuse Tranpose and Cast on CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_einsum.html">Compares implementations of Einsum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_mul_cuda.html">Fusing multiplication operators on CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_conv_denorm.html">How float format has an impact on speed computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_scatternd_cuda.html">Optimizing ScatterND operator on CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_tree_ensemble_optim.html">TreeEnsemble optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_tree_ensemble_sparse.html">TreeEnsemble, dense, and sparse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_profile_gemm_ort.html">Profiles a simple onnx graph including a singleGemm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_bench_gemm_ort.html">Measuring performance about Gemm with onnxruntime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_op_tree_ensemble_implementations.html">Evaluate different implementation of TreeEnsemble</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOGS.html">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">LICENSE</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="onnx-extended-tools-einsum">
<h1>onnx_extended.tools.einsum<a class="headerlink" href="#onnx-extended-tools-einsum" title="Link to this heading">¶</a></h1>
<p>Decomposition of Einsum into simple operations.</p>
<section id="analyse-einsum-equation">
<h2>analyse_einsum_equation<a class="headerlink" href="#analyse-einsum-equation" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl.</span></span><span class="sig-name descname"><span class="pre">analyse_einsum_equation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl.html#analyse_einsum_equation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation" title="Link to this definition">¶</a></dt>
<dd><p>Analyses an einsum equation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>equation</strong> – <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a> equation</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>four results, list of letters,
a matrix (see below), lengths of each components,
duplicates</p>
</dd>
</dl>
<p>The returned a matrix is defined as follows:</p>
<div class="math-wrapper docutils container">
<div class="math">
<p><img src="../_images/math/a7063c05b4f6656899a02be77e6ee3d3ab430e60.svg" alt="m_{ij}=\left\{\begin{array}{ll}-1 &amp;
\text{if letter j is involved in input i} \\
p &amp; \text{p is position of letter j in equation i}
\end{array}\right."/></p>
</div></div>
</dd></dl>

</section>
<section id="apply-einsum-sequence">
<h2>apply_einsum_sequence<a class="headerlink" href="#apply-einsum-sequence" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl.</span></span><span class="sig-name descname"><span class="pre">apply_einsum_sequence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><span class="pre">EinsumSubOp</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl.html#apply_einsum_sequence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence" title="Link to this definition">¶</a></dt>
<dd><p>Applies a sequence of operations on a list of inputs.
The sequence of operations is produced by function
<a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation" title="onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation"><code class="xref py py-func docutils literal notranslate"><span class="pre">decompose_einsum_equation()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seq</strong> – sequence of operations</p></li>
<li><p><strong>inputs</strong> – inputs</p></li>
<li><p><strong>verbose</strong> – verbosity</p></li>
<li><p><strong>kwargs</strong> – additional parameters,
see <cite>apply_sequence</cite> in <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphEinsumSubOp</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>output</p>
</dd>
</dl>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">decompose_einsum_equation</span><span class="p">,</span> <span class="n">apply_einsum_sequence</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">100</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1000</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">decompose_einsum_equation</span><span class="p">(</span><span class="s2">&quot;bac,cd,def-&gt;ebc&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">apply_einsum_sequence</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[[[</span> <span class="mi">8866198</span>  <span class="mi">9864696</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">12090270</span> <span class="mi">13152928</span><span class="p">]]</span>
    
     <span class="p">[[</span> <span class="mi">8883886</span>  <span class="mi">9884376</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">12114390</span> <span class="mi">13179168</span><span class="p">]]]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cachedeinsum">
<h2>CachedEinsum<a class="headerlink" href="#cachedeinsum" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.CachedEinsum">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_fct.</span></span><span class="sig-name descname"><span class="pre">CachedEinsum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runtime:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'batch_dot'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimize:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype:</span> <span class="pre">~typing.Any</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'numpy.float64'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decompose:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose:</span> <span class="pre">bool</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#CachedEinsum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum" title="Link to this definition">¶</a></dt>
<dd><p>Stores all the necessary information to cache the preprocessing
of a an einsum equation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equation</strong> – numpy equation</p></li>
<li><p><strong>runtime</strong> – see <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.einsum" title="onnx_extended.tools.einsum.einsum_fct.einsum"><code class="xref py py-func docutils literal notranslate"><span class="pre">einsum</span></code></a></p></li>
<li><p><strong>opset</strong> – ONNX opset</p></li>
<li><p><strong>optimize</strong> – finds the best letter permutation</p></li>
<li><p><strong>dtype</strong> – dtype</p></li>
<li><p><strong>decompose</strong> – to decompose Einsum operator or to keep it as is</p></li>
<li><p><strong>key</strong> – key used to cache this class</p></li>
<li><p><strong>strategy</strong> – optimization strategy</p></li>
<li><p><strong>verbose</strong> – displays progress information</p></li>
</ul>
</dd>
</dl>
<p>The class creates the following attributes:</p>
<ul class="simple">
<li><p><cite>equation_</cite> corresponding to the best equivalent equation</p></li>
<li><dl class="simple">
<dt><cite>graph_</cite>: the corresponding graph returned by function</dt><dd><p><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation" title="onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation"><code class="xref py py-func docutils literal notranslate"><span class="pre">decompose_einsum_equation</span></code></a></p>
</dd>
</dl>
</li>
<li><p><cite>onnx_</cite>: if a conversion to onnx is used, stores the onnx graph</p></li>
<li><p><cite>runtime_</cite>: a function used by <cite>__call__</cite>, calls the runtime</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#CachedEinsum.build"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build" title="Link to this definition">¶</a></dt>
<dd><p>Preprocesses the equation builds whatever is necessary
to compute the result of the einsum equation.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_einsum">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build_einsum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">runtime</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">decompose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum" title="onnx_extended.tools.einsum.einsum_fct.CachedEinsum"><span class="pre">CachedEinsum</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#CachedEinsum.build_einsum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_einsum" title="Link to this definition">¶</a></dt>
<dd><p>Creates an instance of <em>CachedEinsum</em>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_onnx_einsum">
<span class="sig-name descname"><span class="pre">build_onnx_einsum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://onnx.ai/onnx/api/serialization.html#onnx.ModelProto" title="(in ONNX v1.17.0)"><span class="pre">ModelProto</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#CachedEinsum.build_onnx_einsum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_onnx_einsum" title="Link to this definition">¶</a></dt>
<dd><p>Builds an ONNX graph with a single einsum operator.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_runtime">
<span class="sig-name descname"><span class="pre">build_runtime</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#CachedEinsum.build_runtime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_runtime" title="Link to this definition">¶</a></dt>
<dd><p>Builds the runtime associated to the
equation <cite>self.equation_</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.CachedEinsum.default_inputs">
<span class="sig-name descname"><span class="pre">default_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#CachedEinsum.default_inputs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.default_inputs" title="Link to this definition">¶</a></dt>
<dd><p>Returns default inputs (reshaped numpy.arange + 0.7i).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>N</strong> – dimension (all dimension have the same size)</p>
</dd>
</dl>
<p>If <em>N is None</em>, N is given a size depending on the number of letters
to avoid spending too much time on optimization.</p>
</dd></dl>

</dd></dl>

</section>
<section id="compute-transposition-features">
<h2>compute_transposition_features<a class="headerlink" href="#compute-transposition-features" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_ml.compute_transposition_features">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_ml.</span></span><span class="sig-name descname"><span class="pre">compute_transposition_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_ml.html#compute_transposition_features"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_ml.compute_transposition_features" title="Link to this definition">¶</a></dt>
<dd><p>Given a shape and a permutation, computes many features
used to predict the cost of the transposition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> – shape</p></li>
<li><p><strong>perm</strong> – permutation</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dictionary of features</p>
</dd>
</dl>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum.einsum_ml</span> <span class="kn">import</span> <span class="n">compute_transposition_features</span>

<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">compute_transposition_features</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span><span class="s1">&#39;CST_&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;dbegin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
     <span class="s1">&#39;discont&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s1">&#39;edit&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;end16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>
     <span class="s1">&#39;end32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span>
     <span class="s1">&#39;ibegin16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;middle&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
     <span class="s1">&#39;rbegin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
     <span class="s1">&#39;rdiscont&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.01904761904761905</span><span class="p">,</span>
     <span class="s1">&#39;redit&#39;</span><span class="p">:</span> <span class="mf">0.6666666666666666</span><span class="p">,</span>
     <span class="s1">&#39;rend&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
     <span class="s1">&#39;rend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1523809523809524</span><span class="p">,</span>
     <span class="s1">&#39;rend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3047619047619048</span><span class="p">,</span>
     <span class="s1">&#39;rev&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;rmiddle&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
     <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="decompose-einsum-equation">
<h2>decompose_einsum_equation<a class="headerlink" href="#decompose-einsum-equation" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl.</span></span><span class="sig-name descname"><span class="pre">decompose_einsum_equation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">shapes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'simple'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp"><span class="pre">GraphEinsumSubOp</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl.html#decompose_einsum_equation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation" title="Link to this definition">¶</a></dt>
<dd><p>Decomposes an equation used in <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a> knowing
the input shapes. It returns a sequence of operations
to do to compute the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equation</strong> – a string</p></li>
<li><p><strong>shapes</strong> – sequence of input shapes</p></li>
<li><p><strong>strategy</strong> – there are different way to decompose the equation,
this parameters defines the way to do it (see below)</p></li>
<li><p><strong>clean</strong> – clean the unnecessary node in the graph</p></li>
<li><p><strong>verbose</strong> – verbosity</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>instance of <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphEinsumSubOp</span></code></a></p>
</dd>
</dl>
<p>About <em>strategy</em>:</p>
<ul class="simple">
<li><p><cite>‘simple’</cite>: align all dimensions in the alphabetical order,
some generic matrix multiplication remains implemented with
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a> but only with two matrices aligned on
the same dimension (see <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot</span></code></a>)</p></li>
<li><p><cite>‘numpy’</cite>: same as <cite>simple</cite> but the decomposition does not use
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a> anymore but only multiplication or
matrix multiplication merged into a single operator called
<em>batch_dot</em> (see <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_matrix" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot_matrix</span></code></a>)</p></li>
</ul>
<p>Available operations: <em>expand_dims</em>, <em>transpose</em>, <em>matmul</em>, <em>reduce_sum</em>,
<em>id</em>, <em>squeeze</em>, <em>diagonal</em>. It analyses an equation and produces a graph
where nodes are instance of class <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">EinsumSubOp</span></code></a>.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">decompose_einsum_equation</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">decompose_einsum_equation</span><span class="p">(</span><span class="s2">&quot;bac,cd,def-&gt;ebc&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;squeeze&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;matmul&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;reduce_sum&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;expand_dims&#39;</span><span class="p">,</span> <span class="n">EinsumSubOp</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>It can be better displayed as the following.</p>
<div class="graphviz"><img src="../_images/graphviz-b5e11f73381c192e37a0c90ba16fe670bcae4ab5.png" alt="digraph{
orientation=portrait;
ranksep=0.25;
nodesep=0.05;
width=0.5;
height=0.1;
size=5;
node [shape=record];
0 [label=&quot;input 0\\nbac\\n[ 1  0  2 -1 -1 -1]&quot;];
140096070466576 [label=&quot;id\\nNone&quot;];
0 -&gt; 140096070466576;
140096065938304 [label=&quot;expand_dims\\naxes=((3, 3), (3, 4), (3, 5))None&quot;];
140096070466576 -&gt; 140096065938304;
140096065938352 [label=&quot;transpose\\nperm=(1, 0, 2, 3, 4, 5)None&quot;];
140096065938304 -&gt; 140096065938352;
140092509958208 [label=&quot;reduce_sum - I0\\naxes=(0,)None&quot; style=filled fillcolor=red];
140096065938352 -&gt; 140092509958208;
1 [label=&quot;input 1\\ncd\\n[-1 -1  0  1 -1 -1]&quot;];
140092509958064 [label=&quot;id\\nNone&quot;];
1 -&gt; 140092509958064;
140092509958160 [label=&quot;expand_dims\\naxes=((0, 0), (0, 1), (2, 4), (2, 5))None&quot;];
140092509958064 -&gt; 140092509958160;
140092509958640 [label=&quot;matmul - I1\\naxes=() left=(1, 2) ndim=6 right=(2, 3)\\n~aBCdef,abCDef-\\=aBCDef&quot; style=filled fillcolor=red];
140092509958208 -&gt; 140092509958640;
140092509958160 -&gt; 140092509958640;
2 [label=&quot;input 2\\ndef\\n[-1 -1 -1  0  1  2]&quot;];
140092509958592 [label=&quot;id\\nNone&quot;];
2 -&gt; 140092509958592;
140092509958496 [label=&quot;expand_dims\\naxes=((0, 0), (0, 1), (0, 2))None&quot;];
140092509958592 -&gt; 140092509958496;
140092509958736 [label=&quot;reduce_sum\\naxes=(5,)None&quot;];
140092509958496 -&gt; 140092509958736;
140092509959216 [label=&quot;matmul - I2\\naxes=(3,) left=(1, 2) ndim=6 right=(4,)\\n~aBCdef,abcdEf-\\=aBCEf&quot; style=filled fillcolor=red];
140092509958640 -&gt; 140092509959216;
140092509958736 -&gt; 140092509959216;
140092509959024 [label=&quot;transpose\\nperm=(0, 4, 1, 3, 2, 5)None&quot;];
140092509959216 -&gt; 140092509959024;
140092509959168 [label=&quot;squeeze - I-1\\naxes=(0, 3, 5)None&quot; style=filled fillcolor=red];
140092509959024 -&gt; 140092509959168;
}" class="graphviz" /></div>
</dd></dl>

</section>
<section id="einsum">
<h2>einsum<a class="headerlink" href="#einsum" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.einsum">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_fct.</span></span><span class="sig-name descname"><span class="pre">einsum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runtime</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch_dot'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decompose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#einsum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.einsum" title="Link to this definition">¶</a></dt>
<dd><p>Proposes a new implementation of <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a>.
It does not allow expresion using <cite>…</cite> and expects
a right member.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equation</strong> – einsum equation</p></li>
<li><p><strong>inputs</strong> – inputs</p></li>
<li><p><strong>optimize</strong> – permutes all letters to find the best
permutation</p></li>
<li><p><strong>runtime</strong> – runtime used to compute the results once the
computation graph is produced (see below)</p></li>
<li><p><strong>cache</strong> – if True, the function stores the preprocessing
done for a specific equation, the second call with the same
equation is much faster</p></li>
<li><p><strong>opset</strong> – ONNX opset to use for some runtimes</p></li>
<li><p><strong>decompose</strong> – by default, the function decomposes
the equation into more simple operators but it can keep
the original ONNX einsum operator.</p></li>
<li><p><strong>strategy</strong> – optimisation strategy (see below)</p></li>
<li><p><strong>verbose</strong> – display progress if optimize is True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>einsum result</p>
</dd>
</dl>
<p>The available runtimes are:</p>
<ul class="simple">
<li><p><cite>batch_dot</cite>: the runtime is <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence" title="onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence"><code class="xref py py-func docutils literal notranslate"><span class="pre">apply_einsum_sequence</span></code></a>,</p></li>
<li><p><cite>python</cite>: one ONNX graph executed with a python runtime,</p></li>
<li><p><cite>onnxruntime</cite>: one ONNX graph executed with <a class="reference external" href="https://onnxruntime.ai/">onnxruntime</a>.</p></li>
</ul>
<p>The optimisation strategy can be:</p>
<ul class="simple">
<li><p><cite>None</cite>: the same runtime is used to find the best permutation of letters</p></li>
<li><dl class="simple">
<dt><cite>‘ml’</cite>: a machine learned model is used to predict the</dt><dd><p>best permutation of letters.</p>
</dd>
</dl>
</li>
</ul>
<p>The function works in two steps:</p>
<ul class="simple">
<li><p>first step analyses the equation to produce a computation graph,
this graph can also be converted into ONNX,</p></li>
<li><p>second step runs the graph whatever the graph is.</p></li>
</ul>
<p>Further details are available in the documentation of function
<a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.optimize_decompose_einsum_equation" title="onnx_extended.tools.einsum.einsum_fct.optimize_decompose_einsum_equation"><code class="xref py py-func docutils literal notranslate"><span class="pre">optimize_decompose_einsum_equation()</span></code></a>.
The function works the same way as <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a>:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">einsum</span>

<span class="n">equation</span> <span class="o">=</span> <span class="s2">&quot;abc,cd-&gt;abd&quot;</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">np</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;numpy.einsum&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;onnx_extended.tools.einsum&quot;</span><span class="p">)</span>
<span class="n">mp</span> <span class="o">=</span> <span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span>
    <span class="p">[[[</span> <span class="mf">1.406</span>  <span class="mf">0.266</span><span class="p">]</span>
      <span class="p">[</span><span class="o">-</span><span class="mf">0.837</span> <span class="o">-</span><span class="mf">0.359</span><span class="p">]]</span>
    
     <span class="p">[[</span> <span class="mf">1.737</span> <span class="o">-</span><span class="mf">0.317</span><span class="p">]</span>
      <span class="p">[</span> <span class="mf">1.739</span>  <span class="mf">1.243</span><span class="p">]]]</span>
    <span class="n">onnx_extended</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">einsum</span>
    <span class="p">[[[</span> <span class="mf">1.406</span>  <span class="mf">0.266</span><span class="p">]</span>
      <span class="p">[</span><span class="o">-</span><span class="mf">0.837</span> <span class="o">-</span><span class="mf">0.359</span><span class="p">]]</span>
    
     <span class="p">[[</span> <span class="mf">1.737</span> <span class="o">-</span><span class="mf">0.317</span><span class="p">]</span>
      <span class="p">[</span> <span class="mf">1.739</span>  <span class="mf">1.243</span><span class="p">]]]</span>
</pre></div>
</div>
<p>In some case, the einsum implementation can be optimized by looping
on possible permutation:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">einsum</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum.einsum_fct</span> <span class="kn">import</span> <span class="n">enumerate_cached_einsum</span>

<span class="n">equation</span> <span class="o">=</span> <span class="s2">&quot;cab,cd-&gt;ad&quot;</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;numpy.einsum&quot;</span><span class="p">,</span>
    <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s2">&quot;numpy.einsum(equation, m1, m2)&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">()),</span>
<span class="p">)</span>

<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;einsum&quot;</span><span class="p">,</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s2">&quot;einsum(equation, m1, m2)&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
<span class="p">)</span>

<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;einsum-python&quot;</span><span class="p">,</span>
    <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
        <span class="s1">&#39;einsum(equation, m1, m2, runtime=&quot;python&quot;)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">()</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;einsum-onnxruntime&quot;</span><span class="p">,</span>
    <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
        <span class="s1">&#39;einsum(equation, m1, m2, runtime=&quot;onnxruntime&quot;)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">()</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime&quot;</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;einsum-onnxruntime&quot;</span><span class="p">,</span>
    <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
        <span class="s1">&#39;einsum(equation, m1, m2, runtime=&quot;onnxruntime&quot;, optimize=True)&#39;</span><span class="p">,</span>
        <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list of cached einsum equations&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">enumerate_cached_einsum</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">equation</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">equation_</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    numpy.einsum 0.048173299999689334
    einsum 0.01973530000032042
    einsum-python 0.0946436000012909
    einsum-onnxruntime 0.017104599999584025
    einsum-onnxruntime 0.011454200001026038
    list of cached einsum equations
    (&#39;cab,cd-&gt;ad&#39;, &#39;batch_dot&#39;, None, False, dtype(&#39;float64&#39;), True, None) cab,cd-&gt;ad cab,cd-&gt;ad
    (&#39;cab,cd-&gt;ad&#39;, &#39;python&#39;, None, False, dtype(&#39;float64&#39;), True, None) cab,cd-&gt;ad cab,cd-&gt;ad
    (&#39;cab,cd-&gt;ad&#39;, &#39;onnxruntime&#39;, None, False, dtype(&#39;float64&#39;), True, None) cab,cd-&gt;ad cab,cd-&gt;ad
    (&#39;cab,cd-&gt;ad&#39;, &#39;onnxruntime&#39;, None, True, dtype(&#39;float64&#39;), True, None) cab,cd-&gt;ad dcb,da-&gt;ca
    [runpythonerror]
    0%|          | 0/25 [00:00&lt;?, ?it/s]
0.0015 rtbest=&#39;cab,cd-&gt;ad&#39;:   0%|          | 0/25 [00:00&lt;?, ?it/s]
0.0011 rtbest=&#39;dab,dc-&gt;ac&#39;:   0%|          | 0/25 [00:00&lt;?, ?it/s]
0.001 rtbest=&#39;bad,bc-&gt;ac&#39;:   0%|          | 0/25 [00:00&lt;?, ?it/s] 
0.00072 rtbest=&#39;dac,db-&gt;ab&#39;:   0%|          | 0/25 [00:00&lt;?, ?it/s]
0.00072 rtbest=&#39;dac,db-&gt;ab&#39;:  24%|██▍       | 6/25 [00:00&lt;00:00, 57.19it/s]
0.00062 rtbest=&#39;bda,bc-&gt;dc&#39;:  24%|██▍       | 6/25 [00:00&lt;00:00, 57.19it/s]
0.0006 rtbest=&#39;dca,db-&gt;cb&#39;:  24%|██▍       | 6/25 [00:00&lt;00:00, 57.19it/s] 
0.0006 rtbest=&#39;dca,db-&gt;cb&#39;:  52%|█████▏    | 13/25 [00:00&lt;00:00, 61.30it/s]
0.00058 rtbest=&#39;abd,ac-&gt;bc&#39;:  52%|█████▏    | 13/25 [00:00&lt;00:00, 61.30it/s]
0.00058 rtbest=&#39;abd,ac-&gt;bc&#39;:  80%|████████  | 20/25 [00:00&lt;00:00, 64.03it/s]
0.00057 rtbest=&#39;dcb,da-&gt;ca&#39;:  80%|████████  | 20/25 [00:00&lt;00:00, 64.03it/s]
0.00057 rtbest=&#39;dcb,da-&gt;ca&#39;: 100%|██████████| 25/25 [00:00&lt;00:00, 63.75it/s]
</pre></div>
</div>
<p>The last example shows the time taken by every function:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">cProfile</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">pstats</span> <span class="kn">import</span> <span class="n">Stats</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">einsum</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum.einsum_fct</span> <span class="kn">import</span> <span class="n">enumerate_cached_einsum</span>
<span class="kn">from</span> <span class="nn">onnx_extended</span> <span class="kn">import</span> <span class="vm">__file__</span> <span class="k">as</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">fct</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;cumulative&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">cProfile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
    <span class="n">fct_res</span> <span class="o">=</span> <span class="n">fct</span><span class="p">()</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
    <span class="n">ps</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ps</span><span class="p">,</span> <span class="n">res</span>


<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;onnx-extended&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="n">equation</span> <span class="o">=</span> <span class="s2">&quot;cab,cd-&gt;ad&quot;</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;onnx_extended&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="mi">30</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">fct1</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile cache with default runtime.&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">profile</span><span class="p">(</span><span class="n">fct1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">fct2</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile cache with runtime=&#39;python&#39;.&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">profile</span><span class="p">(</span><span class="n">fct2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">fct3</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile execution with default runtime.&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">profile</span><span class="p">(</span><span class="n">fct3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">fct4</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>


<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile execution with runtime=&#39;python&#39;.&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">profile</span><span class="p">(</span><span class="n">fct4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">fct5</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime&quot;</span><span class="p">)</span>


<span class="n">einsum</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;onnxruntime&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile execution with runtime=&#39;onnxruntime&#39;.&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">profile</span><span class="p">(</span><span class="n">fct5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">Profile</span> <span class="n">cache</span> <span class="k">with</span> <span class="n">default</span> <span class="n">runtime</span><span class="o">.</span>
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">-</span><span class="n">extended</span><span class="o">/</span><span class="n">onnx_extended</span>
             <span class="mi">128702</span> <span class="n">function</span> <span class="n">calls</span> <span class="p">(</span><span class="mi">128502</span> <span class="n">primitive</span> <span class="n">calls</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">0.335</span> <span class="n">seconds</span>
    
       <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
    
       <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.335</span>    <span class="mf">0.335</span> <span class="o">&lt;</span><span class="n">stdin</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">45</span><span class="p">(</span><span class="n">fct1</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.335</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">691</span><span class="p">(</span><span class="n">einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.242</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">599</span><span class="p">(</span><span class="n">optimize_decompose_einsum_equation</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.242</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">562</span><span class="p">(</span><span class="n">_einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.242</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">532</span><span class="p">(</span><span class="n">build_einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.241</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">305</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.240</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">475</span><span class="p">(</span><span class="n">build_runtime</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.239</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">79</span><span class="p">(</span><span class="n">decompose_einsum_equation</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.020</span>    <span class="mf">0.000</span>    <span class="mf">0.170</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">415</span><span class="p">(</span><span class="n">_decompose_einsum_equation_simple</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.091</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">525</span><span class="p">(</span><span class="fm">__call__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.090</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">500</span><span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.090</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">163</span><span class="p">(</span><span class="n">apply_einsum_sequence</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.004</span>    <span class="mf">0.000</span>    <span class="mf">0.089</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1390</span><span class="p">(</span><span class="n">apply_sequence</span><span class="p">)</span>
         <span class="mi">1200</span>    <span class="mf">0.006</span>    <span class="mf">0.000</span>    <span class="mf">0.085</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">717</span><span class="p">(</span><span class="n">apply</span><span class="p">)</span>
         <span class="mi">1200</span>    <span class="mf">0.011</span>    <span class="mf">0.000</span>    <span class="mf">0.068</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">412</span><span class="p">(</span><span class="n">compute_output_row</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.045</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1415</span><span class="p">(</span><span class="n">clean_unused_nodes</span><span class="p">)</span>
          <span class="mi">200</span>    <span class="mf">0.023</span>    <span class="mf">0.000</span>    <span class="mf">0.045</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1422</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
         <span class="mi">4800</span>    <span class="mf">0.007</span>    <span class="mf">0.000</span>    <span class="mf">0.027</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">19</span><span class="p">(</span><span class="n">single_axes</span><span class="p">)</span>
         <span class="mi">1900</span>    <span class="mf">0.026</span>    <span class="mf">0.000</span>    <span class="mf">0.026</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;reduce&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ufunc&#39;</span> <span class="n">objects</span><span class="p">}</span>
          <span class="mi">100</span>    <span class="mf">0.005</span>    <span class="mf">0.000</span>    <span class="mf">0.024</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">596</span><span class="p">(</span><span class="n">_apply_batch_dot</span><span class="p">)</span>
          <span class="mi">500</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span>    <span class="mf">0.024</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">71</span><span class="p">(</span><span class="n">_wrapreduction</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.020</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">676</span><span class="p">(</span><span class="n">_apply_reduce_sum</span><span class="p">)</span>
        <span class="mi">22100</span>    <span class="mf">0.020</span>    <span class="mf">0.000</span>    <span class="mf">0.020</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="p">}</span>
         <span class="mi">3800</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">32</span><span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">500</span>    <span class="mf">0.012</span>    <span class="mf">0.000</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">232</span><span class="p">(</span><span class="n">_apply_transpose_reshape</span><span class="p">)</span>
    <span class="n">Profile</span> <span class="n">cache</span> <span class="k">with</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="o">.</span>
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">-</span><span class="n">extended</span><span class="o">/</span><span class="n">onnx_extended</span>
             <span class="mi">437846</span> <span class="n">function</span> <span class="n">calls</span> <span class="p">(</span><span class="mi">434146</span> <span class="n">primitive</span> <span class="n">calls</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">1.088</span> <span class="n">seconds</span>
    
       <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
    
       <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="mi">1</span>    <span class="mf">0.001</span>    <span class="mf">0.001</span>    <span class="mf">1.088</span>    <span class="mf">1.088</span> <span class="o">&lt;</span><span class="n">stdin</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">56</span><span class="p">(</span><span class="n">fct2</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">1.088</span>    <span class="mf">0.011</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">691</span><span class="p">(</span><span class="n">einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.741</span>    <span class="mf">0.007</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">599</span><span class="p">(</span><span class="n">optimize_decompose_einsum_equation</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.741</span>    <span class="mf">0.007</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">562</span><span class="p">(</span><span class="n">_einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.740</span>    <span class="mf">0.007</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">532</span><span class="p">(</span><span class="n">build_einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.739</span>    <span class="mf">0.007</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">305</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.006</span>    <span class="mf">0.000</span>    <span class="mf">0.738</span>    <span class="mf">0.007</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">475</span><span class="p">(</span><span class="n">build_runtime</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.345</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">525</span><span class="p">(</span><span class="fm">__call__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.344</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">512</span><span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.046</span>    <span class="mf">0.000</span>    <span class="mf">0.342</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">c_reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">262</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.018</span>    <span class="mf">0.000</span>    <span class="mf">0.258</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1652</span><span class="p">(</span><span class="n">to_onnx</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.256</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">c_reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">231</span><span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.007</span>    <span class="mf">0.000</span>    <span class="mf">0.222</span>    <span class="mf">0.002</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">202</span><span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.216</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">79</span><span class="p">(</span><span class="n">decompose_einsum_equation</span><span class="p">)</span>
         <span class="mi">2300</span>    <span class="mf">0.030</span>    <span class="mf">0.000</span>    <span class="mf">0.206</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">443</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.014</span>    <span class="mf">0.000</span>    <span class="mf">0.200</span>    <span class="mf">0.002</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">398</span><span class="p">(</span><span class="n">_init</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.018</span>    <span class="mf">0.000</span>    <span class="mf">0.158</span>    <span class="mf">0.002</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">415</span><span class="p">(</span><span class="n">_decompose_einsum_equation_simple</span><span class="p">)</span>
         <span class="mi">5000</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span>    <span class="mf">0.156</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1144</span><span class="p">(</span><span class="n">to_onnx</span><span class="p">)</span>
         <span class="mi">2800</span>    <span class="mf">0.015</span>    <span class="mf">0.000</span>    <span class="mf">0.100</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">215</span><span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
         <span class="mi">3400</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span>    <span class="mf">0.090</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">411</span><span class="p">(</span><span class="n">_check_and_fix_outputs</span><span class="p">)</span>
         <span class="mi">2800</span>    <span class="mf">0.038</span>    <span class="mf">0.000</span>    <span class="mf">0.080</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">286</span><span class="p">(</span><span class="n">_load_attributes</span><span class="p">)</span>
         <span class="mi">2800</span>    <span class="mf">0.016</span>    <span class="mf">0.000</span>    <span class="mf">0.062</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">132</span><span class="p">(</span><span class="n">make_node</span><span class="p">)</span>
         <span class="mi">1200</span>    <span class="mf">0.011</span>    <span class="mf">0.000</span>    <span class="mf">0.062</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">412</span><span class="p">(</span><span class="n">compute_output_row</span><span class="p">)</span>
        <span class="mi">55003</span>    <span class="mf">0.041</span>    <span class="mf">0.000</span>    <span class="mf">0.059</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="p">}</span>
         <span class="mi">2800</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span>    <span class="mf">0.055</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">455</span><span class="p">(</span><span class="n">_load_impl</span><span class="p">)</span>
    <span class="n">Profile</span> <span class="n">execution</span> <span class="k">with</span> <span class="n">default</span> <span class="n">runtime</span><span class="o">.</span>
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">-</span><span class="n">extended</span><span class="o">/</span><span class="n">onnx_extended</span>
             <span class="mi">32202</span> <span class="n">function</span> <span class="n">calls</span> <span class="ow">in</span> <span class="mf">0.070</span> <span class="n">seconds</span>
    
       <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
    
       <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.070</span>    <span class="mf">0.070</span> <span class="o">&lt;</span><span class="n">stdin</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">67</span><span class="p">(</span><span class="n">fct3</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.070</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">691</span><span class="p">(</span><span class="n">einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.068</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">525</span><span class="p">(</span><span class="fm">__call__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.068</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">500</span><span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.068</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">163</span><span class="p">(</span><span class="n">apply_einsum_sequence</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span>    <span class="mf">0.068</span>    <span class="mf">0.001</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1390</span><span class="p">(</span><span class="n">apply_sequence</span><span class="p">)</span>
         <span class="mi">1200</span>    <span class="mf">0.004</span>    <span class="mf">0.000</span>    <span class="mf">0.064</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">717</span><span class="p">(</span><span class="n">apply</span><span class="p">)</span>
          <span class="mi">500</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.019</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">71</span><span class="p">(</span><span class="n">_wrapreduction</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.004</span>    <span class="mf">0.000</span>    <span class="mf">0.018</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">596</span><span class="p">(</span><span class="n">_apply_batch_dot</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.016</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">676</span><span class="p">(</span><span class="n">_apply_reduce_sum</span><span class="p">)</span>
          <span class="mi">500</span>    <span class="mf">0.016</span>    <span class="mf">0.000</span>    <span class="mf">0.016</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;reduce&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ufunc&#39;</span> <span class="n">objects</span><span class="p">}</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.014</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2177</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
          <span class="mi">200</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.010</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">503</span><span class="p">(</span><span class="n">_apply_expand_dims</span><span class="p">)</span>
          <span class="mi">400</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.009</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">516</span><span class="p">(</span><span class="n">_apply_transpose</span><span class="p">)</span>
          <span class="mi">300</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.007</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">shape_base</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">512</span><span class="p">(</span><span class="n">expand_dims</span><span class="p">)</span>
         <span class="mi">1300</span>    <span class="mf">0.004</span>    <span class="mf">0.000</span>    <span class="mf">0.006</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">463</span><span class="p">(</span><span class="n">_get_data</span><span class="p">)</span>
          <span class="mi">400</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.006</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2979</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
         <span class="mi">4500</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="p">}</span>
         <span class="mi">1300</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">455</span><span class="p">(</span><span class="n">_check_shape_</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">blas_lapack</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">76</span><span class="p">(</span><span class="n">gemm_dot</span><span class="p">)</span>
          <span class="mi">300</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">numeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1330</span><span class="p">(</span><span class="n">normalize_axis_tuple</span><span class="p">)</span>
          <span class="mi">400</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">588</span><span class="p">(</span><span class="n">transpose</span><span class="p">)</span>
         <span class="mi">1200</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">446</span><span class="p">(</span><span class="n">_check_inputs_</span><span class="p">)</span>
          <span class="mi">300</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">478</span><span class="p">(</span><span class="n">_apply_id</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_impl_classes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">703</span><span class="p">(</span><span class="n">_apply_squeeze</span><span class="p">)</span>
    <span class="n">Profile</span> <span class="n">execution</span> <span class="k">with</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="o">.</span>
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">-</span><span class="n">extended</span><span class="o">/</span><span class="n">onnx_extended</span>
             <span class="mi">145502</span> <span class="n">function</span> <span class="n">calls</span> <span class="ow">in</span> <span class="mf">0.264</span> <span class="n">seconds</span>
    
       <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
    
       <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.264</span>    <span class="mf">0.264</span> <span class="o">&lt;</span><span class="n">stdin</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">79</span><span class="p">(</span><span class="n">fct4</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.264</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">691</span><span class="p">(</span><span class="n">einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.262</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">525</span><span class="p">(</span><span class="fm">__call__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.262</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">512</span><span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.035</span>    <span class="mf">0.000</span>    <span class="mf">0.261</span>    <span class="mf">0.003</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">c_reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">262</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
         <span class="mi">2300</span>    <span class="mf">0.023</span>    <span class="mf">0.000</span>    <span class="mf">0.159</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">443</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
         <span class="mi">3400</span>    <span class="mf">0.016</span>    <span class="mf">0.000</span>    <span class="mf">0.074</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">411</span><span class="p">(</span><span class="n">_check_and_fix_outputs</span><span class="p">)</span>
          <span class="mi">400</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.032</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">_op</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">42</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
         <span class="mi">6800</span>    <span class="mf">0.012</span>    <span class="mf">0.000</span>    <span class="mf">0.028</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">any</span><span class="p">}</span>
         <span class="mi">6800</span>    <span class="mf">0.007</span>    <span class="mf">0.000</span>    <span class="mf">0.027</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">428</span><span class="p">(</span><span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">400</span>    <span class="mf">0.002</span>    <span class="mf">0.000</span>    <span class="mf">0.021</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">_op</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">19</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
        <span class="mi">20900</span>    <span class="mf">0.014</span>    <span class="mf">0.000</span>    <span class="mf">0.021</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="p">}</span>
         <span class="mi">3400</span>    <span class="mf">0.008</span>    <span class="mf">0.000</span>    <span class="mf">0.021</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">numeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1855</span><span class="p">(</span><span class="n">isscalar</span><span class="p">)</span>
         <span class="mi">5600</span>    <span class="mf">0.008</span>    <span class="mf">0.000</span>    <span class="mf">0.020</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">244</span><span class="p">(</span><span class="n">_log</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.015</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">op_reduce_sum</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">(</span><span class="n">_run</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.013</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2177</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.013</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">71</span><span class="p">(</span><span class="n">_wrapreduction</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.012</span>    <span class="mf">0.000</span>    <span class="mf">0.012</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;reduce&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ufunc&#39;</span> <span class="n">objects</span><span class="p">}</span>
         <span class="mi">5600</span>    <span class="mf">0.008</span>    <span class="mf">0.000</span>    <span class="mf">0.012</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">reference_evaluator</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">409</span><span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">300</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.012</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">op_reshape</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">34</span><span class="p">(</span><span class="n">_run</span><span class="p">)</span>
          <span class="mi">300</span>    <span class="mf">0.005</span>    <span class="mf">0.000</span>    <span class="mf">0.011</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">op_reshape</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span><span class="p">(</span><span class="n">reshape_reference_implementation</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.009</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">op_max</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">15</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
         <span class="mi">6800</span>    <span class="mf">0.007</span>    <span class="mf">0.000</span>    <span class="mf">0.008</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">op_run</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">431</span><span class="p">(</span><span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.008</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">_op</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">104</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
         <span class="mi">1300</span>    <span class="mf">0.003</span>    <span class="mf">0.000</span>    <span class="mf">0.008</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">fromnumeric</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">53</span><span class="p">(</span><span class="n">_wrapfunc</span><span class="p">)</span>
    <span class="n">Profile</span> <span class="n">execution</span> <span class="k">with</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;onnxruntime&#39;</span><span class="o">.</span>
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnx</span><span class="o">-</span><span class="n">extended</span><span class="o">/</span><span class="n">onnx_extended</span>
             <span class="mi">1602</span> <span class="n">function</span> <span class="n">calls</span> <span class="ow">in</span> <span class="mf">0.038</span> <span class="n">seconds</span>
    
       <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
    
       <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.038</span>    <span class="mf">0.038</span> <span class="o">&lt;</span><span class="n">stdin</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">91</span><span class="p">(</span><span class="n">fct5</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.001</span>    <span class="mf">0.000</span>    <span class="mf">0.038</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">691</span><span class="p">(</span><span class="n">einsum</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.037</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">525</span><span class="p">(</span><span class="fm">__call__</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.036</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">512</span><span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.035</span>    <span class="mf">0.000</span>    <span class="mf">0.036</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">linux_cuda</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">202</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">599</span><span class="p">(</span><span class="n">optimize_decompose_einsum_equation</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">linux_cuda</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">192</span><span class="p">(</span><span class="n">_validate_input</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">562</span><span class="p">(</span><span class="n">_einsum</span><span class="p">)</span>
          <span class="mi">300</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">931</span><span class="p">(</span><span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xadupre</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">linux_cuda</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">218</span><span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="n">onnx_extended</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">einsum</span><span class="o">/</span><span class="n">einsum_fct</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">513</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dictcomp</span><span class="o">&gt;</span><span class="p">)</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;get&#39;</span> <span class="n">of</span> <span class="s1">&#39;dict&#39;</span> <span class="n">objects</span><span class="p">}</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="p">}</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="p">}</span>
          <span class="mi">100</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;keys&#39;</span> <span class="n">of</span> <span class="s1">&#39;dict&#39;</span> <span class="n">objects</span><span class="p">}</span>
            <span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;disable&#39;</span> <span class="n">of</span> <span class="s1">&#39;_lsprof.Profiler&#39;</span> <span class="n">objects</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="einsum-benchmark">
<h2>einsum_benchmark<a class="headerlink" href="#einsum-benchmark" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_bench.einsum_benchmark">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_bench.</span></span><span class="sig-name descname"><span class="pre">einsum_benchmark</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'abc,cd-&gt;abd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runtime</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'python'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_tqdm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repeat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">18</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.12)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_bench.html#einsum_benchmark"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_bench.einsum_benchmark" title="Link to this definition">¶</a></dt>
<dd><p>Investigates whether or not the decomposing einsum is faster.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equation</strong> – einsum equation to test</p></li>
<li><p><strong>shape</strong> – an integer (all dimension gets the same size) or
a list of shapes in a string separated with <cite>;</cite>)</p></li>
<li><p><strong>perm</strong> – check on permutation or all letter permutations</p></li>
<li><p><strong>runtime</strong> – a string among ‘numpy’, ‘python’, ‘onnxruntime’</p></li>
<li><p><strong>use_tqdm</strong> – show progress</p></li>
<li><p><strong>number</strong> – usual parameter to measure a function</p></li>
<li><p><strong>repeat</strong> – usual parameter to measure a function</p></li>
<li><p><strong>opset</strong> – target opset</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of dictionaries as an iterator</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="numpy-extended-dot">
<h2>numpy_extended_dot<a class="headerlink" href="#numpy-extended-dot" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl_ext.</span></span><span class="sig-name descname"><span class="pre">numpy_extended_dot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">m2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_ext.html#numpy_extended_dot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot" title="Link to this definition">¶</a></dt>
<dd><p>Extended version of a matrix multiplication (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dot.html#numpy.dot" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.dot()</span></code></a>)
with two matrices <em>m1</em>, <em>m2</em> of the same dimensions.
Loops over <em>left</em> axes for <em>m1</em> and <em>right</em> axes for <em>m2</em>,
summation is done over <em>axes</em>.
Other axes must be empty.
This multiplication combines matrix multiplication (dot)
and broadcasted multiplication term by term.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m1</strong> – first matrix</p></li>
<li><p><strong>m2</strong> – second matrix</p></li>
<li><p><strong>axes</strong> – summation axes</p></li>
<li><p><strong>left</strong> – left axes</p></li>
<li><p><strong>right</strong> – right axes</p></li>
<li><p><strong>verbose</strong> – display intermediate information</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>output</p>
</dd>
</dl>
<p>The dot product is equivalent to:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">numpy_extended_dot</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dot product&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m1</span> <span class="o">@</span> <span class="n">m2</span><span class="p">)</span>

<span class="n">dm1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dm2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">dot</span> <span class="o">=</span> <span class="n">numpy_extended_dot</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;extended dot product&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">dot</span> <span class="n">product</span>
    <span class="p">[[</span><span class="mi">12</span> <span class="mi">13</span><span class="p">]</span>
     <span class="p">[</span><span class="mi">56</span> <span class="mi">61</span><span class="p">]]</span>
      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="n">Abc</span><span class="p">,</span><span class="n">abC</span><span class="o">-&gt;</span><span class="n">AC</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">reshaped</span> <span class="n">into</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> 
    <span class="n">extended</span> <span class="n">dot</span> <span class="n">product</span>
    <span class="p">[[[</span><span class="mi">12</span> <span class="mi">13</span><span class="p">]]</span>
    
     <span class="p">[[</span><span class="mi">56</span> <span class="mi">61</span><span class="p">]]]</span>
</pre></div>
</div>
<p>Empty axes should be squeezed to get identical results.
Dot product when the second matrix is transposed.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">numpy_extended_dot</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dot product&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m1</span> <span class="o">@</span> <span class="n">m2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">dm1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">dm2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">dot</span> <span class="o">=</span> <span class="n">numpy_extended_dot</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;extended dot product&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">dot</span> <span class="n">product</span>
    <span class="p">[[</span><span class="mi">11</span> <span class="mi">13</span><span class="p">]</span>
     <span class="p">[</span><span class="mi">53</span> <span class="mi">63</span><span class="p">]]</span>
      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="n">Abc</span><span class="p">,</span><span class="n">aBc</span><span class="o">-&gt;</span><span class="n">AB</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">reshaped</span> <span class="n">into</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> 
    <span class="n">extended</span> <span class="n">dot</span> <span class="n">product</span>
    <span class="p">[[[</span><span class="mi">11</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">13</span><span class="p">]]</span>
    
     <span class="p">[[</span><span class="mi">53</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">63</span><span class="p">]]]</span>
</pre></div>
</div>
<p>An example when right axes include the summation axis.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">numpy_extended_dot</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dm2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">dot</span> <span class="o">=</span> <span class="n">numpy_extended_dot</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="n">Abc</span><span class="p">,</span><span class="n">aBc</span><span class="o">-&gt;</span><span class="n">ABc</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">reshaped</span> <span class="n">into</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> 
    <span class="p">[[[</span><span class="mi">10</span> <span class="mi">11</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">12</span> <span class="mi">13</span><span class="p">]]</span>
    
     <span class="p">[[</span><span class="mi">50</span> <span class="mi">55</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">60</span> <span class="mi">65</span><span class="p">]]]</span>
</pre></div>
</div>
<p>Example in higher dimension:</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">numpy_extended_dot</span>

<span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="mi">10</span>

<span class="n">dot</span> <span class="o">=</span> <span class="n">numpy_extended_dot</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="n">Abc</span><span class="p">,</span><span class="n">abC</span><span class="o">-&gt;</span><span class="n">AC</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">@</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">[</span><span class="n">numpy_extended_dot</span><span class="p">]</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">reshaped</span> <span class="n">into</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> 
    <span class="p">[[[</span><span class="mi">164</span> <span class="mi">176</span><span class="p">]]</span>
    
     <span class="p">[[</span><span class="mi">580</span> <span class="mi">624</span><span class="p">]]]</span>
</pre></div>
</div>
<p>The current implementation still uses <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a>
but this should be replaced.</p>
</dd></dl>

</section>
<section id="numpy-extended-dot-matrix">
<h2>numpy_extended_dot_matrix<a class="headerlink" href="#numpy-extended-dot-matrix" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_matrix">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl_ext.</span></span><span class="sig-name descname"><span class="pre">numpy_extended_dot_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">m2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_ext.html#numpy_extended_dot_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_matrix" title="Link to this definition">¶</a></dt>
<dd><p>Implementation of <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot</span></code></a>
using dot product, multiplication, transpose and reduction
but not a custom python implementation like
<a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot_python</span></code></a>.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">numpy_extended_dot_matrix</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum.einsum_impl_ext</span> <span class="kn">import</span> <span class="n">_numpy_extended_dot_equation</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">numpy_extended_dot_matrix</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)))</span>

<span class="c1"># Equivalent einsum equation</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;equation&quot;</span><span class="p">,</span>
    <span class="n">_numpy_extended_dot_equation</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Same einsum computation written in a different way.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;kix,kxj-&gt;xij&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[[[</span><span class="mi">40</span> <span class="mi">46</span> <span class="mi">52</span> <span class="mi">58</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">52</span> <span class="mi">61</span> <span class="mi">70</span> <span class="mi">79</span><span class="p">]]]</span>
    <span class="n">equation</span> <span class="n">aBc</span><span class="p">,</span><span class="n">abC</span><span class="o">-&gt;</span><span class="n">BC</span>
    <span class="p">[[[</span><span class="mi">40</span> <span class="mi">46</span> <span class="mi">52</span> <span class="mi">58</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">52</span> <span class="mi">61</span> <span class="mi">70</span> <span class="mi">79</span><span class="p">]]]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="numpy-extended-dot-python">
<h2>numpy_extended_dot_python<a class="headerlink" href="#numpy-extended-dot-python" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl_ext.</span></span><span class="sig-name descname"><span class="pre">numpy_extended_dot_python</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">m2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_ext.html#numpy_extended_dot_python"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python" title="Link to this definition">¶</a></dt>
<dd><p>Implementation of <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot</span></code></a>
in pure python. This implementation is not efficient
but shows how to implement this operation without <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a>.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">numpy_extended_dot_python</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum.einsum_impl_ext</span> <span class="kn">import</span> <span class="n">_numpy_extended_dot_equation</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">numpy_extended_dot_python</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)))</span>

<span class="c1"># Equivalent einsum equation</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;equation&quot;</span><span class="p">,</span>
    <span class="n">_numpy_extended_dot_equation</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Same einsum computation written in a different way.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;kix,kxj-&gt;xij&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[[[</span><span class="mi">40</span> <span class="mi">46</span> <span class="mi">52</span> <span class="mi">58</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">52</span> <span class="mi">61</span> <span class="mi">70</span> <span class="mi">79</span><span class="p">]]]</span>
    <span class="n">equation</span> <span class="n">aBc</span><span class="p">,</span><span class="n">abC</span><span class="o">-&gt;</span><span class="n">BC</span>
    <span class="p">[[[</span><span class="mi">40</span> <span class="mi">46</span> <span class="mi">52</span> <span class="mi">58</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">52</span> <span class="mi">61</span> <span class="mi">70</span> <span class="mi">79</span><span class="p">]]]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="einsumsubop">
<h2>EinsumSubOp<a class="headerlink" href="#einsumsubop" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl_classes.</span></span><span class="sig-name descname"><span class="pre">EinsumSubOp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">full_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><span class="pre">EinsumSubOp</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="Link to this definition">¶</a></dt>
<dd><p>Defines a sub operation used in Einsum decomposition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>full_dim</strong> – dimension of the result</p></li>
<li><p><strong>name</strong> – name (reshape, transpose, reduce_sum, matmul, id,
squeeze, diagonal, mul, batch_dot)</p></li>
<li><p><strong>inputs</strong> – inputs</p></li>
<li><p><strong>kwargs</strong> – arguments</p></li>
</ul>
</dd>
</dl>
<p>Operator suffixed by <cite>_mm</cite> (<em>transpose_mm</em>, <em>reduce_sum_mm</em>)
are equivalent to the same operator without the suffix
but takes two inputs and only changes the first one.</p>
<p>Attributes <cite>_info</cite> summarizes the known information
about dimensions. Many of them are empty because inserted.
Value <cite>1</cite> means it was the case, <cite>2</cite> means it is a plain dimension.</p>
<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.add_info">
<span class="sig-name descname"><span class="pre">add_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp.add_info"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.add_info" title="Link to this definition">¶</a></dt>
<dd><p>Adds information to the node.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – dictionary</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.apply" title="Link to this definition">¶</a></dt>
<dd><p>Applies one operator on the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – dictionary storing the results</p></li>
<li><p><strong>verbose</strong> – prints out intermediate results</p></li>
<li><p><strong>kwargs</strong> – additional parameters, see
methods <cite>_apply*</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>output</p>
</dd>
</dl>
<p>Known additional paramaters:</p>
<ul class="simple">
<li><p>‘matmul_impl’: if None calls <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a> through
<a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot</span></code></a>
(default) or ‘py’ to call
<a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python" title="onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy_extended_dot_python</span></code></a>
instead.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.compute_output_row">
<span class="sig-name descname"><span class="pre">compute_output_row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">row2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ab</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp.compute_output_row"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.compute_output_row" title="Link to this definition">¶</a></dt>
<dd><p>Updates <em>row</em> based on the operator.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.dot_label">
<span class="sig-name descname"><span class="pre">dot_label</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp.dot_label"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.dot_label" title="Link to this definition">¶</a></dt>
<dd><p>Displays some informations useful to understand the operator.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.get_dot_kind">
<span class="sig-name descname"><span class="pre">get_dot_kind</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp.get_dot_kind"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.get_dot_kind" title="Link to this definition">¶</a></dt>
<dd><p>Every matrix multiplication can be either:</p>
<ul class="simple">
<li><p>a simple multiplication (<cite>M</cite>) (undetected)</p></li>
<li><p>a 2D matrix multiplication (<cite>11</cite>)</p></li>
<li><p>a broadcasted matrix multiplication (<cite>N1</cite> or <cite>1N</cite>)</p></li>
<li><p>a batch matrix multiplication (<cite>NN</cite>)</p></li>
</ul>
<p>This method returns which kind it is.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.to_onnx">
<span class="sig-name descname"><span class="pre">to_onnx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.12)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://onnx.ai/onnx/api/classes.html#onnx.NodeProto" title="(in ONNX v1.17.0)"><span class="pre">NodeProto</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#EinsumSubOp.to_onnx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.to_onnx" title="Link to this definition">¶</a></dt>
<dd><p>Converts this node into ONNX. Enumerates all ONNX node
which participate to the conversion. The last one
is the final output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>names</strong> – dictionary where to find already converted name</p></li>
<li><p><strong>opset</strong> – opset</p></li>
<li><p><strong>verbose</strong> – prints out intermediate results</p></li>
<li><p><strong>kwargs</strong> – additional parameter for the conversion</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>output</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="grapheinsumsubop">
<h2>GraphEinsumSubOp<a class="headerlink" href="#grapheinsumsubop" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_impl_classes.</span></span><span class="sig-name descname"><span class="pre">GraphEinsumSubOp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">letters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">lengths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp" title="Link to this definition">¶</a></dt>
<dd><p>Class gathering all nodes produced to explicit einsum
operators.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>letters</strong> – list of distinct letters</p></li>
<li><p><strong>mat</strong> – matrix, see <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation" title="onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation"><code class="xref py py-func docutils literal notranslate"><span class="pre">analyse_einsum_equation</span></code></a></p></li>
<li><p><strong>lengths</strong> – lengths of every input</p></li>
<li><p><strong>duplicates</strong> – see <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation" title="onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation"><code class="xref py py-func docutils literal notranslate"><span class="pre">analyse_einsum_equation</span></code></a></p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.append">
<span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">op</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><span class="pre">EinsumSubOp</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><span class="pre">EinsumSubOp</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.append"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.append" title="Link to this definition">¶</a></dt>
<dd><p>Adds one input or result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>op</strong> – integer (an input) or an instance of <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">EinsumSubOp</span></code></a>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>op or None if op is an integer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.apply_sequence">
<span class="sig-name descname"><span class="pre">apply_sequence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><span class="pre">EinsumSubOp</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.apply_sequence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.apply_sequence" title="Link to this definition">¶</a></dt>
<dd><p>Applies a sequence of operations on a list of inputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – inputs</p></li>
<li><p><strong>verbose</strong> – prints out intermediate results</p></li>
<li><p><strong>kwargs</strong> – additional parameters,
see <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.apply" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>output</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.clean_unused_nodes">
<span class="sig-name descname"><span class="pre">clean_unused_nodes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.clean_unused_nodes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.clean_unused_nodes" title="Link to this definition">¶</a></dt>
<dd><p>Cleans nodes with unused outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>verbose</strong> – display intermediate information</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.mark">
<span class="sig-name descname"><span class="pre">mark</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">op</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><span class="pre">EinsumSubOp</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.mark"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.mark" title="Link to this definition">¶</a></dt>
<dd><p>Marks one input or result as an intermediate result
after a full einsum step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>i</strong> – a position</p></li>
<li><p><strong>op</strong> – an instance of <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp" title="onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">EinsumSubOp</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.mark_last_node">
<span class="sig-name descname"><span class="pre">mark_last_node</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.mark_last_node"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.mark_last_node" title="Link to this definition">¶</a></dt>
<dd><p>Marks the last node as the final output.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.remove_duplicate_transpose">
<span class="sig-name descname"><span class="pre">remove_duplicate_transpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.remove_duplicate_transpose"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.remove_duplicate_transpose" title="Link to this definition">¶</a></dt>
<dd><p>Removes consecutive transpose by merging them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>verbose</strong> – display intermediate information</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.simplify_mm_nodes">
<span class="sig-name descname"><span class="pre">simplify_mm_nodes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.simplify_mm_nodes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.simplify_mm_nodes" title="Link to this definition">¶</a></dt>
<dd><p>Node name suffixed by <cite>mm</cite> are an artifact to keep
the graph consistent while building it. They can
now be replaced by the equivalent node without suffix <cite>mm</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>verbose</strong> – display intermediate information</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.to_dot">
<span class="sig-name descname"><span class="pre">to_dot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.to_dot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.to_dot" title="Link to this definition">¶</a></dt>
<dd><p>Produces a graph in <a class="reference external" href="https://graphviz.org/doc/info/lang.html">dot</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – additional graph option</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.to_onnx">
<span class="sig-name descname"><span class="pre">to_onnx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://onnx.ai/onnx/api/serialization.html#onnx.ModelProto" title="(in ONNX v1.17.0)"><span class="pre">ModelProto</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_impl_classes.html#GraphEinsumSubOp.to_onnx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.to_onnx" title="Link to this definition">¶</a></dt>
<dd><p>Converts the graph into ONNX.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output name</p></li>
<li><p><strong>inputs</strong> – input names</p></li>
<li><p><strong>dtype</strong> – type used for all operators</p></li>
<li><p><strong>opset</strong> – desired opset, None for the last one</p></li>
<li><p><strong>verbose</strong> – display intermediate operators</p></li>
<li><p><strong>kwargs</strong> – additional parameter to use when building
the ONNX graph, list of supported parameters:
<em>name</em>, <em>ir_version</em>, <em>producer_name</em>,
<em>producer_version</em>, <em>initializer</em></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ONNX graph</p>
</dd>
</dl>
<p>Not all graphs can be converted into ONNX. Only graphs produced
with <cite>strategy=’numpy’</cite> can be converted otherwise the following
error shows up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">NotImplementedError</span><span class="p">:</span> <span class="n">to_onnx</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="k">for</span> <span class="s1">&#39;matmul&#39;</span><span class="o">.</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="onnxmicroruntime">
<h2>OnnxMicroRuntime<a class="headerlink" href="#onnxmicroruntime" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_fct.</span></span><span class="sig-name descname"><span class="pre">OnnxMicroRuntime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_onnx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#OnnxMicroRuntime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime" title="Link to this definition">¶</a></dt>
<dd><p>Implements a micro runtime for ONNX graphs.
It does not implements all the operator types.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model_onnx</strong> – ONNX model</p>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.input_names">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input_names</span></span><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.input_names" title="Link to this definition">¶</a></dt>
<dd><p>Returns input names.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.output_names">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">output_names</span></span><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.output_names" title="Link to this definition">¶</a></dt>
<dd><p>Returns output names.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unused</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.12)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#OnnxMicroRuntime.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.run" title="Link to this definition">¶</a></dt>
<dd><p>Computes the outputs of the graph.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unused</strong> – unused (the list of desired outputs)</p></li>
<li><p><strong>inputs</strong> – dictionary</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>all intermediates results and output as a dictionary</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="optimize-decompose-einsum-equation">
<h2>optimize_decompose_einsum_equation<a class="headerlink" href="#optimize-decompose-einsum-equation" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_fct.optimize_decompose_einsum_equation">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_fct.</span></span><span class="sig-name descname"><span class="pre">optimize_decompose_einsum_equation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runtime</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'batch_dot'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decompose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum" title="onnx_extended.tools.einsum.einsum_fct.CachedEinsum"><span class="pre">CachedEinsum</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_fct.html#optimize_decompose_einsum_equation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_fct.optimize_decompose_einsum_equation" title="Link to this definition">¶</a></dt>
<dd><p>Proposes a new implementation of <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html#numpy.einsum" title="(in NumPy v1.26)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.einsum()</span></code></a>.
It does not allow expresion using <cite>…</cite> and expects
a right member.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equation</strong> – einsum equation</p></li>
<li><p><strong>dtype</strong> – numpy dtype used for the computation</p></li>
<li><p><strong>optimize</strong> – permutes all letters to find the best
permutation</p></li>
<li><p><strong>runtime</strong> – runtime used to compute the results once the
computation graph is produced (see below)</p></li>
<li><p><strong>cache</strong> – if True, the function stores the preprocessing
done for a specific equation, the second call with the same
equation is much faster</p></li>
<li><p><strong>opset</strong> – ONNX opset to use for some runtimes</p></li>
<li><p><strong>decompose</strong> – by default, the function decomposes
the equation into more simple operators but it can keep
the original ONNX einsum operator.</p></li>
<li><p><strong>strategy</strong> – optimisation strategy (see below)</p></li>
<li><p><strong>verbose</strong> – display progress if optimize is True</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>einsum result</p>
</dd>
</dl>
<p>The available runtimes are:</p>
<ul class="simple">
<li><p><cite>batch_dot</cite>: the runtime is <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence" title="onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence"><code class="xref py py-func docutils literal notranslate"><span class="pre">apply_einsum_sequence</span></code></a>,</p></li>
<li><p><cite>python</cite>: one ONNX graph executed with a python runtime,</p></li>
<li><p><cite>onnxruntime</cite>: one ONNX graph executed with <a class="reference external" href="https://onnxruntime.ai/">onnxruntime</a>.</p></li>
</ul>
<p>The optimisation strategy can be:</p>
<ul class="simple">
<li><p><cite>None</cite>: the same runtime is used to find the best permutation of letters</p></li>
<li><dl class="simple">
<dt><cite>‘ml’</cite>: a machine learned model is used to predict the</dt><dd><p>best permutation of letters.</p>
</dd>
</dl>
</li>
</ul>
<p>The function works in two steps:</p>
<ul class="simple">
<li><p>first step analyses the equation to produce a computation graph,
this graph can also be converted into ONNX,</p></li>
<li><p>second step runs the graph whatever the graph is.</p></li>
</ul>
<p>The function returns an object of type <a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum" title="onnx_extended.tools.einsum.einsum_fct.CachedEinsum"><code class="xref py py-class docutils literal notranslate"><span class="pre">CachedEinsum</span></code></a>
which has the following members after optimization:</p>
<ul class="simple">
<li><p><cite>equation_</cite> corresponding to the best equivalent equation</p></li>
<li><dl class="simple">
<dt><cite>graph_</cite>: the corresponding graph returned by function</dt><dd><p><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation" title="onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation"><code class="xref py py-func docutils literal notranslate"><span class="pre">decompose_einsum_equation</span></code></a></p>
</dd>
</dl>
</li>
<li><p><cite>onnx_</cite>: if a conversion to onnx is used, stores the onnx graph</p></li>
<li><p><cite>runtime_</cite>: a function used by <cite>__call__</cite>, calls the runtime</p></li>
<li><p><cite>oinf_</cite>: an object of type <a class="reference internal" href="reference.html#onnx_extended.reference.CReferenceEvaluator" title="onnx_extended.reference.CReferenceEvaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">CReferenceEvaluator</span></code></a></p></li>
<li><p><cite>timed_permutations_</cite>: memorizes the results of the optimization</p></li>
</ul>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum</span> <span class="kn">import</span> <span class="n">optimize_decompose_einsum_equation</span>

<span class="n">seq_opt</span> <span class="o">=</span> <span class="n">optimize_decompose_einsum_equation</span><span class="p">(</span>
    <span class="s2">&quot;bsnh,btnh-&gt;bnts&quot;</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
    <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;ml&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
    <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best equation:&quot;</span><span class="p">,</span> <span class="n">seq_opt</span><span class="o">.</span><span class="n">equation_</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    
  0%|          | 0/121 [00:00&lt;?, ?it/s]
4.5 mlbest=&#39;bsnh,btnh-&gt;bnts&#39;:   0%|          | 0/121 [00:00&lt;?, ?it/s]
4.5 mlbest=&#39;bnth,bsth-&gt;btsn&#39;:   0%|          | 0/121 [00:00&lt;?, ?it/s]
4.5 mlbest=&#39;bnht,bsht-&gt;bhsn&#39;:   0%|          | 0/121 [00:00&lt;?, ?it/s]
4.5 mlbest=&#39;bhtn,bstn-&gt;btsh&#39;:   0%|          | 0/121 [00:00&lt;?, ?it/s]
4.5 mlbest=&#39;bhtn,bstn-&gt;btsh&#39;:  14%|#4        | 17/121 [00:00&lt;00:00, 165.29it/s]
4.5 mlbest=&#39;bhts,bnts-&gt;btnh&#39;:  14%|#4        | 17/121 [00:00&lt;00:00, 165.29it/s]
4.5 mlbest=&#39;bhts,bnts-&gt;btnh&#39;:  28%|##8       | 34/121 [00:00&lt;00:00, 146.35it/s]
4.5 mlbest=&#39;bhts,bnts-&gt;btnh&#39;:  40%|####      | 49/121 [00:00&lt;00:00, 138.75it/s]
4.5 mlbest=&#39;bhts,bnts-&gt;btnh&#39;:  56%|#####6    | 68/121 [00:00&lt;00:00, 155.69it/s]
4.5 mlbest=&#39;bhts,bnts-&gt;btnh&#39;:  82%|########1 | 99/121 [00:00&lt;00:00, 207.64it/s]
4.5 mlbest=&#39;bhts,bnts-&gt;btnh&#39;: 100%|##########| 121/121 [00:00&lt;00:00, 196.25it/s]
    best equation: bhts,bnts-&gt;btnh
</pre></div>
</div>
</dd></dl>

</section>
<section id="predict-transposition-cost">
<h2>predict_transposition_cost<a class="headerlink" href="#predict-transposition-cost" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="onnx_extended.tools.einsum.einsum_ml.predict_transposition_cost">
<span class="sig-prename descclassname"><span class="pre">onnx_extended.tools.einsum.einsum_ml.</span></span><span class="sig-name descname"><span class="pre">predict_transposition_cost</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coefs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a></span></span><a class="reference internal" href="../_modules/onnx_extended/tools/einsum/einsum_ml.html#predict_transposition_cost"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#onnx_extended.tools.einsum.einsum_ml.predict_transposition_cost" title="Link to this definition">¶</a></dt>
<dd><p>Given a shape and a permutation, predicts the cost of the
transposition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> – shape</p></li>
<li><p><strong>perm</strong> – permutation</p></li>
<li><p><strong>coefs</strong> – trained coefficients or None to get
the default ones</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dictionary of features</p>
</dd>
</dl>
<p>&lt;&lt;&lt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">onnx_extended.tools.einsum.einsum_ml</span> <span class="kn">import</span> <span class="n">compute_transposition_features</span>

<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">compute_transposition_features</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span><span class="s1">&#39;CST_&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;dbegin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
     <span class="s1">&#39;discont&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s1">&#39;edit&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;end16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>
     <span class="s1">&#39;end32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span>
     <span class="s1">&#39;ibegin16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;ibegin8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;iend8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
     <span class="s1">&#39;middle&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
     <span class="s1">&#39;rbegin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
     <span class="s1">&#39;rdiscont&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.01904761904761905</span><span class="p">,</span>
     <span class="s1">&#39;redit&#39;</span><span class="p">:</span> <span class="mf">0.6666666666666666</span><span class="p">,</span>
     <span class="s1">&#39;rend&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
     <span class="s1">&#39;rend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1523809523809524</span><span class="p">,</span>
     <span class="s1">&#39;rend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3047619047619048</span><span class="p">,</span>
     <span class="s1">&#39;rev&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s1">&#39;rmiddle&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
     <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="tools_graph.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">onnx_extended.tools.graph</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="tools_io.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">onnx_extended.tools.onnx_io</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024, Xavier Dupré
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">onnx_extended.tools.einsum</a><ul>
<li><a class="reference internal" href="#analyse-einsum-equation">analyse_einsum_equation</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.analyse_einsum_equation"><code class="docutils literal notranslate"><span class="pre">analyse_einsum_equation()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#apply-einsum-sequence">apply_einsum_sequence</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.apply_einsum_sequence"><code class="docutils literal notranslate"><span class="pre">apply_einsum_sequence()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cachedeinsum">CachedEinsum</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum"><code class="docutils literal notranslate"><span class="pre">CachedEinsum</span></code></a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build"><code class="docutils literal notranslate"><span class="pre">CachedEinsum.build()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_einsum"><code class="docutils literal notranslate"><span class="pre">CachedEinsum.build_einsum()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_onnx_einsum"><code class="docutils literal notranslate"><span class="pre">CachedEinsum.build_onnx_einsum()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.build_runtime"><code class="docutils literal notranslate"><span class="pre">CachedEinsum.build_runtime()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.CachedEinsum.default_inputs"><code class="docutils literal notranslate"><span class="pre">CachedEinsum.default_inputs()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#compute-transposition-features">compute_transposition_features</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_ml.compute_transposition_features"><code class="docutils literal notranslate"><span class="pre">compute_transposition_features()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#decompose-einsum-equation">decompose_einsum_equation</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl.decompose_einsum_equation"><code class="docutils literal notranslate"><span class="pre">decompose_einsum_equation()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#einsum">einsum</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.einsum"><code class="docutils literal notranslate"><span class="pre">einsum()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#einsum-benchmark">einsum_benchmark</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_bench.einsum_benchmark"><code class="docutils literal notranslate"><span class="pre">einsum_benchmark()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#numpy-extended-dot">numpy_extended_dot</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot"><code class="docutils literal notranslate"><span class="pre">numpy_extended_dot()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#numpy-extended-dot-matrix">numpy_extended_dot_matrix</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_matrix"><code class="docutils literal notranslate"><span class="pre">numpy_extended_dot_matrix()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#numpy-extended-dot-python">numpy_extended_dot_python</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_ext.numpy_extended_dot_python"><code class="docutils literal notranslate"><span class="pre">numpy_extended_dot_python()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#einsumsubop">EinsumSubOp</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp</span></code></a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.add_info"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp.add_info()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.apply"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp.apply()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.compute_output_row"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp.compute_output_row()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.dot_label"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp.dot_label()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.get_dot_kind"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp.get_dot_kind()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.EinsumSubOp.to_onnx"><code class="docutils literal notranslate"><span class="pre">EinsumSubOp.to_onnx()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#grapheinsumsubop">GraphEinsumSubOp</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp</span></code></a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.append"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.append()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.apply_sequence"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.apply_sequence()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.clean_unused_nodes"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.clean_unused_nodes()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.mark"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.mark()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.mark_last_node"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.mark_last_node()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.remove_duplicate_transpose"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.remove_duplicate_transpose()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.simplify_mm_nodes"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.simplify_mm_nodes()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.to_dot"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.to_dot()</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_impl_classes.GraphEinsumSubOp.to_onnx"><code class="docutils literal notranslate"><span class="pre">GraphEinsumSubOp.to_onnx()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#onnxmicroruntime">OnnxMicroRuntime</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime"><code class="docutils literal notranslate"><span class="pre">OnnxMicroRuntime</span></code></a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.input_names"><code class="docutils literal notranslate"><span class="pre">OnnxMicroRuntime.input_names</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.output_names"><code class="docutils literal notranslate"><span class="pre">OnnxMicroRuntime.output_names</span></code></a></li>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.OnnxMicroRuntime.run"><code class="docutils literal notranslate"><span class="pre">OnnxMicroRuntime.run()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#optimize-decompose-einsum-equation">optimize_decompose_einsum_equation</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_fct.optimize_decompose_einsum_equation"><code class="docutils literal notranslate"><span class="pre">optimize_decompose_einsum_equation()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#predict-transposition-cost">predict_transposition_cost</a><ul>
<li><a class="reference internal" href="#onnx_extended.tools.einsum.einsum_ml.predict_transposition_cost"><code class="docutils literal notranslate"><span class="pre">predict_transposition_cost()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=83a61292"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    </body>
</html>