<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Gemm or Matmul + Add" href="plot_gemm_or_matmul_add.html"><link rel="prev" title="Export with loops" href="plot_simple_for_loop.html">
        <link rel="prefetch" href="../_static/logo.png" as="image">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>From a LLM to processing a prompt - onnx-diagnostic 0.8.11 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=a7360d90" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">onnx-diagnostic 0.8.11 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">onnx-diagnostic 0.8.11 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../patches.html">Patches Explained</a><input aria-label="Toggle navigation of Patches Explained" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../status/index.html">Exporter Status</a><input aria-label="Toggle navigation of Exporter Status" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../status/exported_program_dynamic.html">Exported Programs with Dynamic Shapes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../status/exporter_dynamic.html">Exported ONNX with Dynamic Shapes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../status/patches_coverage.html">Coverage of the Patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../status/patches_diff.html">Patches Diff</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API of onnx_diagnostic</a><input aria-label="Toggle navigation of API of onnx_diagnostic" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/ci_models/index.html">onnx_diagnostic.ci_models</a><input aria-label="Toggle navigation of onnx_diagnostic.ci_models" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/ci_models/ci_helpers.html">onnx_diagnostic.ci_models.ci_helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/ci_models/export_qwen25_vl.html">onnx_diagnostic.ci_models.export_qwen25_vl</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/export/index.html">onnx_diagnostic.export</a><input aria-label="Toggle navigation of onnx_diagnostic.export" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/export/api.html">onnx_diagnostic.export.api</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/export/control_flow_onnx.html">onnx_diagnostic.export.control_flow_onnx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/export/dynamic_shapes.html">onnx_diagnostic.export.dynamic_shapes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/export/onnx_plug.html">onnx_diagnostic.export.onnx_plug</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/export/shape_helper.html">onnx_diagnostic.export.shape_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/export/validate.html">onnx_diagnostic.export.validate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/export/cf_simple_loop_for.html">onnx_diagnostic.export.cf_simple_loop_for</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/helpers/index.html">onnx_diagnostic.helpers</a><input aria-label="Toggle navigation of onnx_diagnostic.helpers" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/args_helper.html">onnx_diagnostic.helpers.args_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/bench_run.html">onnx_diagnostic.helpers.bench_run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/cache_helper.html">onnx_diagnostic.helpers.cache_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/config_helper.html">onnx_diagnostic.helpers.config_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/doc_helper.html">onnx_diagnostic.helpers.doc_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/dot_helper.html">onnx_diagnostic.helpers.dot_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/fake_tensor_helper.html">onnx_diagnostic.helpers.fake_tensor_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/graph_helper.html">onnx_diagnostic.helpers.graph_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/helper.html">onnx_diagnostic.helpers.helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/_log_helper.html">onnx_diagnostic.helpers._log_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/log_helper.html">onnx_diagnostic.helpers.log_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/memory_peak.html">onnx_diagnostic.helpers.memory_peak</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/mini_onnx_builder.html">onnx_diagnostic.helpers.mini_onnx_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/model_builder_helper.html">onnx_diagnostic.helpers.model_builder_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/onnx_helper.html">onnx_diagnostic.helpers.onnx_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/optim_helper.html">onnx_diagnostic.helpers.optim_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/ort_session.html">onnx_diagnostic.helpers.ort_session</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/rt_helper.html">onnx_diagnostic.helpers.rt_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/torch_fx_graph_helper.html">onnx_diagnostic.helpers.torch_fx_graph_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/helpers/torch_helper.html">onnx_diagnostic.helpers.torch_helper</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/reference/index.html">onnx_diagnostic.reference</a><input aria-label="Toggle navigation of onnx_diagnostic.reference" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/reference/ops/index.html">onnx_diagnostic.reference.ops</a><input aria-label="Toggle navigation of onnx_diagnostic.reference.ops" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_add_add_mul_mul.html">onnx_diagnostic.reference.ops.op_add_add_mul_mul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_average_pool_grad.html">onnx_diagnostic.reference.ops.op_average_pool_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_cast_like.html">onnx_diagnostic.reference.ops.op_cast_like</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_complex.html">onnx_diagnostic.reference.ops.op_complex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_concat.html">onnx_diagnostic.reference.ops.op_concat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_constant_of_shape.html">onnx_diagnostic.reference.ops.op_constant_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_fused_matmul.html">onnx_diagnostic.reference.ops.op_fused_matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_gather_grad.html">onnx_diagnostic.reference.ops.op_gather_grad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_memcpy_host.html">onnx_diagnostic.reference.ops.op_memcpy_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_mul_sigmoid.html">onnx_diagnostic.reference.ops.op_mul_sigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_negxplus1.html">onnx_diagnostic.reference.ops.op_negxplus1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_quick_gelu.html">onnx_diagnostic.reference.ops.op_quick_gelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_replace_zero.html">onnx_diagnostic.reference.ops.op_replace_zero</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_rotary.html">onnx_diagnostic.reference.ops.op_rotary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_qlinear_average_pool.html">onnx_diagnostic.reference.ops.op_qlinear_average_pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_qlinear_conv.html">onnx_diagnostic.reference.ops.op_qlinear_conv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatter_elements.html">onnx_diagnostic.reference.ops.op_scatter_elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_scatternd_of_shape.html">onnx_diagnostic.reference.ops.op_scatternd_of_shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_simplified_layer_normalization.html">onnx_diagnostic.reference.ops.op_simplified_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_skip_layer_normalization.html">onnx_diagnostic.reference.ops.op_skip_layer_normalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_slice.html">onnx_diagnostic.reference.ops.op_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_transpose_cast.html">onnx_diagnostic.reference.ops.op_transpose_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/ops/op_tri_matrix.html">onnx_diagnostic.reference.ops.op_tri_matrix</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/reference/torch_ops/index.html">onnx_diagnostic.reference.torch_ops</a><input aria-label="Toggle navigation of onnx_diagnostic.reference.torch_ops" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/access_ops.html">onnx_diagnostic.reference.torch_ops.access_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/binary_ops.html">onnx_diagnostic.reference.torch_ops.binary_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/controlflow_ops.html">onnx_diagnostic.reference.torch_ops.controlflow_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/generator_ops.html">onnx_diagnostic.reference.torch_ops.generator_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/nn_ops.html">onnx_diagnostic.reference.torch_ops.nn_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/other_ops.html">onnx_diagnostic.reference.torch_ops.other_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/reduce_ops.html">onnx_diagnostic.reference.torch_ops.reduce_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/sequence_ops.html">onnx_diagnostic.reference.torch_ops.sequence_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/shape_ops.html">onnx_diagnostic.reference.torch_ops.shape_ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/reference/torch_ops/unary_ops.html">onnx_diagnostic.reference.torch_ops.unary_ops</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/evaluator.html">onnx_diagnostic.reference.evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/quantized_tensor.html">onnx_diagnostic.reference.quantized_tensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/ort_evaluator.html">onnx_diagnostic.reference.ort_evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/report_results_comparison.html">onnx_diagnostic.reference.report_results_comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/reference/torch_evaluator.html">onnx_diagnostic.reference.torch_evaluator</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/tasks/index.html">onnx_diagnostic.tasks</a><input aria-label="Toggle navigation of onnx_diagnostic.tasks" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/automatic_speech_recognition.html">onnx_diagnostic.tasks.automatic_speech_recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/fill_mask.html">onnx_diagnostic.tasks.fill_mask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/feature_extraction.html">onnx_diagnostic.tasks.feature_extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/image_classification.html">onnx_diagnostic.tasks.image_classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/image_text_to_text.html">onnx_diagnostic.export.image_text_to_text</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/mixture_of_expert.html">onnx_diagnostic.tasks.mixture_of_expert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/object_detection.html">onnx_diagnostic.tasks.object_detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/sentence_similarity.html">onnx_diagnostic.tasks.sentence_similarity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/summarization.html">onnx_diagnostic.tasks.summarization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/text_classification.html">onnx_diagnostic.tasks.text_classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/text_generation.html">onnx_diagnostic.tasks.text_generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/text_to_image.html">onnx_diagnostic.tasks.text_to_image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/text2text_generation.html">onnx_diagnostic.tasks.text2text_generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/tasks/zero_shot_image_classification.html">onnx_diagnostic.tasks.zero_shot_image_classification</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_export_patches/index.html">onnx_diagnostic.torch_export_patches</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_export_patches" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/torch_export_patches/eval/index.html">onnx_diagnostic.torch_export_patches.eval</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_export_patches.eval" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_export_patches/eval/model_cases.html">onnx_diagnostic.torch_export_patches.eval.model_cases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/onnx_export_errors.html">onnx_diagnostic.torch_export_patches.onnx_export_errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/onnx_export_serialization.html">onnx_diagnostic.torch_export_patches.onnx_export_serialization</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/torch_export_patches/patches/index.html">onnx_diagnostic.torch_export_patches.patches</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_export_patches.patches" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_export_patches/patches/patch_torch.html">onnx_diagnostic.torch_export_patches.patches.patch_torch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_export_patches/patches/patch_transformers.html">onnx_diagnostic.torch_export_patches.patches.patch_transformers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/patch_details.html">onnx_diagnostic.torch_export_patches.patch_details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/patch_expressions.html">onnx_diagnostic.torch_export_patches.patch_expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/patch_inputs.html">onnx_diagnostic.torch_export_patches.patch_inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/patch_module.html">onnx_diagnostic.torch_export_patches.patch_module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_export_patches/patch_module_helper.html">onnx_diagnostic.torch_export_patches.patch_module_helper</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/torch_export_patches/serialization/index.html">onnx_diagnostic.torch_export_patches.serialization</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_export_patches.serialization" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_export_patches/serialization/diffusers_impl.html">onnx_diagnostic.torch_export_patches.serialization.diffusers_impl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_export_patches/serialization/transformers_impl.html">onnx_diagnostic.torch_export_patches.serialization.transformers_impl</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_models/index.html">onnx_diagnostic.torch_models</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_models" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/code_sample.html">onnx_diagnostic.torch_models.code_sample</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/torch_models/hghub/index.html">onnx_diagnostic.torch_models.hghub</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_models.hghub" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_models/hghub/hub_api.html">onnx_diagnostic.torch_models.hghub.hub_api</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_models/hghub/hub_data.html">onnx_diagnostic.torch_models.hghub.hub_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/torch_models/hghub/model_inputs.html">onnx_diagnostic.torch_models.hghub.model_inputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/llms.html">onnx_diagnostic.torch_models.llms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_models/validate.html">onnx_diagnostic.torch_models.validate</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/torch_onnx/index.html">onnx_diagnostic.torch_onnx</a><input aria-label="Toggle navigation of onnx_diagnostic.torch_onnx" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_onnx/compare.html">onnx_diagnostic.torch_onnx.compare</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_onnx/runtime_info.html">onnx_diagnostic.torch_onnx.runtime_info</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_onnx/sbs.html">onnx_diagnostic.torch_onnx.sbs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/torch_onnx/sbs_dataclasses.html">onnx_diagnostic.torch_onnx.sbs_dataclasses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/typing.html">onnx_diagnostic.typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ext_test_case.html">onnx_diagnostic.ext_test_case</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cmds/index.html">Command Lines</a><input aria-label="Toggle navigation of Command Lines" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../cmds/compare.html">-m onnx_diagnostic compare … compares two models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmds/config.html">-m onnx_diagnostic config … prints the config for a model id</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmds/optimize.html">-m onnx_diagnostic optimize … optimizes an onnx model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmds/partition.html">-m onnx_diagnostic partition … move layer nodes in local functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmds/sbs.html">-m onnx_diagnostic sbs … runs a side-by-side torch/onnx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmds/validate.html">-m onnx_diagnostic validate … validate a model id</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a><input aria-label="Toggle navigation of Examples Gallery" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_dump_intermediate_results.html">Dumps intermediate results of a torch model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_with_args_kwargs.html">Dynamic Shapes for <code class="docutils literal notranslate"><span class="pre">*args</span></code>, <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_llm_patched.html">Export Tiny-LLM with patches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_llm_method_generate.html">Export a LLM through method generate (with Tiny-LLM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_phi2.html">Export microsoft/phi-2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_with_dynamic_cache.html">Export with DynamicCache and guessed dynamic shapes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_llm_dim01.html">Export with dynamic dimensions in <code class="docutils literal notranslate"><span class="pre">{0,1}</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_llm_dim01_onnx.html">Export with dynamic dimensions in <code class="docutils literal notranslate"><span class="pre">{0,1}</span></code> into ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_llm_dim01_onnx_custom.html">Export with dynamic dimensions in <code class="docutils literal notranslate"><span class="pre">{0,1}</span></code> into ONNX (custom)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_locate_issue.html">Find and fix an export issue due to dynamic shapes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_failing_model_extract.html">Find where a model is failing by running submodels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_failing_reference_evaluator.html">Intermediate results with (ONNX) ReferenceEvaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_failing_onnxruntime_evaluator.html">Intermediate results with onnxruntime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_tiny_llm.html">Steel method forward to guess inputs and dynamic shapes (with Tiny-LLM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_examples/plot_export_hub_codellama.html">Test the export on untrained models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../auto_recipes/index.html">Common Export Issues</a><input aria-label="Toggle navigation of Common Export Issues" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_export_dim1.html">0, 1, 2 for a Dynamic Dimension in the dummy example to export a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_dynamic_shapes_what.html">Builds dynamic shapes from any input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_dynamic_shapes_max.html">Cannot export <code class="docutils literal notranslate"><span class="pre">torch.sym_max(x.shape[0],</span> <span class="pre">y.shape[0])</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_dynamic_shapes_python_int.html">Do not use python int with dynamic shapes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_export_cond.html">Export a model with a control flow (If)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_dynamic_shapes_nonzero.html">Half certain nonzero</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_dynamic_shapes_json.html">JSON returns list when the original dynamic shapes are list or tuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auto_recipes/plot_export_with_dynamic.html">Use DYNAMIC or AUTO when exporting if dynamic shapes has constraints</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Technical Details</a><input aria-label="Toggle navigation of Technical Details" checked="" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_broadcast_export_issue.html">Dynamic Shapes and Broadcasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_simple_for_loop.html">Export with loops</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">From a LLM to processing a prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_gemm_or_matmul_add.html">Gemm or Matmul + Add</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_layer_norm_discrepancies.html">LayerNormalization implementation cannot be exchanged</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_parallelized_reduction.html">Reproducible Parallelized Reduction is difficult</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/auto_technical/plot_generate.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-technical-plot-generate-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="from-a-llm-to-processing-a-prompt">
<span id="l-plot-generate"></span><span id="sphx-glr-auto-technical-plot-generate-py"></span><h1>From a LLM to processing a prompt<a class="headerlink" href="#from-a-llm-to-processing-a-prompt" title="Link to this heading">¶</a></h1>
<p>Method <code class="docutils literal notranslate"><span class="pre">generate</span></code> generates the model answer for a given prompt.
Let’s implement our own to understand better how it works and
then apply it to an ONNX model.</p>
<section id="example-with-phi-1-5">
<h2>Example with Phi 1.5<a class="headerlink" href="#example-with-phi-1-5" title="Link to this heading">¶</a></h2>
<p>epkg:<cite>microsoft/Phi-1.5</cite> is a small LLM. The example given</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoModelForCausalLM</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.ext_test_case</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/ext_test_case.html#onnx_diagnostic.ext_test_case.unit_test_going" title="onnx_diagnostic.ext_test_case.unit_test_going" class="sphx-glr-backref-module-onnx_diagnostic-ext_test_case sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/ext_test_case.html#onnx_diagnostic.ext_test_case.unit_test_going" title="onnx_diagnostic.ext_test_case.unit_test_going" class="sphx-glr-backref-module-onnx_diagnostic-ext_test_case sphx-glr-backref-type-py-function"><span class="n">unit_test_going</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.helpers</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><span class="n">string_type</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.helpers.torch_helper</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.to_any" title="onnx_diagnostic.helpers.torch_helper.to_any" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.to_any" title="onnx_diagnostic.helpers.torch_helper.to_any" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><span class="n">to_any</span></a></a><span class="p">,</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.get_weight_type" title="onnx_diagnostic.helpers.torch_helper.get_weight_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.get_weight_type" title="onnx_diagnostic.helpers.torch_helper.get_weight_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><span class="n">get_weight_type</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.helpers.rt_helper</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/rt_helper.html#onnx_diagnostic.helpers.rt_helper.onnx_generate" title="onnx_diagnostic.helpers.rt_helper.onnx_generate" class="sphx-glr-backref-module-onnx_diagnostic-helpers-rt_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/rt_helper.html#onnx_diagnostic.helpers.rt_helper.onnx_generate" title="onnx_diagnostic.helpers.rt_helper.onnx_generate" class="sphx-glr-backref-module-onnx_diagnostic-helpers-rt_helper sphx-glr-backref-type-py-function"><span class="n">onnx_generate</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.torch_export_patches</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_export_patches/index.html#onnx_diagnostic.torch_export_patches.torch_export_patches" title="onnx_diagnostic.torch_export_patches.torch_export_patches" class="sphx-glr-backref-module-onnx_diagnostic-torch_export_patches sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_export_patches/index.html#onnx_diagnostic.torch_export_patches.torch_export_patches" title="onnx_diagnostic.torch_export_patches.torch_export_patches" class="sphx-glr-backref-module-onnx_diagnostic-torch_export_patches sphx-glr-backref-type-py-function"><span class="n">torch_export_patches</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.torch_models.hghub</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/index.html#onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" title="onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/index.html#onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" title="onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub sphx-glr-backref-type-py-function"><span class="n">get_untrained_model_with_inputs</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.torch_models.hghub.hub_api</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" title="onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" title="onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><span class="n">get_pretrained_config</span></a></a><span class="p">,</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" title="onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" title="onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><span class="n">task_from_id</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.tasks</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/tasks/index.html#onnx_diagnostic.tasks.random_input_kwargs" title="onnx_diagnostic.tasks.random_input_kwargs" class="sphx-glr-backref-module-onnx_diagnostic-tasks sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/tasks/index.html#onnx_diagnostic.tasks.random_input_kwargs" title="onnx_diagnostic.tasks.random_input_kwargs" class="sphx-glr-backref-module-onnx_diagnostic-tasks sphx-glr-backref-type-py-function"><span class="n">random_input_kwargs</span></a></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">onnx_diagnostic.export.api</span><span class="w"> </span><span class="kn">import</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/export/api.html#onnx_diagnostic.export.api.to_onnx" title="onnx_diagnostic.export.api.to_onnx" class="sphx-glr-backref-module-onnx_diagnostic-export-api sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/export/api.html#onnx_diagnostic.export.api.to_onnx" title="onnx_diagnostic.export.api.to_onnx" class="sphx-glr-backref-module-onnx_diagnostic-export-api sphx-glr-backref-type-py-function"><span class="n">to_onnx</span></a></a>

<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a></a> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <a href="https://docs.pytorch.org/docs/stable/generated/torch.cuda.is_available.html#torch.cuda.is_available" title="torch.cuda.is_available" class="sphx-glr-backref-module-torch-cuda sphx-glr-backref-type-py-function"><a href="https://docs.pytorch.org/docs/stable/generated/torch.cuda.is_available.html#torch.cuda.is_available" title="torch.cuda.is_available" class="sphx-glr-backref-module-torch-cuda sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span></a></a><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a></a> <span class="o">=</span> <span class="p">[]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- load the model...&quot;</span><span class="p">)</span>
<span class="k">if</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/ext_test_case.html#onnx_diagnostic.ext_test_case.unit_test_going" title="onnx_diagnostic.ext_test_case.unit_test_going" class="sphx-glr-backref-module-onnx_diagnostic-ext_test_case sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/ext_test_case.html#onnx_diagnostic.ext_test_case.unit_test_going" title="onnx_diagnostic.ext_test_case.unit_test_going" class="sphx-glr-backref-module-onnx_diagnostic-ext_test_case sphx-glr-backref-type-py-function"><span class="n">unit_test_going</span></a></a><span class="p">():</span>
    <span class="c1"># unit_test_going() returns True if UNITTEST_GOING is 1</span>
    <span class="c1"># The example switches to a faster scenario.</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a> <span class="o">=</span> <span class="s2">&quot;arnir0/Tiny-LLM&quot;</span>
    <span class="n">data_export</span> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/index.html#onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" title="onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/index.html#onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" title="onnx_diagnostic.torch_models.hghub.get_untrained_model_with_inputs" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub sphx-glr-backref-type-py-function"><span class="n">get_untrained_model_with_inputs</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">data_export</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a> <span class="o">=</span> <span class="n">data_export</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_shapes</span></a></a> <span class="o">=</span> <span class="n">data_export</span><span class="p">[</span><span class="s2">&quot;dynamic_shapes&quot;</span><span class="p">]</span>
    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a> <span class="o">=</span> <span class="s2">&quot;microsoft/phi-1_5&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForCausalLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="p">,</span> <span class="n">torch_dtype</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" title="onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" title="onnx_diagnostic.torch_models.hghub.hub_api.get_pretrained_config" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><span class="n">get_pretrained_config</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="p">)</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">task</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">task</span></a></a> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" title="onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_models/hghub/hub_api.html#onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" title="onnx_diagnostic.torch_models.hghub.hub_api.task_from_id" class="sphx-glr-backref-module-onnx_diagnostic-torch_models-hghub-hub_api sphx-glr-backref-type-py-function"><span class="n">task_from_id</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="p">)</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kwargs</span></a></a><span class="p">,</span> <span class="n">fct</span> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/tasks/index.html#onnx_diagnostic.tasks.random_input_kwargs" title="onnx_diagnostic.tasks.random_input_kwargs" class="sphx-glr-backref-module-onnx_diagnostic-tasks sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/tasks/index.html#onnx_diagnostic.tasks.random_input_kwargs" title="onnx_diagnostic.tasks.random_input_kwargs" class="sphx-glr-backref-module-onnx_diagnostic-tasks sphx-glr-backref-type-py-function"><span class="n">random_input_kwargs</span></a></a><span class="p">(</span><span class="n">config</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">task</span></a></a><span class="p">)</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">res</span></a></a> <span class="o">=</span> <span class="n">fct</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">add_second_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kwargs</span></a></a><span class="p">)</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">res</span></a></a><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_shapes</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">res</span></a></a><span class="p">[</span><span class="s2">&quot;dynamic_shapes&quot;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <a href="https://docs.pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module.to" title="torch.nn.Module.to" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-method"><a href="https://docs.pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module.to" title="torch.nn.Module.to" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-method"><span class="n">model</span><span class="o">.</span><span class="n">to</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- tokenize the prompt...&quot;</span><span class="p">)</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;def print_prime(n):</span>
<span class="sd">   &quot;&quot;&quot;</span>
<span class="sd">   Print all primes between 1 and n</span>
<span class="sd">   &quot;&quot;&quot;&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
    <span class="n">return_attention_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- compute the answer...&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span>
<a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- done in </span><span class="si">{</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;generate&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output shape:&quot;</span><span class="p">,</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><span class="n">string_type</span></a></a><span class="p">(</span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a><span class="p">,</span> <span class="n">with_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_min_max</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- decode the answer...&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">text</span></a></a> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">batch_decode</span><span class="p">(</span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">text</span></a></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>-- load the model...

Loading weights:   0%|          | 0/341 [00:00&lt;?, ?it/s]
Loading weights:   0%|          | 1/341 [00:00&lt;00:00, 15363.75it/s, Materializing param=lm_head.bias]
Loading weights:   0%|          | 1/341 [00:00&lt;00:00, 6141.00it/s, Materializing param=lm_head.bias]
Loading weights:   1%|          | 2/341 [00:00&lt;00:00, 5200.62it/s, Materializing param=lm_head.weight]
Loading weights:   1%|          | 2/341 [00:00&lt;00:00, 4106.02it/s, Materializing param=lm_head.weight]
Loading weights:   1%|          | 3/341 [00:00&lt;00:00, 1247.81it/s, Materializing param=model.embed_tokens.weight]
Loading weights:   1%|          | 3/341 [00:00&lt;00:00, 1183.94it/s, Materializing param=model.embed_tokens.weight]
Loading weights:   1%|          | 4/341 [00:00&lt;00:00, 1364.22it/s, Materializing param=model.final_layernorm.bias]
Loading weights:   1%|          | 4/341 [00:00&lt;00:00, 1326.37it/s, Materializing param=model.final_layernorm.bias]
Loading weights:   1%|▏         | 5/341 [00:00&lt;00:00, 1510.59it/s, Materializing param=model.final_layernorm.weight]
Loading weights:   1%|▏         | 5/341 [00:00&lt;00:00, 1471.17it/s, Materializing param=model.final_layernorm.weight]
Loading weights:   2%|▏         | 6/341 [00:00&lt;00:00, 1540.42it/s, Materializing param=model.layers.0.input_layernorm.bias]
Loading weights:   2%|▏         | 6/341 [00:00&lt;00:00, 1489.63it/s, Materializing param=model.layers.0.input_layernorm.bias]
Loading weights:   2%|▏         | 7/341 [00:00&lt;00:00, 1496.29it/s, Materializing param=model.layers.0.input_layernorm.weight]
Loading weights:   2%|▏         | 7/341 [00:00&lt;00:00, 1455.85it/s, Materializing param=model.layers.0.input_layernorm.weight]
Loading weights:   2%|▏         | 8/341 [00:00&lt;00:00, 1367.67it/s, Materializing param=model.layers.0.mlp.fc1.bias]
Loading weights:   2%|▏         | 8/341 [00:00&lt;00:00, 1341.91it/s, Materializing param=model.layers.0.mlp.fc1.bias]
Loading weights:   3%|▎         | 9/341 [00:00&lt;00:00, 1357.82it/s, Materializing param=model.layers.0.mlp.fc1.weight]
Loading weights:   3%|▎         | 9/341 [00:00&lt;00:00, 1339.42it/s, Materializing param=model.layers.0.mlp.fc1.weight]
Loading weights:   3%|▎         | 10/341 [00:00&lt;00:00, 1389.62it/s, Materializing param=model.layers.0.mlp.fc2.bias]
Loading weights:   3%|▎         | 10/341 [00:00&lt;00:00, 1371.90it/s, Materializing param=model.layers.0.mlp.fc2.bias]
Loading weights:   3%|▎         | 11/341 [00:00&lt;00:00, 1384.05it/s, Materializing param=model.layers.0.mlp.fc2.weight]
Loading weights:   3%|▎         | 11/341 [00:00&lt;00:00, 1367.56it/s, Materializing param=model.layers.0.mlp.fc2.weight]
Loading weights:   4%|▎         | 12/341 [00:00&lt;00:00, 1382.13it/s, Materializing param=model.layers.0.self_attn.dense.bias]
Loading weights:   4%|▎         | 12/341 [00:00&lt;00:00, 1366.56it/s, Materializing param=model.layers.0.self_attn.dense.bias]
Loading weights:   4%|▍         | 13/341 [00:00&lt;00:00, 1299.72it/s, Materializing param=model.layers.0.self_attn.dense.weight]
Loading weights:   4%|▍         | 13/341 [00:00&lt;00:00, 1288.51it/s, Materializing param=model.layers.0.self_attn.dense.weight]
Loading weights:   4%|▍         | 14/341 [00:00&lt;00:00, 1274.34it/s, Materializing param=model.layers.0.self_attn.k_proj.bias]
Loading weights:   4%|▍         | 14/341 [00:00&lt;00:00, 1264.49it/s, Materializing param=model.layers.0.self_attn.k_proj.bias]
Loading weights:   4%|▍         | 15/341 [00:00&lt;00:00, 1246.85it/s, Materializing param=model.layers.0.self_attn.k_proj.weight]
Loading weights:   4%|▍         | 15/341 [00:00&lt;00:00, 1238.11it/s, Materializing param=model.layers.0.self_attn.k_proj.weight]
Loading weights:   5%|▍         | 16/341 [00:00&lt;00:00, 1289.36it/s, Materializing param=model.layers.0.self_attn.q_proj.bias]
Loading weights:   5%|▍         | 16/341 [00:00&lt;00:00, 1281.58it/s, Materializing param=model.layers.0.self_attn.q_proj.bias]
Loading weights:   5%|▍         | 17/341 [00:00&lt;00:00, 1312.77it/s, Materializing param=model.layers.0.self_attn.q_proj.weight]
Loading weights:   5%|▍         | 17/341 [00:00&lt;00:00, 1301.49it/s, Materializing param=model.layers.0.self_attn.q_proj.weight]
Loading weights:   5%|▌         | 18/341 [00:00&lt;00:00, 1332.51it/s, Materializing param=model.layers.0.self_attn.v_proj.bias]
Loading weights:   5%|▌         | 18/341 [00:00&lt;00:00, 1322.24it/s, Materializing param=model.layers.0.self_attn.v_proj.bias]
Loading weights:   6%|▌         | 19/341 [00:00&lt;00:00, 1351.30it/s, Materializing param=model.layers.0.self_attn.v_proj.weight]
Loading weights:   6%|▌         | 19/341 [00:00&lt;00:00, 1343.10it/s, Materializing param=model.layers.0.self_attn.v_proj.weight]
Loading weights:   6%|▌         | 20/341 [00:00&lt;00:00, 1370.13it/s, Materializing param=model.layers.1.input_layernorm.bias]
Loading weights:   6%|▌         | 20/341 [00:00&lt;00:00, 1361.08it/s, Materializing param=model.layers.1.input_layernorm.bias]
Loading weights:   6%|▌         | 21/341 [00:00&lt;00:00, 1409.29it/s, Materializing param=model.layers.1.input_layernorm.weight]
Loading weights:   6%|▌         | 21/341 [00:00&lt;00:00, 1402.40it/s, Materializing param=model.layers.1.input_layernorm.weight]
Loading weights:   6%|▋         | 22/341 [00:00&lt;00:00, 1409.01it/s, Materializing param=model.layers.1.mlp.fc1.bias]
Loading weights:   6%|▋         | 22/341 [00:00&lt;00:00, 1401.35it/s, Materializing param=model.layers.1.mlp.fc1.bias]
Loading weights:   7%|▋         | 23/341 [00:00&lt;00:00, 1415.68it/s, Materializing param=model.layers.1.mlp.fc1.weight]
Loading weights:   7%|▋         | 23/341 [00:00&lt;00:00, 1407.92it/s, Materializing param=model.layers.1.mlp.fc1.weight]
Loading weights:   7%|▋         | 24/341 [00:00&lt;00:00, 1430.36it/s, Materializing param=model.layers.1.mlp.fc2.bias]
Loading weights:   7%|▋         | 24/341 [00:00&lt;00:00, 1422.12it/s, Materializing param=model.layers.1.mlp.fc2.bias]
Loading weights:   7%|▋         | 25/341 [00:00&lt;00:00, 1405.88it/s, Materializing param=model.layers.1.mlp.fc2.weight]
Loading weights:   7%|▋         | 25/341 [00:00&lt;00:00, 1399.46it/s, Materializing param=model.layers.1.mlp.fc2.weight]
Loading weights:   8%|▊         | 26/341 [00:00&lt;00:00, 1415.95it/s, Materializing param=model.layers.1.self_attn.dense.bias]
Loading weights:   8%|▊         | 26/341 [00:00&lt;00:00, 1409.07it/s, Materializing param=model.layers.1.self_attn.dense.bias]
Loading weights:   8%|▊         | 27/341 [00:00&lt;00:00, 1427.14it/s, Materializing param=model.layers.1.self_attn.dense.weight]
Loading weights:   8%|▊         | 27/341 [00:00&lt;00:00, 1420.83it/s, Materializing param=model.layers.1.self_attn.dense.weight]
Loading weights:   8%|▊         | 28/341 [00:00&lt;00:00, 1423.28it/s, Materializing param=model.layers.1.self_attn.k_proj.bias]
Loading weights:   8%|▊         | 28/341 [00:00&lt;00:00, 1417.06it/s, Materializing param=model.layers.1.self_attn.k_proj.bias]
Loading weights:   9%|▊         | 29/341 [00:00&lt;00:00, 1441.22it/s, Materializing param=model.layers.1.self_attn.k_proj.weight]
Loading weights:   9%|▊         | 29/341 [00:00&lt;00:00, 1432.65it/s, Materializing param=model.layers.1.self_attn.k_proj.weight]
Loading weights:   9%|▉         | 30/341 [00:00&lt;00:00, 1410.21it/s, Materializing param=model.layers.1.self_attn.q_proj.bias]
Loading weights:   9%|▉         | 30/341 [00:00&lt;00:00, 1402.76it/s, Materializing param=model.layers.1.self_attn.q_proj.bias]
Loading weights:   9%|▉         | 31/341 [00:00&lt;00:00, 1407.52it/s, Materializing param=model.layers.1.self_attn.q_proj.weight]
Loading weights:   9%|▉         | 31/341 [00:00&lt;00:00, 1399.92it/s, Materializing param=model.layers.1.self_attn.q_proj.weight]
Loading weights:   9%|▉         | 32/341 [00:00&lt;00:00, 1424.11it/s, Materializing param=model.layers.1.self_attn.v_proj.bias]
Loading weights:   9%|▉         | 32/341 [00:00&lt;00:00, 1416.43it/s, Materializing param=model.layers.1.self_attn.v_proj.bias]
Loading weights:  10%|▉         | 33/341 [00:00&lt;00:00, 1406.45it/s, Materializing param=model.layers.1.self_attn.v_proj.weight]
Loading weights:  10%|▉         | 33/341 [00:00&lt;00:00, 1400.52it/s, Materializing param=model.layers.1.self_attn.v_proj.weight]
Loading weights:  10%|▉         | 34/341 [00:00&lt;00:00, 1397.80it/s, Materializing param=model.layers.2.input_layernorm.bias]
Loading weights:  10%|▉         | 34/341 [00:00&lt;00:00, 1392.33it/s, Materializing param=model.layers.2.input_layernorm.bias]
Loading weights:  10%|█         | 35/341 [00:00&lt;00:00, 1411.11it/s, Materializing param=model.layers.2.input_layernorm.weight]
Loading weights:  10%|█         | 35/341 [00:00&lt;00:00, 1405.34it/s, Materializing param=model.layers.2.input_layernorm.weight]
Loading weights:  11%|█         | 36/341 [00:00&lt;00:00, 1423.27it/s, Materializing param=model.layers.2.mlp.fc1.bias]
Loading weights:  11%|█         | 36/341 [00:00&lt;00:00, 1418.07it/s, Materializing param=model.layers.2.mlp.fc1.bias]
Loading weights:  11%|█         | 37/341 [00:00&lt;00:00, 1412.87it/s, Materializing param=model.layers.2.mlp.fc1.weight]
Loading weights:  11%|█         | 37/341 [00:00&lt;00:00, 1407.60it/s, Materializing param=model.layers.2.mlp.fc1.weight]
Loading weights:  11%|█         | 38/341 [00:00&lt;00:00, 1412.85it/s, Materializing param=model.layers.2.mlp.fc2.bias]
Loading weights:  11%|█         | 38/341 [00:00&lt;00:00, 1408.04it/s, Materializing param=model.layers.2.mlp.fc2.bias]
Loading weights:  11%|█▏        | 39/341 [00:00&lt;00:00, 1404.81it/s, Materializing param=model.layers.2.mlp.fc2.weight]
Loading weights:  11%|█▏        | 39/341 [00:00&lt;00:00, 1400.70it/s, Materializing param=model.layers.2.mlp.fc2.weight]
Loading weights:  12%|█▏        | 40/341 [00:00&lt;00:00, 1413.09it/s, Materializing param=model.layers.2.self_attn.dense.bias]
Loading weights:  12%|█▏        | 40/341 [00:00&lt;00:00, 1408.31it/s, Materializing param=model.layers.2.self_attn.dense.bias]
Loading weights:  12%|█▏        | 41/341 [00:00&lt;00:00, 1400.49it/s, Materializing param=model.layers.2.self_attn.dense.weight]
Loading weights:  12%|█▏        | 41/341 [00:00&lt;00:00, 1395.89it/s, Materializing param=model.layers.2.self_attn.dense.weight]
Loading weights:  12%|█▏        | 42/341 [00:00&lt;00:00, 1388.62it/s, Materializing param=model.layers.2.self_attn.k_proj.bias]
Loading weights:  12%|█▏        | 42/341 [00:00&lt;00:00, 1383.54it/s, Materializing param=model.layers.2.self_attn.k_proj.bias]
Loading weights:  13%|█▎        | 43/341 [00:00&lt;00:00, 1400.47it/s, Materializing param=model.layers.2.self_attn.k_proj.weight]
Loading weights:  13%|█▎        | 43/341 [00:00&lt;00:00, 1395.66it/s, Materializing param=model.layers.2.self_attn.k_proj.weight]
Loading weights:  13%|█▎        | 44/341 [00:00&lt;00:00, 1392.51it/s, Materializing param=model.layers.2.self_attn.q_proj.bias]
Loading weights:  13%|█▎        | 44/341 [00:00&lt;00:00, 1387.72it/s, Materializing param=model.layers.2.self_attn.q_proj.bias]
Loading weights:  13%|█▎        | 45/341 [00:00&lt;00:00, 1402.89it/s, Materializing param=model.layers.2.self_attn.q_proj.weight]
Loading weights:  13%|█▎        | 45/341 [00:00&lt;00:00, 1397.85it/s, Materializing param=model.layers.2.self_attn.q_proj.weight]
Loading weights:  13%|█▎        | 46/341 [00:00&lt;00:00, 1394.67it/s, Materializing param=model.layers.2.self_attn.v_proj.bias]
Loading weights:  13%|█▎        | 46/341 [00:00&lt;00:00, 1390.90it/s, Materializing param=model.layers.2.self_attn.v_proj.bias]
Loading weights:  14%|█▍        | 47/341 [00:00&lt;00:00, 1376.69it/s, Materializing param=model.layers.2.self_attn.v_proj.weight]
Loading weights:  14%|█▍        | 47/341 [00:00&lt;00:00, 1372.95it/s, Materializing param=model.layers.2.self_attn.v_proj.weight]
Loading weights:  14%|█▍        | 48/341 [00:00&lt;00:00, 1386.00it/s, Materializing param=model.layers.3.input_layernorm.bias]
Loading weights:  14%|█▍        | 48/341 [00:00&lt;00:00, 1381.20it/s, Materializing param=model.layers.3.input_layernorm.bias]
Loading weights:  14%|█▍        | 49/341 [00:00&lt;00:00, 1401.46it/s, Materializing param=model.layers.3.input_layernorm.weight]
Loading weights:  14%|█▍        | 49/341 [00:00&lt;00:00, 1398.60it/s, Materializing param=model.layers.3.input_layernorm.weight]
Loading weights:  15%|█▍        | 50/341 [00:00&lt;00:00, 1409.33it/s, Materializing param=model.layers.3.mlp.fc1.bias]
Loading weights:  15%|█▍        | 50/341 [00:00&lt;00:00, 1406.02it/s, Materializing param=model.layers.3.mlp.fc1.bias]
Loading weights:  15%|█▍        | 51/341 [00:00&lt;00:00, 1419.81it/s, Materializing param=model.layers.3.mlp.fc1.weight]
Loading weights:  15%|█▍        | 51/341 [00:00&lt;00:00, 1416.68it/s, Materializing param=model.layers.3.mlp.fc1.weight]
Loading weights:  15%|█▌        | 52/341 [00:00&lt;00:00, 1425.57it/s, Materializing param=model.layers.3.mlp.fc2.bias]
Loading weights:  15%|█▌        | 52/341 [00:00&lt;00:00, 1422.39it/s, Materializing param=model.layers.3.mlp.fc2.bias]
Loading weights:  16%|█▌        | 53/341 [00:00&lt;00:00, 1435.77it/s, Materializing param=model.layers.3.mlp.fc2.weight]
Loading weights:  16%|█▌        | 53/341 [00:00&lt;00:00, 1432.14it/s, Materializing param=model.layers.3.mlp.fc2.weight]
Loading weights:  16%|█▌        | 54/341 [00:00&lt;00:00, 1438.94it/s, Materializing param=model.layers.3.self_attn.dense.bias]
Loading weights:  16%|█▌        | 54/341 [00:00&lt;00:00, 1435.71it/s, Materializing param=model.layers.3.self_attn.dense.bias]
Loading weights:  16%|█▌        | 55/341 [00:00&lt;00:00, 1423.42it/s, Materializing param=model.layers.3.self_attn.dense.weight]
Loading weights:  16%|█▌        | 55/341 [00:00&lt;00:00, 1419.99it/s, Materializing param=model.layers.3.self_attn.dense.weight]
Loading weights:  16%|█▋        | 56/341 [00:00&lt;00:00, 1438.19it/s, Materializing param=model.layers.3.self_attn.k_proj.bias]
Loading weights:  16%|█▋        | 56/341 [00:00&lt;00:00, 1435.50it/s, Materializing param=model.layers.3.self_attn.k_proj.bias]
Loading weights:  17%|█▋        | 57/341 [00:00&lt;00:00, 1443.50it/s, Materializing param=model.layers.3.self_attn.k_proj.weight]
Loading weights:  17%|█▋        | 57/341 [00:00&lt;00:00, 1440.28it/s, Materializing param=model.layers.3.self_attn.k_proj.weight]
Loading weights:  17%|█▋        | 58/341 [00:00&lt;00:00, 1446.25it/s, Materializing param=model.layers.3.self_attn.q_proj.bias]
Loading weights:  17%|█▋        | 58/341 [00:00&lt;00:00, 1443.15it/s, Materializing param=model.layers.3.self_attn.q_proj.bias]
Loading weights:  17%|█▋        | 59/341 [00:00&lt;00:00, 1421.38it/s, Materializing param=model.layers.3.self_attn.q_proj.weight]
Loading weights:  17%|█▋        | 59/341 [00:00&lt;00:00, 1418.39it/s, Materializing param=model.layers.3.self_attn.q_proj.weight]
Loading weights:  18%|█▊        | 60/341 [00:00&lt;00:00, 1429.38it/s, Materializing param=model.layers.3.self_attn.v_proj.bias]
Loading weights:  18%|█▊        | 60/341 [00:00&lt;00:00, 1426.70it/s, Materializing param=model.layers.3.self_attn.v_proj.bias]
Loading weights:  18%|█▊        | 61/341 [00:00&lt;00:00, 1402.25it/s, Materializing param=model.layers.3.self_attn.v_proj.weight]
Loading weights:  18%|█▊        | 61/341 [00:00&lt;00:00, 1398.35it/s, Materializing param=model.layers.3.self_attn.v_proj.weight]
Loading weights:  18%|█▊        | 62/341 [00:00&lt;00:00, 1391.95it/s, Materializing param=model.layers.4.input_layernorm.bias]
Loading weights:  18%|█▊        | 62/341 [00:00&lt;00:00, 1388.09it/s, Materializing param=model.layers.4.input_layernorm.bias]
Loading weights:  18%|█▊        | 63/341 [00:00&lt;00:00, 1400.29it/s, Materializing param=model.layers.4.input_layernorm.weight]
Loading weights:  18%|█▊        | 63/341 [00:00&lt;00:00, 1396.57it/s, Materializing param=model.layers.4.input_layernorm.weight]
Loading weights:  19%|█▉        | 64/341 [00:00&lt;00:00, 1408.87it/s, Materializing param=model.layers.4.mlp.fc1.bias]
Loading weights:  19%|█▉        | 64/341 [00:00&lt;00:00, 1405.08it/s, Materializing param=model.layers.4.mlp.fc1.bias]
Loading weights:  19%|█▉        | 65/341 [00:00&lt;00:00, 1415.21it/s, Materializing param=model.layers.4.mlp.fc1.weight]
Loading weights:  19%|█▉        | 65/341 [00:00&lt;00:00, 1412.44it/s, Materializing param=model.layers.4.mlp.fc1.weight]
Loading weights:  19%|█▉        | 66/341 [00:00&lt;00:00, 1412.22it/s, Materializing param=model.layers.4.mlp.fc2.bias]
Loading weights:  19%|█▉        | 66/341 [00:00&lt;00:00, 1408.61it/s, Materializing param=model.layers.4.mlp.fc2.bias]
Loading weights:  20%|█▉        | 67/341 [00:00&lt;00:00, 1418.19it/s, Materializing param=model.layers.4.mlp.fc2.weight]
Loading weights:  20%|█▉        | 67/341 [00:00&lt;00:00, 1415.27it/s, Materializing param=model.layers.4.mlp.fc2.weight]
Loading weights:  20%|█▉        | 68/341 [00:00&lt;00:00, 1396.44it/s, Materializing param=model.layers.4.self_attn.dense.bias]
Loading weights:  20%|█▉        | 68/341 [00:00&lt;00:00, 1392.82it/s, Materializing param=model.layers.4.self_attn.dense.bias]
Loading weights:  20%|██        | 69/341 [00:00&lt;00:00, 1386.33it/s, Materializing param=model.layers.4.self_attn.dense.weight]
Loading weights:  20%|██        | 69/341 [00:00&lt;00:00, 1383.49it/s, Materializing param=model.layers.4.self_attn.dense.weight]
Loading weights:  21%|██        | 70/341 [00:00&lt;00:00, 1392.17it/s, Materializing param=model.layers.4.self_attn.k_proj.bias]
Loading weights:  21%|██        | 70/341 [00:00&lt;00:00, 1389.18it/s, Materializing param=model.layers.4.self_attn.k_proj.bias]
Loading weights:  21%|██        | 71/341 [00:00&lt;00:00, 1386.28it/s, Materializing param=model.layers.4.self_attn.k_proj.weight]
Loading weights:  21%|██        | 71/341 [00:00&lt;00:00, 1383.86it/s, Materializing param=model.layers.4.self_attn.k_proj.weight]
Loading weights:  21%|██        | 72/341 [00:00&lt;00:00, 1375.57it/s, Materializing param=model.layers.4.self_attn.q_proj.bias]
Loading weights:  21%|██        | 72/341 [00:00&lt;00:00, 1373.04it/s, Materializing param=model.layers.4.self_attn.q_proj.bias]
Loading weights:  21%|██▏       | 73/341 [00:00&lt;00:00, 1386.67it/s, Materializing param=model.layers.4.self_attn.q_proj.weight]
Loading weights:  21%|██▏       | 73/341 [00:00&lt;00:00, 1384.83it/s, Materializing param=model.layers.4.self_attn.q_proj.weight]
Loading weights:  22%|██▏       | 74/341 [00:00&lt;00:00, 1387.77it/s, Materializing param=model.layers.4.self_attn.v_proj.bias]
Loading weights:  22%|██▏       | 74/341 [00:00&lt;00:00, 1385.39it/s, Materializing param=model.layers.4.self_attn.v_proj.bias]
Loading weights:  22%|██▏       | 75/341 [00:00&lt;00:00, 1382.68it/s, Materializing param=model.layers.4.self_attn.v_proj.weight]
Loading weights:  22%|██▏       | 75/341 [00:00&lt;00:00, 1380.56it/s, Materializing param=model.layers.4.self_attn.v_proj.weight]
Loading weights:  22%|██▏       | 76/341 [00:00&lt;00:00, 1385.22it/s, Materializing param=model.layers.5.input_layernorm.bias]
Loading weights:  22%|██▏       | 76/341 [00:00&lt;00:00, 1383.09it/s, Materializing param=model.layers.5.input_layernorm.bias]
Loading weights:  23%|██▎       | 77/341 [00:00&lt;00:00, 1382.91it/s, Materializing param=model.layers.5.input_layernorm.weight]
Loading weights:  23%|██▎       | 77/341 [00:00&lt;00:00, 1380.18it/s, Materializing param=model.layers.5.input_layernorm.weight]
Loading weights:  23%|██▎       | 78/341 [00:00&lt;00:00, 1389.05it/s, Materializing param=model.layers.5.mlp.fc1.bias]
Loading weights:  23%|██▎       | 78/341 [00:00&lt;00:00, 1386.81it/s, Materializing param=model.layers.5.mlp.fc1.bias]
Loading weights:  23%|██▎       | 79/341 [00:00&lt;00:00, 1382.73it/s, Materializing param=model.layers.5.mlp.fc1.weight]
Loading weights:  23%|██▎       | 79/341 [00:00&lt;00:00, 1379.85it/s, Materializing param=model.layers.5.mlp.fc1.weight]
Loading weights:  23%|██▎       | 80/341 [00:00&lt;00:00, 1387.58it/s, Materializing param=model.layers.5.mlp.fc2.bias]
Loading weights:  23%|██▎       | 80/341 [00:00&lt;00:00, 1385.42it/s, Materializing param=model.layers.5.mlp.fc2.bias]
Loading weights:  24%|██▍       | 81/341 [00:00&lt;00:00, 1388.52it/s, Materializing param=model.layers.5.mlp.fc2.weight]
Loading weights:  24%|██▍       | 81/341 [00:00&lt;00:00, 1386.09it/s, Materializing param=model.layers.5.mlp.fc2.weight]
Loading weights:  24%|██▍       | 82/341 [00:00&lt;00:00, 1383.76it/s, Materializing param=model.layers.5.self_attn.dense.bias]
Loading weights:  24%|██▍       | 82/341 [00:00&lt;00:00, 1380.92it/s, Materializing param=model.layers.5.self_attn.dense.bias]
Loading weights:  24%|██▍       | 83/341 [00:00&lt;00:00, 1390.24it/s, Materializing param=model.layers.5.self_attn.dense.weight]
Loading weights:  24%|██▍       | 83/341 [00:00&lt;00:00, 1387.75it/s, Materializing param=model.layers.5.self_attn.dense.weight]
Loading weights:  25%|██▍       | 84/341 [00:00&lt;00:00, 1383.53it/s, Materializing param=model.layers.5.self_attn.k_proj.bias]
Loading weights:  25%|██▍       | 84/341 [00:00&lt;00:00, 1381.01it/s, Materializing param=model.layers.5.self_attn.k_proj.bias]
Loading weights:  25%|██▍       | 85/341 [00:00&lt;00:00, 1383.24it/s, Materializing param=model.layers.5.self_attn.k_proj.weight]
Loading weights:  25%|██▍       | 85/341 [00:00&lt;00:00, 1380.88it/s, Materializing param=model.layers.5.self_attn.k_proj.weight]
Loading weights:  25%|██▌       | 86/341 [00:00&lt;00:00, 1385.04it/s, Materializing param=model.layers.5.self_attn.q_proj.bias]
Loading weights:  25%|██▌       | 86/341 [00:00&lt;00:00, 1382.53it/s, Materializing param=model.layers.5.self_attn.q_proj.bias]
Loading weights:  26%|██▌       | 87/341 [00:00&lt;00:00, 1384.64it/s, Materializing param=model.layers.5.self_attn.q_proj.weight]
Loading weights:  26%|██▌       | 87/341 [00:00&lt;00:00, 1382.64it/s, Materializing param=model.layers.5.self_attn.q_proj.weight]
Loading weights:  26%|██▌       | 88/341 [00:00&lt;00:00, 1375.28it/s, Materializing param=model.layers.5.self_attn.v_proj.bias]
Loading weights:  26%|██▌       | 88/341 [00:00&lt;00:00, 1372.83it/s, Materializing param=model.layers.5.self_attn.v_proj.bias]
Loading weights:  26%|██▌       | 89/341 [00:00&lt;00:00, 1377.30it/s, Materializing param=model.layers.5.self_attn.v_proj.weight]
Loading weights:  26%|██▌       | 89/341 [00:00&lt;00:00, 1375.37it/s, Materializing param=model.layers.5.self_attn.v_proj.weight]
Loading weights:  26%|██▋       | 90/341 [00:00&lt;00:00, 1355.55it/s, Materializing param=model.layers.6.input_layernorm.bias]
Loading weights:  26%|██▋       | 90/341 [00:00&lt;00:00, 1353.77it/s, Materializing param=model.layers.6.input_layernorm.bias]
Loading weights:  27%|██▋       | 91/341 [00:00&lt;00:00, 1338.34it/s, Materializing param=model.layers.6.input_layernorm.weight]
Loading weights:  27%|██▋       | 91/341 [00:00&lt;00:00, 1336.06it/s, Materializing param=model.layers.6.input_layernorm.weight]
Loading weights:  27%|██▋       | 92/341 [00:00&lt;00:00, 1342.44it/s, Materializing param=model.layers.6.mlp.fc1.bias]
Loading weights:  27%|██▋       | 92/341 [00:00&lt;00:00, 1340.57it/s, Materializing param=model.layers.6.mlp.fc1.bias]
Loading weights:  27%|██▋       | 93/341 [00:00&lt;00:00, 1345.36it/s, Materializing param=model.layers.6.mlp.fc1.weight]
Loading weights:  27%|██▋       | 93/341 [00:00&lt;00:00, 1343.51it/s, Materializing param=model.layers.6.mlp.fc1.weight]
Loading weights:  28%|██▊       | 94/341 [00:00&lt;00:00, 1349.63it/s, Materializing param=model.layers.6.mlp.fc2.bias]
Loading weights:  28%|██▊       | 94/341 [00:00&lt;00:00, 1348.10it/s, Materializing param=model.layers.6.mlp.fc2.bias]
Loading weights:  28%|██▊       | 95/341 [00:00&lt;00:00, 1355.86it/s, Materializing param=model.layers.6.mlp.fc2.weight]
Loading weights:  28%|██▊       | 95/341 [00:00&lt;00:00, 1354.01it/s, Materializing param=model.layers.6.mlp.fc2.weight]
Loading weights:  28%|██▊       | 96/341 [00:00&lt;00:00, 1356.35it/s, Materializing param=model.layers.6.self_attn.dense.bias]
Loading weights:  28%|██▊       | 96/341 [00:00&lt;00:00, 1354.59it/s, Materializing param=model.layers.6.self_attn.dense.bias]
Loading weights:  28%|██▊       | 97/341 [00:00&lt;00:00, 1359.48it/s, Materializing param=model.layers.6.self_attn.dense.weight]
Loading weights:  28%|██▊       | 97/341 [00:00&lt;00:00, 1357.97it/s, Materializing param=model.layers.6.self_attn.dense.weight]
Loading weights:  29%|██▊       | 98/341 [00:00&lt;00:00, 1359.01it/s, Materializing param=model.layers.6.self_attn.k_proj.bias]
Loading weights:  29%|██▊       | 98/341 [00:00&lt;00:00, 1357.34it/s, Materializing param=model.layers.6.self_attn.k_proj.bias]
Loading weights:  29%|██▉       | 99/341 [00:00&lt;00:00, 1364.71it/s, Materializing param=model.layers.6.self_attn.k_proj.weight]
Loading weights:  29%|██▉       | 99/341 [00:00&lt;00:00, 1363.26it/s, Materializing param=model.layers.6.self_attn.k_proj.weight]
Loading weights:  29%|██▉       | 100/341 [00:00&lt;00:00, 1368.72it/s, Materializing param=model.layers.6.self_attn.q_proj.bias]
Loading weights:  29%|██▉       | 100/341 [00:00&lt;00:00, 1366.49it/s, Materializing param=model.layers.6.self_attn.q_proj.bias]
Loading weights:  30%|██▉       | 101/341 [00:00&lt;00:00, 1371.14it/s, Materializing param=model.layers.6.self_attn.q_proj.weight]
Loading weights:  30%|██▉       | 101/341 [00:00&lt;00:00, 1369.40it/s, Materializing param=model.layers.6.self_attn.q_proj.weight]
Loading weights:  30%|██▉       | 102/341 [00:00&lt;00:00, 1370.18it/s, Materializing param=model.layers.6.self_attn.v_proj.bias]
Loading weights:  30%|██▉       | 102/341 [00:00&lt;00:00, 1368.58it/s, Materializing param=model.layers.6.self_attn.v_proj.bias]
Loading weights:  30%|███       | 103/341 [00:00&lt;00:00, 1364.40it/s, Materializing param=model.layers.6.self_attn.v_proj.weight]
Loading weights:  30%|███       | 103/341 [00:00&lt;00:00, 1362.81it/s, Materializing param=model.layers.6.self_attn.v_proj.weight]
Loading weights:  30%|███       | 104/341 [00:00&lt;00:00, 1368.41it/s, Materializing param=model.layers.7.input_layernorm.bias]
Loading weights:  30%|███       | 104/341 [00:00&lt;00:00, 1366.67it/s, Materializing param=model.layers.7.input_layernorm.bias]
Loading weights:  31%|███       | 105/341 [00:00&lt;00:00, 1370.59it/s, Materializing param=model.layers.7.input_layernorm.weight]
Loading weights:  31%|███       | 105/341 [00:00&lt;00:00, 1369.03it/s, Materializing param=model.layers.7.input_layernorm.weight]
Loading weights:  31%|███       | 106/341 [00:00&lt;00:00, 1370.67it/s, Materializing param=model.layers.7.mlp.fc1.bias]
Loading weights:  31%|███       | 106/341 [00:00&lt;00:00, 1368.92it/s, Materializing param=model.layers.7.mlp.fc1.bias]
Loading weights:  31%|███▏      | 107/341 [00:00&lt;00:00, 1363.74it/s, Materializing param=model.layers.7.mlp.fc1.weight]
Loading weights:  31%|███▏      | 107/341 [00:00&lt;00:00, 1361.98it/s, Materializing param=model.layers.7.mlp.fc1.weight]
Loading weights:  32%|███▏      | 108/341 [00:00&lt;00:00, 1364.71it/s, Materializing param=model.layers.7.mlp.fc2.bias]
Loading weights:  32%|███▏      | 108/341 [00:00&lt;00:00, 1362.89it/s, Materializing param=model.layers.7.mlp.fc2.bias]
Loading weights:  32%|███▏      | 109/341 [00:00&lt;00:00, 1361.05it/s, Materializing param=model.layers.7.mlp.fc2.weight]
Loading weights:  32%|███▏      | 109/341 [00:00&lt;00:00, 1359.52it/s, Materializing param=model.layers.7.mlp.fc2.weight]
Loading weights:  32%|███▏      | 110/341 [00:00&lt;00:00, 1366.49it/s, Materializing param=model.layers.7.self_attn.dense.bias]
Loading weights:  32%|███▏      | 110/341 [00:00&lt;00:00, 1364.78it/s, Materializing param=model.layers.7.self_attn.dense.bias]
Loading weights:  33%|███▎      | 111/341 [00:00&lt;00:00, 1369.08it/s, Materializing param=model.layers.7.self_attn.dense.weight]
Loading weights:  33%|███▎      | 111/341 [00:00&lt;00:00, 1367.57it/s, Materializing param=model.layers.7.self_attn.dense.weight]
Loading weights:  33%|███▎      | 112/341 [00:00&lt;00:00, 1372.02it/s, Materializing param=model.layers.7.self_attn.k_proj.bias]
Loading weights:  33%|███▎      | 112/341 [00:00&lt;00:00, 1370.60it/s, Materializing param=model.layers.7.self_attn.k_proj.bias]
Loading weights:  33%|███▎      | 113/341 [00:00&lt;00:00, 1375.71it/s, Materializing param=model.layers.7.self_attn.k_proj.weight]
Loading weights:  33%|███▎      | 113/341 [00:00&lt;00:00, 1374.23it/s, Materializing param=model.layers.7.self_attn.k_proj.weight]
Loading weights:  33%|███▎      | 114/341 [00:00&lt;00:00, 1374.82it/s, Materializing param=model.layers.7.self_attn.q_proj.bias]
Loading weights:  33%|███▎      | 114/341 [00:00&lt;00:00, 1373.38it/s, Materializing param=model.layers.7.self_attn.q_proj.bias]
Loading weights:  34%|███▎      | 115/341 [00:00&lt;00:00, 1375.74it/s, Materializing param=model.layers.7.self_attn.q_proj.weight]
Loading weights:  34%|███▎      | 115/341 [00:00&lt;00:00, 1374.07it/s, Materializing param=model.layers.7.self_attn.q_proj.weight]
Loading weights:  34%|███▍      | 116/341 [00:00&lt;00:00, 1379.42it/s, Materializing param=model.layers.7.self_attn.v_proj.bias]
Loading weights:  34%|███▍      | 116/341 [00:00&lt;00:00, 1378.17it/s, Materializing param=model.layers.7.self_attn.v_proj.bias]
Loading weights:  34%|███▍      | 117/341 [00:00&lt;00:00, 1376.81it/s, Materializing param=model.layers.7.self_attn.v_proj.weight]
Loading weights:  34%|███▍      | 117/341 [00:00&lt;00:00, 1374.99it/s, Materializing param=model.layers.7.self_attn.v_proj.weight]
Loading weights:  35%|███▍      | 118/341 [00:00&lt;00:00, 1383.09it/s, Materializing param=model.layers.8.input_layernorm.bias]
Loading weights:  35%|███▍      | 118/341 [00:00&lt;00:00, 1381.84it/s, Materializing param=model.layers.8.input_layernorm.bias]
Loading weights:  35%|███▍      | 119/341 [00:00&lt;00:00, 1386.12it/s, Materializing param=model.layers.8.input_layernorm.weight]
Loading weights:  35%|███▍      | 119/341 [00:00&lt;00:00, 1384.65it/s, Materializing param=model.layers.8.input_layernorm.weight]
Loading weights:  35%|███▌      | 120/341 [00:00&lt;00:00, 1381.38it/s, Materializing param=model.layers.8.mlp.fc1.bias]
Loading weights:  35%|███▌      | 120/341 [00:00&lt;00:00, 1379.37it/s, Materializing param=model.layers.8.mlp.fc1.bias]
Loading weights:  35%|███▌      | 121/341 [00:00&lt;00:00, 1382.15it/s, Materializing param=model.layers.8.mlp.fc1.weight]
Loading weights:  35%|███▌      | 121/341 [00:00&lt;00:00, 1380.67it/s, Materializing param=model.layers.8.mlp.fc1.weight]
Loading weights:  36%|███▌      | 122/341 [00:00&lt;00:00, 1382.91it/s, Materializing param=model.layers.8.mlp.fc2.bias]
Loading weights:  36%|███▌      | 122/341 [00:00&lt;00:00, 1381.37it/s, Materializing param=model.layers.8.mlp.fc2.bias]
Loading weights:  36%|███▌      | 123/341 [00:00&lt;00:00, 1380.71it/s, Materializing param=model.layers.8.mlp.fc2.weight]
Loading weights:  36%|███▌      | 123/341 [00:00&lt;00:00, 1379.19it/s, Materializing param=model.layers.8.mlp.fc2.weight]
Loading weights:  36%|███▋      | 124/341 [00:00&lt;00:00, 1372.13it/s, Materializing param=model.layers.8.self_attn.dense.bias]
Loading weights:  36%|███▋      | 124/341 [00:00&lt;00:00, 1370.72it/s, Materializing param=model.layers.8.self_attn.dense.bias]
Loading weights:  37%|███▋      | 125/341 [00:00&lt;00:00, 1375.88it/s, Materializing param=model.layers.8.self_attn.dense.weight]
Loading weights:  37%|███▋      | 125/341 [00:00&lt;00:00, 1374.02it/s, Materializing param=model.layers.8.self_attn.dense.weight]
Loading weights:  37%|███▋      | 126/341 [00:00&lt;00:00, 1376.70it/s, Materializing param=model.layers.8.self_attn.k_proj.bias]
Loading weights:  37%|███▋      | 126/341 [00:00&lt;00:00, 1375.28it/s, Materializing param=model.layers.8.self_attn.k_proj.bias]
Loading weights:  37%|███▋      | 127/341 [00:00&lt;00:00, 1380.74it/s, Materializing param=model.layers.8.self_attn.k_proj.weight]
Loading weights:  37%|███▋      | 127/341 [00:00&lt;00:00, 1379.56it/s, Materializing param=model.layers.8.self_attn.k_proj.weight]
Loading weights:  38%|███▊      | 128/341 [00:00&lt;00:00, 1367.97it/s, Materializing param=model.layers.8.self_attn.q_proj.bias]
Loading weights:  38%|███▊      | 128/341 [00:00&lt;00:00, 1366.15it/s, Materializing param=model.layers.8.self_attn.q_proj.bias]
Loading weights:  38%|███▊      | 129/341 [00:00&lt;00:00, 1367.47it/s, Materializing param=model.layers.8.self_attn.q_proj.weight]
Loading weights:  38%|███▊      | 129/341 [00:00&lt;00:00, 1366.09it/s, Materializing param=model.layers.8.self_attn.q_proj.weight]
Loading weights:  38%|███▊      | 130/341 [00:00&lt;00:00, 1368.08it/s, Materializing param=model.layers.8.self_attn.v_proj.bias]
Loading weights:  38%|███▊      | 130/341 [00:00&lt;00:00, 1365.87it/s, Materializing param=model.layers.8.self_attn.v_proj.bias]
Loading weights:  38%|███▊      | 131/341 [00:00&lt;00:00, 1371.71it/s, Materializing param=model.layers.8.self_attn.v_proj.weight]
Loading weights:  38%|███▊      | 131/341 [00:00&lt;00:00, 1370.02it/s, Materializing param=model.layers.8.self_attn.v_proj.weight]
Loading weights:  39%|███▊      | 132/341 [00:00&lt;00:00, 1360.49it/s, Materializing param=model.layers.9.input_layernorm.bias]
Loading weights:  39%|███▊      | 132/341 [00:00&lt;00:00, 1358.56it/s, Materializing param=model.layers.9.input_layernorm.bias]
Loading weights:  39%|███▉      | 133/341 [00:00&lt;00:00, 1354.97it/s, Materializing param=model.layers.9.input_layernorm.weight]
Loading weights:  39%|███▉      | 133/341 [00:00&lt;00:00, 1352.89it/s, Materializing param=model.layers.9.input_layernorm.weight]
Loading weights:  39%|███▉      | 134/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.input_layernorm.weight]
Loading weights:  39%|███▉      | 134/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc1.bias]
Loading weights:  39%|███▉      | 134/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc1.bias]
Loading weights:  40%|███▉      | 135/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc1.weight]
Loading weights:  40%|███▉      | 135/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc1.weight]
Loading weights:  40%|███▉      | 136/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc2.bias]
Loading weights:  40%|███▉      | 136/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc2.bias]
Loading weights:  40%|████      | 137/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc2.weight]
Loading weights:  40%|████      | 137/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.mlp.fc2.weight]
Loading weights:  40%|████      | 138/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.dense.bias]
Loading weights:  40%|████      | 138/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.dense.bias]
Loading weights:  41%|████      | 139/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.dense.weight]
Loading weights:  41%|████      | 139/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.dense.weight]
Loading weights:  41%|████      | 140/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.k_proj.bias]
Loading weights:  41%|████      | 140/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.k_proj.bias]
Loading weights:  41%|████▏     | 141/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.k_proj.weight]
Loading weights:  41%|████▏     | 141/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.k_proj.weight]
Loading weights:  42%|████▏     | 142/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.q_proj.bias]
Loading weights:  42%|████▏     | 142/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.q_proj.bias]
Loading weights:  42%|████▏     | 143/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.q_proj.weight]
Loading weights:  42%|████▏     | 143/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.q_proj.weight]
Loading weights:  42%|████▏     | 144/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.v_proj.bias]
Loading weights:  42%|████▏     | 144/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.v_proj.bias]
Loading weights:  43%|████▎     | 145/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.v_proj.weight]
Loading weights:  43%|████▎     | 145/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.9.self_attn.v_proj.weight]
Loading weights:  43%|████▎     | 146/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.input_layernorm.bias]
Loading weights:  43%|████▎     | 146/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.input_layernorm.bias]
Loading weights:  43%|████▎     | 147/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.input_layernorm.weight]
Loading weights:  43%|████▎     | 147/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.input_layernorm.weight]
Loading weights:  43%|████▎     | 148/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc1.bias]
Loading weights:  43%|████▎     | 148/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc1.bias]
Loading weights:  44%|████▎     | 149/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc1.weight]
Loading weights:  44%|████▎     | 149/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc1.weight]
Loading weights:  44%|████▍     | 150/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc2.bias]
Loading weights:  44%|████▍     | 150/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc2.bias]
Loading weights:  44%|████▍     | 151/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc2.weight]
Loading weights:  44%|████▍     | 151/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.mlp.fc2.weight]
Loading weights:  45%|████▍     | 152/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.dense.bias]
Loading weights:  45%|████▍     | 152/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.dense.bias]
Loading weights:  45%|████▍     | 153/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.dense.weight]
Loading weights:  45%|████▍     | 153/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.dense.weight]
Loading weights:  45%|████▌     | 154/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.k_proj.bias]
Loading weights:  45%|████▌     | 154/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.k_proj.bias]
Loading weights:  45%|████▌     | 155/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.k_proj.weight]
Loading weights:  45%|████▌     | 155/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.k_proj.weight]
Loading weights:  46%|████▌     | 156/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.q_proj.bias]
Loading weights:  46%|████▌     | 156/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.q_proj.bias]
Loading weights:  46%|████▌     | 157/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.q_proj.weight]
Loading weights:  46%|████▌     | 157/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.q_proj.weight]
Loading weights:  46%|████▋     | 158/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.v_proj.bias]
Loading weights:  46%|████▋     | 158/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.v_proj.bias]
Loading weights:  47%|████▋     | 159/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.v_proj.weight]
Loading weights:  47%|████▋     | 159/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.10.self_attn.v_proj.weight]
Loading weights:  47%|████▋     | 160/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.input_layernorm.bias]
Loading weights:  47%|████▋     | 160/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.input_layernorm.bias]
Loading weights:  47%|████▋     | 161/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.input_layernorm.weight]
Loading weights:  47%|████▋     | 161/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.input_layernorm.weight]
Loading weights:  48%|████▊     | 162/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc1.bias]
Loading weights:  48%|████▊     | 162/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc1.bias]
Loading weights:  48%|████▊     | 163/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc1.weight]
Loading weights:  48%|████▊     | 163/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc1.weight]
Loading weights:  48%|████▊     | 164/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc2.bias]
Loading weights:  48%|████▊     | 164/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc2.bias]
Loading weights:  48%|████▊     | 165/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc2.weight]
Loading weights:  48%|████▊     | 165/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.mlp.fc2.weight]
Loading weights:  49%|████▊     | 166/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.dense.bias]
Loading weights:  49%|████▊     | 166/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.dense.bias]
Loading weights:  49%|████▉     | 167/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.dense.weight]
Loading weights:  49%|████▉     | 167/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.dense.weight]
Loading weights:  49%|████▉     | 168/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.k_proj.bias]
Loading weights:  49%|████▉     | 168/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.k_proj.bias]
Loading weights:  50%|████▉     | 169/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.k_proj.weight]
Loading weights:  50%|████▉     | 169/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.k_proj.weight]
Loading weights:  50%|████▉     | 170/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.q_proj.bias]
Loading weights:  50%|████▉     | 170/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.q_proj.bias]
Loading weights:  50%|█████     | 171/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.q_proj.weight]
Loading weights:  50%|█████     | 171/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.q_proj.weight]
Loading weights:  50%|█████     | 172/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.v_proj.bias]
Loading weights:  50%|█████     | 172/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.v_proj.bias]
Loading weights:  51%|█████     | 173/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.v_proj.weight]
Loading weights:  51%|█████     | 173/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.11.self_attn.v_proj.weight]
Loading weights:  51%|█████     | 174/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.input_layernorm.bias]
Loading weights:  51%|█████     | 174/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.input_layernorm.bias]
Loading weights:  51%|█████▏    | 175/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.input_layernorm.weight]
Loading weights:  51%|█████▏    | 175/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.input_layernorm.weight]
Loading weights:  52%|█████▏    | 176/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc1.bias]
Loading weights:  52%|█████▏    | 176/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc1.bias]
Loading weights:  52%|█████▏    | 177/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc1.weight]
Loading weights:  52%|█████▏    | 177/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc1.weight]
Loading weights:  52%|█████▏    | 178/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc2.bias]
Loading weights:  52%|█████▏    | 178/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc2.bias]
Loading weights:  52%|█████▏    | 179/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc2.weight]
Loading weights:  52%|█████▏    | 179/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.mlp.fc2.weight]
Loading weights:  53%|█████▎    | 180/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.dense.bias]
Loading weights:  53%|█████▎    | 180/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.dense.bias]
Loading weights:  53%|█████▎    | 181/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.dense.weight]
Loading weights:  53%|█████▎    | 181/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.dense.weight]
Loading weights:  53%|█████▎    | 182/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.k_proj.bias]
Loading weights:  53%|█████▎    | 182/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.k_proj.bias]
Loading weights:  54%|█████▎    | 183/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.k_proj.weight]
Loading weights:  54%|█████▎    | 183/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.k_proj.weight]
Loading weights:  54%|█████▍    | 184/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.q_proj.bias]
Loading weights:  54%|█████▍    | 184/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.q_proj.bias]
Loading weights:  54%|█████▍    | 185/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.q_proj.weight]
Loading weights:  54%|█████▍    | 185/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.q_proj.weight]
Loading weights:  55%|█████▍    | 186/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.v_proj.bias]
Loading weights:  55%|█████▍    | 186/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.v_proj.bias]
Loading weights:  55%|█████▍    | 187/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.v_proj.weight]
Loading weights:  55%|█████▍    | 187/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.12.self_attn.v_proj.weight]
Loading weights:  55%|█████▌    | 188/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.input_layernorm.bias]
Loading weights:  55%|█████▌    | 188/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.input_layernorm.bias]
Loading weights:  55%|█████▌    | 189/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.input_layernorm.weight]
Loading weights:  55%|█████▌    | 189/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.input_layernorm.weight]
Loading weights:  56%|█████▌    | 190/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc1.bias]
Loading weights:  56%|█████▌    | 190/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc1.bias]
Loading weights:  56%|█████▌    | 191/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc1.weight]
Loading weights:  56%|█████▌    | 191/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc1.weight]
Loading weights:  56%|█████▋    | 192/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc2.bias]
Loading weights:  56%|█████▋    | 192/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc2.bias]
Loading weights:  57%|█████▋    | 193/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc2.weight]
Loading weights:  57%|█████▋    | 193/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.mlp.fc2.weight]
Loading weights:  57%|█████▋    | 194/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.dense.bias]
Loading weights:  57%|█████▋    | 194/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.dense.bias]
Loading weights:  57%|█████▋    | 195/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.dense.weight]
Loading weights:  57%|█████▋    | 195/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.dense.weight]
Loading weights:  57%|█████▋    | 196/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.k_proj.bias]
Loading weights:  57%|█████▋    | 196/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.k_proj.bias]
Loading weights:  58%|█████▊    | 197/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.k_proj.weight]
Loading weights:  58%|█████▊    | 197/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.k_proj.weight]
Loading weights:  58%|█████▊    | 198/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.q_proj.bias]
Loading weights:  58%|█████▊    | 198/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.q_proj.bias]
Loading weights:  58%|█████▊    | 199/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.q_proj.weight]
Loading weights:  58%|█████▊    | 199/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.q_proj.weight]
Loading weights:  59%|█████▊    | 200/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.v_proj.bias]
Loading weights:  59%|█████▊    | 200/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.v_proj.bias]
Loading weights:  59%|█████▉    | 201/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.v_proj.weight]
Loading weights:  59%|█████▉    | 201/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.13.self_attn.v_proj.weight]
Loading weights:  59%|█████▉    | 202/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.input_layernorm.bias]
Loading weights:  59%|█████▉    | 202/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.input_layernorm.bias]
Loading weights:  60%|█████▉    | 203/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.input_layernorm.weight]
Loading weights:  60%|█████▉    | 203/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.input_layernorm.weight]
Loading weights:  60%|█████▉    | 204/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc1.bias]
Loading weights:  60%|█████▉    | 204/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc1.bias]
Loading weights:  60%|██████    | 205/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc1.weight]
Loading weights:  60%|██████    | 205/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc1.weight]
Loading weights:  60%|██████    | 206/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc2.bias]
Loading weights:  60%|██████    | 206/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc2.bias]
Loading weights:  61%|██████    | 207/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc2.weight]
Loading weights:  61%|██████    | 207/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.mlp.fc2.weight]
Loading weights:  61%|██████    | 208/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.dense.bias]
Loading weights:  61%|██████    | 208/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.dense.bias]
Loading weights:  61%|██████▏   | 209/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.dense.weight]
Loading weights:  61%|██████▏   | 209/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.dense.weight]
Loading weights:  62%|██████▏   | 210/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.k_proj.bias]
Loading weights:  62%|██████▏   | 210/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.k_proj.bias]
Loading weights:  62%|██████▏   | 211/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.k_proj.weight]
Loading weights:  62%|██████▏   | 211/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.k_proj.weight]
Loading weights:  62%|██████▏   | 212/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.q_proj.bias]
Loading weights:  62%|██████▏   | 212/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.q_proj.bias]
Loading weights:  62%|██████▏   | 213/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.q_proj.weight]
Loading weights:  62%|██████▏   | 213/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.q_proj.weight]
Loading weights:  63%|██████▎   | 214/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.v_proj.bias]
Loading weights:  63%|██████▎   | 214/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.v_proj.bias]
Loading weights:  63%|██████▎   | 215/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.v_proj.weight]
Loading weights:  63%|██████▎   | 215/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.14.self_attn.v_proj.weight]
Loading weights:  63%|██████▎   | 216/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.input_layernorm.bias]
Loading weights:  63%|██████▎   | 216/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.input_layernorm.bias]
Loading weights:  64%|██████▎   | 217/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.input_layernorm.weight]
Loading weights:  64%|██████▎   | 217/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.input_layernorm.weight]
Loading weights:  64%|██████▍   | 218/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc1.bias]
Loading weights:  64%|██████▍   | 218/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc1.bias]
Loading weights:  64%|██████▍   | 219/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc1.weight]
Loading weights:  64%|██████▍   | 219/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc1.weight]
Loading weights:  65%|██████▍   | 220/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc2.bias]
Loading weights:  65%|██████▍   | 220/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc2.bias]
Loading weights:  65%|██████▍   | 221/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc2.weight]
Loading weights:  65%|██████▍   | 221/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.mlp.fc2.weight]
Loading weights:  65%|██████▌   | 222/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.dense.bias]
Loading weights:  65%|██████▌   | 222/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.dense.bias]
Loading weights:  65%|██████▌   | 223/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.dense.weight]
Loading weights:  65%|██████▌   | 223/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.dense.weight]
Loading weights:  66%|██████▌   | 224/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.k_proj.bias]
Loading weights:  66%|██████▌   | 224/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.k_proj.bias]
Loading weights:  66%|██████▌   | 225/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.k_proj.weight]
Loading weights:  66%|██████▌   | 225/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.k_proj.weight]
Loading weights:  66%|██████▋   | 226/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.q_proj.bias]
Loading weights:  66%|██████▋   | 226/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.q_proj.bias]
Loading weights:  67%|██████▋   | 227/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.q_proj.weight]
Loading weights:  67%|██████▋   | 227/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.q_proj.weight]
Loading weights:  67%|██████▋   | 228/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.v_proj.bias]
Loading weights:  67%|██████▋   | 228/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.v_proj.bias]
Loading weights:  67%|██████▋   | 229/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.v_proj.weight]
Loading weights:  67%|██████▋   | 229/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.15.self_attn.v_proj.weight]
Loading weights:  67%|██████▋   | 230/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.input_layernorm.bias]
Loading weights:  67%|██████▋   | 230/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.input_layernorm.bias]
Loading weights:  68%|██████▊   | 231/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.input_layernorm.weight]
Loading weights:  68%|██████▊   | 231/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.input_layernorm.weight]
Loading weights:  68%|██████▊   | 232/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc1.bias]
Loading weights:  68%|██████▊   | 232/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc1.bias]
Loading weights:  68%|██████▊   | 233/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc1.weight]
Loading weights:  68%|██████▊   | 233/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc1.weight]
Loading weights:  69%|██████▊   | 234/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc2.bias]
Loading weights:  69%|██████▊   | 234/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc2.bias]
Loading weights:  69%|██████▉   | 235/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc2.weight]
Loading weights:  69%|██████▉   | 235/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.mlp.fc2.weight]
Loading weights:  69%|██████▉   | 236/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.dense.bias]
Loading weights:  69%|██████▉   | 236/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.dense.bias]
Loading weights:  70%|██████▉   | 237/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.dense.weight]
Loading weights:  70%|██████▉   | 237/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.dense.weight]
Loading weights:  70%|██████▉   | 238/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.k_proj.bias]
Loading weights:  70%|██████▉   | 238/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.k_proj.bias]
Loading weights:  70%|███████   | 239/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.k_proj.weight]
Loading weights:  70%|███████   | 239/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.k_proj.weight]
Loading weights:  70%|███████   | 240/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.q_proj.bias]
Loading weights:  70%|███████   | 240/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.q_proj.bias]
Loading weights:  71%|███████   | 241/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.q_proj.weight]
Loading weights:  71%|███████   | 241/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.q_proj.weight]
Loading weights:  71%|███████   | 242/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.v_proj.bias]
Loading weights:  71%|███████   | 242/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.v_proj.bias]
Loading weights:  71%|███████▏  | 243/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.v_proj.weight]
Loading weights:  71%|███████▏  | 243/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.16.self_attn.v_proj.weight]
Loading weights:  72%|███████▏  | 244/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.input_layernorm.bias]
Loading weights:  72%|███████▏  | 244/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.input_layernorm.bias]
Loading weights:  72%|███████▏  | 245/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.input_layernorm.weight]
Loading weights:  72%|███████▏  | 245/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.input_layernorm.weight]
Loading weights:  72%|███████▏  | 246/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc1.bias]
Loading weights:  72%|███████▏  | 246/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc1.bias]
Loading weights:  72%|███████▏  | 247/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc1.weight]
Loading weights:  72%|███████▏  | 247/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc1.weight]
Loading weights:  73%|███████▎  | 248/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc2.bias]
Loading weights:  73%|███████▎  | 248/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc2.bias]
Loading weights:  73%|███████▎  | 249/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc2.weight]
Loading weights:  73%|███████▎  | 249/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.mlp.fc2.weight]
Loading weights:  73%|███████▎  | 250/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.dense.bias]
Loading weights:  73%|███████▎  | 250/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.dense.bias]
Loading weights:  74%|███████▎  | 251/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.dense.weight]
Loading weights:  74%|███████▎  | 251/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.dense.weight]
Loading weights:  74%|███████▍  | 252/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.k_proj.bias]
Loading weights:  74%|███████▍  | 252/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.k_proj.bias]
Loading weights:  74%|███████▍  | 253/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.k_proj.weight]
Loading weights:  74%|███████▍  | 253/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.k_proj.weight]
Loading weights:  74%|███████▍  | 254/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.q_proj.bias]
Loading weights:  74%|███████▍  | 254/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.q_proj.bias]
Loading weights:  75%|███████▍  | 255/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.q_proj.weight]
Loading weights:  75%|███████▍  | 255/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.q_proj.weight]
Loading weights:  75%|███████▌  | 256/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.v_proj.bias]
Loading weights:  75%|███████▌  | 256/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.v_proj.bias]
Loading weights:  75%|███████▌  | 257/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.v_proj.weight]
Loading weights:  75%|███████▌  | 257/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.17.self_attn.v_proj.weight]
Loading weights:  76%|███████▌  | 258/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.input_layernorm.bias]
Loading weights:  76%|███████▌  | 258/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.input_layernorm.bias]
Loading weights:  76%|███████▌  | 259/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.input_layernorm.weight]
Loading weights:  76%|███████▌  | 259/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.input_layernorm.weight]
Loading weights:  76%|███████▌  | 260/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc1.bias]
Loading weights:  76%|███████▌  | 260/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc1.bias]
Loading weights:  77%|███████▋  | 261/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc1.weight]
Loading weights:  77%|███████▋  | 261/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc1.weight]
Loading weights:  77%|███████▋  | 262/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc2.bias]
Loading weights:  77%|███████▋  | 262/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc2.bias]
Loading weights:  77%|███████▋  | 263/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc2.weight]
Loading weights:  77%|███████▋  | 263/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.mlp.fc2.weight]
Loading weights:  77%|███████▋  | 264/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.self_attn.dense.bias]
Loading weights:  77%|███████▋  | 264/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.self_attn.dense.bias]
Loading weights:  78%|███████▊  | 265/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.self_attn.dense.weight]
Loading weights:  78%|███████▊  | 265/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.self_attn.dense.weight]
Loading weights:  78%|███████▊  | 266/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.self_attn.k_proj.bias]
Loading weights:  78%|███████▊  | 266/341 [00:00&lt;00:00, 1329.85it/s, Materializing param=model.layers.18.self_attn.k_proj.bias]
Loading weights:  78%|███████▊  | 267/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.k_proj.bias]
Loading weights:  78%|███████▊  | 267/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.k_proj.weight]
Loading weights:  78%|███████▊  | 267/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.k_proj.weight]
Loading weights:  79%|███████▊  | 268/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.q_proj.bias]
Loading weights:  79%|███████▊  | 268/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.q_proj.bias]
Loading weights:  79%|███████▉  | 269/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.q_proj.weight]
Loading weights:  79%|███████▉  | 269/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.q_proj.weight]
Loading weights:  79%|███████▉  | 270/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.v_proj.bias]
Loading weights:  79%|███████▉  | 270/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.v_proj.bias]
Loading weights:  79%|███████▉  | 271/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.v_proj.weight]
Loading weights:  79%|███████▉  | 271/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.18.self_attn.v_proj.weight]
Loading weights:  80%|███████▉  | 272/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.input_layernorm.bias]
Loading weights:  80%|███████▉  | 272/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.input_layernorm.bias]
Loading weights:  80%|████████  | 273/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.input_layernorm.weight]
Loading weights:  80%|████████  | 273/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.input_layernorm.weight]
Loading weights:  80%|████████  | 274/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc1.bias]
Loading weights:  80%|████████  | 274/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc1.bias]
Loading weights:  81%|████████  | 275/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc1.weight]
Loading weights:  81%|████████  | 275/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc1.weight]
Loading weights:  81%|████████  | 276/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc2.bias]
Loading weights:  81%|████████  | 276/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc2.bias]
Loading weights:  81%|████████  | 277/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc2.weight]
Loading weights:  81%|████████  | 277/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.mlp.fc2.weight]
Loading weights:  82%|████████▏ | 278/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.dense.bias]
Loading weights:  82%|████████▏ | 278/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.dense.bias]
Loading weights:  82%|████████▏ | 279/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.dense.weight]
Loading weights:  82%|████████▏ | 279/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.dense.weight]
Loading weights:  82%|████████▏ | 280/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.k_proj.bias]
Loading weights:  82%|████████▏ | 280/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.k_proj.bias]
Loading weights:  82%|████████▏ | 281/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.k_proj.weight]
Loading weights:  82%|████████▏ | 281/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.k_proj.weight]
Loading weights:  83%|████████▎ | 282/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.q_proj.bias]
Loading weights:  83%|████████▎ | 282/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.q_proj.bias]
Loading weights:  83%|████████▎ | 283/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.q_proj.weight]
Loading weights:  83%|████████▎ | 283/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.q_proj.weight]
Loading weights:  83%|████████▎ | 284/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.v_proj.bias]
Loading weights:  83%|████████▎ | 284/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.v_proj.bias]
Loading weights:  84%|████████▎ | 285/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.v_proj.weight]
Loading weights:  84%|████████▎ | 285/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.19.self_attn.v_proj.weight]
Loading weights:  84%|████████▍ | 286/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.input_layernorm.bias]
Loading weights:  84%|████████▍ | 286/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.input_layernorm.bias]
Loading weights:  84%|████████▍ | 287/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.input_layernorm.weight]
Loading weights:  84%|████████▍ | 287/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.input_layernorm.weight]
Loading weights:  84%|████████▍ | 288/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc1.bias]
Loading weights:  84%|████████▍ | 288/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc1.bias]
Loading weights:  85%|████████▍ | 289/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc1.weight]
Loading weights:  85%|████████▍ | 289/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc1.weight]
Loading weights:  85%|████████▌ | 290/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc2.bias]
Loading weights:  85%|████████▌ | 290/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc2.bias]
Loading weights:  85%|████████▌ | 291/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc2.weight]
Loading weights:  85%|████████▌ | 291/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.mlp.fc2.weight]
Loading weights:  86%|████████▌ | 292/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.dense.bias]
Loading weights:  86%|████████▌ | 292/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.dense.bias]
Loading weights:  86%|████████▌ | 293/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.dense.weight]
Loading weights:  86%|████████▌ | 293/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.dense.weight]
Loading weights:  86%|████████▌ | 294/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.k_proj.bias]
Loading weights:  86%|████████▌ | 294/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.k_proj.bias]
Loading weights:  87%|████████▋ | 295/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.k_proj.weight]
Loading weights:  87%|████████▋ | 295/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.k_proj.weight]
Loading weights:  87%|████████▋ | 296/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.q_proj.bias]
Loading weights:  87%|████████▋ | 296/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.q_proj.bias]
Loading weights:  87%|████████▋ | 297/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.q_proj.weight]
Loading weights:  87%|████████▋ | 297/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.q_proj.weight]
Loading weights:  87%|████████▋ | 298/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.v_proj.bias]
Loading weights:  87%|████████▋ | 298/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.v_proj.bias]
Loading weights:  88%|████████▊ | 299/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.v_proj.weight]
Loading weights:  88%|████████▊ | 299/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.20.self_attn.v_proj.weight]
Loading weights:  88%|████████▊ | 300/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.input_layernorm.bias]
Loading weights:  88%|████████▊ | 300/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.input_layernorm.bias]
Loading weights:  88%|████████▊ | 301/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.input_layernorm.weight]
Loading weights:  88%|████████▊ | 301/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.input_layernorm.weight]
Loading weights:  89%|████████▊ | 302/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc1.bias]
Loading weights:  89%|████████▊ | 302/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc1.bias]
Loading weights:  89%|████████▉ | 303/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc1.weight]
Loading weights:  89%|████████▉ | 303/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc1.weight]
Loading weights:  89%|████████▉ | 304/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc2.bias]
Loading weights:  89%|████████▉ | 304/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc2.bias]
Loading weights:  89%|████████▉ | 305/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc2.weight]
Loading weights:  89%|████████▉ | 305/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.mlp.fc2.weight]
Loading weights:  90%|████████▉ | 306/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.dense.bias]
Loading weights:  90%|████████▉ | 306/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.dense.bias]
Loading weights:  90%|█████████ | 307/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.dense.weight]
Loading weights:  90%|█████████ | 307/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.dense.weight]
Loading weights:  90%|█████████ | 308/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.k_proj.bias]
Loading weights:  90%|█████████ | 308/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.k_proj.bias]
Loading weights:  91%|█████████ | 309/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.k_proj.weight]
Loading weights:  91%|█████████ | 309/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.k_proj.weight]
Loading weights:  91%|█████████ | 310/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.q_proj.bias]
Loading weights:  91%|█████████ | 310/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.q_proj.bias]
Loading weights:  91%|█████████ | 311/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.q_proj.weight]
Loading weights:  91%|█████████ | 311/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.q_proj.weight]
Loading weights:  91%|█████████▏| 312/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.v_proj.bias]
Loading weights:  91%|█████████▏| 312/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.v_proj.bias]
Loading weights:  92%|█████████▏| 313/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.v_proj.weight]
Loading weights:  92%|█████████▏| 313/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.21.self_attn.v_proj.weight]
Loading weights:  92%|█████████▏| 314/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.input_layernorm.bias]
Loading weights:  92%|█████████▏| 314/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.input_layernorm.bias]
Loading weights:  92%|█████████▏| 315/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.input_layernorm.weight]
Loading weights:  92%|█████████▏| 315/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.input_layernorm.weight]
Loading weights:  93%|█████████▎| 316/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc1.bias]
Loading weights:  93%|█████████▎| 316/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc1.bias]
Loading weights:  93%|█████████▎| 317/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc1.weight]
Loading weights:  93%|█████████▎| 317/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc1.weight]
Loading weights:  93%|█████████▎| 318/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc2.bias]
Loading weights:  93%|█████████▎| 318/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc2.bias]
Loading weights:  94%|█████████▎| 319/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc2.weight]
Loading weights:  94%|█████████▎| 319/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.mlp.fc2.weight]
Loading weights:  94%|█████████▍| 320/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.dense.bias]
Loading weights:  94%|█████████▍| 320/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.dense.bias]
Loading weights:  94%|█████████▍| 321/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.dense.weight]
Loading weights:  94%|█████████▍| 321/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.dense.weight]
Loading weights:  94%|█████████▍| 322/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.k_proj.bias]
Loading weights:  94%|█████████▍| 322/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.k_proj.bias]
Loading weights:  95%|█████████▍| 323/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.k_proj.weight]
Loading weights:  95%|█████████▍| 323/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.k_proj.weight]
Loading weights:  95%|█████████▌| 324/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.q_proj.bias]
Loading weights:  95%|█████████▌| 324/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.q_proj.bias]
Loading weights:  95%|█████████▌| 325/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.q_proj.weight]
Loading weights:  95%|█████████▌| 325/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.q_proj.weight]
Loading weights:  96%|█████████▌| 326/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.v_proj.bias]
Loading weights:  96%|█████████▌| 326/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.v_proj.bias]
Loading weights:  96%|█████████▌| 327/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.v_proj.weight]
Loading weights:  96%|█████████▌| 327/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.22.self_attn.v_proj.weight]
Loading weights:  96%|█████████▌| 328/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.input_layernorm.bias]
Loading weights:  96%|█████████▌| 328/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.input_layernorm.bias]
Loading weights:  96%|█████████▋| 329/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.input_layernorm.weight]
Loading weights:  96%|█████████▋| 329/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.input_layernorm.weight]
Loading weights:  97%|█████████▋| 330/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc1.bias]
Loading weights:  97%|█████████▋| 330/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc1.bias]
Loading weights:  97%|█████████▋| 331/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc1.weight]
Loading weights:  97%|█████████▋| 331/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc1.weight]
Loading weights:  97%|█████████▋| 332/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc2.bias]
Loading weights:  97%|█████████▋| 332/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc2.bias]
Loading weights:  98%|█████████▊| 333/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc2.weight]
Loading weights:  98%|█████████▊| 333/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.mlp.fc2.weight]
Loading weights:  98%|█████████▊| 334/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.dense.bias]
Loading weights:  98%|█████████▊| 334/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.dense.bias]
Loading weights:  98%|█████████▊| 335/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.dense.weight]
Loading weights:  98%|█████████▊| 335/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.dense.weight]
Loading weights:  99%|█████████▊| 336/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.k_proj.bias]
Loading weights:  99%|█████████▊| 336/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.k_proj.bias]
Loading weights:  99%|█████████▉| 337/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.k_proj.weight]
Loading weights:  99%|█████████▉| 337/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.k_proj.weight]
Loading weights:  99%|█████████▉| 338/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.q_proj.bias]
Loading weights:  99%|█████████▉| 338/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.q_proj.bias]
Loading weights:  99%|█████████▉| 339/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.q_proj.weight]
Loading weights:  99%|█████████▉| 339/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.q_proj.weight]
Loading weights: 100%|█████████▉| 340/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.v_proj.bias]
Loading weights: 100%|█████████▉| 340/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.v_proj.bias]
Loading weights: 100%|██████████| 341/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.v_proj.weight]
Loading weights: 100%|██████████| 341/341 [00:00&lt;00:00, 714.91it/s, Materializing param=model.layers.23.self_attn.v_proj.weight]
Loading weights: 100%|██████████| 341/341 [00:00&lt;00:00, 848.20it/s, Materializing param=model.layers.23.self_attn.v_proj.weight]
-- done.
-- tokenize the prompt...
-- done.
-- compute the answer...
-- done in 3.0059874660000787
output shape: T7s1x123[7,50285:A10138.878048780489]
-- decode the answer...
-- done.
def print_prime(n):
   &quot;&quot;&quot;
   Print all primes between 1 and n
   &quot;&quot;&quot;
   primes = []
   for num in range(2, n+1):
       is_prime = True
       for i in range(2, int(math.sqrt(num))+1):
           if num % i == 0:
               is_prime = False
               break
       if is_prime:
           primes.append(num)
   print(primes)

print_prime(20)
``
</pre></div>
</div>
</section>
<section id="eos-token-id">
<h2>eos_token_id?<a class="headerlink" href="#eos-token-id" title="Link to this heading">¶</a></h2>
<p>This token means the end of the answer.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eos_token_id=&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span></a></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>eos_token_id= 50256
</pre></div>
</div>
</section>
<section id="custom-method-generate">
<h2>Custom method generate<a class="headerlink" href="#custom-method-generate" title="Link to this heading">¶</a></h2>
<p>Let’s implement a simple function replicating when method
<code class="docutils literal notranslate"><span class="pre">generate</span></code> does.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">simple_generate_with_cache</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">:</span> <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class"><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></a></a><span class="p">,</span> <span class="n">eos_token_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">):</span>
    <span class="c1"># First call: prefill</span>
    <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Next calls: decode</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_new_tokens</span><span class="p">))):</span>
        <span class="n">next_token_logits</span> <span class="o">=</span> <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span></a></a><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">past_key_values</span> <span class="o">=</span> <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span><span class="o">.</span><span class="n">past_key_values</span></a></a>

        <span class="c1"># The most probable next token is chosen.</span>
        <span class="n">next_token_id</span> <span class="o">=</span> <a href="https://docs.pytorch.org/docs/stable/generated/torch.argmax.html#torch.argmax" title="torch.argmax" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-function"><a href="https://docs.pytorch.org/docs/stable/generated/torch.argmax.html#torch.argmax" title="torch.argmax" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">argmax</span></a></a><span class="p">(</span><span class="n">next_token_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># But we could select it using a multinomial law</span>
        <span class="c1"># &lt;&lt;&lt; probs = torch.softmax(next_token_logits / temperature, dim=-1)</span>
        <span class="c1"># &lt;&lt;&lt; top_probs, top_indices = torch.topk(probs, top_k)</span>
        <span class="c1"># &lt;&lt;&lt; next_token_id = top_indices[torch.multinomial(top_probs, 1)]</span>

        <span class="k">if</span> <span class="n">next_token_id</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">==</span> <span class="n">eos_token_id</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">input_ids</span> <span class="o">=</span> <a href="https://docs.pytorch.org/docs/stable/generated/torch.cat.html#torch.cat" title="torch.cat" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-function"><a href="https://docs.pytorch.org/docs/stable/generated/torch.cat.html#torch.cat" title="torch.cat" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">cat</span></a></a><span class="p">([</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">next_token_id</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Feed only the new token, but with the cache</span>
        <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">next_token_id</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">past_key_values</span><span class="o">=</span><span class="n">past_key_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">input_ids</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- compute the answer with custom generate...&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span>
<a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a> <span class="o">=</span> <span class="n">simple_generate_with_cache</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputs</span><span class="o">.</span><span class="n">input_ids</span></a></a><span class="p">,</span> <span class="n">eos_token_id</span><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span></a></a><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- done in </span><span class="si">{</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output shape:&quot;</span><span class="p">,</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><span class="n">string_type</span></a></a><span class="p">(</span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a><span class="p">,</span> <span class="n">with_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_min_max</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- decode the answer...&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">text</span></a></a> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">batch_decode</span><span class="p">(</span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">text</span></a></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>-- compute the answer with custom generate...

  0%|          | 0/100 [00:00&lt;?, ?it/s]
  3%|▎         | 3/100 [00:00&lt;00:03, 27.30it/s]
  6%|▌         | 6/100 [00:00&lt;00:03, 27.95it/s]
  9%|▉         | 9/100 [00:00&lt;00:03, 27.61it/s]
 12%|█▏        | 12/100 [00:00&lt;00:03, 27.57it/s]
 16%|█▌        | 16/100 [00:00&lt;00:02, 29.08it/s]
 20%|██        | 20/100 [00:00&lt;00:02, 29.20it/s]
 24%|██▍       | 24/100 [00:00&lt;00:02, 28.68it/s]
 27%|██▋       | 27/100 [00:00&lt;00:02, 26.42it/s]
 30%|███       | 30/100 [00:01&lt;00:02, 25.04it/s]
 33%|███▎      | 33/100 [00:01&lt;00:03, 21.91it/s]
 36%|███▌      | 36/100 [00:01&lt;00:02, 23.05it/s]
 39%|███▉      | 39/100 [00:01&lt;00:03, 17.78it/s]
 41%|████      | 41/100 [00:01&lt;00:03, 17.25it/s]
 44%|████▍     | 44/100 [00:01&lt;00:02, 18.84it/s]
 47%|████▋     | 47/100 [00:02&lt;00:02, 21.14it/s]
 50%|█████     | 50/100 [00:02&lt;00:02, 22.44it/s]
 53%|█████▎    | 53/100 [00:02&lt;00:01, 24.00it/s]
 56%|█████▌    | 56/100 [00:02&lt;00:01, 24.84it/s]
 59%|█████▉    | 59/100 [00:02&lt;00:01, 25.65it/s]
 62%|██████▏   | 62/100 [00:02&lt;00:01, 25.01it/s]
 65%|██████▌   | 65/100 [00:02&lt;00:01, 26.01it/s]
 68%|██████▊   | 68/100 [00:02&lt;00:01, 26.66it/s]
 71%|███████   | 71/100 [00:02&lt;00:01, 27.17it/s]
 74%|███████▍  | 74/100 [00:03&lt;00:00, 27.43it/s]
 77%|███████▋  | 77/100 [00:03&lt;00:00, 26.39it/s]
 80%|████████  | 80/100 [00:03&lt;00:00, 26.38it/s]
 83%|████████▎ | 83/100 [00:03&lt;00:00, 26.41it/s]
 86%|████████▌ | 86/100 [00:03&lt;00:00, 26.72it/s]
 89%|████████▉ | 89/100 [00:03&lt;00:00, 26.17it/s]
 92%|█████████▏| 92/100 [00:03&lt;00:00, 21.20it/s]
 95%|█████████▌| 95/100 [00:04&lt;00:00, 18.35it/s]
 98%|█████████▊| 98/100 [00:04&lt;00:00, 19.93it/s]
100%|██████████| 100/100 [00:04&lt;00:00, 23.71it/s]
-- done in 4.376283818997763
-- done.
output shape: T7s1x123[7,50285:A10138.878048780489]
-- decode the answer...
-- done.
def print_prime(n):
   &quot;&quot;&quot;
   Print all primes between 1 and n
   &quot;&quot;&quot;
   primes = []
   for num in range(2, n+1):
       is_prime = True
       for i in range(2, int(math.sqrt(num))+1):
           if num % i == 0:
               is_prime = False
               break
       if is_prime:
           primes.append(num)
   print(primes)

print_prime(20)
``
</pre></div>
</div>
</section>
<section id="method-generate-for-onnx-models">
<h2>Method generate for onnx models<a class="headerlink" href="#method-generate-for-onnx-models" title="Link to this heading">¶</a></h2>
<p>We first need to export the model into ONNX.</p>
<section id="onnx-conversion">
<h3>ONNX Conversion<a class="headerlink" href="#onnx-conversion" title="Link to this heading">¶</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;position_ids&quot;</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a><span class="p">:</span>
    <span class="k">del</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a><span class="p">[</span><span class="s2">&quot;position_ids&quot;</span><span class="p">]</span>
    <span class="k">del</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_shapes</span></a></a><span class="p">[</span><span class="s2">&quot;position_ids&quot;</span><span class="p">]</span>
<a href="https://docs.pytorch.org/docs/stable/tensor_attributes.html#torch.dtype" title="torch.dtype" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensor_attributes.html#torch.dtype" title="torch.dtype" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dtype</span></a></a> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.get_weight_type" title="onnx_diagnostic.helpers.torch_helper.get_weight_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.get_weight_type" title="onnx_diagnostic.helpers.torch_helper.get_weight_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><span class="n">get_weight_type</span></a></a><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- model dtype:&quot;</span><span class="p">,</span> <a href="https://docs.pytorch.org/docs/stable/tensor_attributes.html#torch.dtype" title="torch.dtype" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensor_attributes.html#torch.dtype" title="torch.dtype" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dtype</span></a></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a><span class="p">[</span><span class="s2">&quot;past_key_values&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.to_any" title="onnx_diagnostic.helpers.torch_helper.to_any" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.to_any" title="onnx_diagnostic.helpers.torch_helper.to_any" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><span class="n">to_any</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a><span class="p">[</span><span class="s2">&quot;past_key_values&quot;</span><span class="p">],</span> <a href="https://docs.pytorch.org/docs/stable/tensor_attributes.html#torch.dtype" title="torch.dtype" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensor_attributes.html#torch.dtype" title="torch.dtype" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dtype</span></a></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">exporter</span></a></a> <span class="o">=</span> <span class="s2">&quot;onnx-dynamo&quot;</span> <span class="k">if</span> <span class="s2">&quot;dynamo&quot;</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sys</span><span class="o">.</span><span class="n">argv</span></a></a> <span class="k">else</span> <span class="s2">&quot;custom&quot;</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_name</span></a></a> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;model_</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_id</span></a></a><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">exporter</span></a></a><span class="si">}</span><span class="s2">.onnx&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.exists" title="os.path.exists" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/os.path.html#os.path.exists" title="os.path.exists" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_name</span></a></a><span class="p">):</span>
    <span class="c1"># This step is slow so let&#39;s skip it if it was already done.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- conversion to ONNX.&quot;</span><span class="p">)</span>
    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span>
    <span class="k">with</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_export_patches/index.html#onnx_diagnostic.torch_export_patches.torch_export_patches" title="onnx_diagnostic.torch_export_patches.torch_export_patches" class="sphx-glr-backref-module-onnx_diagnostic-torch_export_patches sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/torch_export_patches/index.html#onnx_diagnostic.torch_export_patches.torch_export_patches" title="onnx_diagnostic.torch_export_patches.torch_export_patches" class="sphx-glr-backref-module-onnx_diagnostic-torch_export_patches sphx-glr-backref-type-py-function"><span class="n">torch_export_patches</span></a></a><span class="p">(</span><span class="n">patch_transformers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/export/api.html#onnx_diagnostic.export.api.to_onnx" title="onnx_diagnostic.export.api.to_onnx" class="sphx-glr-backref-module-onnx_diagnostic-export-api sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/export/api.html#onnx_diagnostic.export.api.to_onnx" title="onnx_diagnostic.export.api.to_onnx" class="sphx-glr-backref-module-onnx_diagnostic-export-api sphx-glr-backref-type-py-function"><span class="n">to_onnx</span></a></a><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="p">(),</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kwargs</span></a></a><span class="o">=</span><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.to_any" title="onnx_diagnostic.helpers.torch_helper.to_any" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/torch_helper.html#onnx_diagnostic.helpers.torch_helper.to_any" title="onnx_diagnostic.helpers.torch_helper.to_any" class="sphx-glr-backref-module-onnx_diagnostic-helpers-torch_helper sphx-glr-backref-type-py-function"><span class="n">to_any</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_inputs</span></a></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a></a><span class="p">),</span>
            <span class="n">dynamic_shapes</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">export_shapes</span></a></a><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_name</span></a></a><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">exporter</span></a></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">exporter</span></a></a><span class="p">,</span>
        <span class="p">)</span>
    <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- done in </span><span class="si">{</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>-- model dtype: torch.float16
-- conversion to ONNX.
[to_onnx] build the graph module from &lt;class &#39;transformers.models.phi.modeling_phi.PhiForCausalLM&#39;&gt;, type(args)=&lt;class &#39;tuple&#39;&gt;
[to_onnx] dynamic_shapes={&#39;input_ids&#39;: {0: &#39;batch&#39;, 1: &#39;seq_length&#39;}, &#39;attention_mask&#39;: {0: &#39;batch&#39;, 1: &#39;cache+seq&#39;}, &#39;past_key_values&#39;: [{0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}]}
[_make_builder_interpreter] export_options=ExportOptions(aten_as_function=(&#39;aten.index_copy.default&#39;, &#39;aten.index_put.default&#39;, &#39;aten.setitem&#39;, &lt;built-in function setitem&gt;))
[_make_builder_interpreter] input args=()
[_make_builder_interpreter] input kwargs=dict(input_ids:T7r2,attention_mask:T7r2,past_key_values:DynamicCache(key_cache=#24[T10r4,...], value_cache=#24[T10r4,...]))
[_make_builder_interpreter] dynamic_shapes={&#39;input_ids&#39;: {0: &#39;batch&#39;, 1: &#39;seq_length&#39;}, &#39;attention_mask&#39;: {0: &#39;batch&#39;, 1: &#39;cache+seq&#39;}, &#39;past_key_values&#39;: [{0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}]}
[_make_builder_interpreter] same_signature=True, tracing_mode=symbolic
[ExportOptions.export] ExportOptions(aten_as_function=(&#39;aten.index_copy.default&#39;, &#39;aten.index_put.default&#39;, &#39;aten.setitem&#39;, &lt;built-in function setitem&gt;)) - torch._dynamo.export &#39;PhiForCausalLM&#39;
[ExportOptions.export] aten_as_function=(&#39;aten.index_copy.default&#39;, &#39;aten.index_put.default&#39;, &#39;aten.setitem&#39;, &lt;built-in function setitem&gt;)
[ExportOptions.export] torch_export strict=False, verbose=1
[ExportOptions.export] dynamic_shapes={&#39;input_ids&#39;: {0: &#39;batch&#39;, 1: &#39;seq_length&#39;}, &#39;attention_mask&#39;: {0: &#39;batch&#39;, 1: &#39;cache+seq&#39;}, &#39;past_key_values&#39;: [{0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}, {0: &#39;batch&#39;, 2: &#39;cache_length&#39;}]}
[ExportOptions.export] args=()
[ExportOptions.export] kwargs=dict(input_ids:T7r2,attention_mask:T7r2,past_key_values:DynamicCache(key_cache=#24[T10r4,...], value_cache=#24[T10r4,...]))
[ExportOptions.export] export start with strict=False...
[ExportOptions.export] export with backed_size_oblivious=auto
[torch_export] backed_size_oblivious=&#39;auto&#39;
[torch_export] inferred backed_size_oblivious=None
[torch_export] export starts with backed_size_oblivious=None
[ExportOptions.export] export done in 11.388620563997392
[ExportOptions.export] post_process_exported_program with decomposition_table=None
[ExportOptions.export] remove inplace nodes
[ExportOptions.export] slices: 6 slices nodes were removed
[CustomTracer.remove_inplace] starts with 1896 nodes (n_inplace_submobules=0)
[CustomTracer.remove_inplace] S1: 80 inplace nodes
[CustomTracer.remove_inplace] S2: 74 inplace nodes and 100 iterations
[CustomTracer.remove_inplace] end with 95 iterations and 1710 nodes (n_inplace=74)
[ExportOptions.export] inplaces: 80 inplaced nodes were removed
[ExportOptions.export] done remove inplace in 0.04992351799955941, modified=80
[ExportOptions.export] done with no decomposition in 0.05059635299767251
[to_onnx] graph module done in 11.58710700300071 s
[to_onnx] start creating the onnx nodes
[to_onnx] interpreter.function_options=FunctionOptions(export_as_function=True, name=&#39;*&#39;, domain=&#39;*&#39;, external_threshold=256, move_initializer_to_constant=True, return_initializer=True, merge_allowed=True, rename_allowed=True)

  0%|          | 0/1710 [00:00&lt;?, ?it/s]
 26%|██▌       | 448/1710 [00:00&lt;00:00, 4459.74it/s]
 52%|█████▏    | 894/1710 [00:00&lt;00:00, 1818.02it/s]
 67%|██████▋   | 1154/1710 [00:00&lt;00:00, 1546.51it/s]
 79%|███████▉  | 1349/1710 [00:00&lt;00:00, 1388.97it/s]
 88%|████████▊ | 1510/1710 [00:01&lt;00:00, 1236.79it/s]
 96%|█████████▋| 1646/1710 [00:01&lt;00:00, 1200.51it/s]
100%|██████████| 1710/1710 [00:01&lt;00:00, 1390.41it/s]
[to_onnx] 2312 onnx nodes done in 1.4021027230010077 s
[to_onnx] start conversion to onnx (before optimization) mask_outputs=[True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True, True]
[GraphBuilder-JUE.inline_functions] begin inlining graph
[GraphBuilder-JUE.inline_functions] skip_functions=set()
[GraphBuilder-JUE._inline_functions_iterations] inline function &#39;submod_3&#39; domain &#39;local_functions&#39; [n_replacements=1]
[GraphBuilder-JUE._inline_functions_iterations] done with 9 new nodes for &#39;submod_3&#39;, &#39;local_functions&#39;
[GraphBuilder-JUE.inline_functions] done inlining graph 129171974220800 in 0.030534073001035722
[GraphBuilder-JUE._add_shape_information] dynamic shapes replacements={&#39;seq_length&#39;: &#39;seq_length&#39;, &#39;batch&#39;: &#39;batch&#39;, &#39;cache_length&#39;: &#39;cache_length&#39;, &#39;s1&#39;: &#39;batch&#39;, &#39;s60&#39;: &#39;batch&#39;, &#39;s43&#39;: &#39;batch&#39;, &#39;s47&#39;: &#39;batch&#39;, &#39;s39&#39;: &#39;batch&#39;, &#39;s69&#39;: &#39;batch&#39;, &#39;s91&#39;: &#39;batch&#39;, &#39;batch^s3^batch^s41&#39;: &#39;batch&#39;, &#39;s93&#39;: &#39;batch&#39;, &#39;batch^s98^batch^s79&#39;: &#39;batch&#39;, &#39;batch^s92^batch^s83&#39;: &#39;batch&#39;, &#39;batch^s84^batch^s91&#39;: &#39;batch&#39;, &#39;s61&#39;: &#39;batch&#39;, &#39;s30&#39;: &#39;batch&#39;, &#39;batch^s45^batch^s47&#39;: &#39;batch&#39;, &#39;batch^s30^batch^s89&#39;: &#39;batch&#39;, &#39;s64&#39;: &#39;batch&#39;, &#39;batch^s49^batch^s26&#39;: &#39;batch&#39;, &#39;s56&#39;: &#39;batch&#39;, &#39;s106&#39;: &#39;batch&#39;, &#39;batch^s35^batch^s60&#39;: &#39;batch&#39;, &#39;batch^s64^batch^s86&#39;: &#39;batch&#39;, &#39;s90&#39;: &#39;batch&#39;, &#39;s79&#39;: &#39;batch&#39;, &#39;s77&#39;: &#39;batch&#39;, &#39;batch^s97^batch^s10&#39;: &#39;batch&#39;, &#39;s13&#39;: &#39;batch&#39;, &#39;s87&#39;: &#39;batch&#39;, &#39;s62&#39;: &#39;batch&#39;, &#39;batch^s39^batch^s71&#39;: &#39;batch&#39;, &#39;s3&#39;: &#39;batch&#39;, &#39;batch^s82^batch^s62&#39;: &#39;batch&#39;, &#39;s41&#39;: &#39;batch&#39;, &#39;s59&#39;: &#39;batch&#39;, &#39;batch^s52^batch^s93&#39;: &#39;batch&#39;, &#39;s35&#39;: &#39;batch&#39;, &#39;s72&#39;: &#39;batch&#39;, &#39;s23&#39;: &#39;batch&#39;, &#39;s52&#39;: &#39;batch&#39;, &#39;s100&#39;: &#39;batch&#39;, &#39;s36&#39;: &#39;batch&#39;, &#39;s49&#39;: &#39;batch&#39;, &#39;s48&#39;: &#39;batch&#39;, &#39;batch^s34^batch^s77&#39;: &#39;batch&#39;, &#39;batch^s104^batch^s106&#39;: &#39;batch&#39;, &#39;s104&#39;: &#39;batch&#39;, &#39;s57&#39;: &#39;batch&#39;, &#39;s8&#39;: &#39;batch&#39;, &#39;s86&#39;: &#39;batch&#39;, &#39;s102&#39;: &#39;batch&#39;, &#39;s89&#39;: &#39;batch&#39;, &#39;batch^s29^batch^s8&#39;: &#39;batch&#39;, &#39;s29&#39;: &#39;batch&#39;, &#39;s83&#39;: &#39;batch&#39;, &#39;s98&#39;: &#39;batch&#39;, &#39;batch^s87^batch^s23&#39;: &#39;batch&#39;, &#39;s97&#39;: &#39;batch&#39;, &#39;s67&#39;: &#39;batch&#39;, &#39;batch^s1^batch^s75&#39;: &#39;batch&#39;, &#39;s84&#39;: &#39;batch&#39;, &#39;batch^s69^batch^s56&#39;: &#39;batch&#39;, &#39;s45&#39;: &#39;batch&#39;, &#39;batch^s48^batch^s59&#39;: &#39;batch&#39;, &#39;s26&#39;: &#39;batch&#39;, &#39;batch^s67^batch^s61&#39;: &#39;batch&#39;, &#39;s82&#39;: &#39;batch&#39;, &#39;batch^s90^batch^s57&#39;: &#39;batch&#39;, &#39;s71&#39;: &#39;batch&#39;, &#39;batch^s36^batch^s13&#39;: &#39;batch&#39;, &#39;s10&#39;: &#39;batch&#39;, &#39;s34&#39;: &#39;batch&#39;, &#39;s92&#39;: &#39;batch&#39;, &#39;s75&#39;: &#39;batch&#39;, &#39;batch^s100^batch^s102&#39;: &#39;batch&#39;, &#39;s70&#39;: &#39;seq_length&#39;, &#39;s42&#39;: &#39;cache_length&#39;, &#39;s65&#39;: &#39;cache_length&#39;, &#39;s101&#39;: &#39;cache_length&#39;, &#39;s76&#39;: &#39;cache_length&#39;, &#39;s31&#39;: &#39;cache_length&#39;, &#39;s28&#39;: &#39;cache_length&#39;, &#39;s63&#39;: &#39;cache_length&#39;, &#39;s85&#39;: &#39;cache_length&#39;, &#39;s105&#39;: &#39;cache_length&#39;, &#39;s88&#39;: &#39;cache_length&#39;, &#39;s99&#39;: &#39;cache_length&#39;, &#39;s96&#39;: &#39;cache_length&#39;, &#39;s95&#39;: &#39;cache_length&#39;, &#39;s14&#39;: &#39;cache_length&#39;, &#39;s18&#39;: &#39;cache_length&#39;, &#39;s46&#39;: &#39;cache_length&#39;, &#39;s11&#39;: &#39;cache_length&#39;, &#39;s66&#39;: &#39;cache_length&#39;, &#39;s50&#39;: &#39;cache_length&#39;, &#39;s55&#39;: &#39;cache_length&#39;, &#39;s81&#39;: &#39;cache_length&#39;, &#39;s27&#39;: &#39;cache_length&#39;, &#39;s38&#39;: &#39;cache_length&#39;, &#39;s51&#39;: &#39;cache_length&#39;, &#39;s40&#39;: &#39;cache_length&#39;, &#39;s21&#39;: &#39;cache_length&#39;, &#39;s54&#39;: &#39;cache_length&#39;, &#39;s37&#39;: &#39;cache_length&#39;, &#39;s73&#39;: &#39;cache_length&#39;, &#39;s2&#39;: &#39;cache_length&#39;, &#39;s58&#39;: &#39;cache_length&#39;, &#39;s25&#39;: &#39;cache_length&#39;, &#39;s107&#39;: &#39;cache_length&#39;, &#39;s68&#39;: &#39;cache_length&#39;, &#39;s44&#39;: &#39;cache_length&#39;, &#39;s15&#39;: &#39;cache_length&#39;, &#39;s32&#39;: &#39;cache_length&#39;, &#39;s33&#39;: &#39;cache_length&#39;, &#39;s22&#39;: &#39;cache_length&#39;, &#39;s94&#39;: &#39;cache_length&#39;, &#39;s103&#39;: &#39;cache_length&#39;, &#39;s9&#39;: &#39;cache_length&#39;, &#39;s4&#39;: &#39;cache_length&#39;, &#39;s78&#39;: &#39;cache_length&#39;, &#39;s74&#39;: &#39;cache_length&#39;, &#39;s7&#39;: &#39;cache_length&#39;, &#39;s80&#39;: &#39;cache_length&#39;, &#39;s24&#39;: &#39;cache_length&#39;}
[GraphBuilder-JUE.optimize] start with 2320 nodes
[GraphBuilder-JUE.optimize] #patterns=110
[GraphBuilder-JUE.optimize] start with subgraphs
[GraphBuilder-JUE.optimize] done with subgraphs
[GraphBuilderPatternOptimization-JUE.optimize] start with 1991 nodes, 459 initializers, 110 patterns, priorities=[0, 1, 2, 3], max_iter=7964
[GraphBuilderPatternOptimization-JUE.optimize] same children={&#39;SameChildrenPattern&#39;, &#39;SameChildrenFromInputPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] iteration 0: 1991 nodes, priority=0
[GraphBuilderPatternOptimization-JUE.optimize] applies 226 matches, 75*CastPattern, 2*IdentityPattern, 1*ShapeBasedStaticExpandPattern, 96*ShapeBasedEditDistanceReshapePattern, 18*ShapeBasedIdentityPattern, 6*SameChildrenPattern, 1*SqueezeAddPattern, 1*SqueezeUnsqueezePattern, 2*UnsqueezeUnsqueezePattern, 24*FunctionAttentionPattern - time=0.161 | max_time=IdentityPattern:0.067
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=201, n_removed=255, n_applied=275 applied patterns, 1592 nodes left with 23 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 1
[GraphBuilderPatternOptimization-JUE.optimize] iteration 1: 1592 nodes, priority=1
[GraphBuilderPatternOptimization-JUE.optimize] applies 202 matches, 2*ConcatTwiceUnaryPattern, 1*ConstantToInitializerPattern, 49*DropoutPattern, 1*IdentityPattern, 25*LayerNormalizationPattern, 96*SlicesSplitPattern, 1*SqueezeUnsqueezePattern, 3*UnsqueezeUnsqueezePattern, 24*GeluOrtPattern - time=0.243 | max_time=IdentityPattern:0.034
[GraphBuilderPatternOptimization-JUE.optimize] iteration 2: 1123 nodes, priority=1
[GraphBuilderPatternOptimization-JUE.optimize] applies 100 matches, 2*ConcatTwiceUnaryPattern, 25*LayerNormalizationScalePattern, 1*UnsqueezeUnsqueezePattern, 48*FunctionHalfRotaryEmbeddingPattern, 24*FastGeluPattern - time=0.184 | max_time=IdentityPattern:0.042
[GraphBuilderPatternOptimization-JUE.optimize] iteration 3: 908 nodes, priority=1
[GraphBuilderPatternOptimization-JUE.optimize] applies 25 matches, 1*FunctionCausalMaskPattern, 24*SkipLayerNormalizationPattern - time=0.109 | max_time=IdentityPattern:0.012
[GraphBuilderPatternOptimization-JUE.optimize] iteration 4: 883 nodes, priority=1
[GraphBuilderPatternOptimization-JUE.optimize] applies 1 matches, [0]=MatchResult: FunctionCausalMaskMulAddPattern replaces [&#39;Squeeze&#39;, &#39;Squeeze&#39;, &#39;Range&#39;, &#39;Range&#39;, &#39;Unsqueeze&#39;, &#39;Unsqueeze&#39;, &#39;Mul&#39;, &#39;Add&#39;] - time=0.103 | max_time=IdentityPattern:0.011
[GraphBuilderPatternOptimization-JUE.optimize] iteration 5: 877 nodes, priority=1
[GraphBuilderPatternOptimization-JUE.optimize] applies 1 matches, [0]=MatchResult: FunctionCosSinCachePattern replaces [&#39;Squeeze&#39;, &#39;Squeeze&#39;, &#39;Range&#39;, &#39;Unsqueeze&#39;, &#39;Cast&#39;, &#39;Reshape&#39;, &#39;Mul&#39;, &#39;Cos&#39;, &#39;Cast&#39;, &#39;Sin&#39;, &#39;Cast&#39;] - time=0.097 | max_time=IdentityPattern:0.008
[GraphBuilderPatternOptimization-JUE.optimize] iteration 6: 867 nodes, priority=1
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 2
[GraphBuilderPatternOptimization-JUE.optimize] iteration 7: 867 nodes, priority=2
[GraphBuilderPatternOptimization-JUE.optimize] applies 1 matches, [0]=MatchResult: ContribRotaryEmbeddingPattern replaces [&#39;Concat&#39;, &#39;Concat&#39;, &#39;Split&#39;, &#39;HalfRotaryEmbedding&#39;, &#39;Concat&#39;] - time=0.111 | max_time=IdentityPattern:0.016
[GraphBuilderPatternOptimization-JUE.optimize] iteration 8: 872 nodes, priority=2
[GraphBuilderPatternOptimization-JUE.optimize] applies 3 matches, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern - time=0.106 | max_time=ShapeBasedEditDistanceReshapePattern:0.014
[GraphBuilderPatternOptimization-JUE.optimize] iteration 9: 876 nodes, priority=2
[GraphBuilderPatternOptimization-JUE.optimize] applies 6 matches, 2*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.091 | max_time=ShapeBasedEditDistanceReshapePattern:0.008
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=19, n_removed=26, n_applied=620 applied patterns, 874 nodes left with 3 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 10: 874 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 5 matches, 1*ShapeBasedEditDistanceReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.119 | max_time=IdentityPattern:0.014
[GraphBuilderPatternOptimization-JUE.optimize] iteration 11: 880 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 9 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ReshapeReshapePattern, 3*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.105 | max_time=IdentityPattern:0.009
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=641 applied patterns, 873 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 12: 873 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 8 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.102 | max_time=IdentityPattern:0.011
[GraphBuilderPatternOptimization-JUE.optimize] iteration 13: 876 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 14 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 3*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.163 | max_time=IdentityPattern:0.030
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=670 applied patterns, 864 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 14: 864 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.119 | max_time=IdentityPattern:0.017
[GraphBuilderPatternOptimization-JUE.optimize] iteration 15: 863 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.124 | max_time=IdentityPattern:0.015
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=704 applied patterns, 850 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 16: 850 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.118 | max_time=ShapeBasedEditDistanceReshapePattern:0.009
[GraphBuilderPatternOptimization-JUE.optimize] iteration 17: 849 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.117 | max_time=IdentityPattern:0.009
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=738 applied patterns, 836 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 18: 836 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.157 | max_time=ShapeBasedEditDistanceReshapePattern:0.021
[GraphBuilderPatternOptimization-JUE.optimize] iteration 19: 835 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.097 | max_time=ShapeBasedEditDistanceReshapePattern:0.007
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=772 applied patterns, 822 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 20: 822 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.112 | max_time=IdentityPattern:0.015
[GraphBuilderPatternOptimization-JUE.optimize] iteration 21: 821 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.109 | max_time=IdentityPattern:0.009
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=806 applied patterns, 808 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 22: 808 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.130 | max_time=IdentityPattern:0.031
[GraphBuilderPatternOptimization-JUE.optimize] iteration 23: 807 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.136 | max_time=IdentityPattern:0.017
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=840 applied patterns, 794 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 24: 794 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.113 | max_time=IdentityPattern:0.013
[GraphBuilderPatternOptimization-JUE.optimize] iteration 25: 793 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.102 | max_time=IdentityPattern:0.017
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=874 applied patterns, 780 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 26: 780 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.141 | max_time=IdentityPattern:0.016
[GraphBuilderPatternOptimization-JUE.optimize] iteration 27: 779 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.104 | max_time=IdentityPattern:0.015
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=908 applied patterns, 766 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 28: 766 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.122 | max_time=IdentityPattern:0.036
[GraphBuilderPatternOptimization-JUE.optimize] iteration 29: 765 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.085 | max_time=ShapeBasedEditDistanceReshapePattern:0.006
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=942 applied patterns, 752 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 30: 752 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.095 | max_time=IdentityPattern:0.015
[GraphBuilderPatternOptimization-JUE.optimize] iteration 31: 751 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.095 | max_time=IdentityPattern:0.014
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=976 applied patterns, 738 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 32: 738 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.113 | max_time=IdentityPattern:0.023
[GraphBuilderPatternOptimization-JUE.optimize] iteration 33: 737 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.114 | max_time=ShapeBasedEditDistanceReshapePattern:0.008
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1010 applied patterns, 724 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 34: 724 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.139 | max_time=IdentityPattern:0.016
[GraphBuilderPatternOptimization-JUE.optimize] iteration 35: 723 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 14 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 3*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.125 | max_time=IdentityPattern:0.021
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1043 applied patterns, 711 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 36: 711 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.105 | max_time=IdentityPattern:0.009
[GraphBuilderPatternOptimization-JUE.optimize] iteration 37: 710 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.090 | max_time=IdentityPattern:0.011
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1077 applied patterns, 697 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 38: 697 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.091 | max_time=ShapeBasedEditDistanceReshapePattern:0.007
[GraphBuilderPatternOptimization-JUE.optimize] iteration 39: 696 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.117 | max_time=IdentityPattern:0.030
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1111 applied patterns, 683 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 40: 683 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.084 | max_time=IdentityPattern:0.007
[GraphBuilderPatternOptimization-JUE.optimize] iteration 41: 682 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.104 | max_time=IdentityPattern:0.009
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1145 applied patterns, 669 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 42: 669 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.105 | max_time=IdentityPattern:0.016
[GraphBuilderPatternOptimization-JUE.optimize] iteration 43: 668 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.095 | max_time=ShapeBasedEditDistanceReshapePattern:0.008
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1179 applied patterns, 655 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 44: 655 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.114 | max_time=ShapeBasedEditDistanceReshapePattern:0.007
[GraphBuilderPatternOptimization-JUE.optimize] iteration 45: 654 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.079 | max_time=SameChildrenPattern:0.005
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1213 applied patterns, 641 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 46: 641 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.097 | max_time=IdentityPattern:0.008
[GraphBuilderPatternOptimization-JUE.optimize] iteration 47: 640 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.102 | max_time=IdentityPattern:0.010
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1247 applied patterns, 627 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 48: 627 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.079 | max_time=SameChildrenPattern:0.005
[GraphBuilderPatternOptimization-JUE.optimize] iteration 49: 626 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.088 | max_time=IdentityPattern:0.008
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1281 applied patterns, 613 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 50: 613 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.084 | max_time=IdentityPattern:0.014
[GraphBuilderPatternOptimization-JUE.optimize] iteration 51: 612 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.094 | max_time=IdentityPattern:0.013
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1315 applied patterns, 599 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 52: 599 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.084 | max_time=CastCastBinaryPattern:0.005
[GraphBuilderPatternOptimization-JUE.optimize] iteration 53: 598 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 15 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern - time=0.096 | max_time=SameChildrenPattern:0.006
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=21, n_removed=29, n_applied=1349 applied patterns, 585 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 54: 585 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 12 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbeddingPattern, 1*ContribRotaryEmbedding3DPattern, 1*MultiHeadAttention3DPattern - time=0.105 | max_time=IdentityPattern:0.020
[GraphBuilderPatternOptimization-JUE.optimize] iteration 55: 582 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 14 matches, 1*ShapeBasedEditDistanceReshapePattern, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 4*SameChildrenPattern, 2*SqueezeUnsqueezePattern, 1*ContribRotaryEmbedding3DPattern - time=0.115 | max_time=IdentityPattern:0.025
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=11, n_removed=15, n_applied=1379 applied patterns, 567 nodes left with 4 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 56: 567 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 8 matches, 1*ShapeBasedEditDistanceReshapePattern, 5*ShapedBasedReshapePattern, 1*ReshapeReshapePattern, 1*MultiHeadAttention3DPattern - time=0.075 | max_time=IdentityPattern:0.011
[GraphBuilderPatternOptimization-JUE.optimize] iteration 57: 558 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 7 matches, 1*ShapedBasedReshapePattern, 5*ReshapeReshapePattern, 1*SameChildrenPattern - time=0.060 | max_time=SameChildrenPattern:0.005
[GraphBuilderPatternOptimization-JUE.optimize] reapply {&#39;SameChildrenPattern&#39;}
[GraphBuilderPatternOptimization-JUE.optimize] n_added=0, n_removed=0, n_applied=1394 applied patterns, 551 nodes left with 1 iterations
[GraphBuilderPatternOptimization-JUE.optimize] increase priority to 3
[GraphBuilderPatternOptimization-JUE.optimize] iteration 58: 551 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] applies 5 matches, 5*ShapedBasedReshapePattern - time=0.068 | max_time=SameChildrenPattern:0.006
[GraphBuilderPatternOptimization-JUE.optimize] iteration 59: 546 nodes, priority=3
[GraphBuilderPatternOptimization-JUE.optimize] stops current_priority_index=4, priorities=[0, 1, 2, 3]
[GraphBuilderPatternOptimization-JUE.optimize] done after 60 iterations with 546 nodes in 12.728
[OrderOptimization.optimize] ALGO-2
[OrderOptimization.random_order] -- starts with 471 nodes, 353 initializers
[OrderOptimization.shape_order] done after in 0.002608037000754848s with changed=4 scale=16
[GraphBuilder-JUE.optimize] done with 471 nodes in 15.077
[GraphBuilder-JUE.to_onnx] make_model 499 inits 341 params
[GraphBuilder-JUE.time_evaluation_constants_] 0.0009738480002852157
[GraphBuilder-JUE._build_initializers] start with 499 initializers, large_model=True, external_threshold=1024
[GraphBuilder-JUE._build_initializers] switch low/high order
[GraphBuilder-JUE._build_initializers] done in 3.35000004270114e-06s with 353 initializers, 341 large initializers
[GraphBuilder-JUE._add_shape_information] dynamic shapes replacements={&#39;seq_length&#39;: &#39;seq_length&#39;, &#39;batch&#39;: &#39;batch&#39;, &#39;cache_length&#39;: &#39;cache_length&#39;, &#39;s1&#39;: &#39;batch&#39;, &#39;s60&#39;: &#39;batch&#39;, &#39;s43&#39;: &#39;batch&#39;, &#39;s47&#39;: &#39;batch&#39;, &#39;s39&#39;: &#39;batch&#39;, &#39;s69&#39;: &#39;batch&#39;, &#39;s91&#39;: &#39;batch&#39;, &#39;batch^s3^batch^s41&#39;: &#39;batch&#39;, &#39;s93&#39;: &#39;batch&#39;, &#39;batch^s98^batch^s79&#39;: &#39;batch&#39;, &#39;batch^s92^batch^s83&#39;: &#39;batch&#39;, &#39;batch^s84^batch^s91&#39;: &#39;batch&#39;, &#39;s61&#39;: &#39;batch&#39;, &#39;s30&#39;: &#39;batch&#39;, &#39;batch^s45^batch^s47&#39;: &#39;batch&#39;, &#39;batch^s30^batch^s89&#39;: &#39;batch&#39;, &#39;s64&#39;: &#39;batch&#39;, &#39;batch^s49^batch^s26&#39;: &#39;batch&#39;, &#39;s56&#39;: &#39;batch&#39;, &#39;s106&#39;: &#39;batch&#39;, &#39;batch^s35^batch^s60&#39;: &#39;batch&#39;, &#39;batch^s64^batch^s86&#39;: &#39;batch&#39;, &#39;s90&#39;: &#39;batch&#39;, &#39;s79&#39;: &#39;batch&#39;, &#39;s77&#39;: &#39;batch&#39;, &#39;batch^s97^batch^s10&#39;: &#39;batch&#39;, &#39;s13&#39;: &#39;batch&#39;, &#39;s87&#39;: &#39;batch&#39;, &#39;s62&#39;: &#39;batch&#39;, &#39;batch^s39^batch^s71&#39;: &#39;batch&#39;, &#39;s3&#39;: &#39;batch&#39;, &#39;batch^s82^batch^s62&#39;: &#39;batch&#39;, &#39;s41&#39;: &#39;batch&#39;, &#39;s59&#39;: &#39;batch&#39;, &#39;batch^s52^batch^s93&#39;: &#39;batch&#39;, &#39;s35&#39;: &#39;batch&#39;, &#39;s72&#39;: &#39;batch&#39;, &#39;s23&#39;: &#39;batch&#39;, &#39;s52&#39;: &#39;batch&#39;, &#39;s100&#39;: &#39;batch&#39;, &#39;s36&#39;: &#39;batch&#39;, &#39;s49&#39;: &#39;batch&#39;, &#39;s48&#39;: &#39;batch&#39;, &#39;batch^s34^batch^s77&#39;: &#39;batch&#39;, &#39;batch^s104^batch^s106&#39;: &#39;batch&#39;, &#39;s104&#39;: &#39;batch&#39;, &#39;s57&#39;: &#39;batch&#39;, &#39;s8&#39;: &#39;batch&#39;, &#39;s86&#39;: &#39;batch&#39;, &#39;s102&#39;: &#39;batch&#39;, &#39;s89&#39;: &#39;batch&#39;, &#39;batch^s29^batch^s8&#39;: &#39;batch&#39;, &#39;s29&#39;: &#39;batch&#39;, &#39;s83&#39;: &#39;batch&#39;, &#39;s98&#39;: &#39;batch&#39;, &#39;batch^s87^batch^s23&#39;: &#39;batch&#39;, &#39;s97&#39;: &#39;batch&#39;, &#39;s67&#39;: &#39;batch&#39;, &#39;batch^s1^batch^s75&#39;: &#39;batch&#39;, &#39;s84&#39;: &#39;batch&#39;, &#39;batch^s69^batch^s56&#39;: &#39;batch&#39;, &#39;s45&#39;: &#39;batch&#39;, &#39;batch^s48^batch^s59&#39;: &#39;batch&#39;, &#39;s26&#39;: &#39;batch&#39;, &#39;batch^s67^batch^s61&#39;: &#39;batch&#39;, &#39;s82&#39;: &#39;batch&#39;, &#39;batch^s90^batch^s57&#39;: &#39;batch&#39;, &#39;s71&#39;: &#39;batch&#39;, &#39;batch^s36^batch^s13&#39;: &#39;batch&#39;, &#39;s10&#39;: &#39;batch&#39;, &#39;s34&#39;: &#39;batch&#39;, &#39;s92&#39;: &#39;batch&#39;, &#39;s75&#39;: &#39;batch&#39;, &#39;batch^s100^batch^s102&#39;: &#39;batch&#39;, &#39;s70&#39;: &#39;seq_length&#39;, &#39;s42&#39;: &#39;cache_length&#39;, &#39;s65&#39;: &#39;cache_length&#39;, &#39;s101&#39;: &#39;cache_length&#39;, &#39;s76&#39;: &#39;cache_length&#39;, &#39;s31&#39;: &#39;cache_length&#39;, &#39;s28&#39;: &#39;cache_length&#39;, &#39;s63&#39;: &#39;cache_length&#39;, &#39;s85&#39;: &#39;cache_length&#39;, &#39;s105&#39;: &#39;cache_length&#39;, &#39;s88&#39;: &#39;cache_length&#39;, &#39;s99&#39;: &#39;cache_length&#39;, &#39;s96&#39;: &#39;cache_length&#39;, &#39;s95&#39;: &#39;cache_length&#39;, &#39;s14&#39;: &#39;cache_length&#39;, &#39;s18&#39;: &#39;cache_length&#39;, &#39;s46&#39;: &#39;cache_length&#39;, &#39;s11&#39;: &#39;cache_length&#39;, &#39;s66&#39;: &#39;cache_length&#39;, &#39;s50&#39;: &#39;cache_length&#39;, &#39;s55&#39;: &#39;cache_length&#39;, &#39;s81&#39;: &#39;cache_length&#39;, &#39;s27&#39;: &#39;cache_length&#39;, &#39;s38&#39;: &#39;cache_length&#39;, &#39;s51&#39;: &#39;cache_length&#39;, &#39;s40&#39;: &#39;cache_length&#39;, &#39;s21&#39;: &#39;cache_length&#39;, &#39;s54&#39;: &#39;cache_length&#39;, &#39;s37&#39;: &#39;cache_length&#39;, &#39;s73&#39;: &#39;cache_length&#39;, &#39;s2&#39;: &#39;cache_length&#39;, &#39;s58&#39;: &#39;cache_length&#39;, &#39;s25&#39;: &#39;cache_length&#39;, &#39;s107&#39;: &#39;cache_length&#39;, &#39;s68&#39;: &#39;cache_length&#39;, &#39;s44&#39;: &#39;cache_length&#39;, &#39;s15&#39;: &#39;cache_length&#39;, &#39;s32&#39;: &#39;cache_length&#39;, &#39;s33&#39;: &#39;cache_length&#39;, &#39;s22&#39;: &#39;cache_length&#39;, &#39;s94&#39;: &#39;cache_length&#39;, &#39;s103&#39;: &#39;cache_length&#39;, &#39;s9&#39;: &#39;cache_length&#39;, &#39;s4&#39;: &#39;cache_length&#39;, &#39;s78&#39;: &#39;cache_length&#39;, &#39;s74&#39;: &#39;cache_length&#39;, &#39;s7&#39;: &#39;cache_length&#39;, &#39;s80&#39;: &#39;cache_length&#39;, &#39;s24&#39;: &#39;cache_length&#39;}
[to_onnx] to_onnx done in 15.317917730000772s and 471 nodes, 353 initializers, 50 inputs, 49 outputs
-- done in 38.80732817199896
</pre></div>
</div>
</section>
<section id="onnx-generate">
<h3>onnx_generate<a class="headerlink" href="#onnx-generate" title="Link to this heading">¶</a></h3>
<p>Then we can call method generate for two tokens.
This function is part of <a class="reference internal" href="../api/index.html#module-onnx_diagnostic" title="onnx_diagnostic"><code class="xref py py-mod docutils literal notranslate"><span class="pre">onnx_diagnostic</span></code></a> but follows the implementation
seen earlier for a torch model.
Let’s ask first the function to return the session to avoid creating on the second call.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_res</span></a></a><span class="p">,</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/ort_session.html#onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" title="onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" class="sphx-glr-backref-module-onnx_diagnostic-helpers-ort_session sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/ort_session.html#onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" title="onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" class="sphx-glr-backref-module-onnx_diagnostic-helpers-ort_session sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">session</span></a></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_feeds</span></a></a> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/rt_helper.html#onnx_diagnostic.helpers.rt_helper.onnx_generate" title="onnx_diagnostic.helpers.rt_helper.onnx_generate" class="sphx-glr-backref-module-onnx_diagnostic-helpers-rt_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/rt_helper.html#onnx_diagnostic.helpers.rt_helper.onnx_generate" title="onnx_diagnostic.helpers.rt_helper.onnx_generate" class="sphx-glr-backref-module-onnx_diagnostic-helpers-rt_helper sphx-glr-backref-type-py-function"><span class="n">onnx_generate</span></a></a><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model_name</span></a></a><span class="p">,</span> <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputs</span><span class="o">.</span><span class="n">input_ids</span></a></a><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_session</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># And now the full answer.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- compute the answer with custom generate...&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span>
<a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a> <span class="o">=</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/rt_helper.html#onnx_diagnostic.helpers.rt_helper.onnx_generate" title="onnx_diagnostic.helpers.rt_helper.onnx_generate" class="sphx-glr-backref-module-onnx_diagnostic-helpers-rt_helper sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/rt_helper.html#onnx_diagnostic.helpers.rt_helper.onnx_generate" title="onnx_diagnostic.helpers.rt_helper.onnx_generate" class="sphx-glr-backref-module-onnx_diagnostic-helpers-rt_helper sphx-glr-backref-type-py-function"><span class="n">onnx_generate</span></a></a><span class="p">(</span>
    <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/ort_session.html#onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" title="onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" class="sphx-glr-backref-module-onnx_diagnostic-helpers-ort_session sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/ort_session.html#onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" title="onnx_diagnostic.helpers.ort_session.InferenceSessionForTorch" class="sphx-glr-backref-module-onnx_diagnostic-helpers-ort_session sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">session</span></a></a><span class="p">,</span> <a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputs</span><span class="o">.</span><span class="n">input_ids</span></a></a><span class="p">,</span> <span class="n">eos_token_id</span><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span></a></a><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><a href="https://docs.python.org/3/library/time.html#time.perf_counter" title="time.perf_counter" class="sphx-glr-backref-module-time sphx-glr-backref-type-py-function"><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span></a></a><span class="p">()</span> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">begin</span></a></a>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- done in </span><span class="si">{</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;onnx&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">duration</span></a></a><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output shape:&quot;</span><span class="p">,</span> <a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><a href="https://sdpython.github.io/doc/onnx-diagnostic/dev/api/helpers/index.html#onnx_diagnostic.helpers.string_type" title="onnx_diagnostic.helpers.string_type" class="sphx-glr-backref-module-onnx_diagnostic-helpers sphx-glr-backref-type-py-function"><span class="n">string_type</span></a></a><span class="p">(</span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a><span class="p">,</span> <span class="n">with_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_min_max</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- decode the answer...&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">text</span></a></a> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">batch_decode</span><span class="p">(</span><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputs</span></a></a><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- done.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">text</span></a></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>-- compute the answer with custom generate...
-- done in 1.6451467569968372
-- done.
output shape: T7s1x123[7,50285:A10138.878048780489]
-- decode the answer...
-- done.
def print_prime(n):
   &quot;&quot;&quot;
   Print all primes between 1 and n
   &quot;&quot;&quot;
   primes = []
   for num in range(2, n+1):
       is_prime = True
       for i in range(2, int(math.sqrt(num))+1):
           if num % i == 0:
               is_prime = False
               break
       if is_prime:
           primes.append(num)
   print(primes)

print_prime(20)
``
</pre></div>
</div>
</section>
</section>
<section id="plots">
<h2>Plots<a class="headerlink" href="#plots" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a></a> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class"><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span></a></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data</span></a></a><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>          duration
name
generate  3.005987
custom    4.376284
onnx      1.645147
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a></a> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a></a><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Time (s) comparison to generate a prompt.&quot;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a></a><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="matplotlib.axes.Axes" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a></a><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;plot_generate.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_generate_001.png" srcset="../_images/sphx_glr_plot_generate_001.png" alt="Time (s) comparison to generate a prompt." class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 55.258 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-technical-plot-generate-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/4abe8fbbba017df665a2860409951fa2/plot_generate.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_generate.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/181ca987a171a2871b13555e984753c6/plot_generate.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_generate.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/1e72670ba0dd2e333fc4236f8630465c/plot_generate.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">plot_generate.zip</span></code></a></p>
</div>
</div>
<p class="rubric">Related examples</p>
<div class="sphx-glr-thumbnails"><div class="sphx-glr-thumbcontainer" tooltip="This example applies what was illustrated l-plot-parallelized-reduction, reduction operations are sensitive to parallelization."><img alt="" src="../_images/sphx_glr_plot_layer_norm_discrepancies_thumb.png" />
<p><a class="reference internal" href="plot_layer_norm_discrepancies.html"><span class="doc">LayerNormalization implementation cannot be exchanged</span></a></p>
  <div class="sphx-glr-thumbnail-title">LayerNormalization implementation cannot be exchanged</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="Order of computation matters. 1 + 1e-20 - 1 != 1 - 1 + 1e-20 if the precision of the computation is taken into account. What an operator Gemm in onnxruntime, the most simple way to represent a linear neural layer."><img alt="" src="../_images/sphx_glr_plot_gemm_or_matmul_add_thumb.png" />
<p><a class="reference internal" href="plot_gemm_or_matmul_add.html"><span class="doc">Gemm or Matmul + Add</span></a></p>
  <div class="sphx-glr-thumbnail-title">Gemm or Matmul + Add</div>
</div><div class="sphx-glr-thumbcontainer" tooltip="This is a simple example of loop which cannot be efficiently rewritten with scan."><img alt="" src="../_images/sphx_glr_plot_simple_for_loop_thumb.png" />
<p><a class="reference internal" href="plot_simple_for_loop.html"><span class="doc">Export with loops</span></a></p>
  <div class="sphx-glr-thumbnail-title">Export with loops</div>
</div></div><p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="plot_gemm_or_matmul_add.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Gemm or Matmul + Add</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="plot_simple_for_loop.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Export with loops</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">From a LLM to processing a prompt</a><ul>
<li><a class="reference internal" href="#example-with-phi-1-5">Example with Phi 1.5</a></li>
<li><a class="reference internal" href="#eos-token-id">eos_token_id?</a></li>
<li><a class="reference internal" href="#custom-method-generate">Custom method generate</a></li>
<li><a class="reference internal" href="#method-generate-for-onnx-models">Method generate for onnx models</a><ul>
<li><a class="reference internal" href="#onnx-conversion">ONNX Conversion</a></li>
<li><a class="reference internal" href="#onnx-generate">onnx_generate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plots">Plots</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=65ed1ecc"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>